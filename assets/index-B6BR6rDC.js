const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeveloperPage-BMGO60jF.js","assets/vendor-CTtG1aUU.js","assets/auth-DqTHE5Ot.js","assets/caption-parsing-08ziiJls.js","assets/react-dom-DtOyD6e-.js","assets/Icons-BapQY1Uh.js","assets/language-db-CHnJe_TE.js","assets/Icons-ybeVSQkp.css","assets/locales-BbqYBiZD.js","assets/hls-CJm5oz2q.js","assets/TestView-BxxXwwET.js","assets/PlayerView-D7c7UoO3.js","assets/Settings-DddXXiO9.js"])))=>i.map(i=>d[i]);
import{an as Ae,ao as Ze,ap as Oe,aq as bo,r as c,j as e,ar as dt,as as Tl,at as Rl,c as z,au as Pl,av as is,aw as Ll,ax as Dl,ay as Ee,az as Al,aA as Ml,aB as yo,m as be,aC as _l,aD as Ol,aE as Bl,aF as Fl,aG as vo,n as xs,aH as wo,aI as nr,aJ as rr,aK as ar,a7 as jo,aL as Os,aM as vn,aN as $l,aO as re,aP as tt,aQ as ko,aR as Ul,i as Hl,aS as Vl,B as Ye,aT as No,aU as Wl,aV as ve,aW as Kl,aX as zl}from"./vendor-CTtG1aUU.js";import{u as Gl,a as ql,s as Yl,k as Ql,h as Xl,n as Jl,f as Zl,r as ec,p as tc,g as sc,b as nc,i as rc,z as ac,t as oc,c as ic,d as lc,j as cc,e as dc,l as uc,m as mc,o as hc,q as fc,v as pc,w as xc,x as gc,y as bc,A as yc,B as vc,C as wc,D as jc,E as kc,F as Nc,G as Sc,H as Cc,I as Ec,J as Ic,K as Tc,L as Rc,M as Pc,N as Lc,O as Dc,P as Ac,Q as Mc,R as _c,S as Oc,T as Bc,U as Fc,V as $c,W as Uc,X as Hc,Y as Vc,Z as Wc,_ as Kc,$ as zc}from"./locales-BbqYBiZD.js";import{g as Nr,a as yt,I as M,b as k,U as xt,c as ke,d as on,F as So,s as Gc}from"./Icons-BapQY1Uh.js";import{i as qc,T as Yc,u as Sr,a as Dt,q as ta,r as Qc,F as Xc,b as q,c as Jc,L as vt,d as pe,e as rt,f as Co,g as ls,D as Eo,h as Io,j as To,k as Ro,S as Po,v as Lo,l as Do,s as Ao,K as Mo,M as _o,m as Oo,n as Bo,I as ot,o as Cr,p as Fo,t as Zc,w as $o,x as Uo,y as wn,_ as ed,z as td,A as sd,B as nd,C as rd,H as ad}from"./react-dom-DtOyD6e-.js";import{f as mt}from"./auth-DqTHE5Ot.js";import"./language-db-CHnJe_TE.js";import{d as od,f as id,g as jn,h as Ho,l as ld,s as cd,F as dd}from"./caption-parsing-08ziiJls.js";import{H as ut}from"./hls-CJm5oz2q.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();let ge=function(t){return t.MOVIE="movie",t.SERIES="series",t.ANIME="anime",t}({}),Nt=0;const me=Ae(Ze(Oe(t=>({bookmarks:{},updateQueue:[],removeBookmark(s){t(n=>{Nt+=1,n.updateQueue.push({id:Nt.toString(),action:"delete",tmdbId:s}),delete n.bookmarks[s]})},addBookmark(s){t(n=>{Nt+=1,n.updateQueue.push({id:Nt.toString(),action:"add",tmdbId:s.tmdbId,type:s.type,title:s.title,year:s.releaseYear,poster:s.poster}),n.bookmarks[s.tmdbId]={type:s.type,title:s.title,year:s.releaseYear,poster:s.poster,updatedAt:Date.now()}})},addBookmarkWithGroups(s,n){t(r=>{Nt+=1,r.updateQueue.push({id:Nt.toString(),action:"add",tmdbId:s.tmdbId,type:s.type,title:s.title,year:s.releaseYear,poster:s.poster,group:n}),r.bookmarks[s.tmdbId]={type:s.type,title:s.title,year:s.releaseYear,poster:s.poster,updatedAt:Date.now(),group:n}})},replaceBookmarks(s){t(n=>{n.bookmarks=s})},clear(){t(s=>{s.bookmarks={}})},clearUpdateQueue(){t(s=>{s.updateQueue=[]})},removeUpdateItem(s){t(n=>{n.updateQueue=[...n.updateQueue.filter(r=>r.id!==s)]})},toggleFavoriteEpisode(s,n,r){t(a=>{a.bookmarks[s]||(a.bookmarks[s]={title:(r==null?void 0:r.title)||"Unknown Show",type:"show",poster:r==null?void 0:r.poster,year:r==null?void 0:r.year,updatedAt:Date.now(),favoriteEpisodes:[]});const o=a.bookmarks[s];o.favoriteEpisodes||(o.favoriteEpisodes=[]);const i=o.favoriteEpisodes.indexOf(n);i>-1?o.favoriteEpisodes.splice(i,1):o.favoriteEpisodes.push(n),o.updatedAt=Date.now(),Nt+=1,a.updateQueue.push({id:Nt.toString(),action:"add",tmdbId:s,favoriteEpisodes:o.favoriteEpisodes})})},isEpisodeFavorited(s,n){var i;const a=me.getState().bookmarks[s];return((i=a==null?void 0:a.favoriteEpisodes)==null?void 0:i.includes(n))??!1},getFavoriteEpisodes(s){const n=me.getState().bookmarks[s];return(n==null?void 0:n.favoriteEpisodes)??[]}})),{name:"__MW::bookmarks"})),St={},Vo={};async function ud(){var t,s;for(const[n,r]of Object.values(Vo)){const a=r.versions.sort((m,u)=>m.version-u.version),o=n._raw(),i=o["--version"]&&typeof o["--version"]=="number"?o["--version"]:0,l=a.filter(m=>m.version>=i);let d=o;try{for(const m of l)m.migrate&&(localStorage.setItem(`BACKUP-v${m.version}-${r.key}`,JSON.stringify(d)),d=await m.migrate(d))}catch(m){console.error(`FAILED TO MIGRATE STORE ${r.key}`,m),d=((s=(t=l[l.length-1]).create)==null?void 0:s.call(t))??{}}n.save(d)}}function md(t){const s=t.key??"",n=t.versions.sort((l,d)=>d.version-l.version)[0];function r(l){return St[s]||(St[s]=[]),St[s].push(l),{destroy(){St[s]=St[s].filter(d=>d===l)}}}function a(){var d;const l=((d=n.create)==null?void 0:d.call(n))??{};return l["--version"]=n.version,l}function o(){const l=localStorage.getItem(s);if(!l)return a();try{return JSON.parse(l)}catch(d){return console.error(`FAILED TO PARSE LOCALSTORAGE FOR KEY ${s}`,d),a()}}function i(l){const d={...l};d["--version"]=n.version,localStorage.setItem(s,JSON.stringify(d)),St[s]||(St[s]=[]),St[s].forEach(m=>m(window.structuredClone(l)))}return{get(){const l=o();return delete l["--version"],l},_raw(){return o()},onChange:r,save:i}}function hd(t){var r;const s=t.versions.sort((a,o)=>a.version-o.version);if(s.forEach((a,o,i)=>{if(o!==0&&a.version!==i[o-1].version+1)throw new Error("Version list of store is not incremental")}),s.forEach(a=>{if(a.version<0)throw new Error("Versions cannot be negative")}),((r=s[0])==null?void 0:r.version)!==0)throw new Error("Version 0 doesn't exist in version list of store");if(!t.versions[t.versions.length-1].create)throw new Error("Missing create function on latest version of store");if(!t.key)throw new Error("storage key not set in store");const n=[...s];n.pop(),n.forEach(a=>{if(!a.migrate)throw new Error(`Migration missing on version ${a.version}`)})}function kn(){const t={versions:[],key:null};return{setKey(s){return t.key=s,this},addVersion(s){return t.versions.push(s),this},build(){hd(t);const s=md(t);return Vo[t.key??""]=[s,t],s}}}const fd={description:"P-Stream is a fork of movie-web that is ensured to stay up even after the shutdown of movie-web.app. P-Stream runs on a private, self-hosted VPS. I run this site at a loss; there are very minimal ads due to my beliefs in free media.",help:"Can't find an answer? <0>Get support here.</0>",faqTitle:"Common questions",searchPlaceholder:"Search FAQ...",sections:{general:"General",search:"Search & Content Availability",playback:"Playback Issues",connections:"Connections",language:"Language & Subtitle Settings"},q1:{title:"Where does the content come from?",body:"P-Stream does not host any content. When you click on something to watch, the internet is searched for the selected media (On the loading screen and in the 'video sources' tab you can see which source you're using). Media never gets uploaded by P-Stream, everything is through this searching mechanism.",section:"general"},q2:{title:"Where can I request a show or movie?",body:"It's not possible to request a show or movie, P-Stream does not manage any content. All content is viewed through sources on the internet.",section:"search"},q3:{title:"The search results display the show or movie, why can't I play it?",body:"Our search results are powered by The Movie Database (TMDB) and display regardless of whether our sources actually have the content.",section:"search"},q4:{title:"What about my data and stuff?",body:"All data is synced to the community backend, anyone is free to use this as well.",section:"general"},q5:{title:"How can I find out more?",body:"P-Stream has a Discord server that can be found at the header of this page!",section:"general"},q6:{title:"Is there a P-Stream app?",body:"Not yet, but you can install it as a PWA (Progressive Web App). On iOS, use Safari ‚Üí Share ‚Üí Add to Home Screen. On Android, use Chrome ‚Üí 3 dots ‚Üí Add to Home Screen. An experimental APK is available via our Discord, but it's not recommended.",section:"general"},q7:{title:"How do I make an account?",body:'Tap "Sync to Cloud" in the dropdown menu or go to Settings to create and sync a community account.',section:"general"},q9:{title:"This media is missing / Can I request media?",body:"No‚Äîsince we don't host content, we cannot add or change what's available. The content list is based on what's publicly accessible through the search mechanism.",section:"search"},q10:{title:"I can't find the movie/show I'm searching for!",body:"TMDB powers our search. Try tapping the üîé icon for advanced search options if results aren't accurate.",section:"search"},q11:{title:"Why am I seeing a black screen?",body:"Likely a corrupt or broken video file. Try switching sources.",section:"playback"},q12:{title:"The episode I'm watching is incorrect.",body:"Switch to a different source. We don't control any content or episode accuracy.",section:"playback"},q13:{title:"The video quality isn't what I expected.",body:"Try switching sources. Quality varies by provider; FED API often offers more options.",section:"playback"},q14:{title:"4K isn't available.",body:"If 4K is not shown, it's likely unavailable from that source.",section:"playback"},q15:{title:"Why is there no audio?",body:"Ensure your device isn't muted and try switching sources. Audio issues may be source-specific.",section:"playback"},q16:{title:"The video is tinted or washed out.",body:"Could be a faulty file or an HDR video. Ensure your device supports HDR, or switch sources.",section:"playback"},q17:{title:"I'm experiencing visual glitches.",body:"Visual bugs usually come from poor file uploads. Try switching sources.",section:"playback"},q18:{title:"The source is loading slowly.",body:"Speed depends on the hosting site. Switch to another source for better performance.",section:"playback"},q19:{title:"How do I switch sources?",body:'While playing, tap the ‚öôÔ∏è icon, then choose another source under "video sources".',section:"playback"},q20:{title:"What is FED API?",body:"FED API is our private scraper that pulls streams directly from Febbox. Each free Febbox account includes 100 GB/month of unlimited bandwidth, and we use your UI token to scrape content as if you're watching it yourself. Setup is easiest via desktop browser, but mobile instructions are available on our Discord.",section:"connections"},q21:{title:"Does FED API work on all devices?",body:"Yes. Once set up, your token works across all logged-in devices.",section:"connections"},q22:{title:"Why do I need the extension or custom proxy?",body:"Some sources block scrapers. The extension acts like a local proxy and bypasses such blocks using your IP, headers, and cookies.",section:"connections"},q23:{title:"What is the extension? Is it safe?",body:"It's a local proxy tool used to access streams that restrict scrapers. It mimics your browsing session. It's also completly opensource and can be found on our github.",section:"connections"},q24:{title:"My febbox token fails during setup. What should I do?",body:"Your ISP might be blocking FED API. Set a custom DNS like 1.1.1.1 or NextDNS. You can also change your region in the admin panel.",section:"connections"},q25:{title:"How do I change languages?",body:"We prioritize English, but some sources offer other languages. Try switching sources. For FED API, only Safari supports audio switching in MP4 files.",section:"language"},q26:{title:"My subtitles aren't in sync.",body:'Use the "Customize" option in subtitle settings or tap [ and ] on your keyboard to adjust. You can also upload your own subtitle file.',section:"language"},title:"About P-Stream and FAQ (^‚ñΩ^)"},pd={copied:"Copied",copy:"Copy",cancel:"Cancel",confirm:"Confirm"},xd={createAccount:"Don't have an account yet üò¨ <0>Create an account.</0>",deviceNameLabel:"Device name",deviceNamePlaceholder:"Personal phone",generate:{description:"Your passphrase acts as your username and password. Make sure to keep it safe as you will need to enter it to login to your account. <bold>Do NOT lose your passphrase!</bold>",next:"I have saved my passphrase",passphraseFrameLabel:"Passphrase",title:"Your passphrase",custom:"Custom",customPassphraseLabel:"Custom Passphrase",customPassphrasePlaceholder:"Enter your custom passphrase",useCustomPassphrase:"Use Custom Passphrase",invalidPassphraseCharacters:"Invalid passphrase characters. Only English letters, numbers 1-10, and normal symbols are allowed.",passphraseTooShort:"Passphrase must be at least 8 characters long."},hasAccount:"Already have an account? <0>Login here.</0>",login:{description:"Please enter your passphrase to login to your account",deviceLengthError:"Please enter a device name",passphraseLabel:"12-Word passphrase",passphrasePlaceholder:"Passphrase",submit:"Login",title:"Login to your account",validationError:"Incorrect or incomplete passphrase /·ê†. .·êü\\"},register:{information:{color1:"Profile color one",color2:"Profile color two",header:"Enter a name for your device then pick colors and a user icon of your choosing!",icon:"User icon",next:"Next",title:"Account information"}},trust:{failed:{text:"Did you configure it correctly?",title:"Failed to reach server"},noHostTitle:"Server not configured!",noHost:"The server has not been configured, therefore you cannot create an account",host:"You are connecting to <0>{{hostname}}</0> - please confirm you trust it before making an account...",no:"Go back",title:"Do you trust this server?",yes:"I trust this server ü§û"},verify:{description:"Please enter your passphrase from earlier to confirm you have saved it and to create your account",invalidData:"Data is not valid",noMatch:"Passphrase doesn't match üò≠",passphraseLabel:"Your 12-word passphrase",recaptchaFailed:"ReCaptcha validation failed",register:"Create account",title:"Confirm your passphrase"}},gd={badge:"It broke üíÄ",details:"Error details",reloadPage:"Reload the page",showError:"Show error details",title:"We encountered an error!"},bd={legal:{disclaimer:"Disclaimer ‚óù(·µî·µï·µî)‚óú",disclaimerText:"Please note: P-Stream does not host any files itself but instead only display's content from 3rd party providers. Legal issues should be taken up with them."},links:{discord:"Discord",legal:"Legal / DMCA",github:"GitHub",twitter:"Twitter",funding:"Support us"},tagline:"Watch your favorite shows and movies for free with no ads ever! („Å£'„ÉÆ'c)"},yd={name:"P-Stream",pages:{about:"About and FAQ",legal:"Legal / DMCA",discover:"Discover",support:"Support",login:"Login",onboarding:"Setup",pagetitle:"{{title}} - P-Stream",register:"Register",settings:"Settings",migration:"Migrate Account",jip:"Jip"}},vd={bookmarks:{sectionTitle:"Bookmarks",showAll:"Show all",groups:{dropdown:{placeholderButton:"Add to group",empty:"No groups yet",addButton:"Add",removeFromGroup:"Remove from group",removeAll:"Remove all"},reorder:{button:"Reorder",done:"Done",title:"Edit Group Order",description:"Drag and drop to reorder your bookmark groups",cancel:"Cancel",save:"Save"}}},continueWatching:{sectionTitle:"Continue Watching..."},mediaList:{stopEditing:"Stop editing"},search:{allResults:"That's all we have...",failed:"Failed to find media, try again!",loading:"Loading...",noResults:"We couldn't find anything :(",placeholder:{default:"What do you want to watch?",extra:["What are you in the mood for?","Should we delete your browser history?","What do you want to stream?","P-Stream is the best site ever!","What's on your watchlist today?","How was your day?","My bad the site never works...","Isn't P-Stream just the best?",">·¥ó<"]},empty:{default:"Welcome, find media to watch here!",extra:["There's nothing here :(","So empty...","Such emptiness.","Hi new user :3"]},sectionTitle:"Search results",discoverMore:"Discover more",discover:"Discover"},mediaCard:{moreInfo:"More Info",copyLink:"Copy Link",close:"Close"},titles:{69:{default:"Up for something spicy?",extra:["Happy 69 day üòò!"]},420:{default:"What would you like to watch this 4/20?",extra:["Happy 4/20 ü•≥!"]},day:{default:"What would you like to watch this afternoon?",extra:["Viva la P-Stream!"]},morning:{default:"What would you like to watch this morning?",extra:["Viva la P-Stream!"]},night:{default:"What would you like to watch tonight?",extra:["Viva la P-Stream!"]},halloween:{default:"What spooky movie would you like to watch this Halloween?",extra:["Happy Halloween! üéÉüëª","Boo! üëª","Trick or treat! üç¨","It's the Great Pumpkin, Charlie Brown!"]}}},wd={episodeDisplay:"S{{season}} - E{{episode}}",unreleased:"Unreleased",types:{movie:"Movie",show:"Show"},episodeShort:"E",seasonShort:"S",seasonWatched:"Are you sure you want to mark the season as watched?",seasonUnwatched:"Are you sure you want to mark the season as unwatched?"},jd={resume:"Resume",play:"Play",runtime:"Runtime:",language:"Language:",releaseDate:"Release Date:",rating:"Rating:",votes:"votes",tmdb:"View on TMDB",imdb:"View on IMDb",episodes:"Episodes",seasons:"Season/s",season:"Season",episode:"Episode",airs:"Airs",endsAt:"Ends at {{time}}",trailer:"Trailer"},kd={loginRequired:"You must be logged in to migrate your data! Please go back and login to continue.",start:{title:"Migrate your data",explainer:"If you wish to migrate or backup your data, you can do so using the options below. This will allow you to keep your data when you switch backend servers.",options:{or:"or",direct:{description:"This will directly migrate your data to the new server. This is the fastest option. <br /><br />This option allows you to keep your passphrase the same!",title:"Direct migration",quality:"Easiest and fastest",action:"Transfer data"},download:{description:"This will download your data to your device. You can then upload it to the new server or just keep it for safekeeping.",title:"Download data",quality:"More technical",action:"Download data"},upload:{title:"Upload Data",description:"Upload your previously exported data file to restore your bookmarks and progress on this account.",quality:"Restore from backup",action:"Upload Data"}}},direct:{title:"Direct migration",description:"Enter the destination backend URL to migrate your current account data to a new backend. This keeps your passphrase the same!",backendLabel:"Destination Backend URL",recaptchaLabel:"ReCaptcha Key (Optional)",toggleLable:"Needs ReCaptcha?",status:{error:"Failed to migrate your data. üòø",success:"Your data has been migrated successfully! üéâ"},button:{migrate:"Migrate",processing:"Processing...",home:"Go home",login:"Continue to login"}},download:{title:"Download data",description:"This will download your data to your device. You can then upload it to the new server or just keep it for safekeeping.",items:{description:"Download includes:",bookmarks:"Bookmarked media",progress:"Watch progress"},status:{error:"Failed to download your data. üòø",success:"Your data has been downloaded successfully! üéâ"},button:{download:"Download data",home:"Go home",login:"Continue to login"}},upload:{title:"Upload data",description:"Upload your previously exported data file to restore your bookmarks and progress on this account.",status:{processing:"Processing data...",error:"Failed to upload your data. üòø",success:"Your data has been uploaded successfully! üéâ",successLocal:"Your data has been saved locally! üéâ"},file:{description:"Select the file you want to upload",select:"Select file",change:"Change file",name:"File name"},dataPreview:"Preview:",items:{bookmarks:"Bookmarked media",progress:"Watch progress"},exportedOn:"Exported on",button:{import:"Import data",processing:"Processing...",success:"Import complete",home:"Continue to home",saveLocal:"Save locally"}},back:"Go back"},Nd={banner:{offline:"Check your internet connection, silly goose! ü¶¢"},menu:{about:"About and FAQ",logout:"Log out",register:"Sync to Cloud",settings:"Settings",support:"Support",discover:"Discover",development:"Development"}},Sd={badge:"Not found",goHome:"Back to home",reloadButton:"Try again",message:"We looked everywhere: under the bins, in the closet, behind the proxy, but ultimately couldn't find the page you are looking for. (‡≤•Ôπè‡≤•)",title:"Couldn't find that page"},Cd={badge:"Issues",goHome:"Go home",message:"P-Stream is experiencing issues with some providers again, if you cant find or play a show please change the source. Expect this error to persist throughout the below times.",title:"Provider issues"},Ed={defaultConfirm:{cancel:"Cancel",confirm:"Use default setup",description:"The default setup does not have the best streams. You'll be missing out on the best sources!",title:"Are you sure?"},extension:{back:"Go back",explainer:"Using the browser extension, you can get the best streams we have to offer. With just a simple install. üëå",explainerIos:"Unfortunately, the browser extension is not supported on iOS, Press <bold>Go back</bold> to choose another option.",extensionHelp:"If you've installed the extension but it's not detected, <bold>open the extension through your browsers extension menu</bold> and follow the steps on screen.",linkChrome:"Install Chrome extension",linkFirefox:"Install Firefox extension",notDetecting:"Installed on Chrome, but the site isn't detecting it? Try reloading the page!",notDetectingAction:"Reload page",status:{disallowed:"Extension is not enabled for this page (,,>Ôπè<,,)",disallowedAction:"Enable extension",failed:"Failed to request status",loading:"Waiting for you to install the extension",outdated:"Extension version too old",success:"Extension is working as expected!"},submit:"Continue",title:"Let's start with an extension"},proxy:{back:"Go back",explainer:"With the proxy method, you can get great quality streams by making a self-service proxy.",input:{errorConnection:"Could not connect to proxy",errorInvalidUrl:"Not a valid URL",errorNotProxy:"Expected a proxy but got a website",label:"Proxy URL",placeholder:"https://"},link:"Learn how to make a proxy",submit:"Submit proxy",title:"Let's make a new proxy"},start:{explainer:"To get the best streams possible, you will need to choose which streaming method you want to use.",moreInfo:{button:"More info",title:"Understanding a setup",explainer:{intro:"P-Stream doesn't host videos. It relies on third-party websites for content, so you need to choose how it connects to those sites.",options:"Your Options:",extension:"1. Extension",extensionDescription:"The extension gives you access to the most sources. It acts as a local proxy and can handle sites that need special cookies or headers to load.",proxy:"2. Proxy",proxyDescription:"The proxy scrapes media from other websites. It bypasses browser restrictions (like CORS) to allow scraping.",default:"3. Default Setup",defaultDescription:"Uses P-Stream's built-in proxy. It's the easiest option but might be slower due to shared bandwidth.",fedapi:{fedapi:"Additional: Febbox token",fedapiDescription:"Bring your own FREE Febbox account to gain access to FED API and CIA API, the best sources with 4K quality, Dolby Atmos, skip intro and the fastest load times! Highly recommended option!"},outro:"If you have more questions on how this works, feel free to ask on the <0>P-Stream Discord</0> server!"},recommended:{title:"Not sure what to choose?",subtitle:"Recommended Configurations:",desktop:{title:"Desktop:",description:"Extension + Febbox token"},iOS:{title:"iOS:",description:"Custom proxy + Febbox token"},android:{title:"Android:",description:"Extension + Febbox token"}}},options:{or:"or",default:{text:"I don't want good quality streams, use the default setup."},extension:{action:"Install extension",description:"Install browser extension and gain access to additional sources! Remember to enable it for this site.",quality:"Best quality + More Sources",title:"Browser extension"},proxy:{action:"Setup proxy",description:"Setup a free proxy in just 5 minutes! Improves loading reliability!",quality:"Good quality",title:"Custom proxy"}},title:"Let's get you setup with P-Stream ü•≥"}},Id={close:"Close"},Td={back:{default:"Back to home",short:"Back"},casting:{to:"Casting to {{device}} üì∫",device:"device",enabled:"Casting to device üé¨"},menus:{downloads:{button:"Atempt download",hlsDownloader:"Or, go to the <0>hls downloader website</0> and paste the playlist URL from below.",disclaimer:"Downloads are taken directly from the provider. P-Stream does not have control over how the downloads are provided.",copyHlsPlaylist:"Copy HLS playlist link",downloadSubtitle:"Download current subtitle",downloadVideo:"Download video",openIn:"Open in...",vlc:"VLC",iina:"IINA",outplayer:"Outplayer",hlsOpenInDisclaimer:"Opening HLS streams in an external player MAY NOT WORK!",hlsDisclaimer:"Downloads are taken directly from the provider. P-Stream does not have control over how the downloads are provided.<br /><br />Please note you are downloading an HLS playlist, <bold>it is not recommended to download if you are not familiar with advanced streaming formats</bold>. Try different sources for different formats.",onAndroid:{1:"To download on Android, click the download button then, on the new page, <bold>tap and hold</bold> on the video, then select <bold>save</bold>.",shortTitle:"Download / Android",title:"Downloading on Android"},onIos:{1:"To download on iOS, click the download button then, on the new page, click <bold><ios_share /></bold>, then <bold>Save to Files <ios_files /></bold>.",shortTitle:"Download / iOS",title:"Downloading on iOS"},onPc:{1:"On PC, click the download button then, on the new page, right click the video and select <bold>Save video as</bold>",shortTitle:"Download / PC",title:"Downloading on PC"},title:"Download"},episodes:{button:"Episodes",emptyState:"There are no episodes in this season, check back later (sorry :3)...",episodeBadge:"E{{episode}}",loadingError:"Error loading season",loadingList:"Loading...",loadingTitle:"Loading...",unairedEpisodes:"One or more episodes in this season have been disabled because they haven't been aired yet.",seasons:"Seasons",showMore:"Show more",showLess:"Show less",markAsWatched:"Mark as watched",markAsUnwatched:"Mark as unwatched",markAsFavorite:"Mark as favorite",favorites:"Favorites",noFavorites:"No favorite episodes yet. Star episodes to add them to your favorites!"},playback:{speedLabel:"Playback speed",title:"Playback settings",disabled:"(Disabled in watch party)",speedBoosted:"2x",speedUnboosted:"{{speed}}x"},quality:{automaticLabel:"Automatic quality",hint:"You can try <0>switching source</0> to get different quality options.",iosNoQuality:"Due to Apple-defined (common IOS L) limitations, quality selection is not available on iOS for this source. You can try <0>switching to another source</0> to get different quality options.",title:"Quality",auto:"Auto"},settings:{downloadItem:"Download",enableSubtitles:"Enable Subtitles",experienceSection:"Viewing experience",playbackItem:"Playback settings",audioItem:"Audio",qualityItem:"Quality",sourceItem:"Source",subtitleItem:"Subtitles",videoSection:"Video settings"},sources:{failed:{text:"There was an error while trying to find any videos... Try a different source?",title:"Failed to scrape"},noEmbeds:{text:"We were unable to find any embeds, please try a different source.",title:"No embeds found"},noStream:{text:"This source has no streams for this movie or show. /·ê† - Àï -„Éû ‚≥ä",title:"No stream :("},title:"Sources",unknownOption:"Unknown",editOrder:"Edit order"},subtitles:{customChoice:"Drop or upload file",customizeLabel:"Customize",previewLabel:"Subtitle preview:",offChoice:"Off",onChoice:"On",SourceChoice:"Source Subtitles",OpenSubtitlesChoice:"External Subtitles",loadingExternal:"Loading external subtitles...",settings:{backlink:"Custom subtitles",delay:"Subtitle delay",fixCapitals:"Fix capitalization"},title:"Subtitles",unknownLanguage:"Unknown",dropSubtitleFile:"Drop subtitle file here! >_<",scrapeButton:"Scrape subtitles",refresh:"Refresh External Subtitles",refreshing:"Refreshing...",empty:"There are no provided subtitles for this.",notFound:"None of the available options match your query",useNativeSubtitles:"Use native video subtitles",useNativeSubtitlesDescription:"May fix subtitles when casting and in PiP",delayLate:"Heard audio",delayEarly:"Saw caption"},watchparty:{watchpartyItem:"Watch Party",notice:"Legacy Watch Party might not be available for some sources",legacyWatchparty:"Use legacy Watch Party"},audio:{default:"Default"}},metadata:{api:{text:"Could not load API metadata, please check your internet connection.",title:"Failed to load API metadata"},legal:{badge:"Removed",text:"This media is no longer available due to a takedown notice or copyright claim. üò®",title:"Media has been removed"},extensionPermission:{badge:"Permission Missing",button:"Use extension",text:"You have the browser extension, but we need your permission to get started using the extension. (¬¨_¬¨)",title:"Configure the extension"},failed:{badge:"Failed",homeButton:"Go home",text:"Could not load the media's metadata from TMDB. Please check whether TMDB is down or blocked on your internet connection.",title:"Failed to load metadata"},notFound:{badge:"Not found",homeButton:"Back to home",text:"We couldn't find the media you requested. Either it's been removed or you tampered with the URL (naughty, naughty).",title:"Couldn't find that media."}},nextEpisode:{replay:"Replay",next:"Next episode",nextSeason:"Next season"},resume:{title:"Continue watching?",description:"This episode is {{percentage}}% watched",resume:"Resume",restart:"Restart"},playbackError:{badge:"Playback error",errors:{errorAborted:"The fetching of the media was aborted by the user's request.",errorDecode:"Despite having previously been determined to be usable, an error occurred while trying to decode the media resource, resulting in an error.",errorGenericMedia:"Unknown media error occurred.",errorNetwork:"Some kind of network error occurred which prevented the media from being successfully fetched, despite having previously been available.",errorNotSupported:"The media or media provider object is not supported."},copyDebugInfo:"Copy debug info",debugInfo:"Check console for more details.",homeButton:"Go home",text:"There was an error trying to play the media üòñ. Please try again or try a different source!",title:"Failed to play video!"},scraping:{items:{failure:"Error occurred",notFound:"Doesn't have the video (‚ï•Ôπè‚ï•)",pending:"Checking for videos..."},notFound:{badge:"Not found",detailsButton:"Show details",homeButton:"Go home",discoverButton:"Discover more",text:"We have searched through our providers and cannot find the media you are looking for! We do not host the media and have no control over what is available. Please click 'Show details' below for more details.",title:"We couldn't find that",onboarding:"More sources might be avalible using the extension or febbox token!",onboardingButton:"Do setup again"},extensionFailure:{badge:"Extension disabled",homeButton:"Go home",enableExtension:"Enable extension",title:"Please enable the extension",text:"You've installed the P-Stream extension. To start using it, you need to enable the extension for this site."},tips:{1:"Tap the gear icon to switch sources!",2:"Tap the title to copy the link!",3:"Tap and hold or hold SHIFT to show widescreen button instead of fullscreen!",4:"Some sources work better than others!",5:"Get the extension for more sources!",6:"Hold bookmarks to edit or delete them!",7:"Hold SHIFT and tap the title to copy the link with time!",8:"Set a custom subtitle color!",9:"Migrate your account to a new backend in settings!",10:"Join the Discord!",11:"Use [ and ] to adjust subtitle timing!",12:"Press SPACE or K to play/pause!",13:"Use LEFT and RIGHT arrow keys to skip 5 seconds!",14:"Use J and L keys to skip 10 seconds!",15:"Press F to toggle fullscreen!",16:"Press M to toggle mute!",17:"Use UP and DOWN arrows to change volume!",18:"Press < and > to change playback speed!",19:"Press . and , to move frame by frame when paused!",20:"Press C to toggle subtitles!",21:"Press R to do a barrel roll!"}},time:{regular:"{{timeWatched}} / {{duration}}",remaining:"{{timeLeft}} left ‚Ä¢ Finish at {{timeFinished, datetime}}",shortRegular:"{{timeWatched}}",shortRemaining:"-{{timeLeft}}"},turnstile:{description:"Please prove your humanity by completing the quick challenge, this is to keep P-Stream safe.",error:"Failed to verify your humanity - stream failed to load. Clear your cache and try again, or switch to a different source (tap the gear).",title:"Are You a Robot ü§ñ?",verifyingHumanity:"Verifying your humanity... (^‚ñΩ^)üëç"}},Rd={title:"Support",text:"P-Stream is designed to be as user-friendly as possible. However, people still have questions and issues. This page is here to help resolve these shortcomings",q1:{body:"Well, you can join the official <0>P-Stream discord</0> and ask questions there or you can email the one provided at the bottom of this page.",title:"Where can I get help?"},q2:{body:"We have a <0>GitHub</0> where you can create a detailed issue in our repository. Additionally, if you wish, you can create a pull request to fix the issue yourself.",title:"How can I report a bug or issue?"}},Pd={title:"Jip",text:"P-Stream didn't fall out of a coconut tree, it was made mostly by a single person (a very epic one at that).",q1:{body:"Well, you can join the official <0>P-Stream discord</0> and ask questions there or you can email the one provided at the bottom of this page.",title:"Where can I get help?"},q2:{body:"We have a <0>GitHub</0> where you can create a detailed issue in our repository. Additionally, if you wish, you can create a pull request to fix the issue yourself.",title:"How can I report a bug or issue?"}},Ld={legal:{title:"Legal / DMCA"},loadingApp:"Loading application",loadingUser:"Loading your profile",loadingUserError:{logout:"Logout",reset:"Reset custom server",text:"Failed to load your profile",reload:"Reload",textWithReset:"Failed to load your profile from your custom server, want to reset back to the default server?"},migration:{failed:"Failed to migrate your data. üòø",inProgress:"Please hold, we are migrating your data. This shouldn't take long..."}},Dd={search:{placeholder:"Search settings..."},account:{accountDetails:{deviceNameLabel:"Device name",deviceNamePlaceholder:"Personal phone",editProfile:"Edit",logoutButton:"Log out"},admin:{title:"Admin panel",text:"Test P-Stream's condition."},actions:{delete:{button:"Delete account",confirmButton:"Delete account",confirmDescription:"Are you sure you want to delete your account? All your data will be lost! ‡´Æ‚ÇçÀ∂√ìÔπè√í ‚ëÖ‚Çé·Éê",confirmTitle:"Are you sure?",text:"This action is irreversible. All data will be deleted and nothing can be recovered.",title:"Delete account"},migration:{title:"Account migration",text:"Migrate your account to a new server or download your data.",button:"Migrate account"},title:"Actions",logoutAllDevices:{title:"End All Sessions",text:"This will sign you out from all devices linked to your account.",button:"Log Out of All Devices"}},devices:{deviceNameLabel:"Device name",failed:"Failed to load sessions",removeDevice:"Remove",title:"Devices"},profile:{finish:"Finish editing",firstColor:"Profile color one",secondColor:"Profile color two",title:"Edit profile picture",userIcon:"User icon"},register:{cta:"Get started",text:"Share your watch progress between devices and keep them synced. ( Ãß‚∏ù‚∏ù‚ç¢‚∏ù‚∏ù)‡∑Ü",title:"Sync to the Cloud"},title:"Account"},appearance:{activeTheme:"Active",themes:{blue:"Blue",default:"Default",gray:"Gray",red:"Red",teal:"Teal",classic:"Classic",green:"Green",mocha:"Mocha",pink:"Pink",noir:"Noir",ember:"Ember",acid:"Acid",spark:"Spark",grape:"Grape",spiderman:"Spiderman",forest:"Forest",wolverine:"Wolverine",popsicle:"Popsicle",hulk:"Hulk",autumn:"Autumn",skyrealm:"SkyRealm"},title:"Appearance",options:{discover:"Discover section",discoverDescription:"Show the Discover section on the Homepage below your bookmarked media. Enabled by default.",discoverLabel:"Discover section",featured:"Featured media",featuredDescription:"Show a carousel of featured movies and shows at the top of your homepage! Disabled by default.",featuredLabel:"Featured media",modal:"Details modal",modalDescription:"Show the details modal when you click on a media card instead of going to the watch page. Proxy or Extension required for trailer. Disabled by default.",modalLabel:"Details modal",logos:"Image logos",logosDescription:"Show image logos instead of text titles in the details modal and featured section. Enabled by default.",logosNotice:"Most of the time, logos are English only. Other languages might want to disable this!",logosLabel:"Image logos",carouselView:"Carousel view",carouselViewDescription:"Display your currently watching and bookmark sections as carousels instead of a grid. Disabled by default.",carouselViewLabel:"Carousel view",forceCompactEpisodeView:"Force compact episode view",forceCompactEpisodeViewDescription:'Force the episode carousel in the player to use the "classic" compact vertical view. Disabled by default.',homeSectionOrder:"Home section order",homeSectionOrderDescription:"Drag and drop to reorder the watching and bookmarks sections on your homepage. Group order can be editied from the home page.",forceCompactEpisodeViewLabel:"Compact episodes"},sections:{watching:"Currently Watching",bookmarks:"Bookmarks"}},connections:{server:{description:"If you would like to connect to a custom backend to store your data, enable this and provide the URL. <0>Instructions.</0>",label:"Custom server",urlLabel:"Custom server URL",migration:{description:"<0>Migrate my data</0> to a new server.",link:"Migrate my data"},documentation:"Backend documentation"},setup:{doSetup:"Do setup",errorStatus:{description:"It seems that one or more items in this setup need your attention.",title:"Something needs your attention üò±"},itemError:"There is something wrong with this setting. Go through setup again to fix it. (·¥ó_ ·¥ó„ÄÇ)",items:{default:"Default setup",extension:"Extension",proxy:"Custom proxy"},redoSetup:"Redo setup",successStatus:{description:"All things are in place for you to start watching your favorite media. (‡πë>‚ó°<‡πë)",title:"Everything is set up!"},unsetStatus:{description:"Please click the button to the right to start the setup process.",title:"You haven't gone through setup"}},title:"Connections",workers:{addButton:"Add new worker",description:"To make the application function, all traffic is routed through proxies. Enable this if you want to bring your own workers. <0>Instructions.</0>",documentation:"Proxy documentation",emptyState:"No workers yet (ÔΩ°‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄÔΩ°), add one below",label:"Use custom proxy workers",urlLabel:"Worker URLs",urlPlaceholder:"https://",proxyTMDB:{title:"Proxy TMDB",description:"Only needed if you can't access TheMovieDB directly, such as if your ISP blocks it. It is recomended to disable the Discover section to improve performance with this."}}},preferences:{title:"Preferences",language:"Application language",languageDescription:"Language applied to the entire application, only English has silly stuff üôÅ.",thumbnail:"Generate thumbnails",thumbnailDescription:"Most of the time, videos don't have thumbnails. You can enable this setting to generate them on the fly but they can make your video slower.",thumbnailLabel:"Generate thumbnails",autoplay:"Autoplay",autoplayDescription:"Automatically play the next episode in a series after reaching the end. Can be enabled by users with the browser extension, a custom proxy, or with the default setup if allowed by the host.",autoplayLabel:"Autoplay",skipCredits:"Skip End Credits",skipCreditsDescription:"When enabled, automatically play the next episode at 99% completion to skip end credits. When disabled, wait until the episode is fully completed.",skipCreditsLabel:"Skip end credits",lowPerformanceMode:"Low performance/bandwidth mode",lowPerformanceModeDescription:"Optimizes the application for slower connections and devices by disabling bandwidth-heavy features. This mode reduces data usage and improves performance while keeping the core search and watch functionality intact. ",lowPerformanceModeLabel:"Low performance mode",holdToBoost:"Hold to boost speed",holdToBoostDescription:"Hold spacebar or touch and hold the screen to temporarily increase playback speed to 2x. Release to return to previous speed.",holdToBoostLabel:"Enable hold to boost",doubleClickToSeek:"Double tap to seek",doubleClickToSeekDescription:"Double tap on the left or right side of the player to seek 10 seconds forward or backward.",doubleClickToSeekLabel:"Enable double tap to seek",sourceOrder:"Reordering sources",sourceOrderDescription:"Drag and drop to reorder sources. This will determine the order in which sources are checked for the media you are trying to watch. If a source is greyed out, it means the <bold>extension</bold> is required for that source. <br><br> <strong>(The default order is best for most users)</strong>",sourceOrderEnableLabel:"Custom source order",embedOrder:"Reordering embeds",embedOrderDescription:"Drag and drop to reorder embeds. This will determine the order in which embeds are checked for the media you are trying to watch. <br><br> <strong>(The default order is best for most users)</strong>",embedOrderEnableLabel:"Custom embed order",manualSource:"Manual source selection",manualSourceDescription:"Require picking a source before scraping. Disables automatic source selection and opens the source picker when starting playback.",manualSourceLabel:"Manual source selection"},reset:"Reset",save:"Save",sidebar:{info:{appVersion:"App version",backendUrl:"Backend URL",backendVersion:"Backend version",hostname:"Hostname",insecure:"Insecure",notLoggedIn:"You are not logged in",secure:"Secure",title:"App stats",unknownVersion:"Unknown",userId:"User ID"}},subtitles:{backgroundLabel:"Background opacity",backgroundBlurLabel:"Background blur",colorLabel:"Color",previewQuote:"Convinced life is meaningless, I lack the courage of my conviction.",textSizeLabel:"Text size",title:"Subtitles",textBoldLabel:"Bold text",verticalPositionLabel:"Vertical position",default:"Default",low:"Low",textStyle:{title:"Text style",default:"Default",raised:"Raised",depressed:"Depressed",uniform:"Uniform",dropShadow:"Drop Shadow"}},unsaved:"You have unsaved changes... ‡∏Ö^‚Ä¢Ôªå‚Ä¢^‡∏Ö"},Ad={tabs:{movies:"Movies",tvshows:"TV Shows",editorpicks:"Editor Picks"},carousel:{title:{loading:"Loading...",movies:"{{category}} Movies",tvshows:"{{category}} Shows",inCinemas:"In Cinemas",popular:"Most Popular",nowPlaying:"In Cinemas",topRated:"Top Rated",latestReleases:"Latest Releases","4kReleases":"4K Releases",onTheAir:"On The Air",latestTVReleases:"Latest TV Shows",popularOn:"Popular {{type}} on {{provider}}",editorPicksMovies:"Editor Picks Movies",editorPicksShows:"Editor Picks Shows",moviesOn:"Movies on {{provider}}",tvshowsOn:"Shows on {{provider}}",recommended:"Because You Watched: {{title}}",genreMovies:"{{genre}} Movies",genreShows:"{{genre}} Shows",categoryMovies:"{{category}} Movies",categoryShows:"{{category}} Shows"},change:"Change",more:"View more"},featured:{playNow:"Play Now",moreInfo:"More Info"},randomMovie:{button:"Watch Something Random",cancel:"Cancel Countdown",countdown:"{{countdown}}s",nowPlaying:"Now Playing",in:"in"},page:{title:"Discover Movies & TV",subtitle:"Explore the latest hits and timeless classics.",loadMore:"Load more",loading:"Loading...",back:"Go back"},viewLists:"View All Movie Lists",allLists:"All Movie Lists",scrollToTop:"Back to top"},Md={onboarding:{title:"Febbox token",description:"Bring your own FREE Febbox account to gain access to FED API and CIA API, the best sources with 4K quality, Dolby Atmos, skip intro and the fastest load times! Highly recommended option!"},setup:{title:"To get your UI token:",showVideo:"Show Video Tutorial",hideVideo:"Hide Video Tutorial",step:{1:"1. Go to <0>febbox.com</0> and log in with Google (use a fresh account!)",2:"2. Open DevTools or inspect the page",3:"3. Go to Application tab ‚Üí Cookies",4:"4. Copy the 'ui' cookie's value.",5:"5. Close the tab, but do NOT logout!",warning:"(Do not share this token!)"},tokenLabel:"Token",tokenExample:{button:"(Example)",title:"Example Token",description:"This is what a Febbox UI token looks like:",warning:"Don't try to use, it's fake.",close:"Got it"}},status:{success:"success",api_down:"Cannot reach FED API!",invalid_token:"Failed to fetch a 'VIP' stream. Your token is invalid!"}},_d={title:"Real Debrid (Beta)",description:"Enter your Real Debrid API key to access Real Debrid. Extension required.",tokenLabel:"API Key",status:{failure:"Failed to connect to Real Debrid. Please check your API key.",api_down:"Real Debrid API is currently unavailable. Please try again later.",invalid_token:"Invalid API key or non-premium account. Real Debrid requires a premium account."}},Od={status:{inSync:"In sync",outOfSync:"Out of sync"},alone:"Alone",withCount:"With {{count}} others",isHost:"Hosting on <0>{{backendName}}</0>",isGuest:"Watching as a guest on <0>{{backendName}}</0>",hosting:"Hosting",watching:"Watching",syncing:"Syncing...",behindHost:"Behind host by {{seconds}} seconds",aheadOfHost:"Ahead of host by {{seconds}} seconds",showStatusOverlay:"Show status overlay",leaveWatchParty:"Leave Watch Party",shareCode:"Share this code with friends (click to copy link)",connectedAsGuest:"Connected to watch party as guest",hostParty:"Host a Watch Party",joinParty:"Join a Watch Party",viewers:"Viewers ({{count}})",copyCode:"Click to copy",join:"Join",cancel:"Cancel",save:"Save",emptyRoom:"No one is in this room yet",invalidRoom:"Unable to connect to this room",contentMismatch:"Cannot join watch party: The content does not match the host's content.",episodeMismatch:"Cannot join watch party: You are watching a different episode than the host.",validating:"Validating watch party...",linkCopied:"Copied!"},Bd={about:fd,actions:pd,auth:xd,errors:gd,footer:bd,global:yd,home:vd,media:wd,details:jd,migration:kd,navigation:Nd,notFound:Sd,downtimeNotice:Cd,onboarding:Ed,overlays:Id,player:Td,support:Rd,jip:Pd,screens:Ld,settings:Dd,discover:Ad,fedapi:Md,realdebrid:_d,watchParty:Od},Wo={en:Bd,ca:zc,"ca-ES":Kc,cs:Wc,da:Vc,de:Hc,"de-CH":Uc,fr:$c,it:Fc,nl:Bc,pl:Oc,tr:_c,vi:Mc,zh:Ac,he:Dc,sv:Lc,pirate:Pc,kitty:Rc,uwu:Tc,minion:Ic,futhark:Ec,lv:Cc,th:Sc,ne:Nc,ar:kc,es:jc,et:wc,tok:vc,hi:yc,"pt-BR":bc,"pt-PT":gc,uk:xc,bg:pc,bn:fc,el:hc,fa:mc,gu:uc,id:dc,ja:cc,ko:lc,sl:ic,ta:oc,"zh-Hant":ac,is:rc,ru:nc,gl:sc,pa:tc,ro:ec,fi:Zl,nv:Jl,hu:Xl,km:Ql,si:Yl,umb:ql,"ur-PK":Gl},Fd=Object.keys(Wo),$d=Object.fromEntries(Object.entries(Wo).map(t=>[t[0],{translation:t[1]}]));bo.use(qc).init({fallbackLng:"en",resources:$d,interpolation:{escapeValue:!1}});const Gy=Fd.map(t=>{const s=Nr(t);if(!s)throw new Error(`Language with code ${t} cannot be found in database`);return s}),ze=Ae(Ze(Oe(t=>({language:navigator.language.split("-")[0],setLanguage(s){t(n=>{n.language=s})}})),{name:"__MW::locale"}));function Ko(t){const s=Nr(t);s&&bo.changeLanguage(s.code)}function Ud(t){const s=Nr(t);return s?s.isRtl:!1}function Hd(){const t=ze(n=>n.language);c.useEffect(()=>{Ko(t)},[t]);const s=Ud(t);return e.jsx(dt,{children:e.jsx("html",{dir:s?"rtl":"ltr"})})}const sa="https://apis.justwatch.com",Vd="https://images.justwatch.com";function Wd(t){if(t===ge.MOVIE)return"movie";if(t===ge.SERIES)return"show";throw new Error("unsupported type")}function Kd(t){if(t==="movie")return ge.MOVIE;if(t==="show")return ge.SERIES;throw new Error("unsupported type")}function zd(t,s){var a,o;const n=Kd(t.object_type);let r;return n===ge.SERIES&&(r=(a=t.seasons)==null?void 0:a.sort((i,l)=>i.season_number-l.season_number).map(i=>({id:i.id.toString(),number:i.season_number,title:i.title}))),{title:t.title,id:t.id.toString(),year:(o=t.original_release_year)==null?void 0:o.toString(),poster:t.poster?`${Vd}${t.poster.replace("{profile}","s166")}`:void 0,type:n,seasons:r,seasonData:s?{id:s.id.toString(),number:s.season_number,title:s.title,episodes:s.episodes.sort((i,l)=>i.episode_number-l.episode_number).map(i=>({id:i.id.toString(),number:i.episode_number,title:i.title}))}:void 0}}const Gd="5.2.0",qd="https://discord.gg/7z6znYgrTG",Yd="https://twitter.com/SudoFlix",Er=void 0,Qd={TMDB_READ_API_KEY:void 0,APP_VERSION:void 0,GITHUB_LINK:void 0,DISCORD_LINK:void 0,TWITTER_LINK:void 0,ONBOARDING_CHROME_EXTENSION_INSTALL_LINK:void 0,ONBOARDING_FIREFOX_EXTENSION_INSTALL_LINK:void 0,ONBOARDING_PROXY_INSTALL_LINK:void 0,DMCA_EMAIL:void 0,CORS_PROXY_URL:void 0,M3U8_PROXY_URL:void 0,NORMAL_ROUTER:void 0,BACKEND_URL:void 0,DISALLOWED_IDS:void 0,TURNSTILE_KEY:void 0,CDN_REPLACEMENTS:void 0,HAS_ONBOARDING:void 0,ALLOW_AUTOPLAY:void 0,ALLOW_FEBBOX_KEY:void 0,ALLOW_REAL_DEBRID_KEY:void 0,SHOW_AD:void 0,AD_CONTENT_URL:void 0,TRACK_SCRIPT:void 0,BANNER_MESSAGE:void 0,BANNER_ID:void 0};function na(t){if(t!=null&&t.length!==0)return t}function Xd(t){var n;const s=(n=window==null?void 0:window.__CONFIG__)==null?void 0:n[`VITE_${t}`];return na(Qd[t])??na(s)??void 0}function Le(t,s){var n;return((n=Xd(t))==null?void 0:n.toString())??s??null}function le(){return{APP_VERSION:Gd,GITHUB_LINK:Le("GITHUB_LINK",""),DISCORD_LINK:qd,TWITTER_LINK:Yd,DMCA_EMAIL:Le("DMCA_EMAIL"),ONBOARDING_CHROME_EXTENSION_INSTALL_LINK:Le("ONBOARDING_CHROME_EXTENSION_INSTALL_LINK","https://docs.pstream.mov/extension"),ONBOARDING_FIREFOX_EXTENSION_INSTALL_LINK:Le("ONBOARDING_FIREFOX_EXTENSION_INSTALL_LINK","https://docs.pstream.mov/extension"),ONBOARDING_PROXY_INSTALL_LINK:Le("ONBOARDING_PROXY_INSTALL_LINK"),BACKEND_URL:Le("BACKEND_URL",Er),TMDB_READ_API_KEY:Le("TMDB_READ_API_KEY"),PROXY_URLS:Le("CORS_PROXY_URL","").split(",").map(t=>t.trim()).filter(t=>t.length>0),M3U8_PROXY_URLS:Le("M3U8_PROXY_URL","").split(",").map(t=>t.trim()).filter(t=>t.length>0),NORMAL_ROUTER:Le("NORMAL_ROUTER","false")==="true",HAS_ONBOARDING:Le("HAS_ONBOARDING","false")==="true",ALLOW_AUTOPLAY:Le("ALLOW_AUTOPLAY","false")==="true",TURNSTILE_KEY:Le("TURNSTILE_KEY"),DISALLOWED_IDS:Le("DISALLOWED_IDS","").split(",").map(t=>t.trim()).filter(t=>t.length>0),CDN_REPLACEMENTS:Le("CDN_REPLACEMENTS","").split(",").map(t=>t.split(":").map(s=>s.trim()).filter(s=>s.length>0)).filter(t=>t.length===2),ALLOW_FEBBOX_KEY:Le("ALLOW_FEBBOX_KEY","false")==="true",ALLOW_REAL_DEBRID_KEY:Le("ALLOW_REAL_DEBRID_KEY","false")==="true",SHOW_AD:Le("SHOW_AD","false")==="true",AD_CONTENT_URL:Le("AD_CONTENT_URL","").split(",").map(t=>t.trim()).filter(t=>t.length>0),TRACK_SCRIPT:Le("TRACK_SCRIPT"),BANNER_MESSAGE:Le("BANNER_MESSAGE"),BANNER_ID:Le("BANNER_ID")}}const J=Ae(Ze(Oe(t=>({enableThumbnails:!1,enableAutoplay:!0,enableSkipCredits:!0,enableDiscover:!0,enableFeatured:!1,enableDetailsModal:!1,enableImageLogos:!0,enableCarouselView:!1,forceCompactEpisodeView:!1,sourceOrder:[],enableSourceOrder:!1,disabledSources:[],embedOrder:[],enableEmbedOrder:!1,disabledEmbeds:[],proxyTmdb:!1,febboxKey:null,realDebridKey:null,enableLowPerformanceMode:!1,enableNativeSubtitles:!1,enableHoldToBoost:!0,homeSectionOrder:["watching","bookmarks"],manualSourceSelection:!1,enableDoubleClickToSeek:!1,setEnableThumbnails(s){t(n=>{n.enableThumbnails=s})},setEnableAutoplay(s){t(n=>{n.enableAutoplay=s})},setEnableSkipCredits(s){t(n=>{n.enableSkipCredits=s})},setEnableDiscover(s){t(n=>{n.enableDiscover=s})},setEnableFeatured(s){t(n=>{n.enableFeatured=s})},setEnableDetailsModal(s){t(n=>{n.enableDetailsModal=s})},setEnableImageLogos(s){t(n=>{n.enableImageLogos=s})},setEnableCarouselView(s){t(n=>{n.enableCarouselView=s})},setForceCompactEpisodeView(s){t(n=>{n.forceCompactEpisodeView=s})},setSourceOrder(s){t(n=>{n.sourceOrder=s})},setEnableSourceOrder(s){t(n=>{n.enableSourceOrder=s})},setDisabledSources(s){t(n=>{n.disabledSources=s})},setEmbedOrder(s){t(n=>{n.embedOrder=s})},setEnableEmbedOrder(s){t(n=>{n.enableEmbedOrder=s})},setDisabledEmbeds(s){t(n=>{n.disabledEmbeds=s})},setProxyTmdb(s){t(n=>{n.proxyTmdb=s})},setFebboxKey(s){t(n=>{n.febboxKey=s})},setRealDebridKey(s){t(n=>{n.realDebridKey=s})},setEnableLowPerformanceMode(s){t(n=>{n.enableLowPerformanceMode=s})},setEnableNativeSubtitles(s){t(n=>{n.enableNativeSubtitles=s})},setEnableHoldToBoost(s){t(n=>{n.enableHoldToBoost=s})},setHomeSectionOrder(s){t(n=>{n.homeSectionOrder=s.length>0?s:["watching","bookmarks"]})},setManualSourceSelection(s){t(n=>{n.manualSourceSelection=s})},setEnableDoubleClickToSeek(s){t(n=>{n.enableDoubleClickToSeek=s})}})),{name:"__MW::preferences"}));class Ir{constructor(){this.INTERVAL_MS=2*60*1e3,this._interval=null,this._compare=null,this._storage=[]}initialize(){if(this._interval)throw new Error("cache is already initialized");this._interval=setInterval(()=>{const s=new Date;this._storage.filter(n=>!(n.expiry<s))},this.INTERVAL_MS)}destroy(){this._interval&&clearInterval(this._interval),this.clear()}setCompare(s){this._compare=s}has(s){return!!this.get(s)}get(s){if(!this._compare)throw new Error("Compare function not set");const n=this._storage.find(r=>this._compare&&this._compare(r.key,s));if(n)return n.value}set(s,n,r){if(!this._compare)throw new Error("Compare function not set");const a=this._storage.find(i=>this._compare&&this._compare(i.key,s)),o=new Date(new Date().getTime()+r*1e3);if(a){a.key=s,a.value=n,a.expiry=o;return}this._storage.push({key:s,value:n,expiry:o})}remove(s){if(!this._compare)throw new Error("Compare function not set");this._storage.filter(n=>!(this._compare&&this._compare(n.key,s)))}clear(){this._storage=[]}}const he=Ae(Ze(Oe(t=>({account:null,backendUrl:null,proxySet:null,setAccount(s){t(n=>{n.account=s})},removeAccount(){t(s=>{s.account=null})},setBackendUrl(s){t(n=>{n.backendUrl=s})},setProxySet(s){t(n=>{n.proxySet=s})},setAccountProfile(s){t(n=>{n.account&&(n.account.profile=s)})},updateAccount(s){t(n=>{n.account&&(n.account={...n.account,...s})})},updateDeviceName(s){t(n=>{n.account&&(n.account.deviceName=s)})}})),{name:"__MW::auth"})),Jd=le().PROXY_URLS,Zd=["proxy","api"];function ra(t){try{return!!new URL(t)}catch{return!1}}function eu(t){return Zd.includes(t)}function tu(t){const s=t.split(";").map(n=>n.split("=",2).filter(r=>r.length!==0)).filter(n=>n.length===2);return Object.fromEntries(s)}function zo(){const t=he.getState().proxySet??Jd,s=[];return t.forEach(n=>{if(!n.startsWith("|")&&ra(n)){s.push({url:n,type:"proxy"});return}const r=/^\|([^|]+)\|(.*)$/g.exec(n);if(!r||!r[2]||!ra(r[2]))return;const o=tu(r[1]).type??"proxy";eu(o)&&s.push({url:r[2],type:o})}),s}function Kt(){return zo().filter(t=>t.type==="proxy").map(t=>t.url)}function Go(){return le().M3U8_PROXY_URLS}function su(){return zo().filter(t=>t.type==="api").map(t=>t.url)}let Ne=function(t){return t.MOVIE="movie",t.TV="tv",t}({});const nu="^1.0.2";function qo(t){return Tl.satisfies(t,nu)}const or={PREPARE_STREAM:1,SET_DOMAINS_HLS:2,SET_DOMAINS_HLS_AUDIO:3},ru=new Promise(t=>{setTimeout(()=>{t()},500)});let ir=!1;async function Nn(t,s=void 0,n=-1){return await ru,new Promise(r=>{n>=0&&setTimeout(()=>r(null),n),Rl({name:t,body:s}).then(a=>{ir=!0,r(a)}).catch(()=>{ir=!1,r(null)})})}async function Yo(t){return Nn("makeRequest",t)}async function lr(t){return Nn("prepareStream",t)}async function au(t){return Nn("openPage",t)}async function Tr(){return await Nn("hello",void 0,500)}function Xe(){return ir}async function Sn(){const t=await Tr();return!(t!=null&&t.success)||!qo(t.version)?!1:t.allowed&&t.hasPermission}function Qo(t,s){const n=t.toString(),r=(t.stack??"").split(`
`,s+1);return r.pop(),`${n}

${r.join(`
`)}`}async function ou(t){}const iu={success:"success",notfound:"notfound",failure:"failed",pending:null,waiting:null};function ns(t,s,n,r,a){var d,m;const o=(d=t.episode)==null?void 0:d.tmdbId,i=(m=t.season)==null?void 0:m.tmdbId;let l;return a instanceof Error&&(l=a),{status:r,providerId:s,title:t.title,tmdbId:t.tmdbId,type:t.type,embedId:n??void 0,episodeId:o,seasonId:i,errorMessage:l==null?void 0:l.message,fullError:l?Qo(l,5):void 0}}function aa(t,s,n){const r=iu[n.status];if(!r)return null;let a,o;t.type==="show"&&(a=t.episode.tmdbId,o=t.season.tmdbId);let i;return n.error instanceof Error&&(i=n.error),{status:r,providerId:s,title:t.title,tmdbId:t.tmdbId,type:t.type,embedId:n.embedId,episodeId:a,seasonId:o,errorMessage:n.reason??(i==null?void 0:i.message),fullError:i?Qo(i,5):void 0}}function lu(t,s,n){const r=[];return s.forEach(a=>{const o=n[a.id];a.children.forEach(l=>{const d=n[l];if(!d.embedId)return;const m=aa(t,o.id,d);m&&r.push(m)});const i=aa(t,o.id,o);i&&r.push(i)}),r}function Rr(){return{report:c.useCallback(s=>{s.length!==0&&ou().catch(()=>{})},[])}}const ln=Ae(Oe((t,s)=>({isInWidget:!1,turnstiles:[],cbs:[],processToken(n,r){const a=s().cbs,o=s().turnstiles.find(i=>i.id===r);(o==null?void 0:o.id)===r&&(a.forEach(i=>i(n)),t(i=>{i.cbs=[]}))},getToken(){return new Promise((n,r)=>{t(a=>{a.cbs=[...a.cbs,o=>{o?n(o):r(new Error("Failed to get token"))}]})})},setTurnstile(n,r,a){t(o=>{o.turnstiles=o.turnstiles.filter(i=>i.id!==n),r&&o.turnstiles.push({controls:r,isInPopout:a,id:n})})}})));function Xo(){const t=ln.getState().turnstiles,s=t.find(n=>n.isInPopout);return s||t[0]}function cu(){return!!Xo()}async function du(){try{const t=await ln.getState().getToken();return t}catch(t){throw t}}function uu(t){const s=le().TURNSTILE_KEY,n=c.useRef(null),r=ln(o=>o.setTurnstile),a=ln(o=>o.processToken);return s?e.jsx("div",{className:z({hidden:!t.isInPopout}),children:e.jsx(Yc,{siteKey:s,options:{refreshExpired:"never",theme:"light"},onWidgetLoad:o=>{n.current=o,r(o,"mwturnstile",!!t.isInPopout)},onError:()=>{const o=n.current;o&&a(null,o)},onSuccess:o=>{var l;const i=n.current;i&&(a(o,i),(l=t.onUpdateShow)==null||l.call(t,!1))},onBeforeInteractive:()=>{var o;(o=t.onUpdateShow)==null||o.call(t,!0)}})}):null}let cn=null,Ss=null;function qy(t){cn=t}function Ut(){return cn??[]}function Pr(t){Ss=t}function mu(){if(!Ss)return null;try{const t=Pl(Ss);if(!t.exp)return`jwt|${Ss}`;if(Date.now()/1e3<t.exp)return`jwt|${Ss}`}catch{}return null}async function Yy(t){if(cn)return;cn=(await tn(`${t}/metadata`)).flat()}function oa(t){let s={};return t.type==="show"&&(s={episodeNumber:t.episode.number.toString(),episodeTmdbId:t.episode.tmdbId,seasonNumber:t.season.number.toString(),seasonTmdbId:t.season.tmdbId}),{type:t.type,releaseYear:t.releaseYear.toString(),imdbId:t.imdbId,tmdbId:t.tmdbId,title:t.title,...s}}function qs(t,s){Object.entries(s).forEach(n=>{n[1]&&t.searchParams.set(n[0],n[1])})}function dn(t){const s=n=>new URL(`${t}${n}`);return{scrapeSource(n,r){const a=s("/scrape/source");return qs(a,oa(r)),qs(a,{id:n}),a.toString()},scrapeAll(n,r,a){const o=s("/scrape");return qs(o,oa(n)),r&&r.length>0&&o.searchParams.set("sourceOrder",r.join(",")),a&&a.length>0&&o.searchParams.set("embedOrder",a.join(",")),o.toString()},scrapeEmbed(n,r){const a=s("/scrape/embed");return qs(a,{id:n,url:r}),a.toString()}}}async function Lr(){let t=mu();return!t&&cu()&&(t=`turnstile|${await du()}`),t}function ia(t){return t.length===0?{}:JSON.parse(t)}async function un(t,s){const n=await Lr(),r=new URL(t);n&&r.searchParams.set("token",n);const a=new EventSource(r.toString());let o,i;const l=new Promise((d,m)=>{i=d,o=m});return s.forEach(d=>{a.addEventListener(d,m=>{a.close(),i(ia(m.data))})}),a.addEventListener("token",d=>{Pr(ia(d.data))}),a.addEventListener("error",d=>{if(a.close(),d.data){const m=JSON.parse(d.data);let u=new Error("scrape error");m.name===is.name&&(u=new is("Notfound from server")),Object.assign(u,m),o(u);return}console.error("Failed to connect to SSE",d),o(d)}),a.addEventListener("message",d=>{if(!d){a.close();return}setTimeout(()=>{o(new Error("SSE closed improperly"))},1e3)}),{promise:()=>l,on(d,m){a.addEventListener(d,u=>m(JSON.parse(u.data)))}}}function hu(t){return typeof t=="string"?"string":t instanceof FormData?"FormData":t instanceof URLSearchParams?"URLSearchParams":"object"}function fu(t){return t instanceof FormData||t instanceof URLSearchParams?[...t]:t}function Dr(t){let s=-1;return()=>{const n=t();(s===-1||s>=n.length)&&(s=Math.floor(Math.random()*n.length));const r=n[s];return s=(s+1)%n.length,r}}const Jo=Dr(Kt),Ar=Dr(su);function pu(){const t=Go(),s=localStorage.getItem("m3u8-proxy-enabled");if(!s)return t;try{const n=JSON.parse(s);return t.filter((r,a)=>n[a.toString()]!==!1)}catch{return t}}const xu=Dr(pu);async function gu(t,s){const n=await Lr(),r=new Headers(s==null?void 0:s.headers);n&&r.set("X-Token",n);const a=await fetch(t,s?{...s,headers:r}:void 0),o=a.headers.get("X-Token");return o&&Pr(o),a}function Zo(){const t=xu();t&&Ll(t)}function bu(){return async(s,n)=>Dl(Jo(),gu)(s,n)}function yu(t,s){const n=t.map(r=>r.toLowerCase());return new Headers(Object.entries(s).filter(r=>n.includes(r[0].toLowerCase())))}function Mr(){return async(s,n)=>{const r=await Yo({url:s,...n,body:fu(n.body),bodyType:hu(n.body)});if(!(r!=null&&r.success))throw new Error(`extension error: ${r==null?void 0:r.error}`);const a=r.response;return{body:a.body,finalUrl:a.finalUrl,statusCode:a.statusCode,headers:yu(n.readHeaders,a.headers)}}}const ei=Ee.create({retry:0});function la(t,s){let n=t;return Object.entries(s).forEach(([r,a])=>{n=n.replace(`{${r}}`,encodeURIComponent(a))}),n}function tn(t,s={}){return ei(t,s)}async function Cn(t,s,n={}){let r=(n==null?void 0:n.baseURL)??"";r.length>0&&r.endsWith("/")&&s.startsWith("/")?r+=s.slice(1):r.length>0&&!r.endsWith("/")&&!s.startsWith("/")?r+=`/${s}`:r+=s;const a=new URL(r);Object.entries((n==null?void 0:n.params)??{}).forEach(([l,d])=>{a.searchParams.set(l,d)}),Object.entries((n==null?void 0:n.query)??{}).forEach(([l,d])=>{a.searchParams.set(l,d)});let o=n.headers??{};const i=await Lr();return i&&(o={...o,"X-Token":i}),ei(t,{...n,baseURL:void 0,params:{destination:a.toString()},query:{},headers:o,onResponse(l){var m;const d=l.response.headers.get("X-Token");d&&Pr(d),Array.isArray(n.onResponse)?n.onResponse.forEach(u=>u(l)):(m=n.onResponse)==null||m.call(n,l)}})}function Ht(t,s={}){return Cn(Jo(),t,s)}function mn(t){if(t===ge.MOVIE)return Ne.MOVIE;if(t===ge.SERIES)return Ne.TV;throw new Error("unsupported type")}function hn(t){if(t==="movie")return ge.MOVIE;if(t==="show")return ge.SERIES;throw new Error("unsupported type")}function Bs(t){if(t===Ne.MOVIE)return ge.MOVIE;if(t===Ne.TV)return ge.SERIES;throw new Error("unsupported type")}function vu(t){if(t===Ne.MOVIE)return"movie";if(t===Ne.TV)return"show";throw new Error("unsupported type")}function wu(t,s){var a,o,i;const n=Bs(t.object_type);let r;return n===ge.SERIES&&(r=(a=t.seasons)==null?void 0:a.sort((l,d)=>l.season_number-d.season_number).map(l=>({title:l.title,id:l.id.toString(),number:l.season_number}))),{title:t.title,id:t.id.toString(),year:(i=(o=t.original_release_date)==null?void 0:o.getFullYear())==null?void 0:i.toString(),poster:t.poster,type:n,seasons:r,seasonData:s?{id:s.id.toString(),number:s.season_number,title:s.title,episodes:s.episodes.sort((l,d)=>l.episode_number-d.episode_number).map(l=>({id:l.id.toString(),number:l.episode_number,title:l.title,air_date:l.air_date,still_path:l.still_path,overview:l.overview}))}:void 0}}function ca(t){var n;const s=vu(t.object_type);return{title:t.title,id:t.id.toString(),year:((n=t.original_release_date)==null?void 0:n.getFullYear())??0,release_date:t.original_release_date,poster:t.poster,type:s}}function Es(t,s,n){return["tmdb",mn(t),s,Al(n,{lower:!0,strict:!0})].join("-")}function ju(t){return Es(hn(t.type),t.id,t.title)}function Qy(t){const[s,n,r]=t.split("-",3);if(s!=="tmdb")return null;let a;try{a=Bs(n)}catch{return null}return{type:a,id:r}}const da="https://api.themoviedb.org/3/",ku="https://api.tmdb.org/3/",ti=le().TMDB_READ_API_KEY,Hn={accept:"application/json",Authorization:`Bearer ${ti}`},fn=new Ir;fn.setCompare((t,s)=>t.url===s.url&&JSON.stringify(t.params)===JSON.stringify(s.params)&&t.language===s.language);fn.initialize();function Vn(t){const s=new AbortController;return setTimeout(()=>s.abort(),t),s.signal}let ua=0;function _r(t){if(!t.length)return;const s=t[ua%t.length];return ua+=1,s}async function De(t,s){const n=Kt(),r=_r(n),a=J.getState().proxyTmdb,o=ze.getState().language,i=yt(o);if(!ti)throw new Error("TMDB API key not set");const l={url:t,params:s||{},language:i},d=fn.get(l);if(d)return d;const m=new URL(da+t),u={...s,language:i};u&&Object.entries(u).forEach(([g,h])=>{m.searchParams.append(g,String(h))});let p;if(r&&a)try{p=await tn(`/?destination=${encodeURIComponent(m.toString())}`,{headers:Hn,baseURL:r,signal:Vn(5e3)})}catch(g){console.error(g)}if(!p)try{p=await tn(encodeURI(t),{headers:Hn,baseURL:da,params:u,signal:Vn(5e3)})}catch{p=await tn(encodeURI(t),{headers:Hn,baseURL:ku,params:u,signal:Vn(3e4)})}return fn.set(l,p,3600),p}async function si(t){return(await De("search/multi",{query:t,include_adult:!1,page:1})).results.filter(r=>r.media_type===Ne.MOVIE||r.media_type===Ne.TV)}async function Nu(t){return(await De("search/movie",{query:t,include_adult:!1,page:1})).results.map(n=>({...n,media_type:Ne.MOVIE}))}async function Su(t){return(await De("search/tv",{query:t,include_adult:!1,page:1})).results.map(n=>({...n,media_type:Ne.TV}))}async function Cu(t){const s=await si(t);if(s.length===0)return;const n=s[0],r=n.media_type===Ne.MOVIE?n.title:n.name;return`/media/${Es(Bs(n.media_type),n.id.toString(),r)}`}async function zt(t,s){if(s===Ne.MOVIE)return De(`/movie/${t}`,{append_to_response:"external_ids,credits,release_dates"});if(s===Ne.TV){const n=await De(`/tv/${t}`,{append_to_response:"external_ids,credits,content_ratings"}),a=n.seasons.map(async i=>(await De(`/tv/${t}/season/${i.season_number}`)).episodes.map(d=>({id:d.id,name:d.name,episode_number:d.episode_number,overview:d.overview,still_path:d.still_path,air_date:d.air_date,season_number:i.season_number}))),o=(await Promise.all(a)).flat();return{...n,episodes:o}}throw new Error("Invalid media type")}function Eu(t){const s=J.getState().proxyTmdb,n=`https://image.tmdb.org/t/p/original${t}`,r=Kt()[0];if(r&&s)return`${r}/?destination=${n}`;if(t)return n}function It(t){const s=J.getState().proxyTmdb,n=`https://image.tmdb.org/t/p/w342/${t}`;if(s){const r=Kt(),a=_r(r);if(a)return`${a}/?destination=${n}`}if(t)return n}async function ni(t,s){return(await De(`/tv/${t}/season/${s}`)).episodes.map(r=>({id:r.id,episode_number:r.episode_number,title:r.name,air_date:r.air_date,still_path:r.still_path,overview:r.overview}))}async function ri(t){const n=(await De(`/find/${t}`,{external_source:"imdb_id"})).movie_results[0];if(n)return n.id.toString()}function Iu(t,s){if(Bs(s)===ge.SERIES){const a=t;return{title:a.name,poster:It(a.poster_path),id:a.id,original_release_date:new Date(a.first_air_date),object_type:s}}const r=t;return{title:r.title,poster:It(r.poster_path),id:r.id,original_release_date:new Date(r.release_date),object_type:s}}async function ai(t,s,n){var i,l,d;const r=ze.getState().language,a=yt(r),o=s===Ne.MOVIE?`/movie/${t}/images`:`/tv/${t}/images`;try{const m=await De(o,{include_image_language:`${a},en,null`}),u=((i=m.logos)==null?void 0:i.find(p=>p.iso_639_1===a))||((l=m.logos)==null?void 0:l.find(p=>p.iso_639_1==="en"))||((d=m.logos)==null?void 0:d[0]);return u&&u.file_path?`https://image.tmdb.org/t/p/original${u.file_path}`:void 0}catch(m){console.error("Failed to fetch TMDB logo:",m);return}}async function Tu(t,s){const n=s===Ne.MOVIE?"movie":"tv";return De(`/${n}/${t}/credits`)}function ma(t){const s=J.getState().proxyTmdb,n=`https://image.tmdb.org/t/p/w185/${t}`;if(s){const r=Kt(),a=_r(r);if(a)return`${a}/?destination=${n}`}if(t)return n}function Ru(t,s){if(s===ge.MOVIE){const n=t;return{id:t.id,title:n.title,object_type:mn(s),poster:It(n.poster_path)??void 0,original_release_date:new Date(n.release_date)}}if(s===ge.SERIES){const n=t;return{id:t.id,title:n.name,object_type:mn(s),seasons:n.seasons.map(r=>({id:r.id,season_number:r.season_number,title:r.name})),poster:It(n.poster_path)??void 0,original_release_date:new Date(n.first_air_date)}}throw new Error("unsupported type")}async function us(t,s,n){const r=await zt(s,mn(t));if(!r)return null;const a=r.external_ids.imdb_id??void 0;let o;if(t===ge.SERIES){const d=r.seasons;let m=d.find(u=>u.id.toString()===n);if(m||(m=d.find(u=>u.season_number===1)),m){const u=await ni(r.id.toString(),m.season_number);o={id:m.id.toString(),season_number:m.season_number,title:m.name,episodes:u}}}const i=Ru(r,t);if(!i)return null;const l=wu(i,o);return l?{meta:l,imdbId:a,tmdbId:s}:null}async function oi(t,s,n){var p,g,h,x,y;const r=Wd(t),a=ze.getState().language,i=yt(a).replace("-","_");let l;try{const f=la(`/content/titles/{type}/{id}/locale/${i}`,{type:r,id:s});l=await Ht(f,{baseURL:sa})}catch(f){if(f instanceof Ml&&(f.statusCode===400||f.statusCode===404))return null;throw f}let d=(p=l.external_ids.find(f=>f.provider==="imdb_latest"))==null?void 0:p.external_id;d||(d=(g=l.external_ids.find(f=>f.provider==="imdb"))==null?void 0:g.external_id);let m=(h=l.external_ids.find(f=>f.provider==="tmdb_latest"))==null?void 0:h.external_id;m||(m=(x=l.external_ids.find(f=>f.provider==="tmdb"))==null?void 0:x.external_id);let u;if(l.object_type==="show"){const f=((y=l.seasons)==null?void 0:y[0].id.toString())??"",b=la(`/content/titles/show_season/{id}/locale/${i}`,{id:f});u=await Ht(b,{baseURL:sa})}return{meta:zd(l,u),imdbId:d,tmdbId:m}}function cr(t){return!!(t.startsWith("/media/JW")||t.startsWith("/media/tmdb-show"))}function Pu(t){return!!t.startsWith("/media/tmdb-show")}async function Lu(t){if(!cr(t))return;const s=t.split("/").slice(2),[,n,r]=s[0].split("-",3),a=s.slice(1).map(m=>`/${m}`).join("");if(Pu(t)){const m=await zt(r,Ne.TV);return`/media/${Es(ge.SERIES,m.id.toString(),m.name)}${a}`}const o=Bs(n),i=await oi(o,r);if(!i)return;const{tmdbId:l,imdbId:d}=i;if(!(!l&&!d)&&d&&o===ge.MOVIE){const m=await ri(d);if(m)return`/media/${Es(o,m,i.meta.title)}`;if(l)return`/media/${Es(o,l,i.meta.title)}`}}const rs=new Ir;rs.setCompare((t,s)=>t.searchQuery.trim()===s.searchQuery.trim());rs.initialize();const Du=/^tmdb:(\d+)(?::(movie|tv))?$/i,Au=/(.+?)\s+year:(\d{4})$/i,Mu=/(.+?)\s+type:(movie|tv)$/i;async function ii(t){var x;if(rs.has(t))return rs.get(t);const{searchQuery:s}=t,n=s.match(Du);if(n){const y=n[1],f=((x=n[2])==null?void 0:x.toLowerCase())==="tv"?Ne.TV:Ne.MOVIE;try{const b=await zt(y,f);if(b){const v=f===Ne.MOVIE?{id:b.id,title:b.title,poster:It(b.poster_path),object_type:f,original_release_date:new Date(b.release_date)}:{id:b.id,title:b.name,poster:It(b.poster_path),object_type:f,original_release_date:new Date(b.first_air_date)},R=[ca(v)];return rs.set(t,R,3600),R}}catch(b){console.error("Error fetching by TMDB ID:",b)}}let r,a=s;const o=s.match(Au);o&&o[2]&&(a=o[1].trim(),r=o[2]);let i,l=a;const d=a.match(Mu);d&&d[2]&&(l=d[1].trim(),i=d[2].toLowerCase());let m;i==="movie"?m=await Nu(l):i==="tv"?m=await Su(l):m=await si(l);let u=m.map(y=>{const f=Iu(y,y.media_type);return ca(f)});r&&(u=u.filter(y=>{var b;return((b=y.release_date)==null?void 0:b.getFullYear().toString())===r}));const p=u.filter(y=>y.poster),g=u.filter(y=>!y.poster),h=p.concat(g);return rs.set(t,h,3600),h}function ha(t){return t.trim().toLowerCase().replace(/['":]/g,"").replace(/[^a-zA-Z0-9]+/g,"_")}function _u(t,s){return ha(t)===ha(s)}async function li(t,s){const n=(o,i)=>Math.abs(o-i)<=1,r={},a=await Promise.all(Object.values(t).map(async o=>{const i=Number(o.year.toString().split("-")[0]),d=(await ii({searchQuery:`${o.title} ${i}`})).find(m=>n(Number(m.year),i)&&_u(m.title,o.title));if(!d){console.error(`No item found for migration: ${o.title}`);return}return{id:o.mediaId,data:d}}));for(const o of a.filter(Boolean)){if(!o)continue;let i=[["0","0"]];if(o.data.type==="show"){const l=await us(ge.SERIES,o.data.id);if(!l||!(l!=null&&l.meta.seasons))return;i=[...new Set(s!=null&&s.items?s.items.filter(u=>u.mediaId===o.id).map(u=>u.seasonId):["0"])].map(u=>{var p,g;return{num:u,season:(g=(p=l.meta)==null?void 0:p.seasons)==null?void 0:g[Math.max(0,u-1)]}}).map(u=>{var p;return u?[u.num,(p=u==null?void 0:u.season)==null?void 0:p.id]:[]}).filter(u=>u.length>0)}r[o.id]||(r[o.id]={}),await Promise.all(i.map(async([l,d])=>{l&&(r[o.id][l]=await us(hn(o.data.type),o.data.id,d==="0"||d===null?void 0:d))}))}return r}async function Ou(t){const s=t;if(!s)return;const n={};s.bookmarks.forEach(o=>{n[o.mediaId]||(n[o.mediaId]=o)});const r=await li(n);return r?{bookmarks:Object.keys(r).map(o=>r[o][0]).map(o=>o==null?void 0:o.meta).filter(Boolean)}:void 0}async function Bu(t){var i,l,d,m;const s=t;if(!s)return;const n={};s.items.forEach(u=>{n[u.mediaId]||(n[u.mediaId]=u)});const r=await li(n,s);if(!r)return;const a={...s,items:[]},o=Date.now();for(const u of s.items)if(u.mediaType==="movie"){if(!((i=r[u.mediaId][0])!=null&&i.meta))continue;const p={item:{meta:(l=r[u.mediaId][0])==null?void 0:l.meta},progress:u.progress,percentage:u.percentage,watchedAt:Date.now()};s.items=s.items.filter(g=>JSON.stringify(g)!==JSON.stringify(u)),a.items.push(p)}else if(u.mediaType==="series"){if(!((d=r[u.mediaId][u.seasonId])!=null&&d.meta))continue;const p=(m=r[u.mediaId][u.seasonId])==null?void 0:m.meta;if(p.type!=="series")return;const g={item:{meta:p,series:{episode:Number(u.episodeId),season:Number(u.seasonId),seasonId:p.seasonData.id,episodeId:p.seasonData.episodes[Number(u.episodeId)-1].id}},progress:u.progress,percentage:u.percentage,watchedAt:o+Number(u.seasonId)*1e3+Number(u.episodeId)};if(a.items.find(h=>{var x,y;return h.item.meta.id===g.item.meta.id&&((x=h.item.series)==null?void 0:x.episodeId)===((y=g.item.series)==null?void 0:y.episodeId)}))continue;s.items=s.items.filter(h=>JSON.stringify(h)!==JSON.stringify(u)),a.items.push(g)}return a}function Fu(t){return t!=null}async function ci(t,s){const n=await oi(s,t);if(!n)return;const{tmdbId:r,imdbId:a}=n;if(!(!r&&!a)){if(a&&s===ge.MOVIE){const o=await ri(a);if(o)return o}if(r)return r}}async function $u(t){const s=t.bookmarks.map(async n=>({...n,id:await ci(n.id,n.type).catch(()=>{})}));return{bookmarks:(await Promise.all(s)).filter(n=>n.id)}}async function Uu(t){return{items:(await Promise.all(t.items.map(async n=>{try{const r=await ci(n.item.meta.id,n.item.meta.type);if(!r)return null;const a=structuredClone(n);if(a.item.meta.id=r,a.item.series){const o=a.item.series,l=(await zt(r,Ne.TV)).seasons.find(u=>u.season_number===o.season);if(!l)return null;const m=(await ni(r,l.season_number)).find(u=>u.episode_number===o.episode);if(!m)return null;a.item.series.episodeId=m.id.toString(),a.item.series.seasonId=l.id.toString()}return a}catch{return null}}))).filter(Fu)}}const Hu={[ge.ANIME]:null,[ge.MOVIE]:"movie",[ge.SERIES]:"show"};kn().setKey("mw-bookmarks").addVersion({version:0,migrate(t){return Ou(t)}}).addVersion({version:1,migrate(t){return $u(t)}}).addVersion({version:2,migrate(t){const s={};for(const n of t.bookmarks){const r=Hu[n.type];r&&(s[n.id]={title:n.title,year:n.year?Number(n.year):void 0,poster:n.poster,type:r,updatedAt:Date.now()})}return me.getState().replaceBookmarks(s),{bookmarks:[]}}}).addVersion({version:3,create(){return{bookmarks:[]}}}).build();const Te=Ae(Ze(Oe(t=>({enabled:!1,lastSync:{lastSelectedLanguage:null},lastSelectedLanguage:null,isOpenSubtitles:!1,overrideCasing:!1,delay:0,styling:{color:"#ffffff",backgroundOpacity:.5,size:1,backgroundBlur:.5,bold:!1,verticalPosition:3,fontStyle:"default"},showDelayIndicator:!1,resetSubtitleSpecificSettings(){t(s=>{s.delay=0,s.overrideCasing=!1})},updateStyling(s){t(n=>{s.backgroundOpacity!==void 0&&(n.styling.backgroundOpacity=Math.min(1,Math.max(0,s.backgroundOpacity))),s.backgroundBlur!==void 0&&(n.styling.backgroundBlur=Math.min(1,Math.max(0,s.backgroundBlur))),s.color!==void 0&&(n.styling.color=s.color.toLowerCase()),s.size!==void 0&&(n.styling.size=Math.min(10,Math.max(.01,s.size))),s.bold!==void 0&&(n.styling.bold=s.bold),s.verticalPosition!==void 0&&(n.styling.verticalPosition=Math.min(100,Math.max(0,s.verticalPosition))),s.fontStyle!==void 0&&(n.styling.fontStyle=s.fontStyle)})},resetStyling(){t(s=>{s.styling={color:"#ffffff",backgroundOpacity:.5,size:1,backgroundBlur:.5,bold:!1,verticalPosition:3,fontStyle:"default"}})},setLanguage(s){t(n=>{n.enabled=!!s,s&&(n.lastSelectedLanguage=s)})},setIsOpenSubtitles(s){t(n=>{n.isOpenSubtitles=s})},setCustomSubs(){t(s=>{s.enabled=!0,s.lastSelectedLanguage=null})},setOverrideCasing(s){t(n=>{n.overrideCasing=s})},setDelay(s){t(n=>{n.delay=Math.max(Math.min(500,s),-500)})},importSubtitleLanguage(s){t(n=>{n.lastSelectedLanguage=s,n.lastSync.lastSelectedLanguage=s})},setShowDelayIndicator(s){t(n=>{n.showDelayIndicator=s})}})),{name:"__MW::subtitles",merge:(t,s)=>yo({},s,t)}));kn().setKey("mw-settings").addVersion({version:0,create(){return{language:"en",captionSettings:{delay:0,style:{color:"#ffffff",fontSize:25,backgroundColor:"#00000096"}}}},migrate(t){return{language:t.language,captionSettings:{language:"none",...t.captionSettings}}}}).addVersion({version:1,migrate(t){const s=ze.getState(),n=Te.getState(),r=t.captionSettings.style.backgroundColor;let a=.5;if(r.length===9){const o=r.slice(7);a=parseInt(o,16)/255}return s.setLanguage(t.language),n.updateStyling({backgroundOpacity:a,color:t.captionSettings.style.color,size:t.captionSettings.style.fontSize/25}),n.importSubtitleLanguage(t.captionSettings.language==="none"?null:t.captionSettings.language),{}}}).addVersion({version:2,create(){return{}}}).build();const Or=Ae(Ze(Oe(t=>({volume:1,setVolume(s){t(n=>{n.volume=s})}})),{name:"__MW::volume"})),di=Ae(Oe(t=>({showVolume:!1,setShowVolume(s){t(n=>{n.showVolume=s})}})));kn().setKey("mw-volume").addVersion({version:0,create(){return{volume:1}},migrate(t){return Or.getState().setVolume(t.volume),{}}}).addVersion({version:1,create(){return{}}}).build();let Ys=0;const je=Ae(Ze(Oe(t=>({items:{},updateQueue:[],removeItem(s){t(n=>{Ys+=1,n.updateQueue.push({id:Ys.toString(),action:"delete",tmdbId:s}),delete n.items[s]})},replaceItems(s){t(n=>{n.items=s})},updateItem({meta:s,progress:n}){t(r=>{var o,i,l,d;Ys+=1,r.updateQueue.push({tmdbId:s.tmdbId,title:s.title,year:s.releaseYear,poster:s.poster,type:s.type,progress:{...n},id:Ys.toString(),episodeId:(o=s.episode)==null?void 0:o.tmdbId,seasonId:(i=s.season)==null?void 0:i.tmdbId,seasonNumber:(l=s.season)==null?void 0:l.number,episodeNumber:(d=s.episode)==null?void 0:d.number,action:"upsert"}),r.items[s.tmdbId]||(r.items[s.tmdbId]={type:s.type,episodes:{},seasons:{},updatedAt:0,title:s.title,year:s.releaseYear,poster:s.poster});const a=r.items[s.tmdbId];if(a.updatedAt=Date.now(),s.type==="movie"){a.progress||(a.progress={duration:0,watched:0}),a.progress={...n};return}!s.episode||!s.season||(a.seasons[s.season.tmdbId]||(a.seasons[s.season.tmdbId]={id:s.season.tmdbId,number:s.season.number,title:s.season.title}),a.episodes[s.episode.tmdbId]||(a.episodes[s.episode.tmdbId]={id:s.episode.tmdbId,number:s.episode.number,title:s.episode.title,seasonId:s.season.tmdbId,updatedAt:Date.now(),progress:{duration:0,watched:0}}),a.episodes[s.episode.tmdbId].progress={...n})})},clear(){t(s=>{s.items={}})},clearUpdateQueue(){t(s=>{s.updateQueue=[]})},removeUpdateItem(s){t(n=>{n.updateQueue=[...n.updateQueue.filter(r=>r.id!==s)]})}})),{name:"__MW::progress"}));function Vu(t){var n,r;const s={};for(const a of t.items)if(a.item.meta.type===ge.SERIES){if(s[a.item.meta.id]||(s[a.item.meta.id]={type:"show",episodes:{},seasons:{},title:a.item.meta.title,updatedAt:a.watchedAt,poster:a.item.meta.poster,year:Number(a.item.meta.year)}),a.item.series&&!s[a.item.meta.id].episodes[a.item.series.episodeId]){const o=(n=a.item.meta.seasonData.episodes.find(i=>{var l;return i.number===((l=a.item.series)==null?void 0:l.episode)}))==null?void 0:n.title;s[a.item.meta.id].seasons[a.item.series.seasonId]={id:a.item.series.seasonId,number:a.item.series.season,title:((r=a.item.meta.seasons.find(i=>{var l;return i.number===((l=a.item.series)==null?void 0:l.season)}))==null?void 0:r.title)||"Unknown season"},s[a.item.meta.id].episodes[a.item.series.episodeId]={title:o||"Unknown",id:a.item.series.episodeId,number:a.item.series.episode,seasonId:a.item.series.seasonId,updatedAt:a.watchedAt,progress:{duration:100/a.percentage*a.progress,watched:a.progress}}}}else s[a.item.meta.id]={type:"movie",episodes:{},seasons:{},title:a.item.meta.title,updatedAt:a.watchedAt,year:Number(a.item.meta.year),poster:a.item.meta.poster,progress:{duration:100/a.percentage*a.progress,watched:a.progress}};return s}kn().setKey("video-progress").addVersion({version:0,migrate(){return{items:[]}}}).addVersion({version:1,async migrate(t){return Bu(t)}}).addVersion({version:2,migrate(t){return Uu(t)}}).addVersion({version:3,migrate(t){return je.getState().replaceItems(Vu(t)),{items:[]}}}).addVersion({version:4,create(){return{items:[]}}}).build();function Vt(t){return e.jsx("div",{className:["spinner",t.className??""].join(" ")})}function Z(t){var m;const s=be(),{onClick:n,href:r,loading:a}=t,o=c.useCallback(u=>{a||(r&&!n?(u.preventDefault(),r.includes("http")?window.open(r,"_blank","noreferrer"):s(r)):n==null||n(u))},[a,r,n,s]);let i="bg-white hover:bg-gray-200 text-black";t.theme==="purple"&&(i="bg-buttons-purple hover:bg-buttons-purpleHover text-white gap-2"),t.theme==="secondary"&&(i="bg-buttons-cancel hover:bg-buttons-cancelHover transition-colors duration-100 text-white gap-2"),t.theme==="danger"&&(i="bg-buttons-danger hover:bg-buttons-dangerHover text-white gap-2");let l=z("tabbable cursor-pointer inline-flex items-center justify-center rounded-lg font-medium transition-[transform,background-color] duration-100 active:scale-105 md:px-8",t.padding??"px-4 py-3",t.className,i,t.disabled?"!cursor-not-allowed bg-opacity-60 text-opacity-60":null);t.disabled&&(l=l.split(" ").filter(u=>!u.startsWith("hover:")&&!u.startsWith("active:")).join(" "));const d=e.jsxs(e.Fragment,{children:[t.icon&&!t.loading?e.jsx("span",{className:"mr-3 hidden md:inline-block",children:e.jsx(M,{icon:t.icon})}):null,t.loading?e.jsx("span",{className:"mr-3 inline-flex justify-center",children:e.jsx(Vt,{className:"text-lg"})}):null,t.children]});return t.href&&(t.href.startsWith("https://")||(m=t.href)!=null&&m.startsWith("data:"))?e.jsx("a",{className:l,href:t.href,target:"_blank",rel:"noreferrer",download:t.download,onClick:o,children:d}):t.href?e.jsx("a",{className:l,onClick:o,children:d}):e.jsx("button",{type:"button",onClick:o,className:l,children:d})}function fa(t){let s="bg-white hover:bg-gray-200 text-black";t.theme==="purple"&&(s="bg-buttons-purple hover:bg-buttons-purpleHover text-white"),t.theme==="secondary"&&(s="bg-buttons-cancel hover:bg-buttons-cancelHover transition-colors duration-100 text-white");const n=z("cursor-pointer inline-flex items-center justify-center rounded-lg font-medium transition-[transform,background-color] duration-100 active:scale-105 md:px-8","px-4 py-3",t.className,s);return e.jsx("button",{type:"button",onClick:t.onClick,className:n,children:t.children})}const Wu=function(s){return e.jsx("div",{className:s.className,children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex h-12 items-center justify-center",children:[e.jsx("div",{className:"mx-1 h-2 w-2 animate-loading-pin rounded-full bg-[#211D30]"}),e.jsx("div",{className:"mx-1 h-2 w-2 animate-loading-pin rounded-full bg-[#211D30] [animation-delay:150ms]"}),e.jsx("div",{className:"mx-1 h-2 w-2 animate-loading-pin rounded-full bg-[#211D30] [animation-delay:300ms]"}),e.jsx("div",{className:"mx-1 h-2 w-2 animate-loading-pin rounded-full bg-[#211D30] [animation-delay:450ms]"})]}),s.text&&s.text.length?e.jsx("p",{className:"mt-3 max-w-xs text-sm opacity-75",children:s.text}):null]})})},At=Wu;function Be(t){return{authorization:`Bearer ${t}`}}function ui(t,s){return{meta:{title:s.title,type:s.type,poster:s.poster,year:s.year??0},tmdbId:t,group:s.group,favoriteEpisodes:s.favoriteEpisodes}}async function Ku(t,s,n){return Ee(`/users/${s.userId}/bookmarks/${n.tmdbId}`,{method:"POST",headers:Be(s.token),baseURL:t,body:n})}async function zu(t,s,n){return Ee(`/users/${s.userId}/bookmarks/${n}`,{method:"DELETE",headers:Be(s.token),baseURL:t})}function En(t){return mt.util.createBuffer(Array.from(t).map(s=>String.fromCharCode(s)).join(""))}async function Gu(t){return _l(Fl,t,"mnemonic",{c:2048,dkLen:32})}function qu(t){if(Bl(t,vo))return!0;const s=/^[a-zA-Z0-9\s\-_.,!?@#$%^&*()+=:;"'<>[\]{}|\\/`~]+$/;return t.length>=8&&s.test(t)}async function mi(t){const{privateKey:s,publicKey:n}=mt.pki.ed25519.generateKeyPair({seed:t});return{privateKey:new Uint8Array(s),publicKey:new Uint8Array(n),seed:t}}async function pa(t){const s=await Gu(t);return mi(s)}function Yu(){return Ol(vo)}async function Qu(t,s){const n=mt.pki.ed25519.sign({encoding:"utf8",message:t,privateKey:En(s)});return new Uint8Array(n)}function pn(t){return mt.util.encode64(String.fromCodePoint(...t))}function xn(t){return pn(t).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}async function dr(t,s){const n=await Qu(s,t.privateKey);return xn(n)}function In(t){return mt.util.binary.base64.decode(t)}function Wn(t){const s=In(t);return En(s)}function xa(t){return mt.util.encode64(t.getBytes())}async function ur(t,s){if(s.byteLength!==32)throw new Error("Secret must be at least 256-bit");const n=await new Promise((i,l)=>{mt.random.getBytes(16,(d,m)=>{d&&l(d),i(m)})}),r=mt.cipher.createCipher("AES-GCM",En(s));r.start({iv:n,tagLength:128}),r.update(mt.util.createBuffer(t,"utf8")),r.finish();const a=r.output,o=r.mode.tag;return`${mt.util.encode64(n)}.${xa(a)}.${xa(o)}`}function hi(t,s){if(s.byteLength!==32)throw new Error("Secret must be 256-bit");const[n,r,a]=t.split("."),o=mt.cipher.createDecipher("AES-GCM",En(s));if(o.start({iv:Wn(n),tag:Wn(a),tagLength:128}),o.update(Wn(r)),!o.finish())throw new Error("Error decrypting data");return o.output.toString()}function fi(t,s,n){return Ee(`/users/${s.userId}/group-order`,{method:"PUT",body:n,baseURL:t,headers:Be(s.token)})}function pi(t,s){return Ee(`/users/${s.userId}/group-order`,{method:"GET",baseURL:t,headers:Be(s.token)}).catch(n=>{var r;if(((r=n==null?void 0:n.response)==null?void 0:r.status)===404)return{groupOrder:[]};throw n})}function xi(t,s,n){return Ee(`/users/${s.userId}/progress/import`,{method:"PUT",body:n,baseURL:t,headers:Be(s.token)})}function gi(t,s,n){return Ee(`/users/${s.userId}/bookmarks`,{method:"PUT",body:n,baseURL:t,headers:Be(s.token)})}async function Xu(t,s){return Ee("/auth/login/start",{method:"POST",body:{publicKey:s},baseURL:t})}async function Ju(t,s){return Ee("/auth/login/complete",{method:"POST",body:{namespace:"movie-web",...s},baseURL:t})}function Zu(t){var s,n;return{duration:((s=t.progress)==null?void 0:s.duration)??0,watched:((n=t.progress)==null?void 0:n.watched)??0,tmdbId:t.tmdbId,meta:{title:t.title??"",type:t.type??"",year:t.year??NaN,poster:t.poster},episodeId:t.episodeId,seasonId:t.seasonId,episodeNumber:t.episodeNumber,seasonNumber:t.seasonNumber}}function bi(t,s){var n,r;return s.type==="show"?Object.entries(s.episodes).flatMap(([a,o])=>{var i,l;return{duration:((i=s.progress)==null?void 0:i.duration)??o.progress.duration,watched:((l=s.progress)==null?void 0:l.watched)??o.progress.watched,tmdbId:t,meta:{title:s.title??"",type:s.type??"",year:s.year??NaN,poster:s.poster},episodeId:o.id,seasonId:o.seasonId,episodeNumber:o.number,seasonNumber:s.seasons[o.seasonId].number,updatedAt:new Date(o.updatedAt).toISOString()}}):[{duration:((n=s.progress)==null?void 0:n.duration)??0,watched:((r=s.progress)==null?void 0:r.watched)??0,tmdbId:t,updatedAt:new Date(s.updatedAt).toISOString(),meta:{title:s.title??"",type:s.type??"",year:s.year??NaN,poster:s.poster}}]}async function em(t,s,n){return Ee(`/users/${s.userId}/progress/${n.tmdbId}`,{method:"PUT",headers:Be(s.token),baseURL:t,body:n})}async function tm(t,s,n,r,a){await Ee(`/users/${s.userId}/progress/${n}`,{method:"DELETE",headers:Be(s.token),baseURL:t,body:{episodeId:r,seasonId:a}})}async function yi(t,s){return Ee("/auth/register/start",{method:"POST",body:{captchaToken:s},baseURL:t})}async function vi(t,s){return Ee("/auth/register/complete",{method:"POST",body:{namespace:"movie-web",...s},baseURL:t})}async function Xy(t,s){return Ee(`/users/${s.userId}/sessions`,{headers:Be(s.token),baseURL:t})}async function Jy(t,s,n){return Ee(`/sessions/${s.sessionId}`,{method:"PATCH",headers:Be(s.token),body:n,baseURL:t})}async function sm(t,s,n){return Ee(`/sessions/${n}`,{method:"DELETE",headers:Be(s),baseURL:t})}function Br(t,s,n){return Ee(`/users/${s.userId}/settings`,{method:"PUT",body:n,baseURL:t,headers:Be(s.token)})}function nm(t,s){return Ee(`/users/${s.userId}/settings`,{method:"GET",baseURL:t,headers:Be(s.token)})}function rm(t){const s=t.map(n=>{var a;const r={...n.meta,group:((a=n.group)==null?void 0:a.length)>0?n.group:void 0,favoriteEpisodes:n.favoriteEpisodes,updatedAt:new Date(n.updatedAt).getTime()};return[n.tmdbId,r]});return Object.fromEntries(s)}function am(t){const s={};return t.forEach(n=>{s[n.tmdbId]||(s[n.tmdbId]={title:n.meta.title,poster:n.meta.poster,type:n.meta.type,updatedAt:new Date(n.updatedAt).getTime(),episodes:{},seasons:{},year:n.meta.year});const r=s[n.tmdbId];new Date(n.updatedAt).getTime()>r.updatedAt&&(r.updatedAt=new Date(n.updatedAt).getTime()),r.type==="movie"&&(r.progress={duration:Number(n.duration),watched:Number(n.watched)}),r.type==="show"&&n.season.id&&n.episode.id&&(r.seasons[n.season.id]={id:n.season.id,number:n.season.number??0,title:""},r.episodes[n.episode.id]={id:n.episode.id,number:n.episode.number??0,title:"",progress:{duration:Number(n.duration),watched:Number(n.watched)},seasonId:n.season.id,updatedAt:new Date(n.updatedAt).getTime()})}),s}async function ga(t,s){return Ee("/users/@me",{headers:Be(s),baseURL:t})}async function Zy(t,s,n){return Ee(`/users/${s.userId}`,{method:"PATCH",headers:Be(s.token),body:n,baseURL:t})}async function ev(t,s){return Ee(`/users/${s.userId}`,{method:"DELETE",headers:Be(s.token),baseURL:t})}async function om(t,s){return Ee(`/users/${s.userId}/bookmarks`,{headers:Be(s.token),baseURL:t})}async function im(t,s){return Ee(`/users/${s.userId}/progress`,{headers:Be(s.token),baseURL:t})}const Je=Ae(Ze(Oe(t=>({groupOrder:[],setGroupOrder(s){t(n=>{n.groupOrder=s})},async saveGroupOrderToBackend(s,n){if(!n||!s)throw new Error("No authenticated account or backend URL");const r=Je.getState();await fi(s,n,r.groupOrder)},async loadGroupOrderFromBackend(s,n){if(!n||!s)throw new Error("No authenticated account or backend URL");const r=await pi(s,n);t(a=>{a.groupOrder=r.groupOrder})},clear(){t(s=>{s.groupOrder=[]})}})),{name:"__MW::groupOrder"})),gn=new Date,lm=gn.getMonth()+1===4&&gn.getDate()===20,cm=gn.getMonth()+1===10&&gn.getDate()===31,Fr=Ae(Ze(Oe(t=>({theme:lm?"green":cm?"autumn":null,setTheme(s){t(n=>{n.theme=s})}})),{name:"__MW::theme"})),dm=Ae(Oe(t=>({previewTheme:null,setPreviewTheme(s){t(n=>{n.previewTheme=s})}})));function um(t){const s=dm(o=>o.previewTheme),n=Fr(o=>o.theme),r=s??n,a=r?`theme-${r}`:void 0;return e.jsxs("div",{className:a,children:[t.applyGlobal?e.jsx(dt,{children:e.jsx("body",{className:a})}):null,t.children]})}function wi(){const t=!!he(T=>T.account),s=he(T=>T.setAccount),n=he(T=>T.removeAccount),r=he(T=>T.setProxySet),a=me(T=>T.clear),o=je(T=>T.clear),i=Je(T=>T.clear),l=Fr(T=>T.setTheme),d=ze(T=>T.setLanguage),m=Te(T=>T.importSubtitleLanguage),u=J(T=>T.setFebboxKey),p=J(T=>T.setRealDebridKey),g=me(T=>T.replaceBookmarks),h=je(T=>T.replaceItems),x=J(T=>T.setEnableThumbnails),y=J(T=>T.setEnableAutoplay),f=J(T=>T.setEnableSkipCredits),b=J(T=>T.setEnableDiscover),v=J(T=>T.setEnableFeatured),w=J(T=>T.setEnableDetailsModal),R=J(T=>T.setEnableImageLogos),P=J(T=>T.setEnableCarouselView),O=J(T=>T.setForceCompactEpisodeView),U=J(T=>T.setSourceOrder),D=J(T=>T.setEnableSourceOrder),S=J(T=>T.setDisabledSources),N=J(T=>T.setEmbedOrder),C=J(T=>T.setEnableEmbedOrder),_=J(T=>T.setDisabledEmbeds),I=J(T=>T.setProxyTmdb),A=J(T=>T.setEnableLowPerformanceMode),L=J(T=>T.setEnableNativeSubtitles),j=J(T=>T.setEnableHoldToBoost),B=J(T=>T.setHomeSectionOrder),W=J(T=>T.setEnableDoubleClickToSeek),H=J(T=>T.setManualSourceSelection),$=c.useCallback(async(T,X,ae,ce)=>{const Q={token:T.token,userId:X.id,sessionId:T.session.id,deviceName:ae.device,profile:X.profile,seed:ce};return s(Q),Q},[s]),K=c.useCallback(async()=>{n(),a(),o(),i(),u(null)},[n,a,o,i,u]),V=c.useCallback(async(T,X,ae,ce,Q,xe)=>{g(rm(ce)),h(am(ae)),xe!=null&&xe.groupOrder&&Je.getState().setGroupOrder(xe.groupOrder),Q.applicationLanguage&&d(Q.applicationLanguage),Q.defaultSubtitleLanguage&&m(Q.defaultSubtitleLanguage),Q.applicationTheme&&l(Q.applicationTheme),Q.proxyUrls&&r(Q.proxyUrls),Q.enableThumbnails!==void 0&&x(Q.enableThumbnails),Q.enableAutoplay!==void 0&&y(Q.enableAutoplay),Q.enableSkipCredits!==void 0&&f(Q.enableSkipCredits),Q.enableDiscover!==void 0&&b(Q.enableDiscover),Q.enableFeatured!==void 0&&v(Q.enableFeatured),Q.enableDetailsModal!==void 0&&w(Q.enableDetailsModal),Q.enableImageLogos!==void 0&&R(Q.enableImageLogos),Q.enableCarouselView!==void 0&&P(Q.enableCarouselView),Q.forceCompactEpisodeView!==void 0&&O(Q.forceCompactEpisodeView),Q.sourceOrder!==void 0&&U(Q.sourceOrder??[]),Q.enableSourceOrder!==void 0&&D(Q.enableSourceOrder),Q.disabledSources!==void 0&&S(Q.disabledSources??[]),Q.embedOrder!==void 0&&N(Q.embedOrder??[]),Q.enableEmbedOrder!==void 0&&C(Q.enableEmbedOrder),Q.disabledEmbeds!==void 0&&_(Q.disabledEmbeds??[]),Q.proxyTmdb!==void 0&&I(Q.proxyTmdb),Q.febboxKey!==void 0&&u(Q.febboxKey),Q.realDebridKey!==void 0&&p(Q.realDebridKey),Q.enableLowPerformanceMode!==void 0&&A(Q.enableLowPerformanceMode),Q.enableNativeSubtitles!==void 0&&L(Q.enableNativeSubtitles),Q.enableHoldToBoost!==void 0&&j(Q.enableHoldToBoost),Q.homeSectionOrder!==void 0&&B(Q.homeSectionOrder??["watching","bookmarks"]),Q.manualSourceSelection!==void 0&&H(Q.manualSourceSelection),Q.enableDoubleClickToSeek!==void 0&&W(Q.enableDoubleClickToSeek)},[g,h,d,m,l,r,x,y,f,b,v,w,R,P,O,U,D,S,N,C,_,I,u,p,A,L,j,B,H,W]);return{loggedIn:t,login:$,logout:K,syncData:V}}function He(){return he(s=>s.backendUrl)??le().BACKEND_URL}function Mt(){const t=he(g=>g.account),s=he(g=>{var h;return(h=g.account)==null?void 0:h.profile}),n=!!he(g=>g.account),r=He(),{logout:a,login:o,syncData:i}=wi(),l=c.useCallback(async g=>{if(!r)return;const h=await pa(g.mnemonic),x=xn(h.publicKey),{challenge:y}=await Xu(r,x),f=await dr(h,y),b=await Ju(r,{challenge:{code:y,signature:f},publicKey:x,device:await ur(g.userData.device,h.seed)}),v=await ga(r,b.token),w=pn(h.seed);return o(b,v.user,v.session,w)},[o,r]),d=c.useCallback(async()=>{if(!(!t||!r)){try{await sm(r,t.token,t.sessionId)}catch{}await a()}},[a,r,t]),m=c.useCallback(async g=>{if(!r)return;const{challenge:h}=await yi(r,g.recaptchaToken),x=await pa(g.mnemonic),y=await dr(x,h),f=await vi(r,{challenge:{code:h,signature:y},publicKey:xn(x.publicKey),device:await ur(g.userData.device,x.seed),profile:g.userData.profile});return o(f,f.user,f.session,pn(x.seed))},[r,o]),u=c.useCallback(async(g,h,x)=>{if(!r||Object.keys(h).length===0&&Object.keys(x).length===0)return;const y=Object.entries(h).flatMap(([b,v])=>bi(b,v)),f=Object.entries(x).map(([b,v])=>ui(b,v));await Promise.all([xi(r,g,y),gi(r,g,f)])},[r]),p=c.useCallback(async g=>{var v,w,R;if(!r)return;let h;try{h=await ga(r,g.token)}catch(P){const O=P;if(((v=O==null?void 0:O.response)==null?void 0:v.status)===401||((w=O==null?void 0:O.response)==null?void 0:w.status)===403||((R=O==null?void 0:O.response)==null?void 0:R.status)===400){await d();return}throw console.error(P),P}const[x,y,f,b]=await Promise.all([om(r,g),im(r,g),nm(r,g),pi(r,g)]);i(h.user,h.session,y,x,f,b)},[r,i,d]);return{loggedIn:n,profile:s,login:l,logout:d,register:m,restore:p,importData:u}}const mm=12*60*60*1e3;function hm(){const{account:t}=he(),{restore:s}=Mt(),n=c.useRef(!1);return Sr(()=>{t&&s(t)},mm),Dt(async()=>{n.current||!t||await s(t).finally(()=>{n.current=!0})},[])}function Tn(t){return e.jsxs("div",{className:"bg-pill-background bg-opacity-50 px-4 py-2 rounded-full text-white flex justify-center items-center",children:[e.jsx(M,{icon:t.icon??k.WAND,className:"mr-3 text-xl text-type-link"}),t.children]})}function ms(t){return e.jsx("h2",{className:z("text-white text-3xl font-bold text-opacity-100 mt-6",t.className),children:t.children})}const Rn="pb-4 border-b border-utils-divider border-opacity-50";function wt(t){return e.jsx("h1",{className:["text-3xl lg:text-5xl font-bold text-white mb-9",t.border?Rn:null,t.className??""].join(" "),children:t.children})}function Ce(t){return e.jsx("h2",{className:["text-xl lg:text-2xl font-bold text-white mt-20 mb-9",t.border?Rn:null,t.className??""].join(" "),children:t.children})}function Gt(t){return e.jsx("h2",{className:["text-lg lg:text-xl font-bold text-white mb-3",t.border?Rn:null,t.className??""].join(" "),children:t.children})}function ye(t){return e.jsx("p",{className:["text-type-text my-9 font-medium",t.border?Rn:null,t.className??""].join(" "),children:t.children})}function Pn(t){return e.jsx("div",{className:z("w-full p-6 text-center flex flex-col items-center",t.maxWidth??"max-w-[28rem]"),children:t.children})}function Ln(t){return e.jsx("div",{className:"w-full h-full flex justify-center items-center flex-col",children:t.children})}const fm=function(s){const n=s.clickable?"cursor-pointer hover:scale-110 hover:bg-pill-backgroundHover hover:text-white active:scale-125":"",r=s.transparent?"bg-opacity-0 hover:bg-opacity-50":"",a=s.navigation?"bg-opacity-50 hover:bg-opacity-100":"",o=s.active?"bg-pill-backgroundHover text-white":"",i=s.downsized?"h-10 w-10":"h-12 w-12";return e.jsx("div",{className:s.className||void 0,onClick:s.onClick,children:e.jsx("div",{className:`flex items-center justify-center rounded-full border-2 border-transparent bg-pill-background bg-opacity-100 transition-[background-color,color,transform,border-color] duration-75 ${r} ${a} ${n} ${o} ${i}`,children:e.jsx(M,{icon:s.icon})})})},ht=fm;function pm(t,s){return t==="slide-down"?{leave:`transition-[transform,opacity] ${s}`,leaveFrom:"opacity-100 translate-y-0",leaveTo:"-translate-y-4 opacity-0",enter:`transition-[transform,opacity] ${s}`,enterFrom:"opacity-0 -translate-y-4",enterTo:"translate-y-0 opacity-100"}:t==="slide-up"?{leave:`transition-[transform,opacity] ${s}`,leaveFrom:"opacity-100 translate-y-0",leaveTo:"translate-y-4 opacity-0",enter:`transition-[transform,opacity] ${s}`,enterFrom:"opacity-0 translate-y-4",enterTo:"translate-y-0 opacity-100"}:t==="slide-full-left"?{leave:`transition-[transform] ${s}`,leaveFrom:"translate-x-0",leaveTo:"-translate-x-full",enter:`transition-[transform] ${s}`,enterFrom:"-translate-x-full",enterTo:"translate-x-0"}:t==="slide-full-right"?{leave:`transition-[transform] ${s}`,leaveFrom:"translate-x-0",leaveTo:"translate-x-full",enter:`transition-[transform] ${s}`,enterFrom:"translate-x-full",enterTo:"translate-x-0"}:t==="fade"?{leave:`transition-[transform,opacity] ${s}`,leaveFrom:"opacity-100",leaveTo:"opacity-0",enter:`transition-[transform,opacity] ${s}`,enterFrom:"opacity-0",enterTo:"opacity-100"}:{}}function Se(t){const s=t.durationClass??"duration-200",n=pm(t.animation,s);return t.isChild?e.jsx(ta.Child,{as:c.Fragment,...n,children:e.jsx("div",{className:t.className,style:t.style,children:t.children})}):e.jsx(ta,{show:t.show,as:c.Fragment,...n,children:e.jsx("div",{className:t.className,style:t.style,children:t.children})})}function xm(){const t=xs();return c.useMemo(()=>Object.fromEntries(new URLSearchParams(t.search).entries()),[t.search])}function $r(t){const s=xm(),n=xs(),r=be(),a=s[t]??null,o=c.useCallback(i=>{const l=new URLSearchParams(n.search);i?l.set(t,i):l.delete(t),r({search:l.toString()})},[t,n.search,r]);return[a,o]}const hs=Ae(Oe(t=>({transition:null,routes:{},anchorPoint:null,setTransition(s){t(n=>{n.transition=s})},registerRoute(s){t(n=>{n.routes[s.id]=s})},setAnchorPoint(s){t(n=>{n.anchorPoint=s})}})));function Jt(t,s){return[s??"",...t.split("/")].filter(r=>r.length>0)}function Zt(t){return`/${t.join("/")}`}function gm(t){const[s]=$r("r"),n=hs(o=>o.setAnchorPoint),r=c.useMemo(()=>!!s&&s.startsWith(`/${t}`),[s,t]),a=c.useCallback(()=>{if(!r)return;const o=document.getElementById(`__overlayRouter::${t}`);if(o){const i=o.getBoundingClientRect();n({h:i.height,w:i.width,x:i.x,y:i.y})}},[r,n,t]);c.useEffect(()=>{a()},[r,a]),c.useEffect(()=>{function o(){a()}return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[a])}function gs(t){const[s,n]=$r("r"),r=hs(x=>x.transition),a=hs(x=>x.setTransition),o=!!s&&s.startsWith(`/${t}`);function i(x){return Zt(Jt(x,t))}function l(x){const y=s,f=Zt(Jt(x,t));a({from:y??"/",to:f}),n(f)}function d(x){if(!r)return"none";const y=Zt(Jt(x,t));return y===r.to&&r.from.startsWith(r.to)||y===r.from&&r.to.startsWith(r.from)?"yes":"no"}function m(x){return o&&s===Zt(Jt(x,t))}function u(){return o}const p=c.useCallback(x=>{s&&!x&&n(null),a(null)},[n,s,a]),g=c.useCallback((x="/")=>{a(null),n(Zt(Jt(x,t)))},[t,n,a]);return{activeRoute:o?Zt(Jt(s.slice(`/${t}`.length))):"/",showBackwardsTransition:d,isCurrentPage:m,isOverlayActive:u,navigate:l,close:p,open:g,makePath:i,currentRoute:s}}function Re(t){const s=gs(t);return{id:t,route:s.activeRoute,isRouterActive:s.isOverlayActive(),open:s.open,close:s.close,navigate:s.navigate}}const bm=function(){const{t:s}=q(),[n,r]=c.useState(!1);return c.useEffect(()=>{Xo()},[]),e.jsx("div",{className:z("absolute w-full max-w-[43em] max-h-full p-5 md:p-10 rounded-lg bg-dropdown-altBackground select-none z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 transform overflow-auto",n?"":"hidden"),children:e.jsxs("div",{className:"w-full h-full grid lg:grid-cols-[1fr,auto] gap-6 md:gap-7 items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h2",{className:"text-type-emphasis font-bold text-lg md:text-xl mb-4 md:mb-6",children:s("player.turnstile.title")}),e.jsx("p",{className:"text-type-emphasis",children:s("player.turnstile.description")})]}),e.jsx(uu,{isInPopout:!0,onUpdateShow:a=>r(a)})]})})},ym=bm;function vm(t){const s=gs("hello world :)"),n=c.useRef(s);return c.useEffect(()=>{const r=n.current;return r.close(),()=>{r.close()}},[]),e.jsxs("div",{className:"popout-location",children:[e.jsx(ym,{}),t.children]})}function Dn(t){const[s,n]=c.useState(null),[r,a]=c.useState(!1),o=c.useRef(null),i=t.close,l=t.zIndex??999;return c.useEffect(()=>{var u;const d=(u=o.current)==null?void 0:u.closest(".popout-location");n(d??document.body);const m=setTimeout(()=>{a(!0)},100);return()=>clearTimeout(m)},[]),c.useEffect(()=>{const d=m=>{if(m.reason&&typeof m.reason=="object"&&"message"in m.reason){const u=m.reason.message;u&&typeof u=="string"&&u.includes("matches.call")&&(console.warn("Caught focus-trap matches.call error, preventing crash:",m.reason),m.preventDefault())}};return window.addEventListener("unhandledrejection",d),()=>window.removeEventListener("unhandledrejection",d)},[]),e.jsx("div",{ref:o,children:s?Qc.createPortal(e.jsx(Se,{show:t.show,animation:"none",children:e.jsx(Xc,{active:r&&!!t.show,focusTrapOptions:{allowOutsideClick:!0,clickOutsideDeactivates:!0,fallbackFocus:()=>document.body,returnFocusOnDeactivate:!0,escapeDeactivates:!1,preventScroll:!0,checkCanFocusTrap:()=>Promise.resolve()},children:e.jsxs("div",{className:"popout-wrapper fixed overflow-hidden pointer-events-auto inset-0 select-none",style:{zIndex:l},children:[e.jsx(Se,{animation:"fade",isChild:!0,children:e.jsx("div",{onClick:i,className:z({"absolute inset-0":!0,"bg-black opacity-90":t.darken})})}),e.jsxs(Se,{animation:"slide-up",className:"absolute inset-0 pointer-events-none",isChild:!0,durationClass:t.durationClass??"duration-200",children:[e.jsx("div",{tabIndex:1,className:"focus:ring-0 focus:outline-none opacity-0"}),t.children]})]})})}),s):null})}function ji(t){const s=gs(t.id),n=s.close;gm(t.id);const r=c.useCallback(()=>{n()},[n]);return e.jsx(Dn,{close:r,show:s.isOverlayActive(),darken:t.darken,children:t.children})}const wm=200,jm="--colors-global-accentA";function km(t){return e.jsx("div",{tabIndex:t.tabIndex,className:z(t.className,"relative"),onKeyUp:t.onKeyUp,children:t.children})}function Nm(t){return e.jsx("div",{className:z(t.className,"relative"),children:t.children})}const Sm=function(s){const n=c.useRef(null),r=s.flareSize??wm,a=s.cssColorVar??jm,o=s.gradientOpacity??1,i=s.gradientSpread??70;return c.useEffect(()=>{function l(d){if(!n.current)return;const m=n.current.getBoundingClientRect(),u=r/2;n.current.style.setProperty("--bg-x",`${(d.clientX-m.left-u).toFixed(0)}px`),n.current.style.setProperty("--bg-y",`${(d.clientY-m.top-u).toFixed(0)}px`)}return document.addEventListener("mousemove",l),()=>document.removeEventListener("mousemove",l)},[r]),e.jsx("div",{ref:n,className:z("flare-light pointer-events-none absolute inset-0 overflow-hidden opacity-0 transition-opacity duration-[400ms]",s.className,{"!opacity-100":s.enabled??!1}),style:{backgroundImage:`radial-gradient(circle at center, rgba(var(${a}) / ${o}), rgba(var(${a}) / 0) ${i}%)`,backgroundPosition:"var(--bg-x) var(--bg-y)",backgroundRepeat:"no-repeat",backgroundSize:`${r.toFixed(0)}px ${r.toFixed(0)}px`},children:e.jsx("div",{className:z("absolute inset-[1px] overflow-hidden",s.className,s.backgroundClass),children:e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:`radial-gradient(circle at center, rgba(var(${a}) / ${o}), rgba(var(${a}) / 0) ${i}%)`,backgroundPosition:"var(--bg-x) var(--bg-y)",backgroundRepeat:"no-repeat",backgroundSize:`${r.toFixed(0)}px ${r.toFixed(0)}px`}})})})},Cm=Sm,fe={Base:km,Light:Cm,Child:Nm},at=Ae()(Oe((t,s)=>({currentOverlay:null,modalStack:[],setCurrentOverlay:n=>t(r=>{r.currentOverlay=n}),showModal:n=>t(r=>{r.modalStack.includes(n)||r.modalStack.push(n)}),hideModal:n=>t(r=>{r.modalStack=r.modalStack.filter(a=>a!==n)}),isModalVisible:n=>s().modalStack.includes(n),getTopModal:()=>{const n=s().modalStack;return n.length>0?n[n.length-1]:null}})));function Ke(t){const{showModal:s,hideModal:n,isModalVisible:r}=at(),a=c.useCallback(()=>s(t),[t,s]),o=c.useCallback(()=>n(t),[t,n]);return{id:t,isShown:r(t),show:a,hide:o}}function An(t){return e.jsx("div",{className:"w-full max-w-[30rem] m-4",children:e.jsx("div",{className:"w-full bg-modal-background rounded-xl p-8 pointer-events-auto",children:t.children})})}function Fs(t){const s=Ke(t.id),{modalStack:n}=at(),r=n.indexOf(t.id),a=r>=0?1e3+r:999;return e.jsxs(Dn,{darken:!0,close:s.hide,show:s.isShown,zIndex:a,children:[e.jsx(dt,{children:e.jsx("html",{"data-no-scroll":!0})}),e.jsx("div",{className:"flex absolute inset-0 items-center justify-center flex-col",children:t.children})]})}function mr(t){const s=Ke(t.id);c.useEffect(()=>{t.oneTime&&(localStorage.getItem(`modal-${t.id}-dismissed`)||s.show())},[s,t.id,t.oneTime]);const n=()=>{t.oneTime&&localStorage.setItem(`modal-${t.id}-dismissed`,"true"),s.hide()};return e.jsxs(Dn,{darken:!0,close:n,show:s.isShown,children:[e.jsx(dt,{children:e.jsx("html",{"data-no-scroll":!0})}),e.jsx("div",{className:"flex absolute inset-0 items-center justify-center",children:e.jsx(fe.Base,{className:z("group -m-[0.705em] rounded-3xl bg-background-main transition-colors duration-300 focus:relative focus:z-10","w-full mx-4 p-6 bg-mediaCard-hoverBackground bg-opacity-60 backdrop-filter backdrop-blur-lg shadow-lg",t.size==="md"?"max-w-md":"max-w-2xl",t.size==="xl"?"max-w-7xl":"max-w-2xl"),children:e.jsxs("div",{className:"transition-transform duration-300 overflow-y-scroll max-h-[90dvh] scrollbar-none",children:[e.jsx(fe.Light,{flareSize:300,cssColorVar:"--colors-mediaCard-hoverAccent",backgroundClass:"bg-mediaCard-hoverBackground duration-100",className:"rounded-3xl bg-background-main group-hover:opacity-100"}),e.jsxs(fe.Child,{className:"pointer-events-auto relative mb-2p-[0.4em] transition-transform duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.title&&e.jsx(Ce,{className:"!mt-0 !mb-0 pr-6",children:t.title}),e.jsx("button",{type:"button",className:"text-s font-semibold text-type-secondary hover:text-white transition-transform hover:scale-95",onClick:n,children:e.jsx(ht,{icon:k.X})})]}),e.jsx("div",{className:"text-lg text-type-secondary",children:t.children})]})]})})})]})}const Em=t=>({casting:{instance:null,player:null,controller:null,setInstance(s){t(n=>{n.casting.instance=s})},setPlayer(s){t(n=>{n.casting.player=s})},setController(s){t(n=>{n.casting.controller=s})},setIsCasting(s){t(n=>{n.interface.isCasting=s})},clear(){t(s=>{s.casting.instance=null})}}}),Im="modulepreload",Tm=function(t){return"/"+t},ba={},$s=function(s,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(n.map(d=>{if(d=Tm(d),d in ba)return;ba[d]=!0;const m=d.endsWith(".css"),u=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":Im,m||(p.as="script"),p.crossOrigin="",p.href=d,l&&p.setAttribute("nonce",l),document.head.appendChild(p),m)return new Promise((g,h)=>{p.addEventListener("load",g),p.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&o(l.reason);return s().catch(o)})},Rm={unknown:0,360:10,480:20,720:30,1080:40,"4k":35},Ot=Object.entries(Rm).sort((t,s)=>s[1]-t[1]).map(t=>t[0]);function ki(t,s){if(s.automaticQuality||s.lastChosenQuality===null||s.lastChosenQuality==="unknown")return Ot.find(a=>t.includes(a));const n=Ot.indexOf(s.lastChosenQuality);let r;for(let a=n;a<Ot.length;a+=1)if(t.includes(Ot[a])){r=Ot[a];break}if(r)return r;for(let a=n;a>=0;a-=1)if(t.includes(Ot[a])){r=Ot[a];break}return r}function hr(t,s){if(t.type==="hls")return{stream:t,quality:null};if(t.type==="file"){const n=Object.entries(t.qualities).filter(a=>(a[1].url.length??0)>0).map(a=>a[0]),r=ki(n,s);if(r){const a=t.qualities[r];if(a)return{stream:a,quality:r}}}throw new Error("couldn't select quality")}const Ni={"4k":"4K",1080:"1080p",360:"360p",480:"480p",720:"720p",unknown:"unknown"},Pm=Object.keys(Ni);function fr(t){return Ni[t]}const Is=Ae(Ze(Oe(t=>({quality:{automaticQuality:!0,lastChosenQuality:null},setLastChosenQuality(s){t(n=>{n.quality.lastChosenQuality=s})},setAutomaticQuality(s){t(n=>{n.quality.automaticQuality=s})}})),{name:"__MW::quality",merge:(t,s)=>yo({},s,t)})),we={IDLE:"idle",RESUME:"resume",SCRAPING:"scraping",PLAYING:"playing",SCRAPE_NOT_FOUND:"scrapeNotFound",PLAYBACK_ERROR:"playbackError"};function Si(t){if(t.type==="show"){if(!t.episode||!t.season)throw new Error("missing show data");return{title:t.title,releaseYear:t.releaseYear,tmdbId:t.tmdbId,type:"show",imdbId:t.imdbId,episode:t.episode,season:t.season}}return{title:t.title,releaseYear:t.releaseYear,tmdbId:t.tmdbId,type:"movie",imdbId:t.imdbId}}const Lm=(t,s)=>({source:null,sourceId:null,embedId:null,qualities:[],audioTracks:[],captionList:[],isLoadingExternalSubtitles:!1,currentQuality:null,currentAudioTrack:null,status:we.IDLE,meta:null,caption:{selected:null,asTrack:!1},setSourceId(n){t(r=>{r.status=we.PLAYING,r.sourceId=n})},setEmbedId(n){t(r=>{r.embedId=n})},setStatus(n){t(r=>{r.status=n})},setMeta(n,r){t(a=>{a.meta=n,a.embedId=null,a.sourceId=null,a.interface.hideNextEpisodeBtn=!1,r&&(a.status=r)})},setCaption(n){var a;(a=s().display)==null||a.setCaption(n),t(o=>{o.caption.selected=n})},setSource(n,r,a){let o=[];n.type==="file"&&(o=Object.keys(n.qualities));const i=Is.getState(),l=hr(n,i.quality);t(m=>{m.source=n,m.qualities=o,m.currentQuality=l.quality,m.captionList=r,m.interface.error=void 0,m.status=we.PLAYING,m.audioTracks=[],m.currentAudioTrack=null});const d=s();d.redisplaySource(a),setTimeout(()=>{d.addExternalSubtitles()},100)},redisplaySource(n){var l;const r=s(),a=r.currentQuality;if(!r.source)return;const o=Is.getState(),i=hr(r.source,{automaticQuality:o.quality.automaticQuality,lastChosenQuality:a});t(d=>{d.interface.error=void 0,d.status=we.PLAYING}),(l=r.display)==null||l.load({source:i.stream,startAt:n,automaticQuality:o.quality.automaticQuality,preferredQuality:o.quality.lastChosenQuality})},switchQuality(n){var a,o;const r=s();if(r.source)if(r.source.type==="file"){const i=r.source.qualities[n];if(!i)return;t(l=>{l.currentQuality=n,l.status=we.PLAYING,l.interface.error=void 0}),(a=r.display)==null||a.load({source:i,startAt:r.progress.time,automaticQuality:!1,preferredQuality:n})}else r.source.type==="hls"&&((o=r.display)==null||o.changeQuality(!1,n))},enableAutomaticQuality(){var r;(r=s().display)==null||r.changeQuality(!0,null)},setCaptionAsTrack(n){t(r=>{r.caption.asTrack=n})},async addExternalSubtitles(){const n=s();if(n.meta){t(r=>{r.isLoadingExternalSubtitles=!0});try{const{scrapeExternalSubtitles:r}=await $s(async()=>{const{scrapeExternalSubtitles:o}=await import("./externalSubtitles-BMvhbqZS.js");return{scrapeExternalSubtitles:o}},[]),a=await r(n.meta);a.length>0&&(t(o=>{const i=new Set(o.captionList.map(d=>d.id)),l=a.filter(d=>!i.has(d.id));o.captionList=[...o.captionList,...l]}),console.log(`Added ${a.length} external captions`))}catch(r){console.error("Failed to scrape external subtitles:",r)}finally{t(r=>{r.isLoadingExternalSubtitles=!1})}}}}),Dm=(t,s)=>({display:null,setDisplay(n){const r=s().display;if(r&&r.destroy(),!n){t(a=>{a.display=null});return}n.on("pause",()=>t(a=>{a.mediaPlaying.isPaused=!0,a.mediaPlaying.isPlaying=!1})),n.on("play",()=>t(a=>{a.mediaPlaying.hasPlayedOnce=!0,a.mediaPlaying.isPaused=!1,a.mediaPlaying.isPlaying=!0})),n.on("fullscreen",a=>t(o=>{o.interface.isFullscreen=a})),n.on("time",a=>t(o=>{o.progress.time=a})),n.on("volumechange",a=>t(o=>{o.mediaPlaying.volume=a})),n.on("duration",a=>t(o=>{o.progress.duration=a})),n.on("buffered",a=>t(o=>{o.progress.buffered=a})),n.on("loading",a=>t(o=>{o.mediaPlaying.isLoading=a})),n.on("qualities",a=>{t(o=>{o.qualities=a})}),n.on("changedquality",a=>{t(o=>{o.currentQuality=a})}),n.on("audiotracks",a=>{t(o=>{o.audioTracks=a})}),n.on("changedaudiotrack",a=>{t(o=>{o.currentAudioTrack=a})}),n.on("needstrack",a=>{t(o=>{o.caption.asTrack=a})}),n.on("canairplay",a=>{t(o=>{o.interface.canAirplay=a})}),n.on("playbackrate",a=>{t(o=>{o.mediaPlaying.playbackRate=a})}),n.on("error",a=>{t(o=>{o.status=we.PLAYBACK_ERROR,o.interface.error=a})}),t(a=>{a.display=n})},reset(){var n;(n=s().display)==null||n.load({source:null,startAt:0,automaticQuality:!1,preferredQuality:null}),t(r=>{r.status=we.IDLE,r.meta=null,r.embedId=null,r.sourceId=null,r.thumbnails.images=[],r.progress.time=0,r.progress.duration=0})}});let ss=function(t){return t[t.REGULAR=0]="REGULAR",t[t.REMAINING=1]="REMAINING",t}({}),it=function(t){return t.NOT_HOVERING="not_hovering",t.MOUSE_HOVER="mouse_hover",t.MOBILE_TAPPED="mobile_tapped",t}({});const Am=(t,s)=>({interface:{isCasting:!1,hasOpenOverlay:!1,isFullscreen:!1,isSeeking:!1,lastVolume:0,leftControlHovering:!1,isHoveringControls:!1,hovering:it.NOT_HOVERING,lastHoveringState:it.NOT_HOVERING,volumeChangedWithKeybind:!1,volumeChangedWithKeybindDebounce:null,timeFormat:ss.REGULAR,canAirplay:!1,hideNextEpisodeBtn:!1,shouldStartFromBeginning:!1,isSpeedBoosted:!1,showSpeedIndicator:!1},setShouldStartFromBeginning(n){t(r=>{r.interface.shouldStartFromBeginning=n})},setLastVolume(n){t(r=>{r.interface.lastVolume=n})},setHasOpenOverlay(n){t(r=>{r.interface.hasOpenOverlay=n})},setTimeFormat(n){t(r=>{r.interface.timeFormat=n})},updateInterfaceHovering(n){t(r=>{n!==it.NOT_HOVERING&&(r.interface.lastHoveringState=n),r.interface.hovering=n})},setSeeking(n){const r=s().display;r==null||r.setSeeking(n),t(a=>{a.interface.isSeeking=n})},setHoveringLeftControls(n){t(r=>{r.interface.leftControlHovering=n})},setHoveringAnyControls(n){t(r=>{r.interface.isHoveringControls=n})},hideNextEpisodeButton(){t(n=>{n.interface.hideNextEpisodeBtn=!0})},setSpeedBoosted(n){t(r=>{r.interface.isSpeedBoosted=n})},setShowSpeedIndicator(n){t(r=>{r.interface.showSpeedIndicator=n})}}),Mm=t=>({mediaPlaying:{isPlaying:!1,isPaused:!0,isLoading:!1,isSeeking:!1,isDragSeeking:!1,hasPlayedOnce:!1,volume:1,playbackRate:1},play(){t(s=>{s.mediaPlaying.isPlaying=!0,s.mediaPlaying.isPaused=!1})},pause(){t(s=>{s.mediaPlaying.isPlaying=!1,s.mediaPlaying.isPaused=!1})}}),_m=t=>({progress:{time:0,duration:0,buffered:0,draggingTime:0},setDraggingTime(s){t(n=>{n.progress.draggingTime=s})}});function Om(t,s){if(t.length===0)return null;const n=t.findIndex(l=>l.at>s);if(n===-1)return{index:t.length-1,image:t[t.length-1]};const r=t[n];if(n===0)return{index:n,image:r};const a=t[n-1],o=s-a.at,i=r.at-s;return o<i?{index:n-1,image:a}:{index:n,image:r}}const Bm=(t,s)=>({thumbnails:{images:[],resetImages(){t(n=>{n.thumbnails.images=[]})},addImage(n){const r=s(),a=r.thumbnails.images.findIndex(i=>i.at>=n.at);if(a===-1){t(i=>{i.thumbnails.images.push(n),i.thumbnails.images=[...i.thumbnails.images]});return}if(r.thumbnails.images[a].at===n.at){t(i=>{i.thumbnails.images[a]=n,i.thumbnails.images=[...i.thumbnails.images]});return}t(i=>{i.thumbnails.images.splice(a,0,n),i.thumbnails.images=[...i.thumbnails.images]})}}}),E=Ae(Oe((...t)=>({...Am(...t),..._m(...t),...Mm(...t),...Lm(...t),...Dm(...t),...Em(...t),...Bm(...t)})));function Fm(t){var d,m;const s=wo(),n=window.innerWidth<=768,r=/SmartTV|Tizen|WebOS|SamsungBrowser|HbbTV|Viera|NetCast|AppleTV|Android TV|GoogleTV|Roku|PlayStation|Xbox|Opera TV|AquosBrowser|Hisense|SonyBrowser|SharpBrowser|AFT|Chromecast/i.test(navigator.userAgent),a=E.getState(),o=navigator.connection||navigator.mozConnection||navigator.webkitConnection,i=performance.getEntriesByType("navigation")[0],l=performance.memory;return{timestamp:new Date().toISOString(),error:{message:(t==null?void 0:t.message)||(t==null?void 0:t.key)||String(t),type:(t==null?void 0:t.type)||"unknown",stackTrace:(t==null?void 0:t.stackTrace)||(t==null?void 0:t.stack)},device:{userAgent:navigator.userAgent,browser:(s==null?void 0:s.name)||"unknown",os:(s==null?void 0:s.os)||"unknown",isMobile:n,isTV:r,screenResolution:`${window.screen.width}x${window.screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`},player:{status:a.status,sourceId:a.sourceId,embedId:a.embedId??null,currentQuality:a.currentQuality,meta:a.meta?{title:a.meta.title,type:a.meta.type,tmdbId:a.meta.tmdbId,imdbId:a.meta.imdbId,releaseYear:a.meta.releaseYear,season:(d=a.meta.season)==null?void 0:d.number,episode:(m=a.meta.episode)==null?void 0:m.number}:null},network:{online:navigator.onLine,connectionType:o==null?void 0:o.type,effectiveType:o==null?void 0:o.effectiveType,downlink:o==null?void 0:o.downlink,rtt:o==null?void 0:o.rtt},hls:t!=null&&t.hls?{details:t.hls.details,fatal:t.hls.fatal,level:t.hls.level,levelDetails:t.hls.levelDetails?{url:t.hls.levelDetails.url,width:t.hls.levelDetails.width,height:t.hls.levelDetails.height,bitrate:t.hls.levelDetails.bitrate}:void 0,frag:t.hls.frag?{url:t.hls.frag.url,baseurl:t.hls.frag.baseurl,duration:t.hls.frag.duration,start:t.hls.frag.start,sn:t.hls.frag.sn}:void 0,type:t.hls.type,url:t.hls.url}:void 0,url:{pathname:window.location.pathname,search:window.location.search,hash:window.location.hash},performance:{memory:l?{usedJSHeapSize:l.usedJSHeapSize,totalJSHeapSize:l.totalJSHeapSize,jsHeapSizeLimit:l.jsHeapSizeLimit}:void 0,timing:{navigationStart:(i==null?void 0:i.fetchStart)||0,loadEventEnd:(i==null?void 0:i.loadEventEnd)||0,domContentLoadedEventEnd:(i==null?void 0:i.domContentLoadedEventEnd)||0}}}}function $m(t){return["=== ERROR DEBUG INFO ===",`Timestamp: ${t.timestamp}`,"","=== ERROR DETAILS ===",`Type: ${t.error.type}`,`Message: ${t.error.message}`,t.error.stackTrace?`Stack Trace:
${t.error.stackTrace}`:"","","=== DEVICE INFO ===",`Browser: ${t.device.browser} (${t.device.os})`,`User Agent: ${t.device.userAgent}`,`Screen: ${t.device.screenResolution}`,`Viewport: ${t.device.viewportSize}`,`Mobile: ${t.device.isMobile}`,`TV: ${t.device.isTV}`,"","=== PLAYER STATE ===",`Status: ${t.player.status}`,`Source ID: ${t.player.sourceId||"null"}`,`Embed ID: ${t.player.embedId||"null"}`,`Quality: ${t.player.currentQuality||"null"}`,t.player.meta?[`Media: ${t.player.meta.title} (${t.player.meta.type})`,`TMDB ID: ${t.player.meta.tmdbId}`,t.player.meta.imdbId?`IMDB ID: ${t.player.meta.imdbId}`:"",`Year: ${t.player.meta.releaseYear}`,t.player.meta.season?`Season: ${t.player.meta.season}`:"",t.player.meta.episode?`Episode: ${t.player.meta.episode}`:""].filter(Boolean).join(`
`):"No media loaded","","=== NETWORK INFO ===",`Online: ${t.network.online}`,t.network.connectionType?`Connection Type: ${t.network.connectionType}`:"",t.network.effectiveType?`Effective Type: ${t.network.effectiveType}`:"",t.network.downlink?`Downlink: ${t.network.downlink} Mbps`:"",t.network.rtt?`RTT: ${t.network.rtt} ms`:"","","=== URL INFO ===",`Path: ${t.url.pathname}`,t.url.search?`Query: ${t.url.search}`:"",t.url.hash?`Hash: ${t.url.hash}`:"","",t.hls?["=== HLS ERROR DETAILS ===",`Details: ${t.hls.details}`,`Fatal: ${t.hls.fatal}`,`Type: ${t.hls.type}`,t.hls.level!==void 0?`Level: ${t.hls.level}`:"",t.hls.url?`URL: ${t.hls.url}`:"",t.hls.levelDetails?["Level Details:",`  URL: ${t.hls.levelDetails.url}`,`  Resolution: ${t.hls.levelDetails.width}x${t.hls.levelDetails.height}`,`  Bitrate: ${t.hls.levelDetails.bitrate} bps`].join(`
`):"",t.hls.frag?["Fragment Details:",`  URL: ${t.hls.frag.url}`,`  Base URL: ${t.hls.frag.baseurl}`,`  Duration: ${t.hls.frag.duration}s`,`  Start: ${t.hls.frag.start}s`,`  Sequence: ${t.hls.frag.sn}`].join(`
`):""].filter(Boolean).join(`
`):"","","=== PERFORMANCE ===",t.performance.memory?[`Memory Used: ${Math.round(t.performance.memory.usedJSHeapSize/1024/1024)} MB`,`Memory Total: ${Math.round(t.performance.memory.totalJSHeapSize/1024/1024)} MB`,`Memory Limit: ${Math.round(t.performance.memory.jsHeapSizeLimit/1024/1024)} MB`].join(`
`):"Memory info not available"].filter(Boolean).join(`
`)}const Um=function(s){const[n,r]=c.useState(!1),a=c.useRef(null),{t:o}=q();let i=null;typeof s.error=="string"?i=s.error:s.error.key?i=`${s.error.type}: ${o(s.error.key)}`:s.error.message&&(i=`${s.error.type}: ${o(s.error.message)}`);function l(){if(!s.error||!navigator.clipboard)return;const d=Fm(s.error),m=$m(d),u=`\`\`\`
${i}

${m}
\`\`\``;navigator.clipboard.writeText(u),r(!0),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>r(!1),2e3)}return e.jsxs("div",{className:"bg-errors-card w-full rounded-lg p-6 text-left",children:[e.jsxs("div",{className:"border-errors-border flex items-center justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-white",children:o("errors.details")}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(Z,{theme:"secondary",padding:"p-2 h-10 min-w-[40px] md:px-4",onClick:()=>l(),children:n?e.jsxs(e.Fragment,{children:[e.jsx(M,{icon:k.CHECKMARK,className:"text-xs"}),e.jsx("span",{className:"hidden min-[400px]:inline-block ml-3",children:o("actions.copied")})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{icon:k.COPY,className:"text-2xl"}),e.jsx("span",{className:"hidden min-[400px]:inline-block ml-3",children:o("player.playbackError.copyDebugInfo")})]})}),e.jsx(Z,{theme:"secondary",padding:"p-2 md:px-2",onClick:s.onClose,children:e.jsx(M,{icon:k.X,className:"text-2xl"})})]})]}),e.jsx("div",{className:"pointer-events-auto mt-4 h-60 select-text overflow-y-auto whitespace-pre text-left",children:i}),e.jsx("p",{className:"mt-4 text-sm",children:o("player.playbackError.debugInfo")})]})},Ci=Um;function Hm(t){return!t.show||!t.error?null:e.jsx("div",{className:"fixed inset-0 flex h-full w-full items-center justify-center bg-black bg-opacity-30 p-12",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsx(Ci,{error:t.error,onClose:t.onClose})})})}function Vm(t){return t.error?e.jsx(Fs,{id:t.id,children:e.jsx("div",{className:"pointer-events-auto w-11/12 max-w-2xl",children:e.jsx(Ci,{error:t.error,onClose:t.onClose})})}):null}function Wm(t){const{t:s}=q(),[n,r]=c.useState(!1),o=(t.errorInfo.componentStack||"").split(`
`).slice(0,5),i=`${t.error.toString()}
${o.join(`
`)}`;return e.jsx("div",{className:"relative flex min-h-screen flex-1 flex-col",children:e.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center p-5 text-center",children:e.jsx(Ln,{children:e.jsxs(Pn,{maxWidth:"max-w-2xl w-9/10",children:[e.jsx(Tn,{icon:k.EYE_SLASH,children:s("errors.badge")}),e.jsx(ms,{children:s("errors.title")}),e.jsx(ye,{children:t.error.toString()}),e.jsx(Hm,{show:n,onClose:()=>r(!1),error:i}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(fa,{theme:"secondary",className:"mt-6 p-2.5 md:px-12",onClick:()=>window.location.reload(),children:s("errors.reloadPage")}),e.jsx(fa,{theme:"purple",className:"mt-6 p-2.5 md:px-12",onClick:()=>r(!0),children:s("errors.showError")})]})]})})})})}class Km extends c.Component{constructor(s){super(s),this.state={error:void 0}}componentDidCatch(s,n){console.error("Render error caught",s,n),this.setState(r=>({...r,error:{error:s,errorInfo:n}}))}render(){return this.state.error?e.jsx(Wm,{error:this.state.error.error,errorInfo:this.state.error.errorInfo}):this.props.children}}function jt(t){const[s,n]=c.useState(!1),r=c.useRef(!1);return c.useEffect(()=>{function a(){const o=window.innerWidth<1024;r.current!==o&&(r.current=o,n(o))}return a(),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[t]),{isMobile:s}}function qt(t){const{t:s}=q(),n=jt();return e.jsxs("div",{className:z("flex items-center space-x-2 rounded-full px-4 py-2 text-type-logo backdrop-blur-lg",t.backgroundClass??"bg-pill-background bg-opacity-50",t.clickable?"transition-[transform,background-color] hover:scale-105 hover:bg-pill-backgroundHover hover:text-type-logo active:scale-95":""),children:[e.jsx(M,{className:"text-2xl",icon:k.LOGO}),e.jsx("span",{className:["font-semibold text-white",n&&t.header?"hidden sm:block":""].join(" "),children:s("global.name")})]})}function lt(t){return e.jsx("div",{className:`mx-auto max-w-full px-8 ${t.ultraWide?"w-[1300px] xl:w-[18000px] 3xl:w-[2400px] 4xl:w-[2800px]":"w-[950px] xl:w-[1250px] 3xl:w-[1650px] 4xl:w-[1850px]"} ${t.classNames||""}`,children:t.children})}function Us(t){return e.jsx("div",{className:`mx-auto w-[600px] max-w-full px-8 sm:px-0 ${t.classNames||""}`,children:t.children})}function Hs(t){return e.jsx("div",{className:z("min-h-screen w-full flex justify-center p-8 py-24 items-center",t.classNames),children:e.jsx("div",{className:"w-[700px] max-w-full",children:t.children})})}function Ur(t){return e.jsx("div",{className:z("min-h-screen w-full flex justify-center p-8 py-24 items-center",t.classNames),children:e.jsx("div",{className:"w-[1100px] max-w-full",children:t.children})})}function et(t){const{t:s}=q(),n=s(t.k),r=s("global.pages.pagetitle",{title:n});return e.jsx(dt,{children:e.jsx("title",{children:t.subpage?r:n})})}function pt(t){return e.jsx("div",{className:z({"bg-onboarding-card duration-300 border border-onboarding-border rounded-lg p-7":!0,"hover:bg-onboarding-cardHover transition-colors cursor-pointer":!!t.onClick},t.className),onClick:t.onClick,children:t.children})}function Kn(t){return e.jsxs("div",{className:"grid grid-rows-[1fr,auto] h-full",children:[e.jsxs("div",{children:[e.jsx(M,{icon:k.RISING_STAR,className:z("text-4xl mb-8 block",t.colorClass)}),e.jsx(Gt,{className:z("!mt-0 !mb-0 !text-xs uppercase",t.colorClass),children:t.subtitle}),e.jsx(Ce,{className:"!mb-0 !mt-1 !text-base",children:t.title}),e.jsx(ye,{className:"max-w-[320px] !my-4",children:t.description})]}),e.jsx("div",{children:t.children})]})}function zn(t){return e.jsxs("div",{className:"grid grid-rows-[1fr,auto] h-full",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Gt,{className:z("!mt-0 !mb-0 !text-xs uppercase !mr-2",t.colorClass),children:t.subtitle}),e.jsx(Ce,{className:"!mb-0 !mt-1 !text-sm",children:t.title})]}),e.jsx(M,{icon:k.ARROW_RIGHT,className:z("text-3xl mb-4 ml-auto block",t.colorClass)})]}),e.jsx(ye,{className:"max-w-[320px] !my-2 text-sm",children:t.description}),e.jsx("div",{className:"text-sm",children:t.children})]})}function ft(t){const s=be();return e.jsxs("a",{onClick:()=>{t.to&&s(t.to)},href:t.href,target:t.target,className:z("text-onboarding-link cursor-pointer inline-flex gap-2 items-center group hover:opacity-75 transition-opacity",t.className),rel:"noreferrer",children:[t.children,e.jsx(M,{icon:k.ARROW_RIGHT,className:"group-hover:translate-x-0.5 transition-transform text-xl group-active:translate-x-0"})]})}function Ei(){return!!le().DMCA_EMAIL}function es(t){return e.jsxs("div",{className:"bg-onboarding-card/40 duration-300 border border-onboarding-border rounded-lg p-7",children:[e.jsxs("div",{children:[e.jsx(M,{icon:t.icon,className:z("text-4xl mb-6 block",t.colorClass)}),e.jsx(Gt,{className:z("!mt-0 !mb-0 !text-xs uppercase",t.colorClass),children:t.subtitle}),e.jsx(Ce,{className:"!mb-0 !mt-1 !text-base",children:t.title}),e.jsx("div",{className:"!my-4 space-y-3 text-gray-300",children:t.description})]}),e.jsx("div",{children:t.children})]})}function zm(){return e.jsxs(st,{children:[e.jsx(et,{subpage:!0,k:"global.pages.legal"}),e.jsxs(Ur,{classNames:"!pt-0",children:[e.jsx(wt,{children:"DMCA + Legal Information"}),e.jsx(ye,{className:"text-gray-400 text-lg mb-8",children:"Important information about our service, content policies, and user responsibilities."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4",children:[e.jsx(es,{icon:k.SEARCH,subtitle:"Service Model",title:"How We Operate",colorClass:"text-blue-400",description:e.jsxs(e.Fragment,{children:[e.jsxs(ye,{children:["P-Stream functions as a search engine and content aggregator that indexes publicly available media from across the internet.",e.jsx("br",{}),e.jsx("br",{}),"We don't host, store, or control any media files - everything is sourced from external third-party websites that are already publicly accessible.",e.jsx("br",{}),e.jsx("br",{}),"Our automated systems simply provide links to content that's already available online, without bypassing any security measures."]}),e.jsx(ft,{to:"/about",children:"Learn more about how P-Stream works"})]})}),e.jsx(es,{icon:k.CIRCLE_CHECK,subtitle:"Copyright Policy",title:"Content & Copyright",colorClass:"text-green-400",description:e.jsxs(ye,{children:["Since we don't host any content ourselves, all takedown requests must go directly to the websites that actually host the files.",e.jsx("br",{}),e.jsx("br",{}),"We respect intellectual property rights and will cooperate with valid legal requests within our technical capabilities.",e.jsx("br",{}),e.jsx("br",{}),"For content removal, please contact the original hosting platform - we cannot remove what we don't control.",e.jsx("br",{}),e.jsx("br",{}),"If you are a copyright holder and want to report a violation, we are more than happy to point you to where we found the content."]})}),e.jsx(es,{icon:k.EYE_SLASH,subtitle:"Data Protection",title:"Privacy & Data",colorClass:"text-purple-400",description:e.jsxs(ye,{children:["User privacy is important to us. We don't collect, store, or track any personal information about our users.",e.jsx("br",{}),e.jsx("br",{}),"Optionally, users can store their bookmarks and watch history in our encrypted backend. But we don't store any personal information or identifying data.",e.jsx("br",{}),e.jsx("br",{}),"P-Stream is entirely self hostable, and can be run on any server. Even by yourself."]})}),e.jsx(es,{icon:k.USER,subtitle:"User Responsibilities",title:"User Guidelines",colorClass:"text-yellow-400",description:e.jsxs(ye,{children:["Users are responsible for ensuring their access complies with local laws and regulations in their jurisdiction.",e.jsx("br",{}),e.jsx("br",{}),"We strongly recommend using VPN services for enhanced privacy and security while browsing. Downloading is not advised.",e.jsx("br",{}),e.jsx("br",{}),"Please respect intellectual property rights and be mindful of copyright laws in your area."]})}),e.jsx(es,{icon:k.WARNING,subtitle:"Terms & Conditions",title:"Service Terms",colorClass:"text-red-400",description:e.jsxs(ye,{children:["P-Stream is licensed under the MIT license.",e.jsx("br",{}),e.jsx("br",{}),"By using our platform, you acknowledge these terms and agree that we're not responsible for third-party content.",e.jsx("br",{}),e.jsx("br",{}),"We operate in good faith compliance with applicable laws and regulations. We are not liable for any damages or losses incurred while using our service."]})}),e.jsx(es,{icon:k.MAIL,subtitle:"Legal Contact",title:"Legal Inquiries",colorClass:"text-cyan-400",description:e.jsxs(ye,{children:["For legal matters related to specific content, please contact the hosting websites directly as they have control over their files.",e.jsx("br",{}),e.jsx("br",{}),"P-Stream operates within legal boundaries and cooperates with legitimate requests when technically feasible."]}),children:le().DMCA_EMAIL&&e.jsxs("div",{className:"flex space-x-3 items-center pt-4",children:[e.jsx(M,{icon:k.MAIL,className:"text-white"}),e.jsx("span",{className:"text-gray-300",children:"Contact: "}),e.jsx("a",{href:`mailto:${le().DMCA_EMAIL}`,className:"text-type-link hover:text-white transition-colors duration-300",children:le().DMCA_EMAIL})]})})]})]})]})}function sn(t){const s=be(),n=c.useCallback(()=>{t.to&&s(t.to)},[s,t.to]);return e.jsxs("a",{href:t.href,target:t.href?"_blank":void 0,rel:"noreferrer",className:"tabbable rounded py-2 px-3 inline-flex cursor-pointer items-center space-x-3 transition-colors duration-200 hover:text-type-emphasis",onClick:t.to?n:void 0,children:[e.jsx(M,{icon:t.icon,className:"text-2xl"}),e.jsx("span",{className:"font-medium",children:t.children})]})}function ya(){const{t}=q();return!Ei()||window.location.hash==="#/legal"?null:e.jsx(sn,{to:"/legal",icon:k.DRAGON,children:t("footer.links.legal")})}function Gm(){const{t}=q();return e.jsx("footer",{className:"mt-16 border-t border-type-divider py-16 md:py-8",children:e.jsxs(lt,{ultraWide:!0,classNames:"grid md:grid-cols-2 gap-16 md:gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"inline-block",children:e.jsx(qt,{})}),e.jsx("p",{className:"mt-4 lg:max-w-[400px]",children:t("footer.tagline")})]}),e.jsxs("div",{className:"md:text-right",children:[e.jsx("h3",{className:"font-semibold text-type-emphasis",children:t("footer.legal.disclaimer")}),e.jsx("p",{className:"mt-3",children:t("footer.legal.disclaimerText")})]}),e.jsxs("div",{className:"flex flex-wrap gap-[0.5rem] -ml-3",children:[le().GITHUB_LINK&&e.jsx(sn,{icon:k.GITHUB,href:le().GITHUB_LINK,children:t("footer.links.github")}),e.jsx(sn,{icon:k.DISCORD,href:le().DISCORD_LINK,children:t("footer.links.discord")}),e.jsx(sn,{href:"https://rentry.co/h5mypdfs",icon:k.TIP_JAR,children:t("footer.links.funding")}),e.jsx("div",{className:"inline md:hidden",children:e.jsx(ya,{})})]}),e.jsx("div",{className:"hidden items-center justify-end md:flex -mr-3",children:e.jsx(ya,{})})]})})}function Ii(t){return e.jsxs("div",{className:["flex min-h-screen flex-col",t.className||""].join(" "),children:[e.jsx("div",{style:{flex:"1 0 auto"},children:t.children}),e.jsx(Gm,{})]})}function Ti(t){return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:z(t.sizeClass,"rounded-full overflow-hidden flex items-center justify-center text-white"),style:{background:`linear-gradient(to bottom right, ${t.profile.colorA}, ${t.profile.colorB})`},children:e.jsx(xt,{className:t.iconClass,icon:t.profile.icon})}),t.bottom?e.jsx("div",{className:"absolute bottom-0 left-1/2 transform translate-y-1/2 -translate-x-1/2",children:t.bottom}):null]})}function Ri(t){const s=he(),n=c.useMemo(()=>s.account&&s.account.seed?In(s.account.seed):null,[s]);if(!s.account||s.account===null)return null;const r=n?hi(s.account.deviceName,n):"...";return e.jsxs(e.Fragment,{children:[e.jsx(Ti,{profile:s.account.profile,sizeClass:t.sizeClass??"w-[1.5rem] h-[1.5rem] ssm:w-[2rem] ssm:h-[2rem]",iconClass:t.iconClass,bottom:t.bottom}),t.withName&&n?e.jsx("span",{className:"hidden md:inline-block",children:r.length>=20?`${r.slice(0,19)}‚Ä¶`:r}):null]})}function qm(t){return e.jsx("div",{className:"relative inline-block p-1 text-type-dimmed",children:e.jsx(M,{className:t.iconClass??"text-base ssm:text-xl",icon:k.MENU})})}async function Ym(t,s,n){if(!t)throw new Error("Backend URL not set");const r=await fetch(`${t}/api/player/status`,{method:"POST",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s.token}`}:{}},body:JSON.stringify(n)});if(!r.ok)throw new Error(`Failed to send player status: ${r.statusText}`);return r.json()}async function Ps(t,s,n){if(!t)throw new Error("Backend URL not set");const r=await fetch(`${t}/api/player/status?roomCode=${encodeURIComponent(n)}`,{headers:s?{Authorization:`Bearer ${s.token}`}:{}});if(!r.ok)throw new Error(`Failed to get room statuses: ${r.statusText}`);return r.json()}function va(){return e.jsx("hr",{className:"border-0 w-full h-px bg-dropdown-border"})}const Qm=function(s){const n=be(),r=a=>{a.startsWith("http")?window.open(a,"_blank"):(window.scrollTo(0,0),n(a))};return e.jsx("a",{tabIndex:0,href:s.href,onClick:a=>{var o;a.preventDefault(),s.href?r(s.href):(o=s.onClick)==null||o.call(s)},className:s.className,children:s.children})},Pi=Qm;function ts(t){return e.jsxs(Pi,{onClick:t.onClick,href:t.href,className:z("tabbable cursor-pointer flex gap-3 items-center m-3 p-1 rounded font-medium transition-colors duration-100",t.highlight?"text-dropdown-highlight hover:text-dropdown-highlightHover":"text-dropdown-text hover:text-white",t.className),children:[t.icon?e.jsx(M,{icon:t.icon,className:"text-xl"}):null,t.children]})}function Qs(t){return e.jsx(Pi,{href:t.href,onClick:()=>window.scrollTo(0,0),className:"tabbable w-11 h-11 rounded-full bg-dropdown-contentBackground text-dropdown-text hover:text-white transition-colors duration-100 flex justify-center items-center",children:e.jsx(M,{className:"text-2xl",icon:t.icon})})}const Xm=function(){const{t:s}=q(),n=be(),[r,a]=c.useState(""),[o,i]=c.useState(!1),[l,d]=c.useState(!1),[m,u]=c.useState(null),p=He(),g=he(x=>x.account),h=async x=>{var y;if(x.preventDefault(),!(!r.trim()||!p)){d(!0),u(null);try{const f=await Ps(p,g,r.trim().toUpperCase()),b=Object.values(f.users);if(b.length===0){u(s("watchParty.emptyRoom"));return}const v=(y=b.find(O=>O[0].isHost))==null?void 0:y[0];if(!v){u(s("watchParty.noHost"));return}const{content:w}=v;let R="";w.type.toLowerCase()==="tv show"&&w.seasonId&&w.episodeId?R=`/media/tmdb-tv-${w.tmdbId}/${w.seasonId}/${w.episodeId}`:R=`/media/tmdb-movie-${w.tmdbId}`;const P=new URL(R,window.location.origin);P.searchParams.set("watchparty",r.trim().toUpperCase()),n(P.pathname+P.search),a("")}catch(f){console.error("Failed to fetch room data:",f),u(s("watchParty.invalidRoom"))}finally{d(!1)}}};return e.jsx("form",{onSubmit:h,className:z("m-3 p-1 rounded font-medium transition-colors duration-100 group","text-dropdown-text hover:text-white",o?"bg-dropdown-contentBackground":""),children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{icon:k.WATCH_PARTY,className:"text-xl"}),e.jsx("input",{type:"text",value:r,onChange:x=>{a(x.target.value.toUpperCase()),u(null)},onFocus:()=>i(!0),onBlur:()=>i(!1),placeholder:s("watchParty.joinParty"),className:"bg-transparent border-none outline-none w-full text-base placeholder:text-dropdown-text group-hover:placeholder:text-white",maxLength:10,disabled:l}),e.jsx("button",{type:"submit",className:z("p-1 rounded hover:bg-dropdown-contentBackground transition-colors",l&&"opacity-50 cursor-not-allowed",!r.trim()&&"opacity-0 pointer-events-none"),disabled:!r.trim()||l,children:l?e.jsx(Vt,{className:"w-5 h-5"}):e.jsx(M,{icon:k.ARROW_RIGHT,className:"text-xl transition-opacity duration-200"})})]}),m&&e.jsx("p",{className:"text-xs text-red-500 px-1 ml-8",children:m})]})})},Jm=Xm;function Zm(t){const{t:s}=q(),[n,r]=c.useState(!1),a=he(u=>{var p;return(p=u.account)==null?void 0:p.deviceName}),o=he(u=>{var p;return(p=u.account)==null?void 0:p.seed}),i=c.useMemo(()=>o?In(o):null,[o]),{logout:l}=Mt();c.useEffect(()=>{function u(p){p.target.closest(".is-dropdown")||r(!1)}return window.addEventListener("click",u),()=>window.removeEventListener("click",u)},[]);const d=c.useCallback(()=>{r(u=>!u)},[]),m=J(u=>u.enableLowPerformanceMode);return e.jsxs("div",{className:"relative is-dropdown",children:[e.jsxs("div",{className:z("cursor-pointer tabbable rounded-full flex gap-2 text-white items-center py-2 px-3 bg-pill-background hover:bg-pill-backgroundHover backdrop-blur-lg transition-all duration-100 hover:scale-105",n?"bg-opacity-100":"bg-opacity-50"),tabIndex:0,onClick:d,onKeyUp:u=>u.key==="Enter"&&d(),children:[t.children,e.jsx(M,{className:z("text-xl transition-transform duration-100",n?"rotate-180":""),icon:k.CHEVRON_DOWN})]}),e.jsx(Se,{animation:"slide-down",show:n,children:e.jsxs("div",{className:"rounded-lg absolute w-64 bg-dropdown-altBackground top-full mt-3 right-0",children:[a&&i?e.jsxs(ts,{className:"text-white",href:"/settings",children:[e.jsx(Ri,{}),hi(a,i)]}):e.jsx(ts,{href:"/login",icon:k.RISING_STAR,highlight:!0,children:s("navigation.menu.register")}),e.jsx(va,{}),e.jsx(ts,{href:"/settings",icon:k.SETTINGS,children:s("navigation.menu.settings")}),null,e.jsx(ts,{href:"/about",icon:k.CIRCLE_QUESTION,children:s("navigation.menu.about")}),!m&&e.jsx(ts,{href:"/discover",icon:k.RISING_STAR,children:s("navigation.menu.discover")}),e.jsx(Jm,{}),a?e.jsx(ts,{className:"!text-type-danger opacity-75 hover:opacity-100",icon:k.LOGOUT,onClick:l,children:s("navigation.menu.logout")}):null,e.jsx(va,{}),e.jsxs("div",{className:"my-4 flex justify-center items-center gap-4",children:[le().GITHUB_LINK&&e.jsx(Qs,{href:le().GITHUB_LINK,icon:k.GITHUB}),e.jsx(Qs,{href:le().DISCORD_LINK,icon:k.DISCORD}),e.jsx(Qs,{href:"/support",icon:k.SUPPORT}),e.jsx(Qs,{href:"https://rentry.co/h5mypdfs",icon:k.TIP_JAR})]})]})})]})}function Gn(t){return e.jsx("div",{className:z({"bg-onboarding-card duration-300 border border-onboarding-border rounded-lg p-7":!0,"hover:bg-onboarding-cardHover transition-colors cursor-pointer":!!t.onClick},t.className),onClick:t.onClick,children:t.children})}function qn(t){return e.jsxs("div",{className:"grid grid-rows-[1fr,auto] h-full",children:[e.jsxs("div",{children:[e.jsx(M,{icon:t.icon,className:z("text-4xl mb-8 block",t.colorClass)}),e.jsx(Gt,{className:z("!mt-0 !mb-0 !text-xs uppercase",t.colorClass),children:t.subtitle}),e.jsx(Ce,{className:"!mb-0 !mt-1 !text-base",children:t.title}),e.jsx(ye,{className:"max-w-[320px] !my-4",children:t.description})]}),e.jsx("div",{children:t.children})]})}function nn(t){const s=be();return e.jsxs("a",{onClick:()=>{t.to&&s(t.to)},href:t.href,target:t.target,className:z("text-onboarding-link cursor-pointer inline-flex gap-2 items-center group hover:opacity-75 transition-opacity",t.className),rel:"noreferrer",children:[t.children,e.jsx(M,{icon:k.ARROW_RIGHT,className:"group-hover:translate-x-0.5 transition-transform text-xl group-active:translate-x-0"})]})}const wa=["/notifications.xml"],Li=()=>{try{const t=localStorage.getItem("notification-custom-feeds");if(t){const s=JSON.parse(t);return[...wa,...s]}}catch{}return wa},Di=async t=>{if(t.startsWith("/")){const n=await fetch(t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.text()}return await Ht(t,{responseType:"text"})},Ai=t=>{if(t==="/notifications.xml")return"P-Stream";try{return new URL(t).hostname.replace("www.","")}catch{return"Unknown"}},eh=t=>{const n=new Date().getTime()-t.getTime(),r=Math.floor(n/(1e3*60*60*24));if(r===0){const o=Math.floor(n/36e5);if(o===0){const i=Math.floor(n/6e4);return i===0?"just now":`${i} minute${i!==1?"s":""} ago`}return`${o} hour${o!==1?"s":""} ago`}if(r===1)return"1 day ago";if(r<7)return`${r} days ago`;if(r<30){const o=Math.floor(r/7);return`${o} week${o!==1?"s":""} ago`}if(r<365){const o=Math.floor(r/30);return`${o} month${o!==1?"s":""} ago`}const a=Math.floor(r/365);return`${a} year${a!==1?"s":""} ago`},ja=t=>{try{const s=new Date(t),n=s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),r=eh(s);return`${n} ‚Ä¢ ${r}`}catch{return t}},ka=t=>{if(!t||t.trim()==="")return"";switch(t.toLowerCase()){case"announcement":return"bg-blue-500";case"feature":return"bg-green-500";case"update":return"bg-yellow-500";case"bugfix":return"bg-red-500";default:return""}},Na=t=>{switch(t.toLowerCase()){case"announcement":return"Announcement";case"feature":return"New Feature";case"update":return"Update";case"bugfix":return"Bug Fix";default:return t}};function Mi(t){return t.replace(/\n{3,}/g,`

`).replace(/\n- /g,"</p><p>‚Ä¢ ").replace(/\n\*\*([^*]+)\*\*/g,"</p><h4>$1</h4><p>").replace(/\n\n/g,"</p><br /><p>").replace(/\n/g,"<br />").replace(/^/,"<p>").replace(/$/,"</p>").replace(/<p><\/p>/g,"").replace(/<\/p><p><\/p>/g,"</p>").replace(/<p><\/p><p>/g,"<p>").replace(/<p>‚Ä¢ /g,'<p class="flex items-start gap-2"><span class="text-type-link">‚Ä¢</span><span>').replace(/<\/p>/g,"</span></p>")}const th=function({selectedNotification:s,goBackToList:n,getCategoryColor:r,getCategoryLabel:a,formatDate:o,isRead:i,toggleReadStatus:l}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex md:flex-row flex-col items-start md:items-center justify-between gap-4 pb-4 border-b border-utils-divider",children:[e.jsxs("button",{type:"button",onClick:n,className:"text-type-link hover:text-type-linkHover transition-colors flex items-center gap-1 text-sm",children:[e.jsx(M,{icon:k.CHEVRON_LEFT}),e.jsx("span",{children:"Back to notifications"})]}),e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:l,className:`text-sm transition-colors flex items-center gap-2 px-3 py-1 rounded-md ${i?"text-type-link hover:text-type-linkHover bg-background-main/50 hover:bg-background-main/70":"text-type-secondary hover:text-white bg-background-main/30 hover:bg-background-main/50"}`,children:[e.jsx(M,{icon:i?k.EYE_SLASH:k.EYE}),e.jsx("span",{children:i?"Mark as unread":"Mark as read"})]})})]}),e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[70vh] md:max-h-[60vh]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r(s.category)&&e.jsx("span",{className:`inline-block w-3 h-3 rounded-full ${r(s.category)}`}),a(s.category)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-type-secondary",children:a(s.category)}),s.source&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-type-secondary",children:"‚Ä¢"}),e.jsx("span",{className:"text-sm text-type-secondary text-nowrap",children:s.source})]}),e.jsx("span",{className:"text-sm text-type-secondary",children:"‚Ä¢"}),e.jsx("span",{className:"text-sm text-type-secondary",children:o(s.pubDate)})]}),!a(s.category)&&e.jsxs(e.Fragment,{children:[s.source&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-type-secondary",children:s.source}),e.jsx("span",{className:"text-sm text-type-secondary",children:"‚Ä¢"})]}),e.jsx("span",{className:"text-sm text-type-secondary",children:o(s.pubDate)})]})]}),e.jsx("div",{className:"prose prose-invert max-w-none",children:e.jsx("div",{className:"text-type-secondary leading-relaxed",dangerouslySetInnerHTML:{__html:Mi(s.description)}})}),s.link&&e.jsx("div",{className:"pt-4 border-t border-utils-divider",children:e.jsxs(nn,{href:s.link,target:"_blank",children:[e.jsx(M,{icon:k.LINK}),e.jsx("span",{children:"Go to page"})]})})]})]})},sh=th;function nh({notifications:t,readNotifications:s,unreadCount:n,loading:r,error:a,containerRef:o,markAllAsRead:i,markAllAsUnread:l,isShiftHeld:d,onRefresh:m,onOpenSettings:u,openNotificationDetail:p,getCategoryColor:g,getCategoryLabel:h,formatDate:x}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center pb-4 border-b border-utils-divider",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-start md:gap-2",children:[e.jsxs("span",{className:"text-sm text-type-secondary",children:[n," unread notification",n!==1?"s":""]}),e.jsx("div",{className:"flex gap-2",children:d?e.jsx("button",{type:"button",onClick:l,className:"text-sm text-red-400 hover:text-red-300 transition-colors",children:"Mark all as unread"}):n>0&&e.jsx("button",{type:"button",onClick:i,className:"text-sm text-type-link hover:text-type-linkHover transition-colors",children:"Mark all as read"})})]}),e.jsxs("div",{className:"flex-1 flex justify-end gap-2 md:mr-4",children:[e.jsx("button",{type:"button",onClick:u,className:"text-sm text-type-secondary hover:text-white transition-colors",children:e.jsx(M,{icon:k.SETTINGS})}),e.jsx("button",{type:"button",onClick:m,disabled:r,className:"text-sm text-type-secondary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(M,{icon:k.RELOAD,className:r?"animate-spin":""})})]})]}),r&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-2",children:[e.jsx(M,{icon:k.RELOAD,className:"animate-spin rounded-full text-type-secondary text-[2rem]"}),e.jsx("span",{className:"ml-3 text-type-secondary",children:"Loading..."})]}),a&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-2",children:[e.jsx(M,{icon:k.WARNING,className:"text-[2rem] text-red-400"}),e.jsx("p",{className:"text-red-400 mb-2",children:"Failed to load notifications"}),e.jsx("p",{className:"text-sm text-type-secondary",children:a})]}),!r&&!a&&e.jsx("div",{ref:o,className:"space-y-4 overflow-y-auto max-h-[70vh] md:max-h-[60vh]",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-2",children:[e.jsx(M,{icon:k.BELL,className:"text-type-secondary text-[2rem]"}),e.jsx("p",{className:"text-type-secondary",children:"No notifications available"})]}):t.map(y=>{const f=s.has(y.guid);return e.jsxs("div",{className:`p-4 rounded-lg border transition-all cursor-pointer hover:bg-background-main/50 md:mr-2 ${f?"bg-background-main border-utils-divider opacity-75":"bg-background-main border-type-link/70 shadow-sm"}`,onClick:()=>p(y),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap order-2 sm:order-1",children:e.jsx("h3",{className:`font-medium ${f?"text-type-secondary":"text-white"}`,children:y.title})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-1 sm:gap-2 order-1 sm:order-2",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:hidden",children:[g(y.category)&&e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${g(y.category)}`}),e.jsx("span",{className:"text-xs text-type-secondary",children:h(y.category)}),y.source&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-type-secondary",children:"‚Ä¢"}),e.jsx("span",{className:"text-xs text-type-secondary",children:y.source})]})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-col sm:items-end sm:gap-1",children:[y.source&&e.jsx("span",{className:"text-xs text-type-secondary font-medium",children:y.source}),e.jsxs("div",{className:"flex items-center gap-2",children:[g(y.category)&&e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${g(y.category)}`}),e.jsx("span",{className:"text-xs text-type-secondary",children:h(y.category)})]})]})]})]}),e.jsx("div",{className:"text-sm text-type-secondary mb-2 line-clamp-2 max-w-[12rem] md:max-w-[30rem] md:pr-8",dangerouslySetInnerHTML:{__html:Mi(y.description).substring(0,150)+(y.description.length>150?"...":"")}})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-type-secondary",children:x(y.pubDate)}),e.jsx(M,{icon:k.CHEVRON_RIGHT,className:"text-type-link"})]})]},y.guid)})})]})}const rh=function({autoReadDays:s,setAutoReadDays:n,customFeeds:r,setCustomFeeds:a,markAllAsUnread:o,onClose:i}){const l=()=>{a([...r,""])},d=(u,p)=>{a(r.map((g,h)=>h!==u?g:p))},m=u=>{a(r.filter((p,g)=>g!==u))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-3 pb-4 border-b border-utils-divider",children:e.jsxs("button",{type:"button",onClick:i,className:"text-type-link hover:text-type-linkHover transition-colors flex items-center gap-1 text-sm",children:[e.jsx(M,{icon:k.CHEVRON_LEFT}),e.jsx("span",{children:"Back to notifications"})]})}),e.jsxs("div",{className:"space-y-6 overflow-y-auto max-h-[70vh] md:max-h-[60vh] md:pr-2",children:[e.jsxs("div",{className:"bg-background-main/30 rounded-lg p-4 border border-utils-divider",children:[e.jsx("h3",{className:"text-white font-bold mb-3",children:"Mark All as Unread"}),e.jsx("p",{className:"text-sm text-type-secondary mb-4",children:"Permanently mark all notifications as unread. This action cannot be undone."}),e.jsx("button",{type:"button",onClick:o,className:"text-sm text-red-400 hover:text-red-300 transition-colors px-3 py-1 rounded-md border border-red-400/30 hover:border-red-400/50",children:"Mark All as Unread"})]}),e.jsxs("div",{className:"bg-background-main/30 rounded-lg p-4 border border-utils-divider",children:[e.jsx("h3",{className:"text-white font-bold mb-3",children:"Auto-Mark as Read"}),e.jsx("p",{className:"text-sm text-type-secondary mb-4",children:"Automatically mark notifications as read after this many days."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",min:"1",max:"365",value:s,onChange:u=>n(parseInt(u.target.value,10)||14),className:"bg-background-secondary border border-type-secondary rounded px-3 py-2 text-white w-20"}),e.jsx("span",{className:"text-sm text-type-secondary",children:"days"})]})]}),e.jsxs("div",{className:"bg-background-main/30 rounded-lg p-4 border border-utils-divider",children:[e.jsx("h3",{className:"text-white font-bold mb-3",children:"Custom RSS Feeds"}),e.jsxs("p",{className:"text-sm text-type-secondary mb-4",children:["Add custom RSS feeds to receive notifications from other sources.",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-type-danger",children:"Note: This feature is experimental and may not work for all feeds."})]}),e.jsxs("div",{className:"space-y-2 max-w-md",children:[r.length===0?e.jsx("p",{className:"text-sm text-type-secondary",children:"No custom feeds added"}):null,r.map((u,p)=>e.jsxs("div",{className:"grid grid-cols-[1fr,auto] items-center gap-2",children:[e.jsx("input",{type:"url",value:u,onChange:g=>d(p,g.target.value),placeholder:"https://example.com/feed.xml",className:"bg-background-secondary border border-type-secondary rounded px-3 py-2 text-white text-sm"}),e.jsx("button",{type:"button",onClick:()=>m(p),className:"h-full scale-90 hover:scale-100 rounded-full aspect-square bg-authentication-inputBg hover:bg-authentication-inputBgHover flex justify-center items-center transition-transform duration-200 hover:text-white cursor-pointer",children:e.jsx(M,{className:"text-xl",icon:k.X})})]},p))]}),e.jsx("button",{type:"button",onClick:l,className:"mt-3 text-sm text-type-link hover:text-type-linkHover transition-colors px-3 py-1 rounded-md border border-type-link/30 hover:border-type-link/50",children:"Add Custom Feed"})]}),e.jsxs("div",{className:"bg-background-main/30 rounded-lg p-4 border border-utils-divider",children:[e.jsx("h3",{className:"text-white font-bold mb-3",children:"Recommended Feeds"}),e.jsxs("code",{className:"text-type-secondary text-xs md:text-sm",children:["https://www.moviefone.com/feeds/movie-news.rss",e.jsx("br",{}),"https://www.moviefone.com/feeds/tv-news.rss",e.jsx("br",{}),"https://www.filmjabber.com/rss/rss-dvd-reviews.php",e.jsx("br",{}),"https://screenrant.com/feed/",e.jsx("br",{}),"https://www.darkhorizons.com/feed/"]})]})]})]})},ah=rh;function oh({id:t}){const[s,n]=c.useState([]),[r,a]=c.useState(!0),[o,i]=c.useState(null),[l,d]=c.useState(new Set),[m,u]=c.useState("list"),[p,g]=c.useState(null),[h,x]=c.useState(!1),y=c.useRef(null),[f,b]=c.useState(14),[v,w]=c.useState([]);c.useEffect(()=>{const j=localStorage.getItem("read-notifications");if(j)try{const H=JSON.parse(j);d(new Set(H))}catch(H){console.error("Failed to parse read notifications:",H)}const B=localStorage.getItem("notification-auto-read-days");if(B)try{b(parseInt(B,10))}catch(H){console.error("Failed to parse auto read days:",H)}const W=localStorage.getItem("notification-custom-feeds");if(W)try{w(JSON.parse(W))}catch(H){console.error("Failed to parse custom feeds:",H)}},[]),c.useEffect(()=>{const j=W=>{W.key==="Shift"&&x(!0)},B=W=>{W.key==="Shift"&&x(!1)};return window.addEventListener("keydown",j),window.addEventListener("keyup",B),()=>{window.removeEventListener("keydown",j),window.removeEventListener("keyup",B)}},[]);const R=c.useCallback(async()=>{try{a(!0),i(null);const j=[],B=[],W=new Date;W.setDate(W.getDate()-f);const H=Li();for(const $ of H)if($.trim())try{const K=await Di($);if(K&&(K.includes("<rss")||K.includes("<feed"))){const T=new DOMParser().parseFromString(K,"text/xml");if(!T.querySelector("parsererror")&&T&&T.documentElement){const ae=T.querySelectorAll("item, entry");ae&&ae.length>0&&ae.forEach(ce=>{var Q,xe,ee,Pe,Ie,G,oe,ie,de,te,ne,F;try{const se=((Q=ce.querySelector("guid"))==null?void 0:Q.textContent)||((xe=ce.querySelector("id"))==null?void 0:xe.textContent)||"",ue=((ee=ce.querySelector("title"))==null?void 0:ee.textContent)||"",Me=((Pe=ce.querySelector("link"))==null?void 0:Pe.textContent)||((Ie=ce.querySelector("link"))==null?void 0:Ie.getAttribute("href"))||"",$e=((G=ce.querySelector("description"))==null?void 0:G.textContent)||((oe=ce.querySelector("content"))==null?void 0:oe.textContent)||((ie=ce.querySelector("summary"))==null?void 0:ie.textContent)||"",Ve=((de=ce.querySelector("pubDate"))==null?void 0:de.textContent)||((te=ce.querySelector("published"))==null?void 0:te.textContent)||((ne=ce.querySelector("updated"))==null?void 0:ne.textContent)||"",Xt=((F=ce.querySelector("category"))==null?void 0:F.textContent)||"",_e=se||Me;if(!_e||!ue)return;const Un=new Date(Ve);j.push({guid:_e,title:ue,link:Me,description:$e,pubDate:Ve,category:Xt,source:Ai($)}),Un<=W&&B.push(_e)}catch(se){console.warn("Skipping malformed RSS/Atom item:",se)}})}}}catch{}n(j),B.length>0&&d($=>{const K=new Set($);return B.forEach(V=>K.add(V)),localStorage.setItem("read-notifications",JSON.stringify(Array.from(K))),K})}catch(j){console.error("RSS fetch error:",j),i(j instanceof Error?j.message:"Failed to load notifications"),n([])}finally{a(!1)}},[f]);c.useEffect(()=>{R()},[R]);const P=()=>{R()},O=j=>{const B=new Set(l);B.add(j),d(B),localStorage.setItem("read-notifications",JSON.stringify(Array.from(B)))},U=()=>{const j=s.map(W=>W.guid),B=new Set(j);d(B),localStorage.setItem("read-notifications",JSON.stringify(Array.from(B)))},D=()=>{d(new Set),localStorage.setItem("read-notifications",JSON.stringify([]))},S=j=>{g(j),u("detail"),O(j.guid)},N=()=>{u("list"),g(null)},C=()=>{u("settings")},_=()=>{u("list")},I=j=>{b(j),localStorage.setItem("notification-auto-read-days",j.toString())},A=j=>{w(j),localStorage.setItem("notification-custom-feeds",JSON.stringify(j))};c.useEffect(()=>{if(s.length>0&&y.current&&m==="list"){const j=s.findIndex(B=>!l.has(B.guid));if(j>0){const B=y.current.children[j];if(B){const W=y.current,H=B.offsetTop,$=W.clientHeight,K=B.clientHeight,V=H-$/2+K/2;W.scrollTo({top:Math.max(0,V),behavior:"smooth"})}}}},[s,l,m]);const L=s.filter(j=>!l.has(j.guid)).length;return o&&!r?e.jsx(mr,{id:t,title:"Notifications",size:"lg",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-2",children:[e.jsx(M,{icon:k.WARNING,className:"text-[2rem] text-red-400"}),e.jsx("p",{className:"text-red-400 mb-2",children:"Failed to load notifications"}),e.jsx("p",{className:"text-sm text-type-secondary",children:o}),e.jsx("button",{type:"button",onClick:P,className:"mt-4 text-sm text-type-link hover:text-type-linkHover transition-colors",children:"Try again"})]})}):e.jsx(mr,{id:t,title:m==="list"?"Notifications":m==="detail"&&p?p.title:m==="settings"?"Settings":"Notifications",size:"lg",children:m==="list"?e.jsx(nh,{notifications:s,readNotifications:l,unreadCount:L,loading:r,error:o,containerRef:y,markAllAsRead:U,markAllAsUnread:D,isShiftHeld:h,onRefresh:P,onOpenSettings:C,openNotificationDetail:S,getCategoryColor:ka,getCategoryLabel:Na,formatDate:ja}):m==="detail"&&p?e.jsx(sh,{selectedNotification:p,goBackToList:N,getCategoryColor:ka,getCategoryLabel:Na,formatDate:ja,isRead:l.has(p.guid),toggleReadStatus:()=>{if(l.has(p.guid)){const j=new Set(l);j.delete(p.guid),d(j),localStorage.setItem("read-notifications",JSON.stringify(Array.from(j)))}else O(p.guid)}}):m==="settings"?e.jsx(ah,{autoReadDays:f,setAutoReadDays:I,customFeeds:v,setCustomFeeds:A,markAllAsUnread:D,onClose:_}):null})}function ih(){const{showModal:t,hideModal:s,isModalVisible:n}=at(),r="notifications",[a,o]=c.useState([]);return c.useEffect(()=>{(async()=>{try{const p=[],g=Li();for(const h of g)if(h.trim())try{const x=await Di(h);if(x&&(x.includes("<rss")||x.includes("<feed"))){const f=new DOMParser().parseFromString(x,"text/xml");if(!f.querySelector("parsererror")&&f&&f.documentElement){const v=f.querySelectorAll("item, entry");v&&v.length>0&&v.forEach(w=>{var R,P,O,U,D,S,N,C,_,I,A,L;try{const j=((R=w.querySelector("guid"))==null?void 0:R.textContent)||((P=w.querySelector("id"))==null?void 0:P.textContent)||"",B=((O=w.querySelector("title"))==null?void 0:O.textContent)||"",W=((U=w.querySelector("link"))==null?void 0:U.textContent)||((D=w.querySelector("link"))==null?void 0:D.getAttribute("href"))||"",H=((S=w.querySelector("description"))==null?void 0:S.textContent)||((N=w.querySelector("content"))==null?void 0:N.textContent)||((C=w.querySelector("summary"))==null?void 0:C.textContent)||"",$=((_=w.querySelector("pubDate"))==null?void 0:_.textContent)||((I=w.querySelector("published"))==null?void 0:I.textContent)||((A=w.querySelector("updated"))==null?void 0:A.textContent)||"",K=((L=w.querySelector("category"))==null?void 0:L.textContent)||"",V=j||W;if(!V||!B)return;p.push({guid:V,title:B,link:W,description:H,pubDate:$,category:K,source:Ai(h)})}catch{}})}}}catch{}o(p)}catch{}})()},[]),{openNotifications:()=>{t(r)},closeNotifications:()=>{s(r)},isNotificationsOpen:()=>n(r),getUnreadCount:()=>{try{const u=localStorage.getItem("read-notifications");if(!u){const x=a.length;return x>99?"99+":x}const p=JSON.parse(u),g=new Set(p),h=a.filter(x=>!g.has(x.guid)).length;return h>99?"99+":h}catch{return 0}}}}class lh{constructor(s,n={horizontalMotion:!1,sizeRange:[10,15]}){this.x=0,this.y=0,this.radius=0,this.direction=0,this.speed=0,this.lifetime=0,this.ran=0,this.image=null,this.size=10,n.imgSrc&&(this.image=new Image,this.image.src=n.imgSrc),this.options=n,this.reset(s),this.initialize(s)}reset(s){this.x=Math.round(Math.random()*s.width/2+s.width/4),this.y=Math.random()*100+5,this.radius=1+Math.floor(Math.random()*.5),this.direction=Math.random()*Math.PI/2+Math.PI/4,this.speed=.02+Math.random()*.085;const n=65;this.lifetime=n*3+Math.random()*(n*30),this.size=this.options.sizeRange?Math.random()*(this.options.sizeRange[1]-this.options.sizeRange[0])+this.options.sizeRange[0]:10,this.options.horizontalMotion&&(this.direction=Math.random()<=.5?0:Math.PI,this.lifetime=30*n),this.ran=0}initialize(s){this.ran=Math.random()*this.lifetime;const n=this.speed;this.speed=Math.random()*this.lifetime*n,this.update(s),this.speed=n}update(s){this.ran+=1;const n=this.speed*Math.cos(this.direction),r=this.speed*Math.sin(this.direction);this.x+=n,this.y+=r,this.ran>this.lifetime&&this.reset(s)}render(s){const n=s.getContext("2d");if(!n)return;n.save(),n.beginPath();const r=this.ran/this.lifetime,a=(r-r*r)*4;if(n.globalAlpha=Math.max(0,a*.8),this.image){n.translate(this.x,this.y);const o=this.size,i=this.image.naturalWidth/this.image.naturalHeight*o;if(this.image.src.includes("shark")){const l=this.direction===Math.PI?1:-1;n.scale(l,1),n.drawImage(this.image,-o/2*l,-i/2,o,i)}else n.rotate(this.direction-Math.PI),n.drawImage(this.image,-o/2,i,i,o)}else n.ellipse(this.x,this.y,this.radius,this.radius*1.5,this.direction,0,Math.PI*2),n.fillStyle="white",n.fill();n.restore()}}function ch(){const t=c.useRef(null);return c.useEffect(()=>{var h,x;if(!t.current)return;const s=t.current,n=[];s.width=s.scrollWidth,s.height=s.scrollHeight;const r=265;let a=[];const o=new Date,i=o.getMonth(),l=o.getDate();let d=r;switch(!0){case(i===11&&l>=24&&l<=26||Math.random()<.051):a=[{image:"/lightbar-images/snowflake.svg",sizeRange:[12,20]},{image:"/lightbar-images/santa.png",sizeRange:[25,35]}],d=r*.1;break;case(i===9&&l===31):Math.random()<.95&&(a=[{image:"/lightbar-images/ghost.png",sizeRange:[20,33]},{image:"/lightbar-images/pumpkin.png",sizeRange:[25,35]}],d=r*.3);break;case i===9:Math.random()<.25&&(a=[{image:"/lightbar-images/ghost.png",sizeRange:[20,33]},{image:"/lightbar-images/pumpkin.png",sizeRange:[25,35]}],d=r*.15);break;case Math.random()<.1:a=[{image:"/lightbar-images/fishie.png",sizeRange:[10,13]},{image:"/lightbar-images/shark.png",sizeRange:[48,56]}],d=r*.075;break;case(i+1===4&&l===20):a=[{image:"/lightbar-images/weed.png",sizeRange:[32,40]}],d=r/6.25;break;case(i+1===6&&l===9):a=[{image:"/lightbar-images/heart.svg",sizeRange:[32,14]},{image:"/lightbar-images/wine.png",sizeRange:[15,35]}],d=r/6.25;break;case Math.random()<.2:a=[{image:"/lightbar-images/cat.png",sizeRange:[30,38]}],d=r/6.6;break;case Math.random()<.3:a=[{image:"/lightbar-images/camera.png",sizeRange:[24,32]},{image:"/lightbar-images/popcorn.png",sizeRange:[18,27]}],d=r/7.85;break;case Math.random()<.08:a=[{image:"/lightbar-images/cock.png",sizeRange:[25,32]},{image:"/lightbar-images/egg.png",sizeRange:[18,24]},{image:"/lightbar-images/barn.png",sizeRange:[32,38]}],d=r/9;break;case Math.random()<.06:a=[{image:"/lightbar-images/money-sack.png",sizeRange:[24,32]},{image:"/lightbar-images/money.png",sizeRange:[13,23]},{image:"/lightbar-images/coin.png",sizeRange:[8,20]}],d=r/8.45;break;case Math.random()<.075:a=[{image:"/lightbar-images/skull.png",sizeRange:[20,28]},{image:"/lightbar-images/ship.png",sizeRange:[23,27]}],d=r/10;break;case Math.random()<.03:a=[{image:"/lightbar-images/ts.png",sizeRange:[20,32]},{image:"/lightbar-images/git.png",sizeRange:[20,28]}],d=r/9;break;case Math.random()<.7:a=[{image:"/lightbar-images/beer.png",sizeRange:[15,35]},{image:"/lightbar-images/beer-bottle.png",sizeRange:[10,38]},{image:"/lightbar-images/wine.png",sizeRange:[15,35]}],d=r/11;break;case Math.random()<.05:a=[{image:"/lightbar-images/auto-gun.png",sizeRange:[28,36]},{image:"/lightbar-images/gun.png",sizeRange:[23,30]}],d=r/11.6;break;case Math.random()<.15:a=[{image:"/lightbar-images/star.png",sizeRange:[18,28]}],d=r/6.6;break}for(let y=0;y<r;y+=1){const f=a&&y<=d,b=Math.floor(Math.random()*a.length),v=(h=a[b])==null?void 0:h.sizeRange,w=(x=a[b])==null?void 0:x.image,R=new lh(s,{imgSrc:f?w:void 0,horizontalMotion:(w==null?void 0:w.includes("fishie"))||(w==null?void 0:w.includes("shark")),sizeRange:v});n.push(R)}let m=!0,u=null;function p(){if(s.getContext("2d")){if(m){for(const f of n)f.update(s);m=!1}s.width=s.scrollWidth,s.height=s.scrollHeight;for(const f of n)f.render(s);u=requestAnimationFrame(p)}}const g=setInterval(()=>{m=!0},1e3/120);return p(),()=>{u&&cancelAnimationFrame(u),clearInterval(g)}},[]),e.jsx("canvas",{className:"particles",ref:t})}const dh=function(s){return e.jsx("div",{className:"absolute inset-0 w-full h-[680px] overflow-hidden pointer-events-none -mt-64",children:e.jsx("div",{className:"max-w-screen w-full h-[680px] relative pt-64",children:e.jsx("div",{className:s.className,children:e.jsxs("div",{className:"lightbar",children:[!s.noParticles&&e.jsx(ch,{}),e.jsx("div",{className:"lightbar-visual"})]})})})})},uh=dh,Qe=Ae(Oe(t=>({banners:[],isOnline:!0,isTurnstile:!1,location:null,ignoredBannerIds:[],updateOnline(s){t(n=>{n.isOnline=s})},updateTurnstile(s){t(n=>{n.isTurnstile=s})},setLocation(s){t(n=>{n.location=s})},showBanner(s){t(n=>{n.banners.find(r=>r.id===s)||n.ignoredBannerIds.includes(s)||n.banners.push({id:s,height:0})})},hideBanner(s,n=!1){t(r=>{n&&r.ignoredBannerIds.push(s),r.banners=r.banners.filter(a=>a.id!==s)})},updateHeight(s,n){t(r=>{const a=r.banners.find(o=>o.id===s);a&&(a.height=n)})}})));function Mn(t){const s=t??null,n=Qe(o=>o.banners),r=Qe(o=>o.location),a=n.reduce((o,i)=>o+i.height,0);return s!==r?0:a}function mh(t){const[s,{height:n}]=Jc(),r=Qe(i=>i.updateHeight),a=Qe(i=>i.showBanner),o=Qe(i=>i.hideBanner);return c.useEffect(()=>(a(t),()=>{o(t)}),[a,o,t]),c.useEffect(()=>{r(t,n)},[n,t,r]),[s]}const hh=function(s){const n=Mn(),r=be(),{loggedIn:a}=Mt(),[o,i]=c.useState(0),{openNotifications:l,getUnreadCount:d}=ih();c.useEffect(()=>{const g=()=>{i(window.scrollY)};return window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)},[]);const m=g=>{window.scrollTo(0,0),r(g)},u=()=>100+80*(1-Math.min(o,300)/300),p=J(g=>g.enableLowPerformanceMode);return e.jsxs(e.Fragment,{children:[s.noLightbar?null:e.jsx("div",{className:"absolute inset-x-0 top-0 flex h-[88px] items-center justify-center",style:{top:`${n}px`},children:e.jsx("div",{className:"absolute inset-x-0 -mt-[22%] flex items-center sm:mt-0",children:e.jsx(uh,{noParticles:p})})}),e.jsx("div",{className:"top-content fixed z-[20] pointer-events-none left-0 right-0 top-0 min-h-[150px]",style:{top:`${n}px`},children:e.jsxs("div",{className:z("fixed left-0 right-0 top-0 flex items-center","transition-[background-color,backdrop-filter] duration-300 ease-in-out",s.doBackground?s.clearBackground?"backdrop-blur-md bg-transparent":"bg-background-main":"bg-transparent"),children:[s.doBackground?e.jsx("div",{className:"absolute w-full h-full inset-0 overflow-hidden",children:e.jsx(bs,{positionClass:"absolute"})}):null,e.jsx("div",{className:"opacity-0 absolute inset-0 block h-20 pointer-events-auto"}),e.jsx("div",{className:z("transition-[background-color,backdrop-filter,opacity] duration-300 ease-in-out",s.bg?"opacity-100":"opacity-0","absolute inset-0 block h-[11rem]",s.clearBackground?"backdrop-blur-md bg-transparent":"bg-background-main"),style:{maskImage:`linear-gradient(
                to bottom,
                rgba(0, 0, 0, 1),
                rgba(0, 0, 0, 1) calc(100% - ${u()}px),
                rgba(0, 0, 0, 0) 100%
              )`,WebkitMaskImage:`linear-gradient(
                to bottom,
                rgba(0, 0, 0, 1),
                rgba(0, 0, 0, 1) calc(100% - ${u()}px),
                rgba(0, 0, 0, 0) 100%
              )`}})]})}),e.jsx("div",{className:"top-content fixed pointer-events-none left-0 right-0 z-[500] top-0 min-h-[150px]",style:{top:`${n}px`},children:e.jsx("div",{className:z("fixed left-0 right-0 flex items-center"),children:e.jsxs("div",{className:"px-7 py-5 relative z-[60] flex flex-1 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1.5 ssm:space-x-3 pointer-events-auto",children:[e.jsx(vt,{className:"block tabbable rounded-full text-xs ssm:text-base",to:"/",onClick:()=>window.scrollTo(0,0),children:e.jsx(qt,{clickable:!0,header:!0})}),e.jsx("a",{href:le().DISCORD_LINK,target:"_blank",rel:"noreferrer",className:"text-xl text-white tabbable rounded-full backdrop-blur-lg",children:e.jsx(ht,{icon:k.DISCORD,clickable:!0,downsized:!0,navigation:!0})}),!p&&(window.location.pathname!=="/discover"?e.jsx("a",{onClick:()=>m("/discover"),rel:"noreferrer",className:"text-xl text-white tabbable rounded-full backdrop-blur-lg",children:e.jsx(ht,{icon:k.RISING_STAR,clickable:!0,downsized:!0,navigation:!0})}):e.jsx("a",{onClick:()=>m("/"),rel:"noreferrer",className:"text-lg text-white tabbable rounded-full backdrop-blur-lg",children:e.jsx(ht,{icon:k.SEARCH,clickable:!0,downsized:!0,navigation:!0})})),e.jsxs("a",{onClick:()=>l(),rel:"noreferrer",className:"text-xl text-white tabbable rounded-full backdrop-blur-lg relative",children:[e.jsx(ht,{icon:k.BELL,clickable:!0,downsized:!0,navigation:!0}),(()=>{const g=d();return(typeof g=="number"?g>0:g==="99+")?e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full min-w-[16px] h-4 px-1 flex items-center justify-center",children:g}):null})()]})]}),e.jsx("div",{className:"relative pointer-events-auto",children:e.jsx(Zm,{children:a?e.jsx(Ri,{withName:!0}):e.jsx(qm,{})})})]})})})]})},_n=hh;function bs(t){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:z(t.positionClass??"fixed","top-0 -right-48 rotate-[32deg] w-[50rem] h-[15rem] rounded-[70rem] bg-background-accentA blur-[100px] pointer-events-none opacity-25 transition-colors duration-75")}),e.jsx("div",{className:z(t.positionClass??"fixed","top-0 right-48 rotate-[32deg] w-[50rem] h-[15rem] rounded-[70rem] bg-background-accentB blur-[100px] pointer-events-none opacity-25 transition-colors duration-75")})]})}function st(t){return e.jsxs("div",{className:"bg-background-main",style:{backgroundImage:"linear-gradient(to bottom, var(--tw-gradient-from), var(--tw-gradient-to) 800px)"},children:[e.jsx(bs,{}),e.jsxs(Ii,{children:[e.jsx(_n,{doBackground:!0,noLightbar:!0}),e.jsx("div",{className:"mt-40 relative",children:t.children})]})]})}function fh(){const{t}=q();return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen text-center font-medium",children:[e.jsx(bs,{}),e.jsx("div",{className:"right-[calc(2rem+env(safe-area-inset-right))] top-6 absolute",children:e.jsx(qt,{})}),e.jsx(At,{}),e.jsx("p",{className:"max-w-[19rem] mt-3 mb-12 text-type-secondary",children:t("screens.migration.inProgress")})]})}function _i(t){return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen text-center font-medium",children:[e.jsx(bs,{}),e.jsx("div",{className:"right-[calc(2rem+env(safe-area-inset-right))] top-6 absolute",children:e.jsx(qt,{})}),t.iconSlot?t.iconSlot:null,e.jsx("div",{className:"max-w-[19rem] mt-3 mb-12 text-type-secondary",children:t.children})]})}function ph(){const{getTopModal:t,hideModal:s}=at();c.useEffect(()=>{const n=r=>{if(!(r.target&&r.target.nodeName==="INPUT")&&r.key==="Escape"){const a=t();a&&s(a)}};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[t,s])}function xh(){const t=Qe(n=>n.updateOnline),s=c.useRef(!0);c.useEffect(()=>{let n=0,r=null;const a=setInterval(()=>{if(n+=1,s.current&&n<10)return;n=0,r&&r.abort(),r=new AbortController;const o=r.signal;fetch("/ping.txt",{signal:o}).then(()=>{t(!0),s.current=!0}).catch(i=>{i.name!=="AbortError"&&(t(!1),s.current=!1)})},5e3);return()=>{clearInterval(a),r&&r.abort()}},[t])}const Hr=c.forwardRef(({onChange:t,onUnFocus:s,value:n,label:r,name:a,autoComplete:o,className:i,placeholder:l,onFocus:d,passwordToggleable:m},u)=>{let p="text";const[g,h]=c.useState(!0);m&&(p=g?"password":"text");const x=e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:p,ref:u,className:z(i,m&&"pr-12"),placeholder:l,onChange:y=>t&&t(y.target.value),value:n,name:a,autoComplete:o,onBlur:()=>s&&s(),onFocus:()=>d==null?void 0:d(),onKeyDown:y=>y.key==="Enter"?y.target.blur():null}),m?e.jsx("button",{type:"button",className:"absolute top-1/2 -translate-y-1/2 right-1 text-xl p-3",onClick:()=>h(!g),children:e.jsx(M,{icon:g?k.EYE:k.EYE_SLASH})}):null]});return r?e.jsxs("label",{children:[e.jsx("span",{children:r}),x]}):x}),Oi=c.forwardRef((t,s)=>{const[n,r]=c.useState(!1),[a,o]=c.useState(!!t.isInFeatured&&window.scrollY<600),i=c.useRef(null),[l,d]=c.useState(!1);function m(u){t.onChange(u,!0)}return c.useEffect(()=>{const u=()=>{o(!!t.isInFeatured&&window.scrollY<600)};return window.addEventListener("scroll",u),()=>window.removeEventListener("scroll",u)},[t.isInFeatured]),e.jsx("div",{ref:i,children:e.jsxs(fe.Base,{className:z({"hover:flare-enabled group flex flex-col rounded-[28px] transition-colors sm:flex-row sm:items-center relative backdrop-blur-sm":!0,"transition-colors duration-300":!0,"bg-search-background/50":!n&&a,"bg-search-background":n||t.isSticky||!t.isInFeatured}),children:[e.jsx(fe.Light,{flareSize:400,enabled:n,className:"rounded-[28px]",backgroundClass:z({"transition-colors":!0,"bg-search-background":!n,"bg-search-focused":n})}),e.jsxs(fe.Child,{className:"flex flex-1 flex-col",children:[e.jsx("div",{className:z("absolute bottom-0 left-5 top-0 flex max-h-14 items-center text-search-icon cursor-pointer z-10","transition-colors duration-300",t.isInFeatured?a?"text-white/50":"":"text-search-icon"),onClick:u=>{u.preventDefault(),d(!l),s&&typeof s!="function"&&s.current&&s.current.focus()},children:e.jsx(M,{icon:k.SEARCH})}),e.jsx(Hr,{ref:s,onUnFocus:()=>{r(!1),t.onUnFocus()},onFocus:()=>r(!0),onChange:u=>m(u),value:t.value,className:z("w-full flex-1 bg-transparent px-4 py-4 pl-12 !text-search-text focus:outline-none sm:py-4 sm:pr-2 transition-colors duration-300","transition-colors duration-300",t.isInFeatured&&a?"text-white/50":"placeholder-search-placeholder"),placeholder:t.placeholder}),l&&!t.hideTooltip&&e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"font-bold text-sm mb-1 text-search-text",children:"Advanced Search:"}),e.jsxs("div",{className:"space-y-1.5 text-xs text-search-text",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-0.5",children:"Year search:"}),e.jsx("p",{className:"text-type-secondary italic pl-2",children:"Inception year:2010"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-0.5",children:"Type search:"}),e.jsx("p",{className:"text-type-secondary italic pl-2",children:"Marvel type:movie"}),e.jsx("p",{className:"text-type-secondary italic pl-2",children:"Friends type:tv"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-0.5",children:"TMDB ID search:"}),e.jsx("p",{className:"text-type-secondary italic pl-2",children:"tmdb:123456 - For movies"}),e.jsx("p",{className:"text-type-secondary italic pl-2",children:"tmdb:123456:tv - For TV shows"})]})]})]}),t.value.length>0&&e.jsx("div",{onClick:()=>{var u;t.onUnFocus(""),s&&typeof s!="function"&&((u=s.current)==null||u.focus())},className:"cursor-pointer hover:text-white  absolute bottom-0 right-2 top-0 flex justify-center my-auto h-10 w-10 items-center hover:bg-search-hoverBackground active:scale-110 text-search-icon rounded-full transition-[transform,background-color] duration-200",children:e.jsx(M,{icon:k.X,className:"transition-colors duration-200"})})]})]})})});function Vs(t){const s=!!t.url,n=!!t.to,r=e.jsx("span",{className:"group mt-1 cursor-pointer font-bold text-type-link hover:text-type-linkHover active:scale-95",children:t.children});return s?e.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",children:r}):n?e.jsx(vt,{to:t.to??"",children:r}):e.jsx("span",{onClick:()=>t.onClick&&t.onClick(),children:r})}const gh=function(s){return e.jsx("ol",{children:s.items.map((n,r)=>e.jsxs("li",{className:z("grid grid-cols-[auto,1fr] gap-6",r!==s.items.length-1?"pb-12":void 0),children:[e.jsxs("div",{className:"relative z-0",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-about-circle text-about-circleText font-medium flex justify-center items-center relative z-10",children:r+1}),r!==s.items.length-1?e.jsx("div",{className:"h-[calc(100%+1.5rem)] w-px absolute top-6 left-1/2 transform -translate-x-1/2",style:{backgroundImage:"linear-gradient(to bottom, transparent 5px, #1F1F29 5px, #1F1F29 10px)",backgroundSize:"10px 10px",backgroundRepeat:"Repeat"}}):null]}),e.jsx("div",{children:n})]}))})},Ft=gh;function bh(t){return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white mb-2 font-medium",children:t.title}),e.jsx("div",{className:"text-type-text",children:t.children})]})}function bn(t){return e.jsx("button",{className:z("font-bold rounded h-10 w-40 scale-90 hover:scale-95 transition-all duration-200",t.className),type:"button",onClick:t.onClick,disabled:t.disabled,children:t.children})}function ws(t){return e.jsx("h3",{className:"text-white font-medium text-lg my-8 pt-4",children:t.title})}function yh(){const{t}=q(),s=be(),[n,r]=c.useState(""),a=c.useRef(null),o=Object.keys(t("about",{returnObjects:!0})).filter(u=>u.startsWith("q")).sort((u,p)=>parseInt(u.slice(1),10)-parseInt(p.slice(1),10)),i={general:[],search:[],playback:[],connections:[],language:[]};o.forEach(u=>{const p=t(`about.${u}.section`);p&&i[p]&&i[p].push(e.jsx(bh,{title:t(`about.${u}.title`),children:t(`about.${u}.body`)}))});const d=[...i.general,...i.search,...i.playback,...i.connections,...i.language].filter(u=>{var p,g,h,x;try{const y=((g=(p=u==null?void 0:u.props)==null?void 0:p.title)==null?void 0:g.toLowerCase())||"",f=((x=(h=u==null?void 0:u.props)==null?void 0:h.children)==null?void 0:x.toLowerCase())||"",b=n.toLowerCase();return y.includes(b)||f.includes(b)}catch{return!1}}),m=n.length>0;return e.jsxs(st,{children:[e.jsx(et,{subpage:!0,k:"global.pages.about"}),e.jsxs(Us,{children:[e.jsx(wt,{children:t("about.title")}),e.jsx(ye,{children:t("about.description")}),e.jsx("div",{children:e.jsx(Oi,{ref:a,value:n,onChange:u=>r(u),onUnFocus:()=>{},placeholder:t("about.searchPlaceholder"),hideTooltip:!0})}),e.jsx("div",{className:"pt-4",children:e.jsx(pe,{i18nKey:"about.help",children:e.jsx(Vs,{url:"/support"})})}),e.jsx(Ce,{className:"mt-10",children:t("about.faqTitle")}),m?e.jsx(Ft,{items:d}):e.jsxs(e.Fragment,{children:[i.general.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ws,{title:t("about.sections.general")}),e.jsx(Ft,{items:i.general})]}),i.search.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ws,{title:t("about.sections.search")}),e.jsx(Ft,{items:i.search})]}),i.playback.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ws,{title:t("about.sections.playback")}),e.jsx(Ft,{items:i.playback})]}),i.connections.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ws,{title:t("about.sections.connections")}),e.jsx(Ft,{items:i.connections})]}),i.language.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ws,{title:t("about.sections.language")}),e.jsx(Ft,{items:i.language})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},className:"pt-2 w-full",children:[e.jsx(bn,{className:"py-px mt-8 box-content bg-buttons-secondary hover:bg-buttons-secondaryHover bg-opacity-90 text-buttons-secondaryText justify-center items-center",onClick:()=>s("/discover"),children:"Discover"}),e.jsx(bn,{className:"py-px mt-8 box-content bg-buttons-secondary hover:bg-buttons-secondaryHover bg-opacity-90 text-buttons-secondaryText justify-center items-center",onClick:()=>s("/support"),children:"Support"})]})]})]})}function nt(t){return e.jsx("hr",{className:z("w-full h-px border-0 bg-utils-divider bg-opacity-50",t.marginClass??"my-8")})}async function vh(){const s=await(await fetch(`${Er}/metrics`)).text(),n=/mw_provider_hostname_count{hostname="https?:\/\/[^"}]+"} (\d+)/g;let r=0,a=n.exec(s);for(;a!==null;)r+=parseInt(a[1],10),a=n.exec(s);if(r>0)return r.toString();throw new Error("ACCOUNT_NUMBER not found")}async function wh(){const s=await(await fetch(`${Er}/metrics`)).text(),n=/mw_user_count{namespace="movie-web"} (\d+)/,r=s.match(n);if(r)return r[1];throw new Error("USER_COUNT not found")}function js(t){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex",children:[e.jsx("p",{className:"flex-1 font-bold text-white pr-5",children:t.name}),e.jsx("p",{children:t.children})]}),e.jsx(nt,{marginClass:"my-3"})]})}function jh(){const[t,s]=c.useState(null),[n,r]=c.useState(null),a=le().NORMAL_ROUTER,o=le().APP_VERSION,i=le().BACKEND_URL;return c.useEffect(()=>{vh().then(l=>{s(l)}).catch(l=>{console.error("Error fetching account number:",l)}),wh().then(l=>{r(l)}).catch(l=>{console.error("Error fetching all accounts:",l)})},[]),e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mb-8 mt-12",children:"Site Constants"}),e.jsx(js,{name:"Routing mode",children:a?"Normal routing":"Hash based routing"}),e.jsxs(js,{name:"Application version",children:["v",o]}),e.jsx(js,{name:"Backend requests",children:t}),e.jsx(js,{name:"Total User Accounts",children:n}),e.jsx(js,{name:"Backend URL",children:i})]})}const kh=function(s){return e.jsx("button",{type:"button",onClick:s.onClick,className:z("w-11 h-6 p-1 rounded-full grid transition-colors duration-100 group/toggle tabbable",s.enabled?"bg-buttons-toggle":"bg-buttons-toggleDisabled"),children:e.jsx("div",{className:"relative w-full h-full",children:e.jsx("div",{className:z("scale-90 group-hover/toggle:scale-100 h-full aspect-square rounded-full bg-white absolute transition-all duration-100",s.enabled?"left-full transform -translate-x-full":"left-0")})})})},ct=kh;function On(t){return e.jsx("div",{className:"bg-video-scraping-card rounded-xl p-8",children:t.children})}function ks(t){const s=t.url?new URL(t.url).host:null;return e.jsxs("div",{className:"flex mb-2",children:[e.jsx(ct,{enabled:t.enabled,onClick:()=>{var n;return(n=t.onToggle)==null?void 0:n.call(t,!t.enabled)}}),e.jsx(M,{icon:t.errored?k.X:t.success?k.CIRCLE_CHECK:t.questionable?k.CIRCLE_QUESTION:k.EYE_SLASH,className:z({"text-xl mr-2 mt-0.5 ml-3":!0,"text-video-scraping-error":t.errored,"text-video-scraping-noresult":!t.errored&&!t.success&&!t.questionable,"text-video-scraping-success":t.success,"text-yellow-400":t.questionable})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-bold",children:t.name}),t.errorText?e.jsx("p",{children:t.errorText}):null,s?e.jsx("p",{children:s}):null," "]})]})}function Nh(){const t=c.useMemo(()=>Go().map((f,b)=>({id:b.toString(),url:f})),[]),[s,n]=c.useState(()=>{const f=localStorage.getItem("m3u8-proxy-enabled");if(f)try{return JSON.parse(f)}catch{return{}}return Object.fromEntries(t.map(b=>[b.id,!0]))});c.useEffect(()=>{localStorage.setItem("m3u8-proxy-enabled",JSON.stringify(s))},[s]);const[r,a]=c.useState([]),[o,i]=c.useState(!1),[l,d]=c.useState(!1),[m,u]=rt(async()=>{d(!0);function f(w,R){a(P=>[...P.filter(O=>O.id!==w),R])}a([]);const v=t.filter(w=>s[w.id]).map(async w=>{try{if(w.url.endsWith("/")){f(w.id,{id:w.id,status:"error",error:new Error("URL ends with slash")});return}const R=`${w.url}/?destination=${encodeURIComponent("https://postman-echo.com/get")}`;(await fetch(R)).ok&&f(w.id,{id:w.id,status:"success"})}catch(R){const P=R;P.message=P.message.replace(w.url,"M3U8_PROXY_URL"),f(w.id,{id:w.id,status:"questionable",error:P})}});await Promise.all(v),setTimeout(()=>d(!1),5e3)},[t,s]),p=(f,b)=>{n(v=>({...v,[f]:b}))},g=t.every(f=>s[f.id]),h=t.every(f=>!s[f.id]),x=()=>{n(Object.fromEntries(g?t.map(f=>[f.id,!1]):t.map(f=>[f.id,!0])))},y=t.filter(f=>s[f.id]).length;return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"!mb-0 mt-12",children:"M3U8 Proxy tests"}),e.jsxs("div",{className:"flex items-center justify-between mb-8 mt-2",children:[e.jsxs("p",{children:[t.length," M3U8 proxy(s) registered (",y," ","enabled)"]}),e.jsx(Z,{theme:"secondary",onClick:x,disabled:t.length===0,children:g?"Disable All":"Enable All"})]}),e.jsxs(On,{children:[t.map((f,b)=>{var P;const v=r.find(O=>O.id===f.id),w=`M3U8 Proxy ${b+1}`,R=s[f.id];return v?v.status==="error"?e.jsx(ks,{name:w,errored:!0,errorText:(P=v.error)==null?void 0:P.toString(),enabled:R,onToggle:O=>p(f.id,O)},f.id):v.status==="success"?e.jsx(ks,{name:w,url:f.url,success:!0,enabled:R,onToggle:O=>p(f.id,O)},f.id):v.status==="questionable"?e.jsx(ks,{name:w,questionable:!0,url:f.url,enabled:R,onToggle:O=>p(f.id,O)},f.id):e.jsx(ks,{name:w,enabled:R,onToggle:O=>p(f.id,O)},f.id):e.jsx(ks,{name:w,enabled:R,onToggle:O=>p(f.id,O)},f.id)}),e.jsx(nt,{}),e.jsx("div",{className:"flex justify-end",children:o?r.filter(f=>s[f.id]).every(f=>f.status==="success")?e.jsxs("p",{children:["All enabled M3U8 proxies have passed the test!"," ",e.jsx("span",{className:"font-bold",children:"Ÿ©(Àä·óúÀã*)Ÿà‚ô°"})]}):e.jsx("div",{children:e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"pb-4",children:["Some M3U8 proxies have failed the test..."," ",e.jsx("span",{className:"font-bold",children:"(‚Ä¢·∑Ñ‚à©‚Ä¢·∑Ö )"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Z,{theme:"purple",loading:m.loading,onClick:async f=>{f.preventDefault(),d(!0),await u(),i(!0),setTimeout(()=>d(!1),250)},disabled:l||h,children:"Test M3U8 proxies"})})]})}):e.jsx(Z,{theme:"purple",loading:m.loading,onClick:async f=>{f.preventDefault(),d(!0),await u(),i(!0),setTimeout(()=>d(!1),5e3)},disabled:l||h,children:"Test M3U8 proxies"})})]})]})}function Sh(){const t=le().TMDB_READ_API_KEY,[s,n]=c.useState({hasTested:!1,success:!1,errorText:""}),[r,a]=rt(async()=>{if(n({hasTested:!1,success:!1,errorText:""}),!t||t.length===0)return n({hasTested:!0,success:!1,errorText:"TMDB API key is not set"});if(!(t.split(".").length>2))return n({hasTested:!0,success:!1,errorText:"TMDB API key is not a read only key"});try{await zt("556574",Ne.MOVIE)}catch{return n({hasTested:!0,success:!1,errorText:"Failed to call TMDB, double check API key and your internet connection"})}return n({hasTested:!0,success:!0,errorText:""})},[t,n]);return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mb-8 mt-12",children:"TMDB test"}),e.jsx(On,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1",children:s.hasTested?s.success?e.jsxs("p",{className:"flex items-center",children:[e.jsx(M,{icon:k.CIRCLE_CHECK,className:"text-video-scraping-success mr-2"}),"TMDB is working as expected"]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-white font-bold w-full mb-3 flex items-center gap-1",children:[e.jsx(M,{icon:k.CIRCLE_EXCLAMATION,className:"text-video-scraping-error mr-2"}),"TMDB is not working"]}),e.jsx("p",{children:s.errorText})]}):e.jsx("p",{children:"Run the test to validate TMDB"})}),e.jsxs(Z,{theme:"purple",onClick:a,children:[r.loading?e.jsx(Vt,{className:"text-base mr-2"}):null,"Test TMDB"]})]})})]})}function Xs(t){const s=t.url?new URL(t.url).host:null;return e.jsxs("div",{className:"flex mb-2",children:[e.jsx(M,{icon:t.errored?k.WARNING:t.success?k.CIRCLE_CHECK:k.EYE_SLASH,className:z({"text-xl mr-2 mt-0.5":!0,"text-video-scraping-error":t.errored,"text-video-scraping-noresult":!t.errored&&!t.success,"text-video-scraping-success":t.success})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-bold",children:t.name}),t.errorText?e.jsx("p",{children:t.errorText}):null,s?e.jsx("p",{children:s}):null]})]})}function Ch(){const t=c.useMemo(()=>Kt().map((m,u)=>({id:u.toString(),url:m})),[]),[s,n]=c.useState([]),[r,a]=c.useState(!1),[o,i]=c.useState(!1),[l,d]=rt(async()=>{i(!0);function m(p,g){n(h=>[...h.filter(x=>x.id!==p),g])}n([]);const u=t.map(async p=>{try{if(p.url.endsWith("/")){m(p.id,{id:p.id,status:"error",error:new Error("URL ends with slash")});return}await Cn(p.url,"https://postman-echo.com/get",{}),m(p.id,{id:p.id,status:"success"})}catch(g){const h=g;h.message=h.message.replace(p.url,"WORKER_URL"),m(p.id,{id:p.id,status:"error",error:h})}});await Promise.all(u),setTimeout(()=>i(!1),5e3)},[t,n]);return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"!mb-0 mt-12",children:"Worker tests"}),e.jsxs("p",{className:"mb-8 mt-2",children:[t.length," worker(s) registered"]}),e.jsxs(On,{children:[t.map((m,u)=>{var h;const p=s.find(x=>x.id===m.id),g=`Worker ${u+1}`;return p?p.status==="error"?e.jsx(Xs,{name:g,errored:!0,errorText:(h=p.error)==null?void 0:h.toString()},m.id):p.status==="success"?e.jsx(Xs,{name:g,url:m.url,success:!0},m.id):e.jsx(Xs,{name:g},m.id):e.jsx(Xs,{name:g},m.id)}),e.jsx(nt,{}),e.jsx("div",{className:"flex justify-end",children:r?s.every(m=>m.status==="success")?e.jsxs("p",{children:["All workers have passed the test!"," ",e.jsx("span",{className:"font-bold",children:"Ÿ©(Àä·óúÀã*)Ÿà‚ô°"})]}):e.jsx("div",{children:e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:["Some workers have failed the test..."," ",e.jsx("span",{className:"font-bold",children:"(‚Ä¢·∑Ñ‚à©‚Ä¢·∑Ö )"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Z,{theme:"purple",loading:l.loading,onClick:async m=>{m.preventDefault(),i(!0),await d(),a(!0),setTimeout(()=>i(!1),250)},disabled:o,children:"Test workers"})})]})}):e.jsx(Z,{theme:"purple",loading:l.loading,onClick:async m=>{m.preventDefault(),i(!0),await d(),a(!0),setTimeout(()=>i(!1),5e3)},disabled:o,children:"Test workers"})})]})]})}async function yn(t){return Ee("/meta",{baseURL:t})}function Eh(){var o,i,l,d;const t=le().BACKEND_URL,[s,n]=c.useState({hasTested:!1,success:!1,errorText:"",value:null}),[r,a]=rt(async()=>{if(n({hasTested:!1,success:!1,errorText:"",value:null}),!t)return n({hasTested:!0,success:!1,errorText:"Backend URL is not set",value:null});try{const m=await yn(t);return n({hasTested:!0,success:!0,errorText:"",value:m})}catch{return n({hasTested:!0,success:!1,errorText:"Failed to call backend, double check the URL, your internet connection, and ensure CORS is properly configured on your backend.",value:null})}},[n]);return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mb-8 mt-12",children:"Backend API test"}),e.jsxs(On,{children:[e.jsx("div",{children:e.jsx("div",{className:"flex-1",children:s.hasTested&&s.success?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"inline-block w-36 text-white font-medium",children:"Version:"}),(o=s.value)==null?void 0:o.version]}),e.jsxs("p",{children:[e.jsx("span",{className:"inline-block w-36 text-white font-medium",children:"Backend name:"}),(i=s.value)==null?void 0:i.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"inline-block w-36 text-white font-medium",children:"Description:"}),((l=s.value)==null?void 0:l.description)??"Not set"]}),e.jsxs("p",{children:[e.jsx("span",{className:"inline-block w-36 text-white font-medium",children:"Captcha enabled:"}),(d=s.value)!=null&&d.hasCaptcha?"Yes":"No"]}),e.jsx(nt,{})]}):null})}),e.jsxs("div",{className:"w-full flex gap-6 justify-between items-center",children:[s.hasTested?s.success?e.jsxs("p",{className:"flex items-center text-md",children:[e.jsx(M,{icon:k.CIRCLE_CHECK,className:"text-video-scraping-success mr-2"}),"Backend is working as expected"]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-white font-bold w-full mb-3 flex items-center gap-1",children:[e.jsx(M,{icon:k.CIRCLE_EXCLAMATION,className:"text-video-scraping-error mr-2"}),"Backend is not working"]}),e.jsx("p",{children:s.errorText})]}):e.jsx("p",{children:"Run the test to validate backend"}),e.jsx(Z,{theme:"purple",loading:r.loading,className:"whitespace-nowrap",onClick:a,children:"Test backend"})]})]})]})}Zo();function Ls(){return Xe()?nr({fetcher:ar(fetch),proxiedFetcher:Mr(),target:rr.BROWSER_EXTENSION,consistentIpForRequests:!0}):(Zo(),nr({fetcher:ar(fetch),proxiedFetcher:bu(),target:rr.BROWSER}))}function Ih(){return nr({fetcher:ar(fetch),target:rr.BROWSER_EXTENSION,consistentIpForRequests:!0})}function Th(t){const{attributes:s,listeners:n,setNodeRef:r,transform:a,transition:o}=Bo({id:t.item.id}),i={transform:jo.Transform.toString(a),transition:o},l=d=>{d.stopPropagation(),d.preventDefault(),t.onToggle(t.item.id)};return e.jsxs("div",{ref:r,style:i,...s,className:z("bg-dropdown-background hover:bg-dropdown-hoverBackground select-none space-x-3 flex items-center max-w-[25rem] py-3 px-4 rounded-lg",t.item.disabled&&"opacity-50"),children:[e.jsx("span",{className:"flex-1 text-white font-bold",children:t.item.name}),t.item.disabled&&e.jsx(M,{icon:k.UNPLUG}),e.jsx("div",{onClick:l,className:"cursor-pointer flex-shrink-0",onMouseDown:d=>d.stopPropagation(),onTouchStart:d=>d.stopPropagation(),children:e.jsx(ct,{enabled:t.item.enabled??!0})}),e.jsx("div",{...n,className:z("cursor-grab touch-manipulation flex-shrink-0",a?"cursor-grabbing":"cursor-grab"),children:e.jsx(M,{icon:k.MENU})})]})}function Rh(t){const s=Co(ls(Oo,{activationConstraint:{delay:75,tolerance:1}}),ls(_o),ls(Mo,{coordinateGetter:Ao})),n=r=>{const{active:a,over:o}=r;if(o&&a.id!==o.id){const i=t.items,l=i.findIndex(u=>u.id===a.id),d=i.findIndex(u=>u.id===o.id),m=Do(i,l,d);t.setItems(m)}};return e.jsx(Eo,{sensors:s,collisionDetection:Ro,onDragEnd:n,modifiers:[Io,To],children:e.jsx(Po,{items:t.items,strategy:Lo,children:e.jsx("div",{className:"flex flex-col gap-2",children:t.items.map(r=>e.jsx(Th,{item:r,onToggle:t.onToggle},r.id))})})})}function Ph(){const{t}=q(),s=be(),n=J(p=>p.embedOrder),r=J(p=>p.setEmbedOrder),a=J(p=>p.enableEmbedOrder),o=J(p=>p.setEnableEmbedOrder),i=J(p=>p.disabledEmbeds),l=J(p=>p.setDisabledEmbeds),d=Ih().listEmbeds(),m=c.useMemo(()=>{const p=Ls().listEmbeds();return n.length===0?d.map(g=>({id:g.id,name:g.name||g.id,disabled:!p.find(h=>h.id===g.id),enabled:!i.includes(g.id)})):n.map(g=>{var h;return{id:g,name:((h=d.find(x=>x.id===g))==null?void 0:h.name)||g,disabled:!p.find(x=>x.id===g),enabled:!i.includes(g)}})},[n,d,i]),u=p=>{const g=i.includes(p)?i.filter(h=>h!==p):[...i,p];l(g)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{children:"Embed Order Settings"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("p",{className:"text-white font-bold",children:t("settings.preferences.embedOrder")}),e.jsxs("div",{className:"max-w-[25rem] font-medium",children:[e.jsx(pe,{i18nKey:"settings.preferences.embedOrderDescription",components:{bold:e.jsx("span",{className:"text-type-link font-bold cursor-pointer",onClick:()=>s("/onboarding/extension")})}}),e.jsxs("div",{onClick:()=>o(!a),className:"bg-dropdown-background hover:bg-dropdown-hoverBackground select-none my-4 cursor-pointer space-x-3 flex items-center max-w-[25rem] py-3 px-4 rounded-lg",children:[e.jsx(ct,{enabled:a}),e.jsx("p",{className:"flex-1 text-white font-bold",children:t("settings.preferences.embedOrderEnableLabel")})]})]}),a&&e.jsxs("div",{className:"w-full flex flex-col gap-4",children:[e.jsx(Rh,{items:m,setItems:p=>r(p.map(g=>g.id)),onToggle:u}),e.jsx(Z,{className:"max-w-[25rem]",theme:"secondary",onClick:()=>r(d.map(p=>p.id)),children:t("settings.reset")})]})]})]})}function Lh(){return e.jsx(st,{children:e.jsxs(Us,{children:[e.jsx(wt,{children:"Admin tools"}),e.jsx(ye,{children:"Silly tools used test P-Stream! ‡´Æ‚Çç¬¥À∂‚Ä¢ . ‚Ä¢ ‚ëÖ ‚Çé·Éê"}),e.jsx(jh,{}),e.jsx(Eh,{}),e.jsx(Ch,{}),e.jsx(Sh,{}),e.jsx(Nh,{}),e.jsx(Ph,{})]})})}function Tt(t){const{t:s}=q(),[n]=Os(),r=c.useRef(null),a=c.useCallback(()=>{var o;(o=t.onEdit)==null||o.call(t,!t.editing)},[t]);return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:r,type:"button",onClick:a,className:z("h-12 items-center overflow-hidden rounded-full bg-background-secondary px-4 py-2 text-white transition-[background-color,transform] hover:bg-background-secondaryHover active:scale-105",{"hidden sm:flex":t.editing}),id:t.id,children:e.jsx("span",{ref:n,children:t.editing?e.jsx("span",{className:"mx-2 sm:mx-4 whitespace-nowrap",children:s("home.mediaList.stopEditing")}):e.jsx(M,{icon:k.EDIT})})}),t.editing&&e.jsx("button",{type:"button",onClick:a,className:"fixed bottom-9 right-7 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-background-secondary text-white border-2 border-green-500 transition-[background-color,transform,box-shadow] hover:bg-background-secondaryHover hover:scale-110 cursor-pointer",id:t.id?`${t.id}-check`:void 0,children:e.jsx(M,{icon:k.CHECKMARK})})]})}function $t(t){const{t:s}=q(),[n]=Os(),r=c.useRef(null),a=c.useCallback(()=>{var o;(o=t.onEdit)==null||o.call(t,!t.editing)},[t]);return e.jsx("button",{ref:r,type:"button",onClick:a,className:"flex h-12 items-center overflow-hidden rounded-full bg-background-secondary px-4 py-2 text-white transition-[background-color,transform] hover:bg-background-secondaryHover active:scale-105",id:t.id,children:e.jsx("span",{ref:n,children:t.editing?e.jsx("span",{className:"mx-2 sm:mx-4 whitespace-nowrap",children:t.text??s("home.mediaList.stopEditing")}):e.jsx("span",{className:"mx-2 sm:mx-4 whitespace-nowrap",children:t.secondaryText})})})}function gt(t){return e.jsx("div",{className:t.className,children:e.jsxs("div",{className:"mb-5 flex items-center",children:[e.jsxs("p",{className:"flex flex-1 items-center font-bold uppercase text-type-text z-[19]",children:[t.customIcon?e.jsx("span",{className:"mr-2 text-xl flex items-center justify-center",children:t.customIcon}):t.icon?e.jsx("span",{className:"mr-2 text-xl",children:e.jsx(M,{icon:t.icon})}):null,t.title]}),t.children]})})}const Rt=c.forwardRef((t,s)=>e.jsx("div",{className:"grid grid-cols-2 gap-7 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 3xl:grid-cols-8 4xl:grid-cols-10",ref:s,children:t.children})),Sa={duration:0,watched:0};function Dh(t,s){return t-s<60*2}function Bi(t,s){return s<20}function Ah(t,s){return!(Bi(t,s)||Dh(t,s))}function Mh(t,s){const n=s.seasonId;return t.seasons[n].number===1&&s.number===1}function Ds(t){var r,a;if(t.type!=="show")return{show:Ah(((r=t.progress)==null?void 0:r.duration)??0,((a=t.progress)==null?void 0:a.watched)??0),progress:t.progress??Sa};const s=Object.values(t.episodes).sort((o,i)=>i.updatedAt-o.updatedAt).filter(o=>!Bi(o.progress.duration,o.progress.watched)||!Mh(t,o))[0],n=t.seasons[s==null?void 0:s.seasonId];return!s||!n?{show:!1,progress:Sa}:{season:n,episode:s,show:!0,progress:s.progress}}function _h(t){return e.jsx("p",{className:`font-semibold text-type-secondary ${t.className||""}`,children:t.content.map((s,n)=>e.jsxs("span",{children:[n!==0?e.jsx("span",{className:"mx-[0.6em] text-[1em]",children:"‚óè"}):null,s]},s))})}function Ca(t){return t?decodeURIComponent(t):""}function Fi(){const t=be(),s=vn(),[n,r]=c.useState(Ca(s.query));c.useEffect(()=>{r(Ca(s.query))},[s.query]);const a=(i,l=!1)=>{if(r(i),!!l){if(i.length===0){t("/",{replace:!0});return}t($l("/browse/:query",{query:i}),{replace:!0})}};return[n,a,i=>{a(i??n,!0)}]}function pr({media:t,group:s}){const n=me(u=>u.addBookmark),r=me(u=>u.addBookmarkWithGroups),a=me(u=>u.removeBookmark),o=me(u=>u.bookmarks),i=c.useMemo(()=>t.year!==void 0?{type:t.type,title:t.title,tmdbId:t.id,releaseYear:t.year,poster:t.poster}:void 0,[t]),l=!!o[(i==null?void 0:i.tmdbId)??""],d=c.useCallback(()=>{i&&(l?a(i.tmdbId):s&&s.length>0?r(i,s):n(i))},[l,i,n,r,a,s]),m=t.year===void 0?"hover:opacity-100":"hover:opacity-95";return e.jsx("div",{onClick:u=>{u.preventDefault(),u.stopPropagation(),d()},children:e.jsx(ht,{icon:l?k.BOOKMARK:k.BOOKMARK_OUTLINE,className:`${m} p-2 opacity-75 transition-opacity duration-300 hover:scale-110 hover:cursor-pointer`})})}const $i="https://fed-airdate.pstream.mov";function Oh(t,s,n=20){const r=(s-1)*n,a=r+n;return{tmdb_ids:t.tmdb_ids.slice(r,a),hasMore:a<t.tmdb_ids.length,totalCount:t.tmdb_ids.length}}async function Ge(t){const s=await fetch(`${$i}${t}`);if(!s.ok)throw new Error(`Failed to fetch from ${t}: ${s.statusText}`);return s.json()}async function Ui(t,s,n){let r=`/release/${t}`;const a=await fetch(`${$i}${r}`);if(!a.ok)throw new Error(`Failed to fetch release details: ${a.statusText}`);return a.json()}const Bh=()=>Ge("/latest"),Fh=()=>Ge("/latest4k"),$h=()=>Ge("/latesttv"),Uh=()=>Ge("/appletv"),Hh=()=>Ge("/netflixmovies"),Vh=()=>Ge("/netflixtv"),Wh=()=>Ge("/prime"),Kh=()=>Ge("/hulu"),zh=()=>Ge("/disney"),Gh=()=>Ge("/hbo"),qh=()=>Ge("/action"),Yh=()=>Ge("/drama"),Qh=()=>Ge("/discover"),Xh=t=>Ge(`/network/${t}`),Jh=async()=>{const t=[{name:"Letterboxd Top 250 Narrative Feature Films",slug:"narrative",endpoint:"/narrative"},{name:"1001 Greatest Movies of All Time",slug:"top",endpoint:"/top"},{name:"1001 Movies You Must See Before You Die",slug:"lifetime",endpoint:"/lifetime"},{name:"Great Movies You May Have Never Heard Of",slug:"never",endpoint:"/never"},{name:"LGBT Movies/Shows",slug:"LGBTQ",endpoint:"/LGBTQ"},{name:"Best Mindfuck Movies",slug:"mindfuck",endpoint:"/mindfuck"},{name:"Based on a True Story Movies",slug:"truestory",endpoint:"/truestory"}],s=[];for(const n of t)try{const r=await Ge(n.endpoint);s.push({listName:n.name,listSlug:n.slug,tmdbIds:r.tmdb_ids.slice(0,30),count:Math.min(r.count,30)})}catch(r){console.error(`Failed to fetch ${n.name}:`,r)}return s},Zh=async(t,s=50)=>{const n=t.slice(0,s),r=[],a=10;for(let o=0;o<n.length;o+=a){const l=n.slice(o,o+a).map(async u=>{try{return await zt(u.toString(),Ne.MOVIE)}catch(p){return console.error(`Failed to fetch movie details for ID ${u}:`,p),null}}),m=(await Promise.all(l)).filter(u=>u!==null);r.push(...m)}return r},ef={8:"netflix",2:"appletv",10:"prime",15:"hulu",337:"disney",1899:"hbo"},tf={28:"action",18:"drama"},sf={Max:"max","Prime Video":"prime",Netflix:"netflix","Disney+":"disney",Hulu:"hulu","Apple TV+":"appletv","Paramount+":"paramount"},Ea={"en-US":"en-US","es-ES":"es-ES","fr-FR":"fr-FR","de-DE":"de-DE","it-IT":"it-IT","pt-PT":"pt-PT","ru-RU":"ru-RU","ja-JP":"ja-JP","zh-CN":"zh-CN","ko-KR":"ko-KR","ar-SA":"ar-SA","hi-IN":"hi-IN","el-GR":"el-GR"};function nf(t){return Ea[t]?Ea[t]:"en-US"}const rf=["January","February","March","April","May","June","July","August","September","October","November","December"],Ia=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.1 Safari/605.1.15"];function Ta(){return Ia[Math.floor(Math.random()*Ia.length)]}async function Hi(t,s,n,r,a){var y,f,b,v,w,R,P,O,U,D,S,N,C,_,I,A,L,j,B,W,H,$,K,V,T,X,ae,ce,Q,xe,ee,Pe,Ie,G,oe,ie,de,te,ne;const o=await Sn(),i=!!he.getState().proxySet;if(!o&&!i){const F=await fetch(`https://fed-trailers.pstream.mov/${a==="movie"?"movie":"tv"}/${t}`).then(se=>se.json());if((y=F.trailer)!=null&&y.embed_url)return{trailer_url:F.trailer.embed_url};throw new Error("IMDb scraping requires either the browser extension or a custom proxy to be set up. Please install the extension or set up a proxy in the settings.")}if(console.log(`[IMDb Scraper] Using ${o?"browser extension":"custom proxy"} for requests`),!r){const F=ze.getState().language;r=yt(F)}const l=nf(r);let d=`https://www.imdb.com/title/${t}/`;const m=d.includes("?")?"&":"?";d+=`${m}locale=${l}`;const u=Math.floor(Math.random()*128+69);await new Promise(F=>{setTimeout(F,u)});let p;o?p=(await Mr()(d,{headers:{"User-Agent":Ta(),"Accept-Language":l},method:"GET",query:{},readHeaders:[]})).body:p=await Ht(d,{headers:{"User-Agent":Ta(),"Accept-Language":l}});const g=p.match(/<script id="__NEXT_DATA__" type="application\/json">(.*?)<\/script>/);if(!g)throw new Error("Could not find IMDb data on the page");const h=JSON.parse(g[1]),x={title:"",original_title:"",title_type:"",year:null,end_year:null,day:null,month:null,date:"",runtime:null,age_rating:"",imdb_rating:null,votes:null,plot:"",poster_url:"",trailer_url:"",url:d,genre:[],cast:[],directors:[],writers:[],keywords:[],countries:[],languages:[],locations:[],season:s,episode:n};try{const F=h.props.pageProps.aboveTheFoldData,se=h.props.pageProps.mainColumnData;x.title=((f=F.titleText)==null?void 0:f.text)||"",x.original_title=((b=F.originalTitleText)==null?void 0:b.text)||"",x.title_type=((v=F.titleType)==null?void 0:v.text)||"",x.age_rating=((w=F.certificate)==null?void 0:w.rating)||"",x.year=((R=F.releaseYear)==null?void 0:R.year)||null,x.end_year=((P=F.releaseYear)==null?void 0:P.endYear)||null,x.day=((O=F.releaseDate)==null?void 0:O.day)||null,x.month=((U=F.releaseDate)==null?void 0:U.month)||null,x.month&&x.day&&x.year&&(x.date=`${rf[x.month-1]} ${x.day}, ${x.year}`),x.runtime=((D=F.runtime)==null?void 0:D.seconds)||null,x.plot=((N=(S=F.plot)==null?void 0:S.plotText)==null?void 0:N.plainText)||"",x.imdb_rating=((C=F.ratingsSummary)==null?void 0:C.aggregateRating)||null,x.votes=((_=F.ratingsSummary)==null?void 0:_.voteCount)||null,x.poster_url=((I=F.primaryImage)==null?void 0:I.url)||"",x.trailer_url=((H=(W=(B=(j=(L=(A=F.primaryVideos)==null?void 0:A.edges)==null?void 0:L[0])==null?void 0:j.node)==null?void 0:B.playbackURLs)==null?void 0:W[0])==null?void 0:H.url)||"",x.genre=((K=($=F.genres)==null?void 0:$.genres)==null?void 0:K.map(ue=>ue.text))||[],x.cast=((T=(V=F.castPageTitle)==null?void 0:V.edges)==null?void 0:T.map(ue=>ue.node.name.nameText.text))||[],x.directors=((ce=(ae=(X=F.directorsPageTitle)==null?void 0:X[0])==null?void 0:ae.credits)==null?void 0:ce.map(ue=>ue.name.nameText.text))||[],x.writers=((ee=(xe=(Q=se.writers)==null?void 0:Q[0])==null?void 0:xe.credits)==null?void 0:ee.map(ue=>ue.name.nameText.text))||[],x.keywords=((Ie=(Pe=F.keywords)==null?void 0:Pe.edges)==null?void 0:Ie.map(ue=>ue.node.text))||[],x.countries=((oe=(G=se.countriesOfOrigin)==null?void 0:G.countries)==null?void 0:oe.map(ue=>ue.text))||[],x.languages=((de=(ie=se.spokenLanguages)==null?void 0:ie.spokenLanguages)==null?void 0:de.map(ue=>ue.text))||[],x.locations=((ne=(te=se.filmingLocations)==null?void 0:te.edges)==null?void 0:ne.map(ue=>ue.node.text))||[]}catch(F){throw console.error("Error parsing IMDb data:",F),F}return x}function Ra(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"").trim()}function af(t,s){const n=Ra(t),r=Ra(s);if(n.includes(r)||r.includes(n))return .9;const a=new Set(n.split(/[^a-z0-9]+/)),o=new Set(r.split(/[^a-z0-9]+/)),i=new Set([...a].filter(d=>o.has(d))),l=new Set([...a,...o]);return l.size===0?0:i.size/l.size}function of(t,s,n){let r=null,a=0;for(const o of s){const i=af(t,o.name),l=n&&o.year===n?.2:0,d=i+l;d>a&&(d>=.5||l&&d>=.3)&&(r=o,a=d)}return r}async function lf(t,s){var d,m;const n=await Sn(),r=!!he.getState().proxySet;if(!n&&!r)throw new Error("Rotten Tomatoes scraping requires either the browser extension or a custom proxy to be set up. Please install the extension or set up a proxy in the settings.");console.log(`[RT Scraper] Using ${n?"browser extension":"custom proxy"} for requests`);const o=`https://www.rottentomatoes.com/search?search=${encodeURIComponent(t.trim())}`,i=Math.floor(Math.random()*128+69);await new Promise(u=>{setTimeout(u,i)});let l;n?l=(await Mr()(o,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"},method:"GET",query:{},readHeaders:[]})).body:l=await Ht(o,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}});try{const u=l.match(/<div id="search-results"[^>]*>(.*?)<\/div>/s);if(!u)return console.error("Could not find search results in RT response"),null;const p=u[1].match(/<search-page-media-row[^>]*>(.*?)<\/search-page-media-row>/gs);if(!p||p.length===0)return null;const g=p.map(x=>{const y=x.match(/data-qa="info-name"[^>]*>([^<]+)</),f=x.match(/href="([^"]+)"/),b=x.match(/tomatometerscore="([^"]+)"/),v=x.match(/tomatometersentiment="([^"]+)"/),w=x.match(/releaseyear="([^"]+)"/),R=x.match(/tomatometeriscertified="([^"]+)"/);return{name:y?y[1].trim():"",url:f?f[1]:"",year:w?parseInt(w[1],10):null,tomatometer:{value:b?parseInt(b[1],10):0,state:v&&(R==null?void 0:R[1])==="true"&&parseInt((b==null?void 0:b[1])||"0",10)>=75?"certified_fresh":v&&v[1].toLowerCase()==="positive"?"fresh":"rotten"}}}),h=of(t,g,s);return h?{title:h.name,tomatoIcon:((d=h.tomatometer)==null?void 0:d.state)||"rotten",tomatoScore:((m=h.tomatometer)==null?void 0:m.value)||0,url:`https://www.rottentomatoes.com${h.url}`}:null}catch(u){return console.error("Error parsing Rotten Tomatoes data:",u),null}}function cf(t){switch(t){case"certified_fresh":return"/tomatoes/Certified_Fresh.svg";case"fresh":return"/tomatoes/Fresh.svg";case"rotten":return"/tomatoes/Rotten.svg";default:return"/tomatoes/Rotten.svg"}}function Pt(t){const{direction:s="down",customButton:n,customMenu:r}=t;return e.jsx("div",{className:`relative my-4 w-fit max-w-[25rem] ${t.className}`,children:e.jsx(ot,{value:t.selectedItem,onChange:t.setSelectedItem,children:({open:a})=>e.jsxs(e.Fragment,{children:[n?e.jsx(ot.Button,{as:c.Fragment,children:n}):e.jsxs(ot.Button,{className:"relative z-[30] w-full rounded-lg bg-dropdown-background hover:bg-dropdown-hoverBackground py-3 pl-3 pr-10 text-left text-white shadow-md focus:outline-none tabbable cursor-pointer",children:[e.jsxs("span",{className:"flex gap-4 items-center truncate",children:[t.selectedItem.leftIcon?t.selectedItem.leftIcon:null,t.selectedItem.name]}),e.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:e.jsx(M,{icon:k.UP_DOWN_ARROW,className:`transform transition-transform text-xl text-dropdown-secondary ${s==="up"?"rotate-180":""}`})})]}),e.jsx(Se,{animation:"slide-down",show:a,className:`absolute z-[40] min-w-[20px] w-fit max-h-60 overflow-auto rounded-lg bg-dropdown-background py-1 text-white shadow-lg ring-1 ring-black ring-opacity-5 scrollbar-thin scrollbar-track-background-secondary scrollbar-thumb-type-secondary focus:outline-none ${s==="up"?"bottom-full mb-4":"top-full mt-1"} ${t.side==="right"?"right-0":"left-0"}`,children:r?e.jsx(ot.Options,{static:!0,as:c.Fragment,children:r}):e.jsx(ot.Options,{static:!0,className:"py-1",children:t.options.map(o=>e.jsxs(ot.Option,{className:({active:i})=>`cursor-pointer flex gap-4 items-center relative select-none py-2 px-4 mx-1 rounded-lg ${i?"bg-background-secondaryHover text-type-link":"text-type-secondary"} ${t.preventWrap?"whitespace-nowrap":""}`,value:o,children:[o.leftIcon?o.leftIcon:null,o.name]},o.id))})})]})})})}const Js={};function Ct(t){if(Js[t])return Js[t];const s=new Date,n=new Date(t);return Js[t]=n<s,Js[t]}const df=function({episodes:s,showProgress:n,progress:r,selectedSeason:a,onSeasonChange:o,seasons:i,mediaId:l,mediaTitle:d,mediaPosterUrl:m}){const[u,p]=c.useState(!1),[g,h]=c.useState(""),[x,y]=c.useState(""),[f,b]=c.useState(!1),[v,w]=c.useState({}),[R,P]=c.useState({}),[O,U]=c.useState(!1),[D,S]=c.useState([]),N=c.useRef(null),C=c.useRef(null),_=c.useRef(null),I=c.useRef({}),A=je(G=>G.updateItem),L=Ke("season-watch-confirm"),j=G=>{if(!C.current)return;const de=(256+16)*2,te=C.current.scrollLeft+(G==="left"?-de:de);C.current.scrollTo({left:te,behavior:"smooth"})},B=G=>{const oe=i.find(ie=>ie.season_number===a);return!oe||!l||!d?"#":`/media/tmdb-tv-${l}-${d.toLowerCase().replace(/[^a-z0-9]+/g,"-")}/${oe.id}/${G.id}`};c.useEffect(()=>{if(C.current)if(_.current){const G=C.current.getBoundingClientRect().left,oe=C.current.clientWidth,ie=_.current.getBoundingClientRect().left,de=_.current.clientWidth,te=ie-G-oe/2+de/2;C.current.scrollTo({left:C.current.scrollLeft+te,behavior:"smooth"})}else C.current.scrollTo({left:0,behavior:"smooth"})},[s,n]),c.useEffect(()=>{if(!u)return;const G=oe=>{N.current&&!N.current.contains(oe.target)&&p(!1)};return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[u]);const W=()=>{const G=parseInt(g,10),oe=parseInt(x,10);if(Number.isNaN(G)||Number.isNaN(oe)||!l||!d)return;const ie=i.find(ne=>ne.season_number===G);if(!ie)return;const de=s.find(ne=>ne.season_number===G&&ne.episode_number===oe);if(!de){console.error("No episode data found for season:",G,"episode:",oe);return}const te=`/media/tmdb-tv-${l}-${d.toLowerCase().replace(/[^a-z0-9]+/g,"-")}/${ie.id}/${de.id}`;window.location.href=te,p(!1)},H=(G,oe)=>{var ie,de;if(oe.preventDefault(),oe.stopPropagation(),l){const te=s.find(ne=>ne.id===G);if(te){const ne=i.find($e=>$e.season_number===a);if(!ne)return;const F=(de=(ie=r[l.toString()])==null?void 0:ie.episodes)==null?void 0:de[G],ue=(F?F.progress.watched/F.progress.duration*100:0)>90,Me=m;A({meta:{tmdbId:l.toString(),title:d||"",type:"show",releaseYear:new Date().getFullYear(),poster:Me,episode:{tmdbId:G.toString(),number:te.episode_number,title:te.name||""},season:{tmdbId:ne.id.toString(),number:a,title:ne.name||""}},progress:{watched:ue?0:60,duration:60}})}}},$=me(G=>G.toggleFavoriteEpisode),K=me(G=>G.bookmarks),V=me(G=>G.getFavoriteEpisodes),T=(G,oe)=>{oe.preventDefault(),oe.stopPropagation(),l&&$(l.toString(),G.toString(),{title:d||"",poster:m,year:new Date().getFullYear()})},X=G=>{G.preventDefault(),G.stopPropagation(),L.show()},ae=()=>{L.hide()},ce=s.filter(G=>G.season_number===a),Q=c.useMemo(()=>l?V(l.toString()):[],[l,V]);c.useEffect(()=>{if(O&&l&&Q.length>0){const G=s.filter(oe=>Q.includes(oe.id.toString()));S(G)}else S([])},[O,l,Q,s]);const xe=G=>{G.id==="favorites"?(U(!0),o(-1)):(U(!1),o(Number(G.id)))},ee=G=>{try{const oe=[];ce.forEach(de=>{var ue,Me;const te=(Me=(ue=r[(l==null?void 0:l.toString())??""])==null?void 0:ue.episodes)==null?void 0:Me[de.id],ne=te?te.progress.watched/te.progress.duration*100:0,F=Ct(de.air_date),se=ne>90;F&&!se&&oe.push(se)});const ie=oe.length>=1;ce.forEach(de=>{var ue,Me;const te=(Me=(ue=r[(l==null?void 0:l.toString())??""])==null?void 0:ue.episodes)==null?void 0:Me[de.id],ne=te?te.progress.watched/te.progress.duration*100:0,F=Ct(de.air_date),se=ne>90;(ie&&F&&!se||!ie&&F&&se)&&H(de.id,G)}),L.hide()}catch(oe){console.error("Error in handleConfirm:",oe),L.hide()}},Pe=(G,oe)=>{oe.preventDefault(),w(ie=>({...ie,[G]:!ie[G]}))},Ie=G=>G?G.scrollHeight>G.clientHeight:!1;return c.useEffect(()=>{w({}),P({})},[a]),c.useEffect(()=>{const G=()=>{const de={};s.forEach(te=>{if(!v[te.id]){const ne=I.current[te.id];de[te.id]=Ie(ne)}}),P(de)};G();const oe=setTimeout(G,250),ie=()=>{G()};return window.addEventListener("resize",ie),()=>{clearTimeout(oe),window.removeEventListener("resize",ie)}},[s,v]),c.useEffect(()=>{const G=[];ce.forEach(oe=>{var F,se;const ie=(se=(F=r[(l==null?void 0:l.toString())??""])==null?void 0:F.episodes)==null?void 0:se[oe.id],de=ie?ie.progress.watched/ie.progress.duration*100:0,te=Ct(oe.air_date),ne=de>90;te&&!ne&&G.push(ne)}),G.length>=1?b(!0):b(!1)},[ce,s,l,r]),e.jsxs("div",{className:"mt-6 md:mt-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:re("details.episodes")}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>p(!u),className:"p-2 rounded-full hover:bg-white/10 transition-colors",title:re("details.goToEpisode"),children:e.jsx(M,{icon:k.SEARCH,className:"text-white/80"})}),u&&e.jsx("div",{ref:N,className:"absolute top-full left-0 mt-2 p-4 bg-background-main rounded-lg shadow-lg border border-white/10 z-50 min-w-[250px]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/80 mb-1",children:re("details.season")}),e.jsx("input",{type:"number",value:g,onChange:G=>h(G.target.value),min:"1",max:i.length,className:"w-full px-3 py-2 bg-white/5 rounded border border-white/10 text-white focus:outline-none focus:border-white/30",placeholder:re("details.season")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/80 mb-1",children:re("details.episode")}),e.jsx("input",{type:"number",value:x,onChange:G=>y(G.target.value),min:"1",className:"w-full px-3 py-2 bg-white/5 rounded border border-white/10 text-white focus:outline-none focus:border-white/30",placeholder:re("details.episode")})]}),e.jsx(Z,{theme:"purple",onClick:W,className:"w-full px-4 py-2",children:re("details.play")})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(Fs,{id:L.id,children:e.jsxs(An,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:f?re("media.seasonWatched"):re("media.seasonUnwatched")}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Z,{theme:"secondary",onClick:ae,children:re("actions.cancel")}),e.jsx(Z,{theme:"purple",onClick:ee,children:re("actions.confirm")})]})]})}),!O&&e.jsx("button",{type:"button",onClick:G=>X(G),className:"p-1.5 bg-dropdown-background hover:bg-dropdown-hoverBackground transition-colors rounded-full",title:re("Mark season as watched"),children:e.jsx(M,{icon:f?k.EYE:k.EYE_SLASH,className:"h-5 w-5 text-white"})}),e.jsx(Pt,{options:[...Q.length>0?[{id:"favorites",name:`${re("player.menus.episodes.favorites")} (${Q.length})`}]:[],...i.map(G=>({id:G.season_number.toString(),name:`${re("details.season")} ${G.season_number}`}))],selectedItem:{id:O?"favorites":a.toString(),name:O?`${re("player.menus.episodes.favorites")} (${Q.length})`:`${re("details.season")} ${a}`},setSelectedItem:xe})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 z-10 px-4 hidden lg:block",children:e.jsx("button",{type:"button",className:"p-2 bg-black/80 hover:bg-video-context-hoverColor transition-colors rounded-full border border-video-context-border backdrop-blur-sm",onClick:()=>j("left"),children:e.jsx(M,{icon:k.CHEVRON_LEFT,className:"text-white/80"})})}),e.jsxs("div",{ref:C,className:"flex overflow-x-auto space-x-4 pb-4 pt-2 lg:px-12 scrollbar-hide carousel-container",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx("div",{className:"flex-shrink-0 w-4"}),O&&D.length===0?e.jsx("div",{className:"flex-shrink-0 w-full flex justify-center items-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/80 mb-2",children:re("player.menus.episodes.noFavorites")}),e.jsx("p",{className:"text-sm text-white/60",children:re("player.menus.episodes.favoritesDescription")})]})}):(O?D:ce).map(G=>{var ue,Me,$e,Ve,Xt;const oe=((ue=n==null?void 0:n.episode)==null?void 0:ue.id)===G.id.toString(),ie=($e=(Me=r[(l==null?void 0:l.toString())??""])==null?void 0:Me.episodes)==null?void 0:$e[G.id],de=ie?ie.progress.watched/ie.progress.duration*100:0,te=Ct(G.air_date),ne=v[G.id],F=de>90,se=l?((Xt=(Ve=K[l.toString()])==null?void 0:Ve.favoriteEpisodes)==null?void 0:Xt.includes(G.id.toString()))??!1:!1;return e.jsxs(vt,{to:B(G),ref:oe?_:null,className:z("flex-shrink-0 transition-all duration-200 relative cursor-pointer hover:scale-95 rounded-lg overflow-hidden",oe?"bg-video-context-hoverColor/50 hover:bg-white/5":"hover:bg-white/5",te?"":"opacity-50",ne?"w-[32rem]":"w-52 md:w-64","h-[280px]"),children:[!ne&&e.jsxs("div",{className:"relative h-[158px] w-full bg-video-context-hoverColor",children:[G.still_path?e.jsx("img",{src:`https://image.tmdb.org/t/p/w300${G.still_path}`,alt:G.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black bg-opacity-50",children:e.jsx(M,{icon:k.FILM,className:"text-video-context-type-main opacity-50 text-3xl"})}),e.jsxs("div",{className:"absolute top-2 left-2 flex items-center space-x-2",children:[e.jsx("span",{className:"p-0.5 px-2 rounded inline bg-video-context-hoverColor bg-opacity-80 text-video-context-type-main text-sm",children:O?`S${G.season_number}E${G.episode_number}`:`${re("media.episodeShort")}${G.episode_number}`}),!te&&e.jsx("span",{className:"bg-video-context-hoverColor/50 text-video-context-type-main/80 text-sm px-1 py-0.5 rounded-md",children:G.air_date?`(${re("details.airs")} - ${new Date(G.air_date).toLocaleDateString()})`:`(${re("media.unreleased")})`})]}),te&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx("button",{type:"button",onClick:_e=>T(G.id,_e),className:"p-1.5 bg-black/50 rounded-full hover:bg-black/80 transition-colors",title:re("player.menus.episodes.markAsFavorite"),children:e.jsx(M,{icon:se?k.BOOKMARK:k.BOOKMARK_OUTLINE,className:"h-8 w-8 text-white/80"})}),e.jsx("button",{type:"button",onClick:_e=>H(G.id,_e),className:"p-1.5 bg-black/50 rounded-full hover:bg-black/80 transition-colors",title:F?re("player.menus.episodes.markAsUnwatched"):re("player.menus.episodes.markAsWatched"),children:e.jsx(M,{icon:F?k.EYE_SLASH:k.EYE,className:"h-4 w-4 text-white/80"})})]})]}),e.jsxs("div",{className:z("p-3",ne?"h-full":"h-[122px]"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"font-bold text-white line-clamp-1",children:G.name}),ne&&te&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:_e=>T(G.id,_e),className:"p-1.5 rounded-full hover:bg-white/20 transition-colors",title:re("player.menus.episodes.markAsFavorite"),children:e.jsx(M,{icon:se?k.BOOKMARK:k.BOOKMARK_OUTLINE,className:"h-8 w-8 text-white/80"})}),e.jsx("button",{type:"button",onClick:_e=>H(G.id,_e),className:"p-1.5 rounded-full hover:bg-white/20 transition-colors",title:F?re("player.menus.episodes.markAsUnwatched"):re("player.menus.episodes.markAsWatched"),children:e.jsx(M,{icon:F?k.EYE_SLASH:k.EYE,className:"h-4 w-4 text-white/80"})})]})]}),G.overview&&e.jsxs("div",{className:"relative",children:[e.jsx("p",{ref:_e=>{I.current[G.id]=_e},className:z("text-sm text-white/80 mt-1.5 transition-all duration-200",ne?"max-h-[200px] overflow-y-auto scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent pr-2":"line-clamp-2"),children:G.overview}),!ne&&R[G.id]&&e.jsx("button",{type:"button",onClick:_e=>Pe(G.id,_e),className:"text-sm text-white/60 hover:text-white transition-opacity duration-200 opacity-0 animate-fade-in",children:re("player.menus.episodes.showMore")}),ne&&e.jsx("button",{type:"button",onClick:_e=>Pe(G.id,_e),className:"mt-2 text-sm text-white/60 hover:text-white transition-opacity duration-200 opacity-0 animate-fade-in",children:re("player.menus.episodes.showLess")})]})]}),de>0&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-progress-background/25",children:e.jsx("div",{className:"h-full bg-progress-filled",style:{width:`${de>98?100:de}%`}})})]},G.id)}),e.jsx("div",{className:"flex-shrink-0 w-4"})]}),e.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 z-10 px-4 hidden lg:block",children:e.jsx("button",{type:"button",className:"p-2 bg-black/80 hover:bg-video-context-hoverColor transition-colors rounded-full border border-video-context-border backdrop-blur-sm",onClick:()=>j("right"),children:e.jsx(M,{icon:k.CHEVRON_RIGHT,className:"text-white/80"})})})]})]})},uf=df;function mf({mediaId:t,mediaType:s}){const{t:n}=q(),[r,a]=c.useState([]),[o,i]=c.useState(null);return c.useEffect(()=>{async function l(){try{const d=await Tu(t,s),m=d.crew.find(p=>p.job==="Director"&&p.profile_path);i(m||null);const u=d.cast.filter(p=>p.profile_path).slice(0,20);a(u)}catch(d){console.error("Failed to load cast:",d)}}l()},[t,s]),r.length===0&&!o?null:e.jsx("div",{className:"space-y-4 pt-8",children:e.jsxs("div",{className:"flex overflow-x-auto scrollbar-none pb-4 gap-4",children:[o&&e.jsxs("a",{href:`https://www.themoviedb.org/person/${o.id}`,target:"_blank",rel:"noopener noreferrer",className:"flex flex-col items-center space-y-2 flex-shrink-0 hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"relative h-32 w-32 overflow-hidden rounded-full",children:e.jsx("img",{src:ma(o.profile_path),alt:o.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"text-center w-32 flex flex-col",children:[e.jsx("span",{className:"font-medium truncate",children:o.name}),e.jsx("span",{className:"text-sm truncate",children:n("Director")})]})]}),r.map(l=>e.jsxs("a",{href:`https://www.themoviedb.org/person/${l.id}`,target:"_blank",rel:"noopener noreferrer",className:"flex flex-col items-center space-y-2 flex-shrink-0 hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"relative h-32 w-32 overflow-hidden rounded-full",children:e.jsx("img",{src:ma(l.profile_path),alt:l.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"text-center w-32 flex flex-col",children:[e.jsx("span",{className:"font-medium truncate",children:l.name}),e.jsx("span",{className:"text-sm truncate",children:l.character})]})]},l.id))]})})}const hf=function({trailerUrl:s,onClose:n}){return e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center transition-opacity duration-300",onClick:n,children:e.jsxs("div",{className:"relative w-[90%] max-w-6xl aspect-video",onClick:r=>r.stopPropagation(),children:[s.includes("youtube.com/embed")?e.jsx("iframe",{src:s,className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):e.jsx("video",{className:"w-full h-full object-contain",autoPlay:!0,controls:!0,playsInline:!0,children:e.jsx("source",{src:s,type:"video/mp4"})}),e.jsx("button",{type:"button",onClick:n,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full transition-colors",children:e.jsx(M,{icon:k.X,className:"text-white"})})]})})},ff=hf,as=Object.values(ke);function Yn(t){const s=t.match(/^\[([a-zA-Z0-9_]+)\](.*)$/);if(s){const n=s[1].toUpperCase(),r=ke[n]||as[0],a=s[2].trim();return{icon:r,name:a}}return{icon:as[0],name:t}}function pf({groups:t,currentGroups:s,onSelectGroups:n,onCreateGroup:r,onRemoveGroup:a}){const[o,i]=c.useState(!1),[l,d]=c.useState(""),[m,u]=c.useState(!1),[p,g]=c.useState(as[0]),h=c.useRef(null);c.useEffect(()=>{const f=b=>{h.current&&!h.current.contains(b.target)&&(i(!1),u(!1),d(""),g(as[0]))};return o&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[o]);const x=f=>{let b;s.includes(f)?b=s.filter(v=>v!==f):b=[...s,f],n(b)},y=(f,b)=>{const v=`[${b}]${f}`;r(v,b),i(!1),u(!1),d(""),g(as[0])};return e.jsxs("div",{ref:h,className:"relative min-w-[200px]",children:[e.jsxs("button",{type:"button",className:"w-full px-3 py-2 text-xs bg-background-main border border-background-secondary rounded-lg text-white flex justify-between items-center hover:bg-mediaCard-hoverBackground transition-colors",onClick:()=>i(f=>!f),children:[s.length>0?e.jsx("span",{className:"flex flex-wrap gap-1 items-center",children:s.map(f=>{const{icon:b,name:v}=Yn(f);return e.jsxs("span",{className:"flex items-center gap-1 bg-type-link/20 px-2 py-1 rounded text-type-link text-xs",children:[e.jsx(xt,{icon:b,className:"inline-block w-4 h-4"}),v]},f)})}):e.jsx("span",{className:"text-type-secondary",children:re("home.bookmarks.groups.dropdown.placeholderButton")}),e.jsx("span",{className:"ml-2 text-type-secondary",children:e.jsx(M,{icon:o?k.CHEVRON_UP:k.CHEVRON_DOWN,className:"text-base"})})]}),o&&e.jsxs("div",{className:"absolute min-w-full z-[150] mt-1 end-0 bg-background-main border border-background-secondary rounded-lg shadow-lg py-1 pb-3 text-sm",children:[t.length===0&&!m&&e.jsx("div",{className:"px-4 py-2 text-type-secondary",children:re("home.bookmarks.groups.dropdown.empty")}),t.map(f=>{const{icon:b,name:v}=Yn(f);return e.jsxs("label",{className:"flex items-center gap-2 mx-1 px-3 py-2 hover:bg-mediaCard-hoverBackground rounded-md cursor-pointer transition-colors text-type-link/80",children:[e.jsx("input",{type:"checkbox",checked:s.includes(f),onChange:()=>x(f),className:"accent-type-link"}),e.jsx("span",{className:"w-5 h-5 flex items-center justify-center ml-1",children:e.jsx(xt,{icon:b,className:"inline-block w-full h-full"})}),v]},f)}),e.jsxs("div",{className:"flex flex-col gap-2 px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:f=>d(f.target.value),className:"flex-1 px-2 py-1 rounded bg-background-main text-white border border-background-secondary text-xs min-w-0 placeholder:text-type-secondary",placeholder:"Group name",autoFocus:!0,onKeyDown:f=>{f.key==="Enter"&&y(l,p),f.key==="Escape"&&u(!1)},style:{minWidth:0}}),e.jsx("button",{type:"button",className:"text-type-link font-bold px-2 py-1 min-w-[2.5rem]",onClick:()=>y(l,p),disabled:!l.trim(),style:{flexShrink:0},children:re("home.bookmarks.groups.dropdown.addButton")})]}),l.trim().length>0&&e.jsx("div",{className:"flex items-center gap-2 flex-wrap pt-2 w-full justify-center",children:as.map(f=>e.jsx("button",{type:"button",className:`rounded p-1 border-2 ${p===f?"border-type-link bg-mediaCard-hoverBackground":"border-transparent hover:border-background-secondary"}`,onClick:()=>g(f),children:e.jsx("span",{className:"w-5 h-5 flex items-center justify-center",children:e.jsx(xt,{icon:f,className:`w-full h-full ${p===f?"text-type-link":""}`})})},f))})]}),s.length>0&&e.jsxs("div",{className:"border-t border-background-secondary pt-2 px-4",children:[e.jsx("div",{className:"text-xs text-red-400 mb-1",children:re("home.bookmarks.groups.dropdown.removeFromGroup")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.map(f=>{const{icon:b,name:v}=Yn(f);return e.jsxs("button",{type:"button",className:"flex items-center gap-1 px-2 py-1 rounded bg-red-900/30 text-red-300 text-xs hover:bg-red-700/30 transition-colors",onClick:()=>a(f),children:[e.jsx(xt,{icon:b,className:"inline-block w-4 h-4"}),v,e.jsx("span",{className:"ml-1",children:"√ó"})]},f)}),e.jsx("button",{type:"button",className:"ml-2 text-xs text-red-400 underline hover:text-red-300 transition-colors",onClick:()=>a(),children:re("home.bookmarks.groups.dropdown.removeAll")})]})]})]})]})}const xf=function({data:s,onPlayClick:n,onTrailerClick:r,onShareClick:a,showProgress:o,voteAverage:i,voteCount:l,releaseDate:d,seasons:m,imdbData:u}){var O,U,D;const[p,g]=c.useState(null),h=me(S=>S.addBookmarkWithGroups),x=me(S=>S.bookmarks),y=((U=x[((O=s.id)==null?void 0:O.toString())??""])==null?void 0:U.group)||[],f=Array.from(new Set(Object.values(x).flatMap(S=>S.group||[]).filter(Boolean))),b=S=>{if(!s.id)return;const N={tmdbId:s.id.toString(),title:s.title,type:s.type||"movie",releaseYear:s.releaseDate?new Date(s.releaseDate).getFullYear():0,poster:s.posterUrl};h(N,S)},v=S=>{b([...y,S])},w=S=>{if(!s.id)return;const N={tmdbId:s.id.toString(),title:s.title,type:s.type||"movie",releaseYear:s.releaseDate?new Date(s.releaseDate).getFullYear():0,poster:s.posterUrl};if(S){const C=y.filter(_=>_!==S);h(N,C)}else h(N,[])};c.useEffect(()=>{(async()=>{if(s.id)try{const N=await Ui(s.id.toString());g(N)}catch(N){console.error("Failed to fetch release info:",N)}})()},[s.id]);const R=()=>{if(!p||s.type==="show")return null;const S=!!p.digital_release_date,N=!!p.theatrical_release_date;if(S){const C=new Date(p.digital_release_date),_=new Date(C);if(_.setDate(_.getDate()+2),new Date>=_)return e.jsx("span",{className:"text-green-400",children:"HD"})}if(N){const C=new Date(p.theatrical_release_date),_=new Date(C);return _.setDate(_.getDate()+45),new Date>=_?e.jsx("div",{className:"px-2 py-1 rounded-lg backdrop-blur-sm bg-gray-600/40",children:e.jsx("span",{className:"text-green-400",children:"HD"})}):e.jsx("div",{className:"px-2 py-1 rounded-lg backdrop-blur-sm bg-gray-600/40",children:e.jsx("span",{className:"text-yellow-400",children:"CAM"})})}return null},P=S=>S?new Date(S).getFullYear():null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-white/80",children:[R()&&e.jsxs(e.Fragment,{children:[R(),e.jsx("span",{className:"text-white/60",children:"‚Ä¢"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{icon:k.TMDB}),e.jsx("span",{children:i.toFixed(1)}),l&&e.jsxs("span",{className:"text-white/60",children:["(",l.toLocaleString(),")"]})]}),(u==null?void 0:u.rating)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"‚Ä¢"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{icon:k.IMDB,className:"text-yellow-400"}),e.jsx("span",{children:u.rating.toFixed(1)}),u.votes&&e.jsxs("span",{className:"text-white/60",children:["(",u.votes.toLocaleString(),")"]})]})]})]}),(d||m)&&e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"‚Ä¢"}),e.jsx("span",{children:P(d)})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"‚Ä¢"}),e.jsxs("span",{children:[m," ",re("details.seasons")]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Z,{onClick:n,theme:"purple",className:z("flex-1 sm:flex-initial sm:w-auto","gap-2 h-12 rounded-lg px-4 py-2 my-1 transition-transform hover:scale-105 duration-100","text-md text-white flex items-center justify-center"),children:[e.jsx(M,{icon:k.PLAY,className:"text-white"}),e.jsx("span",{className:"text-white text-sm pr-1",children:o&&s.type==="show"&&o.season&&o.episode?`${re("details.resume")} S${o.season.number}:E${o.episode.number}`:s.type==="movie"?!s.releaseDate||new Date(s.releaseDate)>new Date?re("media.unreleased"):o?re("details.resume"):re("details.play"):o?re("details.resume"):re("details.play")})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(u==null?void 0:u.trailer_url)&&e.jsx("button",{type:"button",onClick:r,className:"p-2 opacity-75 transition-opacity duration-300 hover:scale-110 hover:cursor-pointer hover:opacity-95",title:re("details.trailer"),children:e.jsx(ht,{icon:k.FILM,className:"transition-transform duration-300 hover:scale-110 hover:cursor-pointer"})}),e.jsx(pr,{media:{id:((D=s.id)==null?void 0:D.toString())||"",title:s.title,year:s.releaseDate?new Date(s.releaseDate).getFullYear():void 0,poster:s.posterUrl,type:s.type||"movie"}}),e.jsx("button",{type:"button",onClick:a,className:"p-2 opacity-75 transition-opacity duration-300 hover:scale-110 hover:cursor-pointer hover:opacity-95",title:"Share",children:e.jsx(ht,{icon:k.IOS_SHARE,className:"transition-transform duration-300 hover:scale-110 hover:cursor-pointer"})})]})]}),e.jsx(pf,{groups:f,currentGroups:y,onSelectGroups:b,onCreateGroup:v,onRemoveGroup:w})]})]})},gf=xf;function bf({rtData:t,mediaId:s,mediaType:n,imdbId:r,provider:a}){const o=i=>`/platforms/${sf[i]||i.toLowerCase().replace(/\s+/g,"")}.png`;return e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex gap-3 mt-2",children:[a&&e.jsx("div",{className:"w-8 h-8 flex items-center justify-center transition-transform hover:scale-110 animate-[scaleIn_0.6s_ease-out_forwards]",style:{animationDelay:"0ms",transform:"scale(0)",opacity:0},title:a,children:e.jsx("img",{src:o(a),alt:a,className:"w-8 h-8 rounded-md"})}),s&&e.jsx("a",{href:`https://www.themoviedb.org/${n==="show"?"tv":"movie"}/${s}`,target:"_blank",rel:"noopener noreferrer",className:"w-8 h-8 rounded-md bg-[#0d253f] flex items-center justify-center transition-transform hover:scale-110 animate-[scaleIn_0.6s_ease-out_forwards]",style:{animationDelay:"60ms",transform:"scale(0)",opacity:0},title:re("details.tmdb"),children:e.jsx(M,{icon:k.TMDB,className:"text-white"})}),r&&e.jsx("a",{href:`https://www.imdb.com/title/${r}`,target:"_blank",rel:"noopener noreferrer",className:"w-8 h-8 rounded-md bg-yellow-500 flex items-center justify-center transition-transform hover:scale-110 animate-[scaleIn_0.6s_ease-out_forwards]",style:{animationDelay:"120ms",transform:"scale(0)",opacity:0},title:re("details.imdb"),children:e.jsx(M,{icon:k.IMDB,className:"text-black"})}),t&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-1",children:e.jsxs("div",{className:"flex items-center gap-1 animate-[scaleIn_0.6s_ease-out_forwards]",style:{animationDelay:"180ms",transform:"scale(0)",opacity:0},title:"Tomatometer",children:[e.jsx("img",{src:cf(t.tomatoIcon),alt:"Tomatometer",className:"w-8 h-8"}),e.jsxs("span",{className:"text-sm pl-1 text-white/80",children:[t.tomatoScore,"%"]})]})})})]})})}function yf({data:t,imdbData:s,rtData:n,provider:r}){const[a,o]=c.useState(!1),[i,l]=c.useState(!1);c.useEffect(()=>{const g=x=>{x.key==="Shift"&&o(!0)},h=x=>{x.key==="Shift"&&o(!1)};return window.addEventListener("keydown",g),window.addEventListener("keyup",h),()=>{window.removeEventListener("keydown",g),window.removeEventListener("keyup",h)}},[]);const d=async()=>{!a||!t.id||(await navigator.clipboard.writeText(t.id.toString()),l(!0),setTimeout(()=>l(!1),2e3))},m=g=>{if(!g)return null;const h=Math.floor(g/60),x=g%60;return h>0?`${h}h ${x}m`:`${x}m`},u=g=>{if(!g)return null;const h=new Date;return new Date(h.getTime()+g*6e4).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},p=g=>g?new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):null;return e.jsx("div",{className:"md:col-span-1 bg-background-secondary/50 group-hover:bg-background-secondary/80 p-4 rounded-lg border-buttons-primary transition-colors duration-300",children:e.jsxs("div",{className:"space-y-3 text-xs",children:[t.runtime&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-white/80",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:re("details.runtime")})," ",m(t.runtime)]}),t.type==="movie"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"hidden lg:inline mx-1",children:"‚Ä¢"}),e.jsx(pe,{i18nKey:"details.endsAt",className:"font-medium",values:{time:u(t.runtime)}})]})]}),t.language&&e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("span",{className:"font-medium",children:re("details.language")})," ",t.language.toUpperCase()]}),t.releaseDate&&e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("span",{className:"font-medium",children:re("details.releaseDate")})," ",p(t.releaseDate)]}),t.rating&&e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx("span",{className:"font-medium",children:re("details.rating")})," ",t.rating]}),t.id&&a&&e.jsxs("div",{className:"flex items-center gap-1 text-white/80 cursor-pointer transition-opacity duration-200 select-none",onClick:d,title:a?"Click to copy":"Hold Shift to show",children:[e.jsx("span",{className:"font-medium",children:"ID:"}),e.jsx("span",{className:"font-mono",children:t.id}),i&&e.jsx("span",{className:"text-green-400 ml-2",children:"Copied!"})]}),e.jsx(bf,{imdbData:s,rtData:n,mediaId:t.id,mediaType:t.type,imdbId:t.imdbId,voteAverage:t.voteAverage,voteCount:t.voteCount,provider:r})]})})}function vf({data:t,minimal:s=!1}){var D;const[n,r]=c.useState(null),[a,o]=c.useState(null),[i,l]=c.useState(void 0),[,d]=c.useState(!1),[m,u]=c.useState(!1),[p,g]=c.useState(1),[,h]=Cr(),[x,y]=c.useState(!1),[f,b]=c.useState(0),v=c.useRef(null),w=je(S=>S.items),R=J(S=>S.enableImageLogos),P=c.useMemo(()=>{if(!t.id)return null;const S=w[t.id.toString()];return S?Ds(S):null},[t.id,w]);c.useEffect(()=>{var S;(S=P==null?void 0:P.season)!=null&&S.number&&g(P.season.number)},[P]),c.useEffect(()=>{if(v.current){const S=new ResizeObserver(N=>{for(const C of N)b(C.contentRect.height)});return S.observe(v.current),()=>S.disconnect()}},[]),c.useEffect(()=>{(async()=>{if(t.id)try{const N=await Xh(t.id.toString());N&&N.platforms&&N.platforms.length>0?l(N.platforms[0]):l(void 0)}catch(N){console.error("Failed to fetch network data:",N),l(void 0)}})()},[t.id]),c.useEffect(()=>{(async()=>{if(t.imdbId){d(!0);try{const N=ze.getState().language,C=yt(N),_=await Hi(t.imdbId,void 0,void 0,C,t.type);if(typeof _.imdb_rating=="number"&&typeof _.votes=="number"||_.trailer_url?r({rating:_.imdb_rating,votes:_.votes,trailer_url:_.trailer_url}):r(null),t.type==="movie"){const I=await lf(t.title,t.releaseDate?new Date(t.releaseDate).getFullYear():void 0);o(I)}}catch(N){console.error("Failed to fetch external data:",N)}finally{d(!1)}}})()},[t.imdbId,t.title,t.releaseDate,t.type]);const O=()=>{var S,N;t.type==="movie"?window.location.assign(`/media/tmdb-movie-${t.id}-${t.title.toLowerCase().replace(/[^a-z0-9]+/g,"-")}`):t.type==="show"&&((S=P==null?void 0:P.season)!=null&&S.id&&((N=P==null?void 0:P.episode)!=null&&N.id)?window.location.assign(`/media/tmdb-tv-${t.id}-${t.title.toLowerCase().replace(/[^a-z0-9]+/g,"-")}/${P.season.id}/${P.episode.id}`):window.location.assign(`/media/tmdb-tv-${t.id}-${t.title.toLowerCase().replace(/[^a-z0-9]+/g,"-")}`))},U=()=>{const S=t.type==="movie"?`${window.location.origin}/media/tmdb-movie-${t.id}-${t.title.toLowerCase().replace(/[^a-z0-9]+/g,"-")}`:`${window.location.origin}/media/tmdb-tv-${t.id}-${t.title.toLowerCase().replace(/[^a-z0-9]+/g,"-")}`;/iPad|iPhone|iPod/i.test(navigator.userAgent)&&navigator.share?navigator.share({title:"P-Stream",text:t.title,url:S}).catch(N=>console.error("Error sharing:",N)):(h(S),y(!0),setTimeout(()=>y(!1),2e3))};return e.jsxs("div",{className:"relative h-full flex flex-col",children:[x&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 bg-green-600 text-white rounded-lg shadow-lg transition-all duration-300 animate-[scaleIn_0.6s_ease-out_forwards]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{icon:k.CHECKMARK,className:"text-white"}),e.jsx("span",{className:"text-sm font-medium",children:"Link copied to clipboard!"})]})}),m&&(n==null?void 0:n.trailer_url)&&e.jsx(ff,{trailerUrl:n.trailer_url,onClose:()=>u(!1)}),e.jsxs("div",{className:"relative -mt-12 z-20",style:{height:`${Math.max(500,f+400)}px`},children:[e.jsx("div",{ref:v,className:"absolute inset-x-0 bottom-20 z-30 px-6",children:t.logoUrl&&R?e.jsx("img",{src:t.logoUrl,alt:t.title,className:"max-w-[16rem] md:max-w-[20rem] lg:max-w-[30rem] max-h-[12rem] object-contain drop-shadow-lg bg-transparent",style:{background:"none"}}):e.jsx("h3",{className:"text-3xl md:text-4xl font-bold text-white drop-shadow-lg",children:t.title})}),e.jsx("div",{className:"absolute inset-0 bg-cover bg-top before:absolute before:inset-0 before:bg-[radial-gradient(circle_at_center,_transparent_0%,_rgba(0,0,0,0.4)_100%)]",style:{backgroundImage:t.backdrop?`url(${t.backdrop})`:void 0,backgroundPosition:"center top",maskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 150px)",WebkitMaskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 150px)",zIndex:-1}})]}),e.jsxs("div",{className:"px-6 pb-6 mt-[-70px] flex-grow relative z-30",children:[e.jsx(gf,{data:t,onPlayClick:O,onTrailerClick:()=>u(!0),onShareClick:U,showProgress:P,voteAverage:t.voteAverage,voteCount:t.voteCount,releaseDate:t.releaseDate,seasons:t.type==="show"?(D=t.seasonData)==null?void 0:D.seasons.length:void 0,imdbData:n}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 md:gap-6 pt-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[t.overview&&e.jsx("p",{className:"text-sm text-white/90 mb-6",children:t.overview}),t.genres&&t.genres.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 items-center",children:t.genres.map((S,N)=>{var C;return e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-white/20 text-white/80 transition-all duration-300 hover:scale-110 animate-[scaleIn_0.6s_ease-out_forwards]",style:{animationDelay:`${((((C=t.genres)==null?void 0:C.length)??0)-1-N)*60}ms`,transform:"scale(0)",opacity:0},children:S.name},S.id)})}),e.jsxs("div",{className:"space-y-4 mb-6",children:[t.director&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-white/80",children:re("details.director")})," ",e.jsx("span",{className:"text-white/70",children:t.director})]}),t.actors&&t.actors.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-white/80",children:re("details.cast")})," ",e.jsx("span",{className:"text-white/70",children:t.actors.join(", ")})]})]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(yf,{data:t,imdbData:n,rtData:a,provider:i})})]}),t.type==="show"&&t.seasonData&&!s&&e.jsx(uf,{episodes:t.seasonData.episodes,showProgress:P,progress:w,selectedSeason:p,onSeasonChange:g,seasons:t.seasonData.seasons,mediaId:t.id,mediaTitle:t.title,mediaPosterUrl:t.posterUrl}),t.id&&e.jsx(mf,{mediaId:t.id.toString(),mediaType:t.type==="movie"?Ne.MOVIE:Ne.TV})]})]})}const wf=function(){const s=["episode-skeleton-1","episode-skeleton-2","episode-skeleton-3","episode-skeleton-4"],n=["cast-skeleton-1","cast-skeleton-2","cast-skeleton-3","cast-skeleton-4","cast-skeleton-5","cast-skeleton-6"];return e.jsxs("div",{className:"relative h-full flex flex-col animate-pulse",children:[e.jsxs("div",{className:"relative -mt-12 z-20",style:{height:"500px"},children:[e.jsxs("div",{className:"absolute inset-x-0 bottom-20 z-30 px-6",children:[e.jsx("div",{className:"h-12 w-64 bg-white/10 rounded-lg"})," "]}),e.jsx("div",{className:"absolute inset-0 bg-white/10",style:{maskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 120px)",WebkitMaskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 120px)",zIndex:-1}})]}),e.jsxs("div",{className:"px-6 pb-6 mt-[-70px] flex-grow relative z-30",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[e.jsx("div",{className:"h-10 w-32 bg-white/10 rounded-lg"})," ",e.jsx("div",{className:"h-10 w-32 bg-white/10 rounded-lg"})," ",e.jsx("div",{className:"h-10 w-32 bg-white/10 rounded-lg"})," ",e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"h-6 w-24 bg-white/10 rounded-lg"})," ",e.jsx("div",{className:"h-6 w-24 bg-white/10 rounded-lg"})," "]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 md:gap-6 pt-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-full"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-full"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx("div",{className:"h-6 w-20 bg-white/10 rounded-full"}),e.jsx("div",{className:"h-6 w-24 bg-white/10 rounded-full"}),e.jsx("div",{className:"h-6 w-16 bg-white/10 rounded-full"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("div",{className:"h-4 w-48 bg-white/10 rounded"})," ",e.jsx("div",{className:"h-4 w-64 bg-white/10 rounded"})," "]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx("div",{className:"bg-video-context-border p-4 rounded-lg border-buttons-primary bg-opacity-80",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 w-32 bg-white/10 rounded"})," ",e.jsx("div",{className:"h-4 w-24 bg-white/10 rounded"})," ",e.jsx("div",{className:"h-4 w-36 bg-white/10 rounded"})," ",e.jsx("div",{className:"h-4 w-20 bg-white/10 rounded"})," ",e.jsx("div",{className:"h-4 w-40 bg-white/10 rounded"})," "]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"h-6 w-48 bg-white/10 rounded mb-4"})," ",e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:s.map(r=>e.jsx("div",{className:"aspect-video bg-white/10 rounded-lg"},r))})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"h-6 w-32 bg-white/10 rounded mb-4"})," ",e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",children:n.map(r=>e.jsxs("div",{className:"flex-shrink-0 w-32",children:[e.jsx("div",{className:"aspect-[2/3] bg-white/10 rounded-lg mb-2"})," ",e.jsx("div",{className:"h-4 w-24 bg-white/10 rounded mx-auto"})," "]},r))})]})]})]})},jf=wf;function _t({id:t,data:s,minimal:n}){const{hideModal:r,isModalVisible:a,modalStack:o}=at(),[i,l]=c.useState(null),[d,m]=c.useState(!1),u=o.indexOf(t),p=u>=0?1e3+u:999,g=c.useCallback(()=>r(t),[r,t]),h=a(t);return c.useEffect(()=>{const x=async()=>{var y,f,b,v,w,R,P,O,U,D;if(!(!(s!=null&&s.id)||!(s!=null&&s.type))){m(!0);try{const S=s.type==="movie"?Ne.MOVIE:Ne.TV,N=await zt(s.id.toString(),S),C=Eu(N.backdrop_path),_=await ai(s.id.toString(),S);if(S===Ne.MOVIE){const I=N,A=It(I.poster_path);l({title:I.title,overview:I.overview,backdrop:C,posterUrl:A,runtime:I.runtime,genres:I.genres,language:I.original_language,voteAverage:I.vote_average,voteCount:I.vote_count,releaseDate:I.release_date,rating:(w=(v=(b=(f=(y=I.release_dates)==null?void 0:y.results)==null?void 0:f.find(L=>L.iso_3166_1==="US"))==null?void 0:b.release_dates)==null?void 0:v[0])==null?void 0:w.certification,type:"movie",id:I.id,imdbId:(R=I.external_ids)==null?void 0:R.imdb_id,logoUrl:_})}else{const I=N,A=It(I.poster_path);l({title:I.name,overview:I.overview,backdrop:C,posterUrl:A,episodes:I.number_of_episodes,seasons:I.number_of_seasons,genres:I.genres,language:I.original_language,voteAverage:I.vote_average,voteCount:I.vote_count,releaseDate:I.first_air_date,rating:(U=(O=(P=I.content_ratings)==null?void 0:P.results)==null?void 0:O.find(L=>L.iso_3166_1==="US"))==null?void 0:U.rating,type:"show",id:I.id,imdbId:(D=I.external_ids)==null?void 0:D.imdb_id,seasonData:{seasons:I.seasons,episodes:I.episodes},logoUrl:_})}}catch(S){console.error("Failed to fetch media details:",S)}finally{m(!1)}}};h&&(s!=null&&s.id)&&x()},[h,s]),c.useEffect(()=>{h&&!(s!=null&&s.id)&&!d&&g()},[h,s,d,g]),e.jsxs(Dn,{darken:!0,close:g,show:h,durationClass:"duration-500",zIndex:p,children:[e.jsx(dt,{children:e.jsx("html",{"data-no-scroll":!0})}),e.jsx("div",{className:"flex absolute inset-0 items-center justify-center pt-safe",children:e.jsx(fe.Base,{className:z("group -m-[0.705em] rounded-3xl bg-background-main","max-h-[900px] max-w-[1200px]","bg-mediaCard-hoverBackground/60 backdrop-filter backdrop-blur-lg shadow-lg overflow-hidden","h-[97%] w-[95%]","relative"),children:e.jsxs("div",{className:"transition-transform duration-300 h-full relative",children:[e.jsx(fe.Light,{flareSize:300,cssColorVar:"--colors-mediaCard-hoverAccent",backgroundClass:"bg-mediaCard-hoverBackground duration-100",className:"rounded-3xl bg-background-main group-hover:opacity-30 transition-opacity duration-300"}),e.jsx("div",{className:"absolute right-4 top-4 z-50 pointer-events-auto",children:e.jsx("button",{type:"button",className:"text-s font-semibold text-type-secondary hover:text-white transition-transform hover:scale-95 select-none",onClick:g,children:e.jsx(ht,{icon:k.X})})}),e.jsx(fe.Child,{className:"pointer-events-auto relative h-full overflow-y-auto scrollbar-none select-text",children:e.jsx("div",{className:"select-text",children:d||!i?e.jsx(jf,{}):e.jsx(vf,{data:i,minimal:n})})})]})})})]})}function kf(t={}){const[s,n]=c.useState(!1),[r,a]=c.useState(!1),o=c.useRef(null);return c.useEffect(()=>{const i=new IntersectionObserver(([d])=>{n(d.isIntersecting),d.isIntersecting&&a(!0)},{...t,rootMargin:t.rootMargin||"300px 0px"}),l=o.current;return l&&i.observe(l),()=>{l&&i.unobserve(l)}},[t]),{targetRef:o,isIntersecting:s,hasIntersected:r}}const Nf=function(){return e.jsx("div",{className:"group -m-[0.705em] rounded-xl bg-background-main transition-colors duration-300",children:e.jsx("div",{className:"pointer-events-auto relative mb-2 p-[0.4em] transition-transform duration-300",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"relative mb-4 pb-[150%] w-full overflow-hidden rounded-xl bg-mediaCard-hoverBackground"}),e.jsxs("div",{className:"mb-1",children:[e.jsx("div",{className:"h-4 bg-mediaCard-hoverBackground rounded w-full mb-1"}),e.jsx("div",{className:"h-4 bg-mediaCard-hoverBackground rounded w-3/4 mb-1"}),e.jsx("div",{className:"h-4 bg-mediaCard-hoverBackground rounded w-1/2"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-3 bg-mediaCard-hoverBackground rounded w-12"}),e.jsx("div",{className:"h-1 w-1 bg-mediaCard-hoverBackground rounded-full"}),e.jsx("div",{className:"h-3 bg-mediaCard-hoverBackground rounded w-8"})]})]})})})},Sf=Nf;function Vi(t){const s=!!(t.year&&t.year<=new Date().getFullYear()),n=!!(t.release_date&&t.release_date<=new Date);return t.release_date?n:s}function Cf({media:t,linkable:s,series:n,percentage:r,closable:a,onClose:o,onShowDetails:i,forceSkeleton:l}){const{t:d}=q(),m=`${Math.round(r??0).toFixed(0)}%`,u=c.useCallback(()=>Vi(t),[t]),p=s&&!a&&u(),g=[d(`media.types.${t.type}`)],[h]=Fi(),x=J(b=>b.enableLowPerformanceMode),{targetRef:y}=kf({rootMargin:"300px"});return l||!t.title&&!t.poster?e.jsx("div",{ref:y,children:e.jsx(Sf,{})}):(u()&&t.year&&g.push(t.year.toFixed()),u()||g.push(d("media.unreleased")),e.jsxs(fe.Base,{className:`group -m-[0.705em] rounded-xl bg-background-main transition-colors duration-300 focus:relative focus:z-10 ${p?"hover:bg-mediaCard-hoverBackground tabbable":""} ${a?"jiggle":""}`,tabIndex:p?0:-1,onKeyUp:b=>b.key==="Enter"&&b.currentTarget.click(),children:[e.jsx(fe.Light,{flareSize:300,cssColorVar:"--colors-mediaCard-hoverAccent",backgroundClass:"bg-mediaCard-hoverBackground duration-100",className:z({"rounded-xl bg-background-main group-hover:opacity-100":p})}),e.jsxs(fe.Child,{className:`pointer-events-auto relative mb-2 p-[0.4em] transition-transform duration-300 ${p?"group-hover:scale-95":"opacity-60"}`,children:[e.jsxs("div",{className:z("relative mb-4 pb-[150%] w-full overflow-hidden rounded-xl bg-mediaCard-hoverBackground bg-cover bg-center transition-[border-radius] duration-300",{"group-hover:rounded-lg":p}),style:{backgroundImage:t.poster?`url(${t.poster})`:"url(/placeholder.png)"},children:[n?e.jsx("div",{className:["absolute right-2 top-2 rounded-md bg-mediaCard-badge px-2 py-1 transition-colors"].join(" "),children:e.jsx("p",{className:["text-center text-xs font-bold text-mediaCard-badgeText transition-colors",a?"":"group-hover:text-white"].join(" "),children:d("media.episodeDisplay",{season:n.season||1,episode:n.episode})})}):null,r!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`absolute inset-x-0 -bottom-px pb-1 h-12 bg-gradient-to-t from-mediaCard-shadow to-transparent transition-colors ${p?"group-hover:from-mediaCard-hoverShadow":""}`}),e.jsx("div",{className:`absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-mediaCard-shadow to-transparent transition-colors ${p?"group-hover:from-mediaCard-hoverShadow":""}`}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-3",children:e.jsx("div",{className:"relative h-1 overflow-hidden rounded-full bg-mediaCard-barColor",children:e.jsx("div",{className:"absolute inset-y-0 left-0 rounded-full bg-mediaCard-barFillColor",style:{width:m}})})})]}):null,!a&&e.jsx("div",{className:"absolute bookmark-button",onClick:b=>b.preventDefault(),children:e.jsx(pr,{media:t})}),h.length>0&&!a?e.jsx("div",{className:"absolute",onClick:b=>b.preventDefault(),children:e.jsx(pr,{media:t})}):null,e.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-mediaCard-badge bg-opacity-80 transition-opacity duration-500 ${a?"opacity-100":"pointer-events-none opacity-0"}`,children:e.jsx(ht,{clickable:!0,className:"text-2xl text-mediaCard-badgeText transition-transform hover:scale-110 duration-500",onClick:()=>a&&(o==null?void 0:o()),icon:k.X})})]}),e.jsx("h1",{className:"mb-1 line-clamp-3 max-h-[4.5rem] text-ellipsis break-words font-bold text-white",children:e.jsx("span",{children:t.title})}),e.jsx("div",{className:"media-info-container justify-content-center flex flex-wrap",children:e.jsx(_h,{className:"text-xs",content:g})}),!a&&!x&&e.jsx("div",{className:"absolute bottom-0 translate-y-1 right-1",children:e.jsx("button",{className:"media-more-button p-2",type:"button",onClick:b=>{b.preventDefault(),b.stopPropagation(),i==null||i(t)},children:e.jsx(M,{className:"text-xs font-semibold text-type-secondary",icon:k.ELLIPSIS})})})]})]}))}function cs(t){const{media:s,onShowDetails:n,forceSkeleton:r}=t,[a,o]=c.useState(null),{showModal:i}=at(),l=J(y=>y.enableDetailsModal),d=c.useCallback(()=>Vi(t.media),[t.media]),m=t.linkable&&!t.closable&&d();let u=m?`/media/${encodeURIComponent(ju(t.media))}`:"#";m&&t.series&&(t.series.season===0&&!t.series.episodeId?u+=`/${encodeURIComponent(t.series.seasonId)}`:u+=`/${encodeURIComponent(t.series.seasonId)}/${encodeURIComponent(t.series.episodeId)}`);const p=c.useCallback(async()=>{if(n){n(s);return}o({id:Number(s.id),type:s.type==="movie"?"movie":"show"}),i("details")},[s,i,n]),g=y=>{l&&m&&(y.preventDefault(),p())},h=y=>{y.preventDefault(),p()},x=e.jsxs(e.Fragment,{children:[e.jsx(Cf,{...t,onShowDetails:p,forceSkeleton:r}),a&&e.jsx(_t,{id:"details",data:a})]});return m?e.jsx(vt,{to:u,tabIndex:-1,className:z("tabbable",t.closable?"hover:cursor-default":""),onClick:g,onContextMenu:h,children:x}):e.jsx("span",{className:"relative",onClick:y=>{y.defaultPrevented&&y.preventDefault()},onContextMenu:h,children:x})}function Ef(t){var s,n,r,a;if(!(!t||!t.episode||!t.season))return{episode:(s=t.episode)==null?void 0:s.number,season:(n=t.season)==null?void 0:n.number,episodeId:(r=t.episode)==null?void 0:r.id,seasonId:(a=t.season)==null?void 0:a.id}}function bt(t){const s=je(o=>o.items),n=c.useMemo(()=>s[t.media.id],[s,t.media]),r=c.useMemo(()=>n?Ds(n):null,[n]),a=r!=null&&r.show?r.progress.watched/r.progress.duration*100:void 0;return e.jsx(cs,{media:t.media,series:Ef(r),linkable:!0,percentage:a,onClose:t.onClose,closable:t.closable,onShowDetails:t.onShowDetails})}function If(t){const{attributes:s,listeners:n,setNodeRef:r,transform:a,transition:o}=Bo({id:t.item.id}),i={transform:jo.Transform.toString(a),transition:o};return e.jsxs("div",{ref:r,style:i,...s,...n,className:z("bg-dropdown-background hover:bg-dropdown-hoverBackground select-none space-x-3 flex items-center max-w-[25rem] py-3 px-4 rounded-lg touch-manipulation",t.item.disabled&&"opacity-50",a?"cursor-grabbing":"cursor-grab"),children:[e.jsx("span",{className:"flex-1 text-white font-bold",children:t.item.name}),t.item.disabled&&e.jsx(M,{icon:k.UNPLUG}),e.jsx(M,{icon:k.MENU})]})}function Tf(t){const s=Co(ls(Oo,{activationConstraint:{delay:75,tolerance:1}}),ls(_o),ls(Mo,{coordinateGetter:Ao})),n=r=>{const{active:a,over:o}=r;if(o&&a.id!==o.id){const i=t.items,l=i.findIndex(u=>u.id===a.id),d=i.findIndex(u=>u.id===o.id),m=Do(i,l,d);t.setItems(m)}};return e.jsx(Eo,{sensors:s,collisionDetection:Ro,onDragEnd:n,modifiers:[Io,To],children:e.jsx(Po,{items:t.items,strategy:Lo,children:e.jsx("div",{className:"flex flex-col gap-2",children:t.items.map(r=>e.jsx(If,{item:r},r.id))})})})}function Vr({id:t,isShown:s,items:n,onCancel:r,onSave:a,onItemsChange:o}){const{t:i}=q();return s?e.jsx(Fs,{id:t,children:e.jsxs(An,{children:[e.jsx(Ce,{className:"!my-0",children:i("home.bookmarks.groups.reorder.title")}),e.jsx(ye,{className:"mt-4",children:i("home.bookmarks.groups.reorder.description")}),e.jsx("div",{children:e.jsx(Tf,{items:n,setItems:o})}),e.jsxs("div",{className:"flex gap-4 mt-6 justify-end",children:[e.jsx(Z,{theme:"secondary",onClick:r,children:i("home.bookmarks.groups.reorder.cancel")}),e.jsx(Z,{theme:"purple",onClick:a,children:i("home.bookmarks.groups.reorder.save")})]})]})}):null}const Rf=()=>Math.random()<.35;function Wr(){const{t}=q(),s=c.useMemo(()=>Rf(),[]),n=c.useMemo(()=>Math.random(),[]);return{t:c.useCallback(a=>{const o=t(`${a}.default`)??"";if(!s)return o;const i=t(`${a}.extra`,{returnObjects:!0,defaultValue:o});return Array.isArray(i)?i.length===0?o:i[Math.floor(n*i.length)]:typeof i=="string"?i:o},[t,n,s])}}function Qn(t){const s=t.match(/^\[([a-zA-Z0-9_]+)\](.*)$/);if(s){const n=s[1].toUpperCase(),r=ke[n]||ke.BOOKMARK,a=s[2].trim();return{icon:r,name:a}}return{icon:ke.BOOKMARK,name:t}}function Pf({onShowDetails:t}){const{t:s}=q(),{t:n}=Wr(),r=n("home.search.empty"),a=be(),o=je(j=>j.items),i=me(j=>j.bookmarks),l=Je(j=>j.groupOrder),d=Je(j=>j.setGroupOrder),m=me(j=>j.removeBookmark),[u,p]=c.useState(!1),[g]=Os(),h=Ke("bookmark-edit-order-all"),[x,y]=c.useState([]),f=He(),b=he(j=>j.account),[v,w]=c.useState(),{showModal:R}=at(),P=async j=>{t?t(j):(w({id:Number(j.id),type:j.type==="movie"?"movie":"show"}),R("details"))},O=c.useMemo(()=>{let j=[];return Object.entries(i).forEach(B=>{j.push({id:B[0],...B[1]})}),j=j.sort((B,W)=>{const H=i[B.id],$=i[W.id],K=o[B.id],V=o[W.id],T=Math.max(H.updatedAt,(K==null?void 0:K.updatedAt)??0);return Math.max($.updatedAt,(V==null?void 0:V.updatedAt)??0)-T}),j},[i,o]),{groupedItems:U,regularItems:D}=c.useMemo(()=>{const j={},B=[];return O.forEach(W=>{const H=i[W.id];Array.isArray(H==null?void 0:H.group)?H.group.forEach($=>{j[$]||(j[$]=[]),j[$].push(W)}):B.push(W)}),Object.keys(j).forEach(W=>{j[W].sort((H,$)=>{const K=i[H.id],V=i[$.id],T=o[H.id],X=o[$.id],ae=Math.max(K.updatedAt,(T==null?void 0:T.updatedAt)??0);return Math.max(V.updatedAt,(X==null?void 0:X.updatedAt)??0)-ae})}),{groupedItems:j,regularItems:B}},[O,i,o]),S=c.useMemo(()=>{const j=new Set;return Object.values(i).forEach(B=>{Array.isArray(B.group)&&B.group.forEach(W=>j.add(W))}),j.add("bookmarks"),Array.from(j)},[i]),N=c.useMemo(()=>{const j=h.isShown?x:l;if(j.length===0)return S.map(H=>{const{name:$}=Qn(H);return{id:H,name:H==="bookmarks"?s("home.bookmarks.sectionTitle"):$}});const B=new Map(j.map((H,$)=>[H,$]));return S.sort((H,$)=>{const K=B.has(H)?B.get(H):Number.MAX_SAFE_INTEGER,V=B.has($)?B.get($):Number.MAX_SAFE_INTEGER;return K-V}).map(H=>{const{name:$}=Qn(H);return{id:H,name:H==="bookmarks"?s("home.bookmarks.sectionTitle"):$}})},[S,s,h.isShown,x,l]),C=c.useMemo(()=>{const j=[],B=new Map;if(Object.entries(U).forEach(([W,H])=>{B.set(W,H)}),D.length>0&&B.set("bookmarks",D),l.length===0)B.forEach((W,H)=>{H==="bookmarks"?j.push({type:"regular",items:W}):j.push({type:"grouped",group:H,items:W})});else{const W=new Map(l.map((H,$)=>[H,$]));Array.from(B.entries()).sort(([H],[$])=>{const K=W.has(H)?W.get(H):Number.MAX_SAFE_INTEGER,V=W.has($)?W.get($):Number.MAX_SAFE_INTEGER;return K-V}).forEach(([H,$])=>{H==="bookmarks"?j.push({type:"regular",items:$}):j.push({type:"grouped",group:H,items:$})})}return j},[U,D,l]),_=()=>{if(l.length===0){const j=S.map(B=>B);y(j)}else y([...l]);h.show()},I=()=>{_(),p(!0)},A=()=>{h.hide()},L=()=>{d(x),h.hide(),f&&b&&Je.getState().saveGroupOrderToBackend(f,b)};return O.length===0?e.jsx(st,{children:e.jsx(lt,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center translate-y-1/2",children:[e.jsx("p",{className:"text-[18.5px] pb-3",children:r}),e.jsx(Z,{theme:"purple",onClick:()=>a("/"),className:"mt-4",children:s("notFound.goHome")})]})})}):e.jsx(st,{children:e.jsxs(lt,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-8",children:[e.jsx(wt,{className:"text-2xl font-bold text-white",children:s("home.bookmarks.sectionTitle")}),e.jsx("div",{className:"flex items-center gap-2",children:u&&S.length>1&&e.jsx($t,{editing:u,onEdit:I,id:"edit-group-order-button-all",text:s("home.bookmarks.groups.reorder.button"),secondaryText:s("home.bookmarks.groups.reorder.done")})})]}),e.jsx("div",{className:"flex items-center gap-4 pb-8",children:e.jsxs("button",{type:"button",onClick:()=>a("/"),className:"flex items-center text-white hover:text-gray-300 transition-colors",children:[e.jsx(M,{icon:k.ARROW_LEFT,className:"text-xl"}),e.jsx("span",{className:"ml-2",children:s("discover.page.back")})]})}),e.jsx("div",{className:`relative ${h.isShown?"pointer-events-none":""}`,children:C.map(j=>{if(j.type==="grouped"){const{icon:B,name:W}=Qn(j.group||"");return e.jsxs("div",{className:"mb-6",children:[e.jsx(gt,{title:W,customIcon:e.jsx("span",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx(xt,{icon:B,className:"w-full h-full"})}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[u&&S.length>1&&e.jsx($t,{editing:u,onEdit:I,id:"edit-group-order-button",text:s("home.bookmarks.groups.reorder.button"),secondaryText:s("home.bookmarks.groups.reorder.done")}),e.jsx(Tt,{editing:u,onEdit:p,id:`edit-button-bookmark-${j.group}`})]})}),e.jsx(Rt,{children:j.items.map(H=>e.jsx("div",{style:{userSelect:"none"},onContextMenu:$=>$.preventDefault(),children:e.jsx(bt,{media:H,closable:u,onClose:()=>m(H.id),onShowDetails:P})},H.id))})]},j.group||"bookmarks")}return e.jsxs("div",{className:"mb-6",children:[e.jsx(gt,{title:s("home.bookmarks.sectionTitle"),icon:k.BOOKMARK,children:e.jsxs("div",{className:"flex items-center gap-2",children:[u&&S.length>1&&e.jsx($t,{editing:u,onEdit:I,id:"edit-group-order-button",text:s("home.bookmarks.groups.reorder.button"),secondaryText:s("home.bookmarks.groups.reorder.done")}),e.jsx(Tt,{editing:u,onEdit:p,id:"edit-button-bookmark"})]})}),e.jsx(Rt,{ref:g,children:j.items.map(B=>e.jsx("div",{style:{userSelect:"none"},onContextMenu:W=>W.preventDefault(),children:e.jsx(bt,{media:B,closable:u,onClose:()=>m(B.id),onShowDetails:P})},B.id))})]},"regular-bookmarks")})}),e.jsx(Vr,{id:h.id,isShown:h.isShown,items:N,onCancel:A,onSave:L,onItemsChange:j=>{const B=j.map(W=>W.id);y(B)}}),v&&e.jsx(_t,{id:"details",data:v})]})})}const Lf=od.sanitize,Pa={"√É∆í√Ç¬§":"√§","√É∆í√Ç‚Äû":"√Ñ","√É¬§":"√§","√É‚Äû":"√Ñ","√É∆í√Ç¬∂":"√∂","√É¬∂":"√∂","√É∆í√Ç¬•":"√•","√É¬•":"√•","√É∆í√Ç¬©":"√©","√É¬©":"√©",√É∆í√Ç¬∫:"√∫",√É¬∫:"√∫","√É∆í√Ç¬±":"√±","√É¬±":"√±","√É∆í√Ç¬°":"√°","√É¬°":"√°","√É∆í√Ç¬≠":"√≠","√É¬≠":"√≠","√É∆í√Ç¬≥":"√≥","√É¬≥":"√≥","√É∆í√Ç¬º":"√º","√É¬º":"√º","√É∆í√Ç¬ß":"√ß","√É¬ß":"√ß","√É∆í√Ç¬®":"√®","√É¬®":"√®","√É∆í√Ç¬¨":"√¨","√É¬¨":"√¨","√É∆í√Ç¬≤":"√≤","√É¬≤":"√≤","√É∆í√Ç¬π":"√π","√É¬π":"√π",√É∆í√Ç:"√†",√É:"√†","√É‚Äö":"",√Ç:"","√Ç ":""};function ys(t){let s=t;return Object.keys(Pa).forEach(n=>{s=s.split(n).join(Pa[n])}),s}function Wi(t,s,n,r){const a=t/1e3+n,o=s/1e3+n;return Math.max(0,a)<=r&&Math.max(0,o)>=r}function Df(t,s,n){return`${t}-${s}-${n}`}function Ki(t){const s=t.trim();if(s==="")throw new Error("Given text is empty");const n=ys(s),r=jn(n,"vtt");if(Ho(r)==="")throw new Error("Invalid subtitle format");return r}function zi(t){const s=t.trim();if(s==="")throw new Error("Given text is empty");const n=ys(s),r=jn(n,"srt");if(Ho(r)==="")throw new Error("Invalid subtitle format");return r}function Af(t){return t.reduce((s,n)=>{const r=s[s.length-1],a=(r==null?void 0:r.start)===n.start&&(r==null?void 0:r.end)===n.end&&(r==null?void 0:r.content)===n.content;return(r===void 0||!a)&&s.push(n),s},[])}function Gi(t){return id(t).filter(s=>s.type==="caption")}function qi(t,s){const n=Ki(t);return Gi(n)}function Mf(t){return btoa(String.fromCodePoint(...new TextEncoder().encode(t)))}function _f(t){return`data:application/x-subrip;base64,${Mf(zi(t))}`}function Of(t){return URL.createObjectURL(new Blob([Ki(t)],{type:"text/vtt"}))}function xr(t){return t.map(s=>({id:s.id,language:s.language,url:s.url,type:s.type,needsProxy:s.hasCorsRestrictions,opensubtitles:s.opensubtitles,display:s.display,media:s.media,isHearingImpaired:s.isHearingImpaired,source:s.source,encoding:s.encoding}))}const Yi=ld().map(t=>`.${t}`),As=new Ir;As.setCompare((t,s)=>t===s);const Qi=24*60*60;async function Bf(t){const s=As.get(t.url);if(s)return s;let n;if(t.needsProxy)if(Xe()){const m=await Yo({url:t.url,method:"GET"});if(!(m!=null&&m.success)||typeof m.response.body!="string")throw new Error("failed to get caption data from extension");n=m.response.body}else n=await Ht(t.url,{responseType:"text",headers:{"Accept-Charset":"utf-8"}});else{const m=await fetch(t.url),u=m.headers.get("content-type")||"",p=u.includes("charset=")?u.split("charset=")[1].toLowerCase():"utf-8",g=await m.arrayBuffer();n=new TextDecoder(p).decode(g)}if(!n)throw new Error("failed to get caption data");const r=new TextEncoder,a=new TextDecoder("utf-8"),o=r.encode(n),i=a.decode(o),l=ys(i),d=zi(l);return As.set(t.url,d,Qi),d}async function Ff(t){const s=As.get(t);if(s)return s;const n=await fetch(t),r=n.headers.get("content-type")||"",a=r.includes("charset=")?r.split("charset=")[1].toLowerCase():"utf-8",o=await n.arrayBuffer(),i=new TextDecoder(a),l=i.decode(o),m=new TextEncoder().encode(l),u=i.decode(m),p=ys(u);return As.set(t,p,Qi),p}function Bn(){const t=Te(b=>b.setLanguage),s=Te(b=>b.enabled),n=Te(b=>b.resetSubtitleSpecificSettings),r=E(b=>b.setCaption),a=Te(b=>b.lastSelectedLanguage),o=Te(b=>b.setIsOpenSubtitles),i=E(b=>b.captionList),l=E(b=>{var v;return(v=b.display)==null?void 0:v.getCaptionList}),d=E(b=>{var v;return(v=b.display)==null?void 0:v.getSubtitleTracks}),m=E(b=>{var v;return(v=b.display)==null?void 0:v.setSubtitlePreference}),u=c.useMemo(()=>i.length!==0?i:(l==null?void 0:l())??[],[i,l]),p=c.useCallback(async b=>{var R,P;const v=u.find(O=>O.id===b);if(!v)return;const w={id:v.id,language:v.language,url:v.url,srtData:""};if(v.hls){await(m==null?void 0:m(v.language));const O=d==null?void 0:d().find(C=>C.id.toString()===v.id&&C.details!==void 0);if(!O)return;const U=((P=(R=O.details)==null?void 0:R.fragments)==null?void 0:P.filter(C=>C!==null&&C.url!==null))??[],D=(await Promise.all(U.map(async C=>{const _=await Ff(C.url);return Gi(_)}))).flat(),S=Af(D),N=cd.build(S,{format:"srt"});w.srtData=N}else{const O=await Bf(v);w.srtData=O}o(!!v.opensubtitles),r(w),n(),t(v.language)},[o,t,u,r,n,d,m]),g=c.useCallback(async b=>{const v=u.find(w=>w.language===b);if(v)return p(v.id)},[u,p]),h=c.useCallback(async()=>{o(!1),r(null),t(null)},[r,t,o]),x=c.useCallback(async()=>(await g(a??"en"),!0),[a,g]),y=c.useCallback(async()=>{s?h():await x()},[x,h,s]),f=c.useCallback(async()=>{s&&await x()},[x,s]);return{selectLanguage:g,disable:h,selectLastUsedLanguage:x,toggleLastUsed:y,selectLastUsedLanguageIfEnabled:f,selectCaptionById:p}}function $f(){const t=E(r=>r.display),s=Or(r=>r.volume);return{init:c.useCallback(()=>{t==null||t.setVolume(s)},[t,s])}}function Uf(){const t=E(a=>a.source),s=c.useMemo(()=>t?JSON.stringify(t):null,[t]),{selectLastUsedLanguageIfEnabled:n}=Bn(),r=c.useRef(n);c.useEffect(()=>{r.current=n},[n]),c.useEffect(()=>{s&&r.current()},[s])}function Hf(t,s){var a;const n=t[(s==null?void 0:s.tmdbId)??""];if(!n||!s)return 0;if(s.type==="movie")return n.progress?n.progress.watched:0;const r=n.episodes[((a=s.episode)==null?void 0:a.tmdbId)??""];return r?r.progress.watched:0}function Xi(){const t=E(h=>h.setStatus),s=E(h=>h.setMeta),n=E(h=>h.setSource),r=E(h=>h.setCaption),a=E(h=>h.setSourceId),o=E(h=>h.status),i=E(h=>h.setEmbedId),l=E(h=>h.interface.shouldStartFromBeginning),d=E(h=>h.setShouldStartFromBeginning),m=E(h=>h.reset),u=E(h=>h.meta),{init:p}=$f(),g=je();return{meta:u,reset:m,status:o,shouldStartFromBeginning:l,setShouldStartFromBeginning:d,setStatus:t,setMeta(h,x){s(h,x)},playMedia(h,x,y,f){const b=f??Hf(g.items,u);r(null),i(null),n(h,x,b),a(y),t(we.PLAYING),p()},setScrapeStatus(){t(we.SCRAPING)},setScrapeNotFound(){t(we.SCRAPE_NOT_FOUND)}}}function Vf(t){return e.jsx("p",{className:z("text-errors-type-secondary",t.marginClass??"mt-6"),children:t.children})}function Wf(){const{t}=q(),s=E(i=>i.interface.error),n=Ke("error"),r=Re("settings"),a=c.useRef(!1);c.useEffect(()=>{s&&!a.current&&(a.current=!0,r.open(),r.navigate("/source"))},[s,r]);const o=()=>{r.open(),r.navigate("/source")};return e.jsxs(Ln,{children:[e.jsxs(Pn,{children:[e.jsx(Tn,{icon:k.WAND,children:t("player.playbackError.badge")}),e.jsx(ms,{children:t("player.playbackError.title")}),e.jsx(Vf,{children:t("player.playbackError.text")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Z,{onClick:()=>n.show(),theme:"danger",padding:"md:px-12 p-2.5",className:"mt-6",children:t("errors.showError")}),e.jsx(Z,{onClick:o,theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:t("player.menus.sources.title")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Z,{href:"/",theme:"secondary",padding:"md:px-12 p-2.5",className:"mt-6",children:t("player.playbackError.homeButton")}),e.jsx(Z,{theme:"secondary",padding:"md:px-12 p-2.5",className:"mt-6",onClick:i=>{i.preventDefault(),window.location.reload()},children:t("errors.reloadPage")})]})]}),e.jsx(Vm,{onClose:()=>n.hide(),error:s,id:n.id})]})}const qe=c.forwardRef((t,s)=>e.jsxs("button",{ref:s,type:"button",onClick:n=>{var r;return(r=t.onClick)==null?void 0:r.call(t,n.currentTarget)},className:z(["tabbable p-2 rounded-full hover:bg-video-buttonBackground hover:bg-opacity-50 transition-transform duration-100 flex items-center gap-3",t.activeClass??"active:scale-110 active:bg-opacity-75 active:text-white",t.className??""]),children:[t.icon&&e.jsx(M,{className:t.iconSizeClass||"text-2xl",icon:t.icon}),t.children]}));function La(t){const s=E(a=>a.display),{isPaused:n}=E(a=>a.mediaPlaying),r=()=>{n?s==null||s.play():s==null||s.pause()};return e.jsx(qe,{className:t.className,iconSizeClass:t.iconSizeClass,onClick:r,icon:n?k.PLAY:k.PAUSE})}function Da(){const{isFullscreen:t}=E(n=>n.interface),s=E(n=>n.display);return e.jsx(qe,{onClick:()=>s==null?void 0:s.toggleFullscreen(),icon:t?k.COMPRESS:k.EXPAND})}const Ji=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let Xn=null;async function Zi(){if(Xn===null){const t=new Promise(n=>{setTimeout(()=>n(!1),1e3)}),s=new Promise(n=>{const r=document.createElement("video"),a=()=>{r.removeEventListener("volumechange",a),n(!0)};r.addEventListener("volumechange",a),r.volume=.5});Xn=await Promise.race([s,t])}return Xn}function Fn(){return tt.fullscreenEnabled}function el(){return Fn()||Ji}function tl(){return Fn()||el()}function sl(){return"pictureInPictureEnabled"in document}function nl(){return"webkitSupportsPresentationMode"in document.createElement("video")}function rn(t){return ut.isSupported()?!1:!!t.canPlayType("application/vnd.apple.mpegurl")}function Kf(){const t=wo();return(t==null?void 0:t.type)!=="browser"?"unknown":t.name==="ios"||t.name==="ios-webview"?"ios":t.name==="chrome"||t.name==="chromium-webview"||t.name==="edge-chromium"||t.name==="opera"?"chrome":t.name==="firefox"?"firefox":"unknown"}function Aa(){const t=E(s=>s.display);return!sl()&&!nl()?null:e.jsx(qe,{onClick:()=>t==null?void 0:t.togglePictureInPicture(),icon:k.PICTURE_IN_PICTURE})}function zf(t){return`${t.toFixed(2)}%`}function Ma(t){return Number(Math.max(0,Math.min(t,100)).toFixed(2))}function Gf(t){return t.type==="mousedown"||t.type==="mouseup"||t.type==="mousemove"}const Jn=t=>Gf(t)?t.pageX:t.changedTouches[0].pageX;function $n(t,s,n=!1){const[r,a]=c.useState(!1),[o,i]=c.useState(0);c.useEffect(()=>{function d(u){if(!r||!t.current)return;const p=t.current.getBoundingClientRect(),g=(Jn(u)-p.left)/t.current.offsetWidth;i(g*100),n&&s(g)}function m(u){if(!r||(a(!1),document.body.removeAttribute("data-no-select"),!t.current))return;const p=t.current.getBoundingClientRect(),g=(Jn(u)-p.left)/t.current.offsetWidth;s(g)}return document.addEventListener("mousemove",d),document.addEventListener("touchmove",d),document.addEventListener("mouseup",m),document.addEventListener("touchend",m),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("touchmove",d),document.removeEventListener("mouseup",m),document.removeEventListener("touchend",m)}},[r,t,s,n]);const l=c.useCallback(d=>{if(a(!0),document.body.setAttribute("data-no-select","true"),!t.current)return;const m=t.current.getBoundingClientRect(),u=(Jn(d)-m.left)/t.current.offsetWidth*100;i(u)},[i,t]);return{dragging:r,dragPercentage:o,dragMouseDown:l}}function Ts(t,s=!1){if(Number.isNaN(t))return s?"0:00:00":"0:00";let n=t;const r=Math.floor(n%60);n/=60;const a=Math.floor(n%60);n/=60;const o=Math.floor(n),i=r.toString().padStart(2,"0"),l=a.toString().padStart(2,"0");return s?[o,l,i].join(":"):[l,i].join(":")}function gr(t){return t>60*60}function qf(t){const s=E(i=>i.thumbnails.images),n=c.useMemo(()=>{var i;return(i=Om(s,t.at))==null?void 0:i.image},[s,t.at]),[r,a]=c.useState({offscreenLeft:0,offscreenRight:0}),o=c.useRef(null);return c.useEffect(()=>{if(!o.current)return;const i=o.current.getBoundingClientRect(),l=32,d=Math.max(0,(i.left-l)*-1),m=Math.max(0,i.right+l-window.innerWidth);a({offscreenLeft:d,offscreenRight:m})},[t.at]),!t.show||!n?null:e.jsx("div",{className:"flex flex-col items-center -translate-x-1/2 pointer-events-none",children:e.jsx("div",{className:"w-screen flex justify-center",children:e.jsx("div",{ref:o,children:e.jsxs("div",{style:{transform:`translateX(${r.offscreenLeft>0?r.offscreenLeft:-r.offscreenRight}px)`},children:[e.jsx("img",{src:n.data,className:"h-24 border rounded-xl border-gray-800"}),e.jsx("p",{className:"text-center mt-1",children:Ts(Math.max(t.at,0),gr(t.at))})]})})})})}function Yf(t){const[s,n]=c.useState(-1),r=c.useCallback(o=>{if(!t.current)return;const l=t.current.getBoundingClientRect(),d=(o.pageX-l.left)/t.current.offsetWidth;n(d*100)},[n,t]),a=c.useCallback(()=>{n(-1)},[n]);return{mousePos:s,mouseMove:r,mouseLeave:a}}const Qf=function(){const{duration:s,time:n,buffered:r}=E(f=>f.progress),a=E(f=>f.display),o=E(f=>f.setDraggingTime),i=E(f=>f.setSeeking),{isSeeking:l}=E(f=>f.interface),d=c.useCallback(f=>{a==null||a.setTime(f*s)},[s,a]),m=c.useRef(null),{mouseMove:u,mouseLeave:p,mousePos:g}=Yf(m),{dragging:h,dragPercentage:x,dragMouseDown:y}=$n(m,d);return c.useEffect(()=>{i(h)},[i,h]),c.useEffect(()=>{o(x/100*s)},[o,s,x]),e.jsxs("div",{className:"w-full relative",dir:"ltr",children:[e.jsx("div",{className:"top-0 absolute inset-x-0",children:e.jsx("div",{className:"absolute bottom-0",style:{left:`${g}%`},children:e.jsx(qf,{at:Math.floor(g/100*s),show:g>-1})})}),e.jsx("div",{className:"w-full",ref:m,children:e.jsx("div",{className:"group w-full h-8 flex items-center cursor-pointer",onMouseDown:y,onTouchStart:y,onMouseLeave:p,onMouseMove:u,children:e.jsxs("div",{className:["relative w-full h-1 bg-progress-background bg-opacity-25 rounded-full transition-[height] duration-100 group-hover:h-1.5",h?"!h-1.5":""].join(" "),children:[e.jsx("div",{className:"absolute top-0 left-0 h-full rounded-full bg-progress-preloaded bg-opacity-50 flex justify-end items-center",style:{width:`${r/s*100}%`}}),e.jsx("div",{className:"absolute top-0 dir-neutral:left-0 h-full rounded-full bg-progress-filled flex justify-end items-center",style:{width:`${Math.max(0,Math.min(1,h?x/100:n/s))*100}%`},children:e.jsx("div",{className:["w-[1rem] min-w-[1rem] h-[1rem] rounded-full transform translate-x-1/2 scale-0 group-hover:scale-100 bg-white transition-[transform] duration-100",l?"scale-100":""].join(" ")})})]})})})]})},Xf=Qf;function _a(t){const s=E(o=>o.display),n=E(o=>o.progress.time),r=J(o=>o.enableDoubleClickToSeek),a=c.useCallback(()=>{s==null||s.setTime(n+10)},[s,n]);return!t.inControl||r?null:e.jsx(qe,{iconSizeClass:t.iconSizeClass,onClick:a,icon:k.SKIP_FORWARD})}function Oa(t){const s=E(o=>o.display),n=E(o=>o.progress.time),r=J(o=>o.enableDoubleClickToSeek),a=c.useCallback(()=>{s==null||s.setTime(n-10)},[s,n]);return!t.inControl||r?null:e.jsx(qe,{iconSizeClass:t.iconSizeClass,onClick:a,icon:k.SKIP_BACKWARD})}function Ba(t){const s=E(w=>w.interface.timeFormat),n=E(w=>w.setTimeFormat),r=E(w=>w.mediaPlaying.playbackRate),{duration:a,time:o,draggingTime:i}=E(w=>w.progress),{isSeeking:l}=E(w=>w.interface),{t:d}=q(),m=gr(a);function u(){n(s===ss.REGULAR?ss.REMAINING:ss.REGULAR)}const p=Math.min(Math.max(l?i:o,0),a),g=Math.abs(p-a),h=r>0?g/r:g,x=Ts(g,gr(g)),y=Ts(p,m),f=new Date(Date.now()+h*1e3),b=Ts(a,m);let v=s===ss.REGULAR?"regular":"remaining";return t.short&&(v=s===ss.REGULAR?"shortRegular":"shortRemaining"),e.jsx(qe,{onClick:()=>u(),children:e.jsx("span",{children:d(`player.time.${v}`,{timeFinished:f,timeWatched:y,timeLeft:x,duration:b,formatParams:{timeFinished:{hour:"numeric",minute:"numeric"}}})})})}function Jf(){return E(s=>s.mediaPlaying.isLoading)?e.jsx(Vt,{className:"text-4xl"}):null}function Zf(){const t=E(i=>i.display),s=E(i=>i.mediaPlaying.isPlaying),n=E(i=>i.mediaPlaying.isLoading),r=E(i=>i.mediaPlaying.hasPlayedOnce),a=E(i=>i.status),o=c.useCallback(()=>{t==null||t.play()},[t]);return r||s||n||a!==we.PLAYING?null:e.jsx("div",{onClick:o,className:"group pointer-events-auto flex h-16 w-16 cursor-pointer items-center justify-center bg-video-autoPlay-background hover:bg-video-autoPlay-hover rounded-full text-white transition-[background-color,transform] hover:scale-125 active:scale-100",children:e.jsx(M,{icon:k.PLAY,className:"text-2xl transition-transform group-hover:scale-125"})})}function rl(){const t=E(i=>i.mediaPlaying.volume),s=E(i=>i.interface.lastVolume),n=E(i=>i.setLastVolume),r=E(i=>i.display),a=Or(i=>i.setVolume),o=()=>{let i=0;t>0?(i=0,n(t)):s>0?i=s:i=1,r==null||r.setVolume(i),a(i)};return{toggleMute(){o()},setVolume(i){a(i),n(i),r==null||r.setVolume(i)}}}const ep=function(s){const n=c.useRef(null),r=E(w=>w.setHoveringLeftControls),a=E(w=>w.interface.leftControlHovering),o=E(w=>w.mediaPlaying.volume),{setVolume:i,toggleMute:l}=rl(),d=c.useCallback(w=>{i(w)},[i]),{dragging:m,dragPercentage:u,dragMouseDown:p}=$n(n,d,!0),g=c.useCallback(()=>{l()},[l]),h=c.useCallback(async()=>{await Zi()&&r(!0),document.body.classList.add("overflow-y-hidden")},[r]),x=()=>{document.body.classList.remove("overflow-y-hidden")};let y=Ma(o*100);m&&(y=Ma(u));const f=zf(y),b=c.useCallback(w=>{w.preventDefault();let R=o-w.deltaY/1e3;R=Math.max(0,Math.min(R,1)),i(R)},[o,i]),v=w=>w===0?k.VOLUME_X:w>0&&w<=.33?k.VOLUME_LOW:w>.33&&w<=.66?k.VOLUME_MED:k.VOLUME;return e.jsx("div",{className:s.className,onMouseEnter:h,onMouseLeave:x,onWheel:b,children:e.jsxs("div",{className:"pointer-events-auto flex cursor-pointer items-center py-0 touch-none",children:[e.jsx("div",{className:"px-4 text-2xl text-white",onClick:g,children:e.jsx(M,{icon:v(y/100)})}),e.jsx("div",{className:`linear -ml-2 w-0 overflow-hidden transition-[width,opacity] duration-300 ${a||m?"!w-24 opacity-100":"w-4 opacity-0"}`,children:e.jsx("div",{ref:n,className:"flex h-10 w-20 items-center px-2",onMouseDown:p,onTouchStart:p,children:e.jsx("div",{className:"relative h-1 flex-1 rounded-full bg-gray-500 bg-opacity-50",children:e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center justify-end rounded-full bg-video-audio-set",style:{width:f},children:e.jsx("div",{className:"absolute h-3 w-3 translate-x-1/2 rounded-full bg-white"})})})})})]})})},tp=ep;function sp(){const t=E(o=>{var i;return(i=o.meta)==null?void 0:i.title}),{time:s}=E(o=>o.progress),[n,r]=c.useState(!1);c.useEffect(()=>{const o=l=>{l.key==="Shift"&&r(!0)},i=l=>{l.key==="Shift"&&r(!1)};return document.addEventListener("keydown",o),document.addEventListener("keyup",i),()=>{document.removeEventListener("keydown",o),document.removeEventListener("keyup",i)}},[]);const a=()=>{const o=window.location.href,i=Ts(s,s>=3600);n?navigator.clipboard.writeText(`${o}?t=${i}`).then(()=>{}):navigator.clipboard.writeText(o).then(()=>{})};return e.jsx("p",{onClick:a,className:"cursor-copy transform transition-transform duration-200 hover:scale-105",title:n?"Copy with current time":"Copy link",children:t})}function np(){var n,r,a;const{t}=q(),s=E(o=>o.meta);return(s==null?void 0:s.type)!=="show"?null:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"text-white font-medium",children:t("media.episodeDisplay",{season:(n=s==null?void 0:s.season)==null?void 0:n.number,episode:(r=s==null?void 0:s.episode)==null?void 0:r.number})}),e.jsx("span",{className:"text-type-secondary font-medium",children:(a=s==null?void 0:s.episode)==null?void 0:a.title})]})}function Kr(t){return e.jsxs("div",{className:z("relative",t.className),children:[e.jsx("div",{id:`__overlayRouter::${t.id}`,className:"absolute inset-0 -z-10"}),t.children]})}function Fe(t){const s=gs(t.id),n=s.showBackwardsTransition(t.path),r=s.isCurrentPage(t.path),a=hs(m=>m.registerRoute),o=c.useMemo(()=>s.makePath(t.path),[t.path,s]),{isMobile:i}=jt();c.useEffect(()=>{a({id:o,width:t.fullWidth?window.innerWidth-60:t.width,height:t.height})},[t.height,t.width,t.fullWidth,o,a]);const l=i?"100%":t.fullWidth?"calc(100vw - 60px)":`${t.width}px`;let d="none";return(n==="yes"||n==="no")&&(d=n==="yes"?"slide-full-left":"slide-full-right"),e.jsx(Se,{animation:d,className:"absolute inset-0",durationClass:"duration-[400ms]",show:r,children:e.jsx("div",{className:z(["grid grid-rows-1 max-h-full",t.className,t.fullWidth?"max-w-none":""]),style:{height:t.height?`${t.height}px`:void 0,width:t.width?l:void 0},children:t.children})})}function rp(){const t=hs(m=>m.anchorPoint),s=c.useRef(null),[n,r]=c.useState(0),[a,o]=c.useState(0),[i,l]=c.useState(null),d=c.useCallback((m,u)=>{if(!m)return;const p=m.x+m.w/2,g=window.innerHeight-(m.y+m.h);o(window.innerHeight-g-m.h-u.height-30),r(Math.min(p-u.width/2,window.innerWidth-u.width-30))},[]);return c.useEffect(()=>{!t||!i||d(t,i)},[t,d,i]),c.useEffect(()=>{if(!s.current)return;function m(){var g;const p=(g=s.current)==null?void 0:g.getBoundingClientRect();l(p??null)}m();const u=new ResizeObserver(m);return u.observe(s.current),()=>{u.disconnect()}},[]),[s,n,a]}function ap(t){const[s,n,r]=rp();return e.jsx("div",{ref:s,style:{transform:`translateX(${n}px) translateY(${r}px)`},className:z(["[&>*]:pointer-events-auto z-10 flex dir-neutral:items-start rtl:justify-start ltr:justify-end dir-neutral:origin-top-left touch-none",t.className]),children:t.children})}function op(t){const[s,n]=c.useState(!1),r=gs("hello world :)"),{t:a}=q(),o=()=>{n(!s)},i=window.location.href.endsWith("settings%2Fcaptions%2Fsettings");return e.jsxs(e.Fragment,{children:[i?e.jsx("button",{className:"fixed top-1 right-4 w-12 h-12 text-video-context-type-main bg-video-context-background z-10 hover:bg-video-context-closeHover active:scale-95 rounded-2xl pointer-events-auto transition-all duration-100 flex justify-center items-center py-3 mt-3 font-bold border border-video-context-border hover:text-white",type:"button",onClick:o,children:s?e.jsx(M,{icon:k.EYE,className:"w-4"}):e.jsx(M,{icon:k.EYE_SLASH,className:"w-4"})}):null,e.jsxs("div",{className:z(["pointer-events-auto px-4 pb-6 z-10 ml-[env(safe-area-inset-left)] mr-[env(safe-area-inset-right)] bottom-0 origin-top-left inset-x-0 absolute overflow-hidden max-h-[calc(100vh-1.5rem)] grid grid-rows-[minmax(0,1fr),auto]",t.className,"transition-all duration-300",s?"opacity-50":"opacity-100"]),children:[t.children,e.jsx("button",{className:"w-full text-video-context-type-main bg-video-context-background z-10 relative hover:bg-video-context-closeHover active:scale-95 rounded-2xl pointer-events-auto transition-all duration-100 flex justify-center items-center py-3 mt-3 font-bold border border-video-context-border hover:text-white",type:"button",onClick:()=>r.close(),children:a("overlays.close")}),e.jsx("div",{className:"pointer-events-none absolute z-0 bottom-0 left-0 w-full h-32 bg-gradient-to-t from-black to-transparent"})]})]})}function ip(t){const s=c.useRef(null),{isMobile:n}=jt(),r=hs(m=>m.routes),a=gs(t.id),o=c.useMemo(()=>r[a.currentRoute??""],[r,a]),[i,l]=ko(()=>({from:{height:`${(o==null?void 0:o.height)??0}px`,width:n?"100%":`${(o==null?void 0:o.width)??0}px`},config:{easing:Ul.linear}}),[]),d=c.useRef(null);return c.useEffect(()=>{const m={height:o==null?void 0:o.height,width:o==null?void 0:o.width,isMobile:n},u=JSON.stringify(m);if(u!==d.current){const p=d.current?JSON.parse(d.current):null;d.current=u,m.isMobile?(l.set({width:"100%"}),l.start({height:`${(o==null?void 0:o.height)??0}px`})):(p==null?void 0:p.height)===void 0&&m.height!==void 0?l.set({height:`${(o==null?void 0:o.height)??0}px`,width:`${(o==null?void 0:o.width)??0}px`}):l.start({height:`${(o==null?void 0:o.height)??0}px`,width:`${(o==null?void 0:o.width)??0}px`})}},[o==null?void 0:o.height,o==null?void 0:o.width,n,l]),e.jsx(Fo.div,{ref:s,style:i,className:"overflow-hidden relative z-10 max-h-full",children:e.jsxs(fe.Base,{className:"group w-full bg-video-context-border bg-opacity-50 backdrop-blur-md h-full rounded-2xl transition-colors duration-100 text-video-context-type-main",children:[e.jsx(fe.Light,{flareSize:400,cssColorVar:"--colors-video-context-light",backgroundClass:"bg-video-context-background duration-100",className:"rounded-2xl opacity-80",gradientOpacity:.3,gradientSpread:60}),e.jsx(fe.Child,{className:"pointer-events-auto relative transition-transform duration-100 h-full",children:t.children})]})})}function al(t){const{isMobile:s}=jt(),n=e.jsx(ip,{id:t.id,children:t.children});return s?e.jsx(op,{children:n}):e.jsx(ap,{children:n})}function Fa(t){try{return new URL(t).hostname}catch{return null}}function lp(t){return t.type==="hls"?[Fa(t.playlist)].filter(s=>!!s):t.type==="file"?Object.values(t.qualities).map(s=>Fa(s.url)).filter(s=>!!s):[]}function cp(t){const s={};return Object.entries(t.headers??{}).forEach(n=>{s[n[0]]=n[1]}),Object.entries(t.preferredHeaders??{}).forEach(n=>{s[n[0]]=n[1]}),s}async function Ms(t){await lr({ruleId:or.PREPARE_STREAM,targetDomains:lp(t),requestHeaders:cp(t)})}const dp={"4k":"4k",1080:"1080",480:"480",360:"360",720:"720",unknown:"unknown"},up=Object.keys(dp),mp=["mp4"];function hp(t){return up.includes(t)}function br(t){if(t.stream.type==="hls")return{type:"hls",url:t.stream.playlist,headers:t.stream.headers,preferredHeaders:t.stream.preferredHeaders};if(t.stream.type==="file"){const s={};return Object.entries(t.stream.qualities).forEach(n=>{if(!hp(n[0])){console.warn(`unrecognized quality: ${n[0]}`);return}if(!mp.includes(n[1].type)){console.warn(`unrecognized file type: ${n[1].type}`);return}s[n[0]]={type:n[1].type,url:n[1].url}}),{type:"file",qualities:s,headers:t.stream.headers,preferredHeaders:t.stream.preferredHeaders}}throw new Error("unrecognized type")}function fp(t,s,n,r){const a=E(x=>x.setSource),o=E(x=>x.setCaption),i=E(x=>x.setSourceId),l=E(x=>x.setEmbedId),d=E(x=>x.progress.time),m=E(x=>x.meta),u=Re(t),{report:p}=Rr(),[g,h]=rt(async()=>{const x=Ar();let y;if(m){try{if(x&&!Xe()){const f=dn(x);y=await(await un(f.scrapeEmbed(r,n),["completed","noOutput"])).promise()}else y=await Ls().runEmbedScraper({id:r,url:n})}catch(f){console.error(`Failed to scrape ${r}`,f);const v=f instanceof is?"notfound":"failed";throw p([ns(m,s,r,v,f)]),f}p([ns(m,s,null,"success",null)]),Xe()&&await Ms(y.stream[0]),i(s),l(r),o(null),a(br({stream:y.stream[0]}),xr(y.stream[0].captions),d),u.close()}},[r,s,m,u,p,o]);return{run:h,loading:g.loading,errored:!!g.error}}function pp(t,s){const n=E(g=>g.meta),r=E(g=>g.setSource),a=E(g=>g.setCaption),o=E(g=>g.setSourceId),i=E(g=>g.setEmbedId),l=E(g=>g.progress.time),d=Re(s),{report:m}=Rr(),[u,p]=rt(async()=>{if(!t||!n)return null;i(null);const g=Si(n),h=Ar();let x;try{if(h&&!Xe()){const y=dn(h);x=await(await un(y.scrapeSource(t,g),["completed","noOutput"])).promise()}else x=await Ls().runSourceScraper({id:t,media:g})}catch(y){console.error(`Failed to scrape ${t}`,y);const b=y instanceof is?"notfound":"failed";throw m([ns(n,t,null,b,y)]),y}if(m([ns(n,t,null,"success",null)]),x.stream)return Xe()&&await Ms(x.stream[0]),i(null),a(null),r(br({stream:x.stream[0]}),xr(x.stream[0].captions),l),o(t),d.close(),null;if(x.embeds.length===1){let y;if(!n)return;try{if(h&&!Xe()){const f=dn(h);y=await(await un(f.scrapeEmbed(x.embeds[0].embedId,x.embeds[0].url),["completed","noOutput"])).promise()}else y=await Ls().runEmbedScraper({id:x.embeds[0].embedId,url:x.embeds[0].url})}catch(f){console.error(`Failed to scrape ${x.embeds[0].embedId}`,f);const v=f instanceof is?"notfound":"failed";throw m([ns(n,t,x.embeds[0].embedId,v,f)]),f}m([ns(n,t,x.embeds[0].embedId,"success",null)]),o(t),i(x.embeds[0].embedId),a(null),Xe()&&await Ms(y.stream[0]),r(br({stream:y.stream[0]}),xr(y.stream[0].captions),l),d.close()}return x.embeds},[t,n,d,a]);return{run:p,watching:(u.value??null)===null,loading:u.loading,items:u.value,notfound:u.error instanceof is,errored:!!u.error}}function xp(t){return e.jsx("div",{className:"h-full grid grid-rows-[1fr]",children:e.jsx("div",{className:"px-6 h-full flex flex-col justify-start overflow-y-auto overflow-x-hidden pb-4 scrollbar-none",children:t.children})})}function gp(t){return e.jsx("div",{className:"[&>*]:px-6 h-full grid grid-rows-[auto,1fr] [&>*:nth-child(2)]:overflow-y-auto [&>*:nth-child(2)]:overflow-x-hidden",children:t.children})}const bp=Object.freeze(Object.defineProperty({__proto__:null,Card:xp,CardWithScrollable:gp},Symbol.toStringTag,{value:"Module"}));function yr(t){return e.jsx("div",{children:e.jsxs("h3",{className:"font-bold text-video-context-type-main pb-3 pt-5 border-b border-video-context-border flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center space-x-3",children:t.children}),e.jsx("div",{children:t.rightSide})]})})}function yp(t){return e.jsx("button",{type:"button",onClick:t.onClick,children:e.jsx(M,{className:"text-xl",icon:t.icon})})}function vp(){return e.jsx("hr",{className:"!my-4 border-0 w-full h-px bg-video-context-border"})}function wp(t){return e.jsx("p",{className:"text-sm mt-8 font-medium",children:t.children})}function jp(t){return e.jsx("a",{type:"button",className:"text-video-context-type-accent cursor-pointer",onClick:t.onClick,children:t.children})}function kp(t){return e.jsx("p",{className:"font-medium",children:t.children})}function Np(t){return e.jsx("p",{className:t.marginClass??"my-3",children:t.children})}function Sp(t){return e.jsx("span",{className:"text-white",children:t.children})}function Cp(t){return e.jsx("div",{className:"w-full h-full flex justify-center items-center text-center",children:e.jsxs("div",{className:"flex items-center gap-4 flex-col",children:[t.noIcon?null:e.jsx("div",{className:"w-16 h-10 border border-video-context-border rounded-lg flex justify-center items-center",children:e.jsx(M,{className:"text-xl",icon:k.EYE_SLASH})}),t.title?e.jsx("h2",{className:"text-white text-lg font-bold",children:t.title}):null,e.jsx("div",{children:t.children})]})})}const Ep=Object.freeze(Object.defineProperty({__proto__:null,Anchor:jp,Divider:vp,FieldTitle:kp,Highlight:Sp,IconButton:yp,Paragraph:Np,SmallText:wp,TextDisplay:Cp,Title:yr},Symbol.toStringTag,{value:"Module"}));function ol(t){return e.jsxs("span",{className:"text-white flex items-center font-medium",children:[t.children,e.jsx(M,{className:"text-xl ml-1 -mr-1.5",icon:k.CHEVRON_RIGHT})]})}function zr(t){return e.jsx("span",{className:z(["font-medium text-left",t.box?"flex flex-col items-center justify-center h-full gap-1 text-center":"",t.textClass||"text-video-context-type-main"]),children:t.children})}function Ip(t){const{side:s="left"}=t;return s==="right"?e.jsx(yr,{rightSide:e.jsx("button",{type:"button",className:"p-2 rounded tabbable hover:bg-video-context-light hover:bg-opacity-10",onClick:t.onClick,children:e.jsx(M,{className:"text-xl",icon:k.ARROW_RIGHT})}),children:e.jsx("button",{type:"button",onClick:t.onClick,children:e.jsx("span",{className:"line-clamp-1 break-all",children:t.children})})}):e.jsxs(yr,{rightSide:t.rightSide,children:[e.jsx("button",{type:"button",className:"-ml-2 p-2 rounded tabbable hover:bg-video-context-light hover:bg-opacity-10",onClick:t.onClick,children:e.jsx(M,{className:"text-xl",icon:k.ARROW_LEFT})}),e.jsx("span",{className:"line-clamp-1 break-all",children:t.children})]})}function Gr(t){const s=z("flex py-2 transition-colors duration-100 rounded-lg",t.box?"bg-video-context-light/10 h-20":"",{"cursor-default":!t.clickable,"hover:bg-video-context-light hover:bg-opacity-20 cursor-pointer tabbable":t.clickable,"bg-video-context-light bg-opacity-20":t.active,"-ml-3 px-3 w-full":!t.box,"opacity-50 pointer-events-none":t.disabled}),n={width:"calc(100% + 1.5rem)"},r=e.jsxs("div",{className:z("flex items-center flex-1 h-full",t.className),children:[e.jsx("div",{className:"flex-1 text-left flex h-full",children:t.children}),e.jsx("div",{className:"flex",children:t.rightSide})]});return t.onClick?e.jsx("button",{type:"button",className:s,style:t.box?{}:n,onClick:t.onClick,"data-active-link":t.active?!0:void 0,disabled:t.disabled,children:r}):e.jsx("div",{className:s,style:n,"data-active-link":t.active?!0:void 0,children:r})}function Tp(t){const s=e.jsx(ol,{children:t.rightText});return e.jsx(Gr,{onClick:t.onClick,active:t.active,clickable:!0,rightSide:t.box?null:s,className:t.box?"flex flex-col items-center justify-center":"",box:t.box,disabled:t.disabled,children:e.jsx(zr,{box:t.box,children:t.children})})}function vs(t){let s;return t.selected&&(s=e.jsx(M,{icon:k.CIRCLE_CHECK,className:"text-xl text-video-context-type-accent"})),t.error&&(s=e.jsx("span",{className:"flex items-center text-video-context-error",children:e.jsx(M,{className:"ml-2",icon:k.WARNING})})),t.loading&&(s=e.jsx(Vt,{className:"text-lg"})),e.jsx(Gr,{onClick:t.onClick,clickable:!t.disabled,rightSide:s,box:t.box,children:e.jsx(zr,{textClass:z({"text-white":t.selected,"text-video-context-type-main text-opacity-40":t.disabled}),children:t.children})})}const Rp=Object.freeze(Object.defineProperty({__proto__:null,BackLink:Ip,Chevron:ol,ChevronLink:Tp,Link:Gr,LinkTitle:zr,SelectableLink:vs},Symbol.toStringTag,{value:"Module"}));function Pp(t){return e.jsx("h3",{className:z("uppercase font-bold text-type-secondary text-xs pl-1 pb-2.5 border-b border-type-secondary/40",t.children?"pt-8":"pt-4",t.className),children:t.children})}function Lp(t){return e.jsx("div",{className:z(t.grid?"grid grid-cols-2 gap-3 pt-6":"pt-4 space-y-1",t.className),children:t.children})}function Dp(t){const s=c.useRef(null);return c.useEffect(()=>{var i,l,d;const n=(i=s.current)==null?void 0:i.querySelector("[data-active-link]"),r=(l=s.current)==null?void 0:l.getBoundingClientRect(),a=n==null?void 0:n.getBoundingClientRect();if(!a||!r)return;const o=a.top-r.top;(d=s.current)==null||d.scrollTo(0,o-r.height/2+a.height/2)},[t.loaded]),e.jsx("div",{ref:s,className:z("pt-4 space-y-1",t.className),children:t.children})}const Ap=Object.freeze(Object.defineProperty({__proto__:null,ScrollToActiveSection:Dp,Section:Lp,SectionTitle:Pp},Symbol.toStringTag,{value:"Module"})),Y={...bp,...Rp,...Ap,...Ep};function Mp(t){const{t:s}=q(),n=E(d=>d.embedId),r=s("player.menus.sources.unknownOption"),a=c.useMemo(()=>{if(!t.embedId)return r;const d=Ut().find(m=>m.id===t.embedId);return(d==null?void 0:d.name)??r},[t.embedId,r]),{run:o,errored:i,loading:l}=fp(t.routerId,t.sourceId,t.url,t.embedId);return e.jsx(vs,{loading:l,error:i,onClick:o,selected:t.embedId===n,children:e.jsx("span",{className:"flex flex-col",children:e.jsx("span",{children:a})})})}function _p({sourceId:t,id:s}){const{t:n}=q(),r=Re(s),{run:a,watching:o,notfound:i,loading:l,items:d,errored:m}=pp(t,s),u=c.useMemo(()=>{if(!t)return"...";const h=Ut().find(x=>x.id===t);return(h==null?void 0:h.name)??"..."},[t]),p=c.useRef(null);c.useEffect(()=>{p.current!==t&&(p.current=t,t&&a())},[a,t]);let g=null;return l?g=e.jsx(Y.TextDisplay,{noIcon:!0,children:e.jsx(At,{})}):i?g=e.jsx(Y.TextDisplay,{title:n("player.menus.sources.noStream.title")??void 0,children:n("player.menus.sources.noStream.text")}):(d==null?void 0:d.length)===0?g=e.jsx(Y.TextDisplay,{title:n("player.menus.sources.noEmbeds.title")??void 0,children:n("player.menus.sources.noEmbeds.text")}):m?g=e.jsx(Y.TextDisplay,{title:n("player.menus.sources.failed.title")??void 0,children:n("player.menus.sources.failed.text")}):o?g=null:d&&t&&(g=d.map(h=>e.jsx(Mp,{embedId:h.embedId,url:h.url,routerId:s,sourceId:t},`${h.embedId}-${h.url}`))),e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>r.navigate("/source"),children:u}),e.jsx(Y.Section,{children:g})]})}function Op({id:t,onChoose:s}){const{t:n}=q(),r=Re(t),a=E(u=>{var p;return(p=u.meta)==null?void 0:p.type}),o=E(u=>u.sourceId),i=J(u=>u.sourceOrder),l=J(u=>u.enableSourceOrder),d=J(u=>u.disabledSources),m=c.useMemo(()=>{if(!a)return[];const u=Ut().filter(h=>h.type==="source").filter(h=>{var x;return(x=h.mediaTypes)==null?void 0:x.includes(a)}).filter(h=>!d.includes(h.id));if(!l||i.length===0)return u;const p=[],g=[...u];for(const h of i){const x=g.findIndex(y=>y.id===h);x!==-1&&(p.push(g[x]),g.splice(x,1))}return p.push(...g),p},[a,i,l,d]);return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>r.navigate("/"),rightSide:e.jsx("button",{type:"button",onClick:()=>window.open("/settings#source-order"),className:"-mr-2 -my-1 px-2 p-[0.4em] rounded tabbable hover:bg-video-context-light hover:bg-opacity-10",children:n("player.menus.sources.editOrder")}),children:n("player.menus.sources.title")}),e.jsx(Y.Section,{className:"pb-4",children:m.map(u=>e.jsx(vs,{onClick:()=>{s==null||s(u.id),r.navigate("/source/embeds")},selected:u.id===o,children:u.name},u.id))})]})}function Bp(t){return e.jsx(vs,{selected:t.selected,onClick:t.onClick,children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{"data-code":t.langCode,className:"mr-3 inline-flex",children:e.jsx(So,{langCode:t.langCode})}),e.jsx("span",{children:t.children})]})})}function Fp({id:t}){const{t:s}=q(),n=s("player.menus.subtitles.unknownLanguage"),r=Re(t),a=E(d=>d.audioTracks),o=E(d=>d.currentAudioTrack),i=E(d=>{var m;return(m=d.display)==null?void 0:m.changeAudioTrack}),l=c.useCallback(d=>{i==null||i(d),r.close()},[r,i]);return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>r.navigate("/"),children:"Audio"}),e.jsx(Y.Section,{className:"flex flex-col pb-4",children:a.map(d=>e.jsx(Bp,{selected:d.id===(o==null?void 0:o.id),langCode:d.language.length===3?Hl[d.language]??d.language:d.language,onClick:a.includes(d)?()=>l(d):void 0,children:on(d.language)??d.label??n},d.id))})]})}const $p=function(s){return e.jsx("button",{type:"button",className:z("tabbable p-1.5 bg-video-context-buttonFocus rounded transition-colors duration-100",s.active?"bg-opacity-100":"bg-opacity-0 cursor-pointer"),onClick:s.onClick,children:e.jsx("div",{className:"w-6 h-6 rounded-full flex justify-center items-center",style:{backgroundColor:s.color},children:s.active?e.jsx(M,{className:"text-sm text-black",icon:k.CHECKMARK}):null})})},Up=$p,Hp=function(s){const{t:n}=q(),r=c.useRef(null),a=c.useRef(null),o=(s.value-s.min)/(s.max-s.min),i=c.useCallback(f=>{var w;const b=s.max-s.min,v=Math.min(Math.max(f,0),1);(w=s.onChange)==null||w.call(s,s.min+b*v)},[s]),{dragging:l,dragPercentage:d,dragMouseDown:m}=$n(a,i,!0),[u,p]=c.useState(!1),[g,h]=c.useState("");c.useEffect(()=>{function f(b){var v;b.key==="Enter"&&u&&((v=r.current)==null||v.blur())}return window.addEventListener("keydown",f),()=>{window.removeEventListener("keydown",f)}},[u]);const x="tabbable py-1 bg-video-context-inputBg rounded text-white cursor-text text-center px-4 w-24 h-12",y=s.textTransformer??(f=>f);return e.jsxs("div",{children:[e.jsx(Y.FieldTitle,{children:s.label}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{ref:a,children:e.jsx("div",{className:"group/progress w-full h-8 flex items-center cursor-pointer",onMouseDown:m,onTouchStart:m,children:e.jsx("div",{dir:"ltr",className:["relative w-full h-1 bg-video-context-slider bg-opacity-25 rounded-full transition-[height] duration-100 group-hover/progress:h-1.5",l?"!h-1.5":""].join(" "),children:e.jsx("div",{className:"absolute top-0 left-0 h-full rounded-full bg-video-context-sliderFilled flex justify-end items-center",style:{width:`${Math.max(0,Math.min(1,l?d/100:o))*100}%`},children:e.jsx("div",{className:["w-[1rem] min-w-[1rem] h-[1rem] border-[4px] border-video-context-sliderFilled rounded-full transform translate-x-1/2 bg-white transition-[transform] duration-100"].join(" ")})})})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{var f;return(f=s.onChange)==null?void 0:f.call(s,s.value-1/10**(s.decimalsAllowed??0))},className:"flex-1 flex-col tabbable py-2 h-12 hover:text-white transition-colors duration-100 flex justify-center items-center hover:bg-video-context-buttonOverInputHover rounded bg-video-context-inputBg",children:[e.jsx(M,{icon:k.CHEVRON_LEFT}),e.jsx("span",{className:"text-xs",children:n("player.menus.subtitles.delayLate")})]}),u?e.jsx("input",{className:x,value:g,autoFocus:!0,onFocus:f=>{f.target.select()},onBlur:f=>{var v;p(!1);const b=Number(f.target.value);Number.isNaN(b)||(v=s.onChange)==null||v.call(s,(s.decimalsAllowed??0)===0?Math.round(b):b)},ref:r,onChange:f=>h(f.target.value)}):e.jsx("button",{className:x,type:"button",tabIndex:0,onClick:()=>{h(s.value.toFixed(s.decimalsAllowed??0)),p(!0)},children:y(s.value.toFixed(s.decimalsAllowed??0))}),e.jsxs("button",{type:"button",onClick:()=>{var f;return(f=s.onChange)==null?void 0:f.call(s,s.value+1/10**(s.decimalsAllowed??0))},className:"flex-1 flex-col tabbable py-2 h-12 hover:text-white transition-colors duration-100 flex justify-center items-center hover:bg-video-context-buttonOverInputHover rounded bg-video-context-inputBg",children:[e.jsx(M,{icon:k.CHEVRON_RIGHT}),e.jsx("span",{className:"text-xs",children:n("player.menus.subtitles.delayEarly")})]})]})]})]})},Vp=Hp,Wp=function(s){const n=c.useRef(null),r=c.useRef(null),a=(s.value-s.min)/(s.max-s.min),o=c.useCallback(f=>{var w;const b=s.max-s.min,v=Math.min(Math.max(f,0),1);(w=s.onChange)==null||w.call(s,s.min+b*v)},[s]),{dragging:i,dragPercentage:l,dragMouseDown:d}=$n(r,o,!0),[m,u]=c.useState(!1),[p,g]=c.useState("");c.useEffect(()=>{function f(b){var v;b.key==="Enter"&&m&&((v=n.current)==null||v.blur())}return window.addEventListener("keydown",f),()=>{window.removeEventListener("keydown",f)}},[m]);const h=`tabbable py-1 bg-video-context-inputBg rounded text-white cursor-text ${s.controlButtons?"text-center px-4 w-24":"px-3 text-left w-20"}`,x="tabbable hover:text-white transition-colors duration-100 w-full h-full flex justify-center items-center hover:bg-video-context-buttonOverInputHover rounded",y=s.textTransformer??(f=>f);return e.jsxs("div",{children:[e.jsx(Y.FieldTitle,{children:s.label}),e.jsxs("div",{className:"grid items-center grid-cols-[1fr,auto] gap-4",children:[e.jsx("div",{ref:r,children:e.jsx("div",{className:"group/progress w-full h-8 flex items-center cursor-pointer",onMouseDown:d,onTouchStart:d,children:e.jsx("div",{dir:"ltr",className:["relative w-full h-1 bg-video-context-slider bg-opacity-25 rounded-full transition-[height] duration-100 group-hover/progress:h-1.5",i?"!h-1.5":""].join(" "),children:e.jsx("div",{className:"absolute top-0 left-0 h-full rounded-full bg-video-context-sliderFilled flex justify-end items-center",style:{width:`${Math.max(0,Math.min(1,i?l/100:a))*100}%`},children:e.jsx("div",{className:["w-[1rem] min-w-[1rem] h-[1rem] border-[4px] border-video-context-sliderFilled rounded-full transform translate-x-1/2 bg-white transition-[transform] duration-100"].join(" ")})})})})}),e.jsx("div",{children:m?e.jsx("input",{className:h,value:p,autoFocus:!0,onFocus:f=>{f.target.select()},onBlur:f=>{var v;u(!1);const b=Number(f.target.value);Number.isNaN(b)||(v=s.onChange)==null||v.call(s,(s.decimalsAllowed??0)===0?Math.round(b):b)},ref:n,onChange:f=>g(f.target.value)}):e.jsxs("div",{className:"relative",onClick:f=>{f.target.closest(".actions")||(g(s.value.toFixed(s.decimalsAllowed??0)),u(!0))},children:[e.jsx("button",{className:z(h,s.controlButtons?"relative":void 0),type:"button",tabIndex:0,children:y(s.value.toFixed(s.decimalsAllowed??0))}),s.controlButtons?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"actions w-6 h-full absolute left-0 top-0 grid grid-cols-1 items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>{var f;return(f=s.onChange)==null?void 0:f.call(s,s.value-1/10**(s.decimalsAllowed??0))},className:x,children:e.jsx(M,{icon:k.CHEVRON_LEFT})})}),e.jsx("div",{className:"actions w-6 h-full absolute right-0 top-0 grid grid-cols-1 items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>{var f;return(f=s.onChange)==null?void 0:f.call(s,s.value+1/10**(s.decimalsAllowed??0))},className:x,children:e.jsx(M,{icon:k.CHEVRON_RIGHT})})})]}):null]})})]})]})},Zn=Wp,Kp=["#ffffff","#80b1fa","#e2e535","#10B239FF"];function $a({id:t,overlayBackLink:s}){const{t:n}=q(),r=Re(t),a=Te(),o=J(),i=a.styling,l=a.overrideCasing,d=a.delay,m=a.setOverrideCasing,u=a.setDelay,p=a.updateStyling,g=E(f=>f.setCaptionAsTrack),h=o.enableNativeSubtitles;c.useEffect(()=>{a.updateStyling(i)},[i,a]),c.useEffect(()=>{g(h)},[h,g]);const x=f=>{p(f)},y=()=>{a.updateStyling({color:"#ffffff",backgroundOpacity:.5,size:1,backgroundBlur:.5,bold:!1,fontStyle:"default"})};return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>r.navigate(s?"/captionsOverlay":"/captions"),children:n("player.menus.subtitles.settings.backlink")}),e.jsx(Y.Section,{className:"space-y-6 pb-5",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y.FieldTitle,{children:n("player.menus.subtitles.settings.useNativeSubtitles","Use native video subtitles")}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(ct,{enabled:h,onClick:()=>o.setEnableNativeSubtitles(!h)})})]}),e.jsx("span",{className:"text-xs text-type-secondary",children:n("player.menus.subtitles.useNativeSubtitlesDescription")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y.FieldTitle,{children:n("player.menus.subtitles.useNativeSubtitles")}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(ct,{enabled:h,onClick:()=>o.setEnableNativeSubtitles(!h)})})]}),e.jsx("span",{className:"text-xs text-type-secondary",children:n("player.menus.subtitles.useNativeSubtitlesDescription")}),e.jsx(Vp,{label:n("player.menus.subtitles.settings.delay"),max:20,min:-20,onChange:f=>u(f),value:d,textTransformer:f=>`${f}s`,decimalsAllowed:1}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y.FieldTitle,{children:n("player.menus.subtitles.settings.fixCapitals")}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(ct,{enabled:l,onClick:()=>m(!l)})})]}),e.jsx(Y.Divider,{}),e.jsx(Zn,{label:n("settings.subtitles.backgroundLabel"),max:100,min:0,onChange:f=>x({...i,backgroundOpacity:f/100}),value:i.backgroundOpacity*100,textTransformer:f=>`${f}%`}),e.jsx(Zn,{label:n("settings.subtitles.backgroundBlurLabel"),max:100,min:0,onChange:f=>x({...i,backgroundBlur:f/100}),value:i.backgroundBlur*100,textTransformer:f=>`${f}%`}),e.jsx(Zn,{label:n("settings.subtitles.textSizeLabel"),max:200,min:1,textTransformer:f=>`${f}%`,onChange:f=>x({...i,size:f/100}),value:i.size*100}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y.FieldTitle,{children:n("settings.subtitles.textStyle.title")||"Font Style"}),e.jsx(Pt,{options:[{id:"default",name:n("settings.subtitles.textStyle.default")},{id:"raised",name:n("settings.subtitles.textStyle.raised")},{id:"depressed",name:n("settings.subtitles.textStyle.depressed")},{id:"uniform",name:n("settings.subtitles.textStyle.uniform")},{id:"dropShadow",name:n("settings.subtitles.textStyle.dropShadow")}],selectedItem:{id:i.fontStyle,name:n(`settings.subtitles.textStyle.${i.fontStyle}`)||i.fontStyle},setSelectedItem:f=>x({...i,fontStyle:f.id})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y.FieldTitle,{children:n("settings.subtitles.textBoldLabel")}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(ct,{enabled:i.bold,onClick:()=>x({...i,bold:!i.bold})})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y.FieldTitle,{children:n("settings.subtitles.colorLabel")}),e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[Kp.map(f=>e.jsx(Up,{color:f,active:i.color===f,onClick:()=>x({...i,color:f})},f)),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("input",{type:"color",value:i.color,onChange:f=>{const b=f.target.value;x({...i,color:b})},className:"absolute opacity-0 cursor-pointer w-10 h-10"}),e.jsx("div",{style:{color:i.color},children:e.jsx(M,{icon:k.BRUSH,className:"text-2xl"})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y.FieldTitle,{children:n("settings.subtitles.verticalPositionLabel")}),e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("button",{type:"button",className:z("px-3 py-1 rounded transition-colors duration-100",i.verticalPosition===3?"bg-video-context-buttonFocus":"bg-video-context-buttonFocus bg-opacity-0 hover:bg-opacity-50"),onClick:()=>x({...i,verticalPosition:3}),children:n("settings.subtitles.default")}),e.jsx("button",{type:"button",className:z("px-3 py-1 rounded transition-colors duration-100",i.verticalPosition===1?"bg-video-context-buttonFocus":"bg-video-context-buttonFocus bg-opacity-0 hover:bg-opacity-50"),onClick:()=>x({...i,verticalPosition:1}),children:n("settings.subtitles.low")})]})]}),e.jsx(Z,{className:"w-full md:w-auto",theme:"secondary",onClick:y,children:n("settings.reset")})]})})]})}function zp(t){const[s,n]=c.useState(!1),r=l=>{l.preventDefault(),n(!0)},a=l=>{l.currentTarget.contains(l.relatedTarget)||n(!1)},o=l=>{l.preventDefault()},i=l=>{l.preventDefault(),n(!1),t.onDrop(l)};return c.useEffect(()=>{t.onDraggingChange(s)},[s,t]),e.jsx("div",{onDragEnter:r,onDragLeave:a,onDragOver:o,onDrop:i,className:t.className,children:t.children})}function Gp(t){return e.jsxs("div",{className:"w-full relative",children:[e.jsx(M,{className:"pointer-events-none absolute top-1/2 left-3 transform -translate-y-1/2 text-video-context-inputPlaceholder",icon:k.SEARCH}),e.jsx("input",{placeholder:"Search",className:"w-full py-2 px-3 pl-[calc(0.75rem+24px)] tabbable bg-video-context-inputBg rounded placeholder:text-video-context-inputPlaceholder",value:t.value,onInput:s=>t.onInput(s.currentTarget.value)})]})}function vr(t){const[s,n]=c.useState(!1),r=c.useRef(null),a=c.useMemo(()=>{if(!t.subtitleUrl&&!t.subtitleSource)return null;const l=[];return t.subtitleSource&&l.push(`Source: ${t.subtitleSource}`),t.subtitleEncoding&&l.push(`Encoding: ${t.subtitleEncoding}`),t.isHearingImpaired&&l.push("Hearing Impaired: Yes"),t.subtitleUrl&&l.push(`URL: ${t.subtitleUrl}`),l.join(`
`)},[t.subtitleUrl,t.subtitleSource,t.subtitleEncoding,t.isHearingImpaired]),o=()=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>n(!0),500)},i=()=>{r.current&&clearTimeout(r.current),n(!1)};return c.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]),e.jsxs("div",{className:"relative",onMouseEnter:o,onMouseLeave:i,children:[e.jsx(vs,{selected:t.selected,loading:t.loading,error:t.error,onClick:t.onClick,children:e.jsxs("span",{"data-active-link":t.selected?!0:void 0,className:"flex items-center",children:[t.flag?e.jsx("span",{"data-code":t.countryCode,className:"mr-3 inline-flex",children:e.jsx(So,{langCode:t.countryCode})}):null,e.jsx("span",{children:t.children}),t.subtitleType&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded bg-video-context-hoverColor bg-opacity-80 text-video-context-type-main text-xs font-semibold",children:t.subtitleType.toUpperCase()}),t.subtitleSource&&e.jsx("span",{className:z("ml-2 px-2 py-0.5 rounded text-white text-xs font-semibold overflow-hidden text-ellipsis whitespace-nowrap",{"bg-blue-500":t.subtitleSource.includes("wyzie"),"bg-orange-500":t.subtitleSource==="opensubs","bg-purple-500":t.subtitleSource==="febbox"}),children:t.subtitleSource.toUpperCase()}),t.isHearingImpaired&&e.jsx(M,{icon:k.EAR,className:"ml-2"})]})}),a&&s&&e.jsx("div",{className:"absolute z-50 left-1/2 -translate-x-1/2 bottom-full mb-2 px-3 py-2 bg-black/80 text-white/80 text-xs rounded-lg backdrop-blur-sm w-60 break-all whitespace-pre-line",children:a})]})}function Ua(t,s){const{t:n}=q(),r=n("player.menus.subtitles.unknownLanguage");return c.useMemo(()=>{const a=t.map(l=>({...l,languageName:on(l.language)??r})),o=Gc(a.map(l=>l.language));let i=a.sort((l,d)=>o.indexOf(l.language)-o.indexOf(d.language));return s.trim().length>0&&(i=new dd(a,{includeScore:!0,threshold:.3,keys:["languageName"]}).search(s).map(d=>d.item)),i},[t,s,r])}function qp(){const{t}=q(),s=E(o=>{var i;return(i=o.caption.selected)==null?void 0:i.language}),n=E(o=>o.setCaption),r=Te(o=>o.setCustomSubs),a=c.useRef(null);return e.jsxs(vr,{selected:s==="custom",onClick:()=>{var o;return(o=a.current)==null?void 0:o.click()},children:[t("player.menus.subtitles.customChoice"),e.jsx("input",{className:"hidden",ref:a,accept:Yi.join(","),type:"file",onChange:o=>{if(!o.target.files)return;const i=new FileReader;i.addEventListener("load",l=>{if(!l.target||typeof l.target.result!="string")return;const d=new TextEncoder,m=new TextDecoder("utf-8"),u=d.encode(l.target.result),p=m.decode(u),g=ys(p),h=jn(g,"srt");n({language:"custom",srtData:h,id:"custom-caption"}),r()}),i.readAsText(o.target.files[0],"utf-8")}})]})}function Ha({id:t,backLink:s}){const{t:n}=q(),r=Re(t),a=E(L=>{var j;return(j=L.caption.selected)==null?void 0:j.id}),{disable:o,selectCaptionById:i}=Bn(),[l,d]=c.useState(!1),m=E(L=>L.setCaption),[u,p]=c.useState(""),[g,h]=c.useState(null),x=E(L=>L.progress.time),y=E(L=>{var j;return(j=L.caption.selected)==null?void 0:j.srtData}),f=E(L=>{var j;return(j=L.caption.selected)==null?void 0:j.language}),b=E(L=>L.captionList),v=E(L=>{var j;return(j=L.display)==null?void 0:j.getCaptionList}),w=E(L=>L.isLoadingExternalSubtitles),R=Te(L=>L.delay),P=c.useMemo(()=>b.length!==0?b:(v==null?void 0:v())??[],[b,v]),O=c.useMemo(()=>P.filter(L=>!L.opensubtitles),[P]),U=c.useMemo(()=>P.filter(L=>L.opensubtitles),[P]),D=Ua(O,u),S=Ua(U,u),N=c.useMemo(()=>{if(!y||!a)return null;const j=qi(y).find(({start:B,end:W})=>Wi(B,W,R,x));return j==null?void 0:j.content},[y,f,R,x,a]),[C,_]=rt(async L=>(h(L),i(L)),[i,h]);function I(L){const j=L.dataTransfer.files,B=j[0];if(!j||!B)return;const W=`.${B.name.split(".").pop()}`;if(!W||!Yi.includes(W))return;const H=new FileReader;H.addEventListener("load",$=>{if(!$.target||typeof $.target.result!="string")return;const K=new TextEncoder,V=new TextDecoder("utf-8"),T=K.encode($.target.result),X=V.decode(T),ae=ys(X),ce=jn(ae,"srt");m({language:"custom",srtData:ce,id:"custom-caption"})}),H.readAsText(B,"utf-8")}const A=L=>e.jsx(vr,{countryCode:L.language,selected:L.id===a,loading:L.id===g&&C.loading,error:L.id===g&&C.error?C.error.toString():void 0,onClick:()=>_(L.id),flag:!0,subtitleUrl:L.url,subtitleType:L.type,subtitleSource:L.source,subtitleEncoding:L.encoding,isHearingImpaired:L.isHearingImpaired,children:L.languageName},L.id);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:z("absolute inset-0 flex items-center justify-center text-white z-10 pointer-events-none transition-opacity duration-300",l?"opacity-100":"opacity-0"),children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(M,{className:"text-5xl mb-4",icon:k.UPLOAD}),e.jsx("span",{className:"text-xl weight font-medium",children:n("player.menus.subtitles.dropSubtitleFile")})]})}),s?e.jsx(Y.BackLink,{onClick:()=>r.navigate("/"),rightSide:e.jsx("button",{type:"button",onClick:()=>r.navigate("/captions/settings"),className:"-mr-2 -my-1 px-2 p-[0.4em] rounded tabbable hover:bg-video-context-light hover:bg-opacity-10",children:n("player.menus.subtitles.customizeLabel")}),children:n("player.menus.subtitles.title")}):e.jsx(Y.Title,{rightSide:e.jsx("button",{type:"button",onClick:()=>r.navigate("/captions/settingsOverlay"),className:"-mr-2 -my-1 px-2 p-[0.4em] rounded tabbable hover:bg-video-context-light hover:bg-opacity-10",children:n("player.menus.subtitles.customizeLabel")}),children:n("player.menus.subtitles.title")})]}),e.jsxs(zp,{className:`transition duration-300 ${l?"opacity-20":""}`,onDraggingChange:L=>{d(L)},onDrop:L=>I(L),children:[a&&e.jsxs("div",{className:"mt-3 p-2 rounded-xl bg-video-context-light bg-opacity-10 text-center sm:hidden",children:[e.jsx("div",{className:"text-sm text-video-context-type-secondary mb-1",children:n("player.menus.subtitles.previewLabel")}),e.jsx("div",{className:"text-base font-medium min-h-[3rem] flex items-center justify-center",style:{minHeight:"3rem"},children:N?e.jsx("div",{dangerouslySetInnerHTML:{__html:N.replaceAll(/\r?\n/g,"<br />")}}):e.jsxs("span",{className:"text-video-context-type-secondary italic",children:["..."," "]})})]}),e.jsxs(Y.ScrollToActiveSection,{className:"!pt-1 mt-2 pb-3",children:[e.jsx(vr,{onClick:()=>o(),selected:!a,children:n("player.menus.subtitles.offChoice")}),e.jsx(qp,{}),(O.length||U.length)>0&&e.jsx("div",{className:"mt-3",children:e.jsx(Gp,{value:u,onInput:p})}),!w&&O.length===0&&U.length===0&&e.jsx("div",{className:"p-4 rounded-xl bg-video-context-light bg-opacity-10 text-center",children:e.jsx("div",{className:"text-video-context-type-secondary",children:n("player.menus.subtitles.empty")})}),w&&U.length===0&&e.jsx("div",{className:"p-4 rounded-xl bg-video-context-light bg-opacity-10 text-center",children:e.jsx("div",{className:"text-video-context-type-secondary",children:n("player.menus.subtitles.loadingExternal")})}),O.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-video-context-type-secondary pt-2 mb-2",children:n("player.menus.subtitles.SourceChoice")}),D.length>0?D.map(A):e.jsx("div",{className:"text-center text-video-context-type-secondary py-2",children:n("player.menus.subtitles.notFound")})]}),U.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-video-context-type-secondary pt-2 mb-2",children:n("player.menus.subtitles.OpenSubtitlesChoice")}),S.length>0?S.map(A):e.jsx("div",{className:"text-center text-video-context-type-secondary py-2",children:n("player.menus.subtitles.notFound")})]}),w&&O.length>0&&e.jsx("div",{className:"text-center text-video-context-type-secondary py-4 mt-2",children:n("player.menus.subtitles.loadingExternal")||"Loading external subtitles..."})]})]})]})}function Va({options:t,onSelectOption:s}){const{t:n}=q(),r=n("player.menus.downloads.openIn");return e.jsx("div",{className:"relative w-full mb-3",children:e.jsx(ot,{onChange:s,children:({open:a})=>e.jsxs(e.Fragment,{children:[e.jsxs(ot.Button,{className:"relative z-[101] w-full rounded-lg bg-dropdown-background hover:bg-dropdown-hoverBackground py-3 pl-3 pr-10 text-left text-white shadow-md focus:outline-none tabbable cursor-pointer",children:[e.jsx("span",{className:"flex gap-4 items-center truncate",children:r}),e.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:e.jsx(M,{icon:k.UP_DOWN_ARROW,className:"transform transition-transform text-xl text-dropdown-secondary rotate-180"})})]}),e.jsx(Se,{animation:"slide-down",show:a,className:"absolute z-[102] bottom-full mb-1 w-full max-h-60 overflow-auto rounded-lg bg-dropdown-background py-1 text-white shadow-lg ring-1 ring-black ring-opacity-5 scrollbar-thin scrollbar-track-background-secondary scrollbar-thumb-type-secondary focus:outline-none",children:e.jsx(ot.Options,{static:!0,className:"py-1",children:t.map(o=>e.jsxs(ot.Option,{className:({active:i})=>`cursor-pointer flex gap-4 items-center relative select-none py-2 px-4 mx-1 rounded-lg ${i?"bg-background-secondaryHover text-type-link":"text-type-secondary"}`,value:o,children:[o.leftIcon?o.leftIcon:null,o.name]},o.id))})})]})})})}function il(){const t=E(r=>r.source),s=E(r=>r.currentQuality);return c.useMemo(()=>{var r;return(t==null?void 0:t.type)==="file"&&s?((r=t.qualities[s])==null?void 0:r.url)??null:(t==null?void 0:t.type)==="hls"?t.url:null},[t,s])}function fs(t){return e.jsx(pe,{i18nKey:t.k,components:{bold:e.jsx(Y.Highlight,{}),br:e.jsx("br",{}),ios_share:e.jsx(M,{icon:k.IOS_SHARE,className:"inline-block text-xl -mb-1"}),ios_files:e.jsx(M,{icon:k.IOS_FILES,className:"inline-block text-xl -mb-1"})}})}function Yp({id:t}){const s=Re(t),{t:n}=q(),r=il(),a=c.useCallback(()=>{if(!r)return"";const g=r.match(/m3u8-proxy\?url=(.*)$/);return g&&g[1]?decodeURIComponent(g[1]):r},[r]),o=`https://hls-downloader.pstream.mov/?url=${encodeURIComponent(a())}`,[,i]=Cr(),l=E(g=>{var h;return(h=g.source)==null?void 0:h.type}),d=E(g=>{var h;return(h=g.caption)==null?void 0:h.selected}),m=c.useCallback(()=>{const g=d?_f(d==null?void 0:d.srtData):null;g&&window.open(g)},[d]),u=c.useMemo(()=>[{id:"vlc",name:n("player.menus.downloads.vlc")},{id:"iina",name:n("player.menus.downloads.iina")},{id:"outplayer",name:n("player.menus.downloads.outplayer")}],[n]),p=c.useCallback(g=>{if(!r)return;let h="";switch(g.id){case"vlc":h=`vlc://${r}`;break;case"iina":h=`iina://weblink?url=${encodeURIComponent(r)}`;break;case"outplayer":h=`outplayer://${r}`;break}h&&window.open(h)},[r]);return r?e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>s.navigate("/"),children:n("player.menus.downloads.title")}),e.jsx(Y.Section,{children:e.jsx("div",{className:"mb-4",children:l==="hls"?e.jsxs("div",{className:"mb-6",children:[e.jsx(Y.Paragraph,{marginClass:"mb-6",children:e.jsx(fs,{k:"player.menus.downloads.hlsDisclaimer"})}),e.jsx(Va,{options:u,onSelectOption:p}),e.jsx("p",{className:"text-xs pb-4 text-type-danger",children:e.jsx(pe,{i18nKey:"player.menus.downloads.hlsOpenInDisclaimer"})}),e.jsx(Z,{className:"w-full mt-2",theme:"purple",href:o,children:n("player.menus.downloads.button")}),e.jsx("p",{className:"text-xs py-4",children:e.jsx(pe,{i18nKey:"player.menus.downloads.hlsDownloader",children:e.jsx("a",{className:"text-type-link",href:"https://hls-downloader.pstream.mov/"})})}),e.jsx(Z,{className:"w-full mt-2",theme:"secondary",href:r,onClick:g=>{g.preventDefault(),i(r)},children:n("player.menus.downloads.copyHlsPlaylist")}),e.jsx(Z,{className:"w-full mt-2",onClick:m,disabled:!d,theme:"secondary",children:n("player.menus.downloads.downloadSubtitle")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y.ChevronLink,{onClick:()=>s.navigate("/download/pc"),children:n("player.menus.downloads.onPc.title")}),e.jsx(Y.ChevronLink,{onClick:()=>s.navigate("/download/ios"),children:n("player.menus.downloads.onIos.title")}),e.jsx(Y.ChevronLink,{onClick:()=>s.navigate("/download/android"),children:n("player.menus.downloads.onAndroid.title")}),e.jsx(Y.Divider,{}),e.jsx(Y.Paragraph,{marginClass:"my-6",children:e.jsx(fs,{k:"player.menus.downloads.disclaimer"})}),e.jsx(Va,{options:u,onSelectOption:p}),e.jsx(Z,{className:"w-full",href:r,theme:"purple",children:n("player.menus.downloads.downloadVideo")}),e.jsx(Z,{className:"w-full mt-2",onClick:m,disabled:!d,theme:"secondary",download:"subtitles.srt",children:n("player.menus.downloads.downloadSubtitle")})]})})})]}):null}function Qp({id:t}){const s=Re(t),{t:n}=q();return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>s.navigate("/download"),children:n("player.menus.downloads.onAndroid.shortTitle")}),e.jsx(Y.Section,{children:e.jsx(Y.Paragraph,{children:e.jsx(fs,{k:"player.menus.downloads.onAndroid.1"})})})]})}function Xp({id:t}){const s=Re(t),{t:n}=q();return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>s.navigate("/download"),children:n("player.menus.downloads.onPc.shortTitle")}),e.jsx(Y.Section,{children:e.jsx(Y.Paragraph,{children:e.jsx(fs,{k:"player.menus.downloads.onPc.1"})})})]})}function Jp({id:t}){const s=Re(t);return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>s.navigate("/download"),children:e.jsx(fs,{k:"player.menus.downloads.onIos.shortTitle"})}),e.jsx(Y.Section,{children:e.jsx(Y.Paragraph,{children:e.jsx(fs,{k:"player.menus.downloads.onIos.1"})})})]})}function Zp({id:t}){return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{id:t,path:"/download",width:343,height:490,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(Yp,{id:t})})}),e.jsx(Fe,{id:t,path:"/download/ios",width:343,height:440,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(Jp,{id:t})})}),e.jsx(Fe,{id:t,path:"/download/android",width:343,height:440,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(Qp,{id:t})})}),e.jsx(Fe,{id:t,path:"/download/pc",width:343,height:440,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(Xp,{id:t})})})]})}const ex=()=>Math.floor(1e3+Math.random()*9e3).toString(),Wa=()=>{const t=E.getState().display;t&&t.setPlaybackRate(1)},kt=Ae()(Ze(t=>({enabled:!1,roomCode:null,isHost:!1,showStatusOverlay:!1,enableAsHost:()=>{Wa(),t(()=>({enabled:!0,roomCode:ex(),isHost:!0}))},enableAsGuest:s=>{Wa(),t(()=>({enabled:!0,roomCode:s,isHost:!1}))},updateRoomCode:s=>t(n=>({...n,roomCode:s})),disable:()=>t(()=>({enabled:!1,roomCode:null})),setShowStatusOverlay:s=>t(()=>({showStatusOverlay:s}))}),{name:"watch-party-storage"}));function ll(){return!!(le().ALLOW_AUTOPLAY||Xe()||he.getState().proxySet)}function tx(t){const[s,n]=c.useState(null),[r,a]=c.useState(""),[o,i]=c.useState(!1);c.useEffect(()=>{t.options.includes(t.selected)?i(!1):i(!0)},[t.selected,t.options]);const l=c.useCallback((h,x)=>{if(s!==x){if(o&&h===t.selected){n(0),a(h.toString());return}t.onClick(h),i(!1)}},[s,t,o]),d=c.useCallback((h,x)=>{t.disabled||(n(x),a(h.toString()))},[t.disabled]),m=c.useCallback(h=>{a(h.target.value)},[]),u=c.useCallback(h=>{if(h.key==="Enter"){const x=parseFloat(r);!Number.isNaN(x)&&x>0&&x<=5&&(t.onClick(x),n(null),i(!0))}else h.key==="Escape"&&n(null)},[r,t]),p=c.useCallback(()=>{n(null)},[]),g=c.useCallback(()=>{i(!1),t.onClick(1)},[t]);return e.jsx("div",{className:"flex items-center bg-video-context-light/10 p-1 rounded-lg",children:o?e.jsx("button",{type:"button",disabled:t.disabled,className:z("w-full px-2 py-1 rounded-md tabbable relative","bg-video-context-light/20 text-white",t.disabled?"opacity-50 cursor-not-allowed":null),onClick:()=>l(t.selected,0),onDoubleClick:()=>d(t.selected,0),children:s===0?e.jsx("input",{type:"text",value:r,onChange:m,onKeyDown:u,onBlur:p,className:"w-full bg-transparent text-center focus:outline-none",autoFocus:!0,"aria-label":"Custom playback speed"}):e.jsxs(e.Fragment,{children:[`${t.selected}x`,e.jsx("button",{type:"button",className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-xs text-video-context-light/70 hover:text-white",onClick:g,title:"Reset to presets",children:e.jsx(M,{icon:k.X,className:"text-sm"})})]})},"custom"):t.options.map((h,x)=>{const y=s===x;return e.jsx("button",{type:"button",disabled:t.disabled,className:z("w-full px-2 py-1 rounded-md tabbable relative",t.selected===h?"bg-video-context-light/20 text-white":null,t.disabled?"opacity-50 cursor-not-allowed":null),onClick:()=>l(h,x),onDoubleClick:()=>d(h,x),children:y?e.jsx("input",{type:"text",value:r,onChange:m,onKeyDown:u,onBlur:p,className:"w-full bg-transparent text-center focus:outline-none",autoFocus:!0,"aria-label":"Custom playback speed"}):`${h}x`},h)})})}function sx({id:t}){const{t:s}=q(),n=Re(t),r=E(y=>y.mediaPlaying.playbackRate),a=E(y=>y.display),o=J(y=>y.enableThumbnails),i=J(y=>y.setEnableThumbnails),l=J(y=>y.enableAutoplay),d=J(y=>y.setEnableAutoplay),m=J(y=>y.enableLowPerformanceMode),u=kt(y=>y.enabled),p=c.useMemo(()=>ll(),[]),g=!u&&p&&!m,h=c.useCallback(y=>{u||a==null||a.setPlaybackRate(y)},[a,u]);c.useEffect(()=>{u&&a&&r!==1&&a.setPlaybackRate(1)},[u,a,r]);const x=[.25,.5,1,1.5,2];return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>n.navigate("/"),children:s("player.menus.playback.title")}),e.jsx(Y.Section,{children:e.jsxs("div",{className:"space-y-4 mt-3",children:[e.jsxs(Y.FieldTitle,{children:[s("player.menus.playback.speedLabel"),u&&e.jsx("span",{className:"text-sm text-type-secondary ml-2",children:s("player.menus.playback.disabled")})]}),e.jsx(tx,{options:x,selected:u?1:r,onClick:h,disabled:u})]})}),e.jsx(Y.Section,{children:e.jsxs("div",{className:"space-y-4 mt-3",children:[g&&e.jsx(Y.Link,{rightSide:e.jsx(ct,{enabled:l,onClick:()=>d(!l)}),children:s("settings.preferences.autoplayLabel")}),e.jsx(Y.Link,{rightSide:e.jsx(ct,{enabled:o,onClick:()=>i(!o)}),children:s("settings.preferences.thumbnailLabel")})]})})]})}const nx={unknown:!1,360:!0,480:!0,720:!0,1080:!0,"4k":!0};function rx(){const t=E(n=>{var r;return(r=n.source)==null?void 0:r.type});return c.useMemo(()=>{const n=document.createElement("video");return!(t!=="hls"||ut.isSupported()||!rn(n))},[t])}function ax({id:t}){const s=Re(t),n=rx(),r=E(h=>h.qualities),a=E(h=>h.currentQuality),o=E(h=>h.switchQuality),i=E(h=>h.enableAutomaticQuality),l=Is(h=>h.setAutomaticQuality),d=Is(h=>h.setLastChosenQuality),m=Is(h=>h.quality.automaticQuality),u=c.useCallback(h=>{d(h),l(!1),o(h),s.close()},[s,o,d,l]),p=c.useCallback(()=>{const h=!m;l(h),h&&i()},[l,m,i]),g=Pm.filter(h=>!!(nx[h]||r.includes(h)));return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>s.navigate("/"),children:re("player.menus.quality.title")}),e.jsxs(Y.Section,{className:"flex flex-col pb-4",children:[g.map(h=>e.jsx(vs,{selected:h===a,onClick:r.includes(h)?()=>u(h):void 0,disabled:!r.includes(h),children:fr(h)},h)),e.jsx(Y.Divider,{}),e.jsx(Y.Link,{rightSide:e.jsx(ct,{onClick:p,enabled:m}),children:re("player.menus.quality.automaticLabel")}),e.jsx(Y.SmallText,{children:e.jsx(pe,{i18nKey:n?"player.menus.quality.iosNoQuality":"player.menus.quality.hint",children:e.jsx(Y.Anchor,{onClick:()=>s.navigate("/source"),children:"text"})})})]})]})}function ox({id:t}){const{t:s}=q(),n=Re(t),r=E(f=>f.currentQuality),a=E(f=>f.currentAudioTrack),o=E(f=>{var b;return(b=f.caption.selected)==null?void 0:b.language}),i=Te(f=>f.enabled),l=E(f=>f.sourceId),d=E(f=>f.embedId),m=c.useMemo(()=>{if(!l)return"...";const f=Ut().find(b=>b.id===l);return(f==null?void 0:f.name)??"..."},[l]),u=c.useMemo(()=>{if(!d)return;const f=Ut().find(b=>b.id===d);return f==null?void 0:f.name},[d]),{toggleLastUsed:p}=Bn(),g=o?on(o)??s("player.menus.subtitles.unknownLanguage"):void 0,h=a?on(a.language)??a.label??s("player.menus.subtitles.unknownLanguage"):void 0,x=E(f=>f.source),y=(x==null?void 0:x.type)==="file"||(x==null?void 0:x.type)==="hls";return e.jsxs(Y.Card,{children:[e.jsxs(Y.Section,{grid:!0,children:[e.jsxs(Y.ChevronLink,{box:!0,onClick:()=>n.navigate("/quality"),rightText:r?fr(r):"",children:[s("player.menus.settings.qualityItem"),e.jsx("span",{className:"text-type-secondary text-sm",children:r?fr(r):s("player.menus.quality.auto")})]}),e.jsxs(Y.ChevronLink,{box:!0,onClick:()=>n.navigate("/source"),rightText:m,children:[s("player.menus.settings.sourceItem"),e.jsx("span",{className:"text-type-secondary text-sm",children:m}),u&&e.jsx("span",{className:"text-type-secondary text-xs",children:u})]}),e.jsxs(Y.ChevronLink,{box:!0,onClick:()=>n.navigate("/captions"),rightText:m,children:[s("player.menus.settings.subtitleItem"),e.jsx("span",{className:"text-type-secondary text-sm",children:g??s("player.menus.subtitles.offChoice")})]}),a?e.jsxs(Y.ChevronLink,{box:!0,onClick:()=>n.navigate("/audio"),rightText:h??void 0,children:[s("player.menus.settings.audioItem"),e.jsx("span",{className:"text-type-secondary text-sm",children:h})]}):e.jsxs(Y.ChevronLink,{box:!0,onClick:()=>n.navigate("/audio"),disabled:!0,children:[s("player.menus.settings.audioItem"),e.jsx("span",{className:"text-type-secondary text-sm",children:s("player.menus.audio.default")})]})]}),e.jsxs(Y.Section,{children:[e.jsx(Y.Link,{clickable:!0,onClick:()=>n.navigate(y?"/download":"/download/unable"),rightSide:e.jsx(M,{className:"text-xl",icon:k.DOWNLOAD}),className:y?"opacity-100":"opacity-50",children:s("player.menus.settings.downloadItem")}),e.jsx(Y.Link,{clickable:!0,onClick:()=>n.navigate(y?"/watchparty":"/download/unable"),rightSide:e.jsx(M,{className:"text-xl",icon:k.WATCH_PARTY}),className:y?"opacity-100":"opacity-50",children:s("player.menus.watchparty.watchpartyItem")})]}),e.jsx(Y.SectionTitle,{}),e.jsxs(Y.Section,{children:[e.jsx(Y.Link,{rightSide:e.jsx(ct,{enabled:i,onClick:()=>p().catch(()=>{})}),children:s("player.menus.settings.enableSubtitles")}),e.jsx(Y.ChevronLink,{onClick:()=>n.navigate("/playback"),children:s("player.menus.settings.playbackItem")})]})]})}function cl(t=5){const[s,n]=c.useState([]),[r,a]=c.useState(!1),[o,i]=c.useState(1),l=c.useRef({lastUserCount:1,previousHostPlaying:null,previousHostTime:null,lastSyncTime:0,syncInProgress:!1,checkedUrlParams:!1,prevRoomUsers:[]}),d=he(D=>D.account),m=He(),u=E(D=>D.display),p=E(D=>D.progress.time),g=E(D=>D.mediaPlaying.isPlaying),{roomCode:h,isHost:x,enabled:y,enableAsGuest:f}=kt();c.useEffect(()=>{if(!l.current.checkedUrlParams)try{const S=new URLSearchParams(window.location.search).get("watchparty");S&&!y&&S.length>0&&f(S),l.current.checkedUrlParams=!0}catch(D){console.error("Failed to check URL parameters for watch party:",D)}},[y,f]);const b=s.find(D=>D.isHost)||null,v=c.useCallback(()=>{if(!b)return 0;const S=(Date.now()-b.lastUpdate)/1e3;return b.player.isPlaying&&!b.player.isPaused?b.player.time+S:b.player.time},[b]),w=b?p-v():0,R=b&&!x&&w<-t,P=b&&!x&&w>t,O=c.useCallback(()=>{if(!b||x||!u||l.current.syncInProgress)return;l.current.syncInProgress=!0,a(!0);const D=v();u.setTime(D),setTimeout(()=>{b.player.isPlaying&&!b.player.isPaused?u.play():u.pause(),setTimeout(()=>{a(!1),l.current.syncInProgress=!1},500),l.current.lastSyncTime=Date.now()},200)},[b,x,u,v]);c.useEffect(()=>{if(!b||x||!u||l.current.syncInProgress)return;const D=l.current,S=b.player.isPlaying&&!b.player.isPaused,N=v(),C=p-N,_=g?2:5,I=Math.abs(C)>_,A=D.previousHostPlaying!==null&&D.previousHostPlaying!==S,L=D.previousHostTime!==null&&Math.abs(b.player.time-D.previousHostTime)>5;(I||A||L)&&!r&&(D.syncInProgress=!0,a(!0),u.setTime(N),setTimeout(()=>{S?u.play():u.pause(),setTimeout(()=>{a(!1),D.syncInProgress=!1},500)},200)),D.previousHostPlaying=S,D.previousHostTime=b.player.time},[b,x,p,u,r,v,g]);const U=c.useCallback(async()=>{if(!(!y||!h||!m))try{const D=await Ps(m,d,h),S=[];Object.entries(D.users).forEach(([C,_])=>{if(_.length>0){const I=[..._].sort((A,L)=>L.timestamp-A.timestamp)[0];S.push({userId:C,isHost:I.isHost,lastUpdate:I.timestamp,player:{isPlaying:I.player.isPlaying,isPaused:I.player.isPaused,time:I.player.time,duration:I.player.duration},content:{title:I.content.title,type:I.content.type,tmdbId:I.content.tmdbId,seasonId:I.content.seasonId,episodeId:I.content.episodeId,seasonNumber:I.content.seasonNumber,episodeNumber:I.content.episodeNumber}})}}),S.sort((C,_)=>C.isHost&&!_.isHost?-1:!C.isHost&&_.isHost?1:_.lastUpdate-C.lastUpdate);const N=S.length;N!==l.current.lastUserCount&&(i(N),l.current.lastUserCount=N),l.current.prevRoomUsers=S,n(S)}catch(D){console.error("Failed to refresh room data:",D)}},[m,d,h,y]);return c.useEffect(()=>{const D=l.current;if(!y||!h){n([]),i(1),D.lastUserCount=1,D.prevRoomUsers=[],D.previousHostPlaying=null,D.previousHostTime=null;return}U();const S=setInterval(U,1e3);return()=>{clearInterval(S),n([]),i(1),D.previousHostPlaying=null,D.previousHostTime=null}},[y,h,U]),{roomUsers:s,hostUser:b,isBehindHost:!!R,isAheadOfHost:!!P,timeDifferenceFromHost:w,syncWithHost:O,isSyncing:r,refreshRoomData:U,userCount:o}}function ix({id:t}){var xe;const s=Re(t),{t:n}=q(),r=il(),[a,o]=c.useState(""),[i,l]=c.useState(!1),[d,m]=c.useState(!1),[u,p]=c.useState(""),[g,h]=c.useState(!1),[x,y]=c.useState(""),[f,b]=c.useState(!1),v=He(),[w,R]=c.useState(!1),[P,O]=c.useState(null),U=he(ee=>ee.account),D=Dt(async()=>{if(v)return yn(v)},[v]),S=(xe=D==null?void 0:D.value)!=null&&xe.version?D.value.version>="2.0.1":!1,{enabled:N,roomCode:C,isHost:_,enableAsHost:I,enableAsGuest:A,updateRoomCode:L,disable:j,showStatusOverlay:B,setShowStatusOverlay:W}=kt(),{roomUsers:H}=cl();c.useEffect(()=>{if(!N||_||H.length>1)return;const ee=setTimeout(()=>{H.length<=1&&I()},1e4);return()=>clearTimeout(ee)},[N,_,H.length,I]),c.useEffect(()=>{v&&N&&yn(v).then(ee=>{p(ee.name)}).catch(()=>{p("Unknown Server")})},[v,N]),c.useEffect(()=>{const ee=()=>{m(!1)};return window.addEventListener("watchparty:validation",ee),()=>{window.removeEventListener("watchparty:validation",ee)}},[]),c.useEffect(()=>{N||m(!1)},[N]);const $=()=>{if(r){const ee=`https://www.watchparty.me/create?video=${encodeURIComponent(r)}`;window.open(ee)}},K=()=>{I(),l(!1)},V=async()=>{if(a.length>0){R(!0),O(null);try{const ee=await Ps(v,U,a);if(!(Object.keys(ee.users).length>0)){O(n("watchParty.emptyRoom")),R(!1);return}m(!0),A(a),l(!1)}catch(ee){console.error("Failed to validate room:",ee),O(n("watchParty.invalidRoom"))}finally{R(!1)}}},T=()=>{j(),l(!1),o("")},X=()=>{if(C){const ee=new URL(window.location.href);ee.searchParams.set("watchparty",C),navigator.clipboard.writeText(ee.toString()),b(!0),setTimeout(()=>b(!1),2e3)}},ae=()=>{_&&C&&(y(C),h(!0))},ce=()=>{if(x.length>0){if(L(x),C){const ee=new URL(window.location.href);ee.searchParams.set("watchparty",x),window.history.replaceState({},"",ee.toString())}h(!1)}},Q=()=>{W(!B)};return e.jsxs(e.Fragment,{children:[e.jsx(Y.BackLink,{onClick:()=>s.navigate("/"),children:n("player.menus.watchparty.watchpartyItem")}),e.jsx(Y.Section,{children:e.jsxs("div",{className:"pb-4",children:[S&&(N?e.jsx("div",{className:"space-y-4",children:d?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Vt,{}),e.jsx("p",{className:"text-sm text-type-secondary",children:n("watchParty.validating")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"text-center",children:e.jsx(pe,{i18nKey:_?"watchParty.isHost":"watchParty.isGuest",values:{backendName:u},className:"text-sm text-type-secondary",children:e.jsx("span",{className:"text-type-logo"})})}),e.jsxs("div",{className:"relative flex items-center justify-center p-3 bg-mediaCard-hoverBackground rounded-lg border border-mediaCard-hoverAccent border-opacity-20 cursor-pointer transition-all duration-300 hover:bg-mediaCard-hoverShadow group",onClick:g?void 0:X,title:g?void 0:n("watchParty.copyCode"),children:[_&&!g&&e.jsx("div",{className:"absolute top-2 right-2 p-1 hover:bg-mediaCard-hoverShadow rounded-full transition-colors",onClick:ee=>{ee.stopPropagation(),ae()},children:e.jsx(M,{icon:k.EDIT,className:"w-3 h-3 text-type-secondary hover:text-type-logo"})}),g?e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx("input",{type:"text",value:x,maxLength:10,className:"bg-transparent border-none text-center font-mono tracking-widest w-full outline-none text-type-logo text-[min(2rem,4vw)]",onChange:ee=>y(ee.target.value.toUpperCase()),onClick:ee=>ee.stopPropagation(),autoFocus:!0}),e.jsx(Z,{theme:"purple",className:"px-2 py-1  text-xs",onClick:ee=>{ee.stopPropagation(),ce()},children:n("watchParty.save")})]}):e.jsx("input",{type:"text",readOnly:!0,value:f?n("watchParty.linkCopied"):C||"",className:"bg-transparent border-none text-center font-mono tracking-widest w-full outline-none cursor-pointer text-type-logo text-[min(2rem,4vw)]",onClick:ee=>{ee.target instanceof HTMLInputElement&&ee.target.select()}})]}),e.jsx("p",{className:"text-xs text-center text-type-secondary",children:n(_?"watchParty.shareCode":"watchParty.connectedAsGuest")})]}),H.length>1&&e.jsxs("div",{className:"bg-mediaCard-hoverBackground rounded-lg p-3 border border-mediaCard-hoverAccent border-opacity-20",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("span",{className:"text-sm font-medium text-white",children:n("watchParty.viewers",{count:H.length})})}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1",children:H.map(ee=>e.jsxs("div",{className:"flex items-center justify-between text-xs py-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{icon:ee.isHost?k.RISING_STAR:k.USER,className:`w-3 h-3 ${ee.isHost?"text-onboarding-best":"text-type-secondary"}`}),e.jsxs("span",{className:ee.isHost?"text-onboarding-best":"text-type-secondary",children:[ee.userId.substring(0,8),"..."]})]}),e.jsx("span",{className:"text-type-secondary",children:ee.player.duration>0?`${Math.floor(ee.player.time/ee.player.duration*100)}%`:`${Math.floor(ee.player.time)}s`})]},ee.userId))})]}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-mediaCard-hoverBackground rounded-lg p-3 border border-mediaCard-hoverAccent border-opacity-20",children:[e.jsx("span",{className:"text-white",children:n("watchParty.showStatusOverlay")}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:B,onChange:Q}),e.jsx("div",{className:"w-9 h-5 bg-mediaCard-hoverBackground rounded-full peer peer-checked:bg-buttons-purple peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-mediaCard-hoverAccent after:border after:rounded-full after:h-4 after:w-4 after:transition-all"})]})]}),e.jsx(Z,{className:"w-full",theme:"danger",onClick:T,children:n("watchParty.leaveWatchParty")})]})]})}):e.jsx("div",{className:"space-y-4",children:i?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",maxLength:10,className:"w-full p-2 text-center text-2xl tracking-widest bg-mediaCard-hoverBackground border border-mediaCard-hoverAccent border-opacity-20 rounded-lg text-type-logo",placeholder:"ABCD123456",value:a,onChange:ee=>{o(ee.target.value.toUpperCase()),O(null)}}),P&&e.jsx("p",{className:"text-xs text-center text-red-500 mt-1",children:P}),w&&e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Vt,{className:"w-5 h-5 mr-2"}),n("watchParty.validating")]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Z,{className:"w-full",theme:"secondary",onClick:()=>{l(!1),O(null)},children:n("watchParty.cancel")}),e.jsx(Z,{className:"w-full",theme:"purple",onClick:V,disabled:a.length===0||w,children:n("watchParty.join")})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Z,{className:"w-full",theme:"purple",onClick:K,children:n("watchParty.hostParty")}),e.jsx(Z,{className:"w-full",theme:"secondary",onClick:()=>l(!0),children:n("watchParty.joinParty")})]})})),S&&e.jsx(Y.Divider,{}),e.jsx(Y.Link,{clickable:!0,onClick:$,rightSide:e.jsx(M,{className:"text-xl",icon:k.WATCH_PARTY}),children:n("player.menus.watchparty.legacyWatchparty")}),e.jsx(Y.Paragraph,{marginClass:"text-xs text-type-secondary mt-2",children:n("player.menus.watchparty.notice")})]})})]})}function lx({id:t}){const[s,n]=c.useState(null),r=Re(t);return c.useEffect(()=>{r.isRouterActive||n(null),r.route==="/"&&n(null)},[r.isRouterActive,r.route]),e.jsx(ji,{id:t,children:e.jsxs(al,{id:t,children:[e.jsx(Fe,{id:t,path:"/",width:343,height:452,children:e.jsx(ox,{id:t})}),e.jsx(Fe,{id:t,path:"/quality",width:343,height:452,children:e.jsx(Y.Card,{children:e.jsx(ax,{id:t})})}),e.jsx(Fe,{id:t,path:"/audio",width:343,height:452,children:e.jsx(Y.Card,{children:e.jsx(Fp,{id:t})})}),e.jsx(Fe,{id:t,path:"/captions",width:343,height:452,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(Ha,{id:t,backLink:!0})})}),e.jsx(Fe,{id:t,path:"/captionsOverlay",width:343,height:452,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(Ha,{id:t})})}),e.jsx(Fe,{id:t,path:"/captions/settings",width:343,height:452,children:e.jsx(Y.Card,{children:e.jsx($a,{id:t})})}),e.jsx(Fe,{id:t,path:"/captions/settingsOverlay",width:343,height:452,children:e.jsx(Y.Card,{children:e.jsx($a,{id:t,overlayBackLink:!0})})}),e.jsx(Fe,{id:t,path:"/source",width:343,height:452,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(Op,{id:t,onChoose:n})})}),e.jsx(Fe,{id:t,path:"/source/embeds",width:343,height:452,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(_p,{id:t,sourceId:s})})}),e.jsx(Fe,{id:t,path:"/playback",width:343,height:330,children:e.jsx(Y.Card,{children:e.jsx(sx,{id:t})})}),e.jsx(Zp,{id:t}),e.jsx(Fe,{id:t,path:"/watchparty",width:343,height:455,children:e.jsx(Y.CardWithScrollable,{children:e.jsx(ix,{id:t})})})]})})}function cx(){return e.jsx(lx,{id:"settings"})}function Ka(){const t=Re("settings"),s=E(n=>n.setHasOpenOverlay);return c.useEffect(()=>{s(t.isRouterActive)},[s,t.isRouterActive]),e.jsx(Kr,{id:t.id,children:e.jsx(qe,{onClick:()=>t.open(),icon:k.GEAR})})}const dx=function(s){const n=s.radius??40;return e.jsxs("svg",{className:`${s.className??""} -rotate-90`,viewBox:"0 0 100 100",children:[e.jsx("circle",{className:`fill-transparent stroke-type-text stroke-[15] opacity-25 ${s.backingRingClassname??""}`,r:n,cx:"50",cy:"50"}),e.jsx("circle",{className:"fill-transparent stroke-current stroke-[15] transition-[stroke-dashoffset] duration-150",r:n,cx:"50",cy:"50",style:{strokeDasharray:`${2*Math.PI*n} ${2*Math.PI*n}`,strokeDashoffset:`${2*Math.PI*n-s.percentage/100*(2*Math.PI*n)}`}})]})},ux=dx;function Ws(){const{meta:t,setMeta:s}=Xi(),n=c.useMemo(()=>t?Si(t):null,[t]),r=c.useCallback(o=>{s(o,we.SCRAPING)},[s]),a=c.useCallback((o,i)=>{let l;if(o.meta.type===ge.SERIES){const d=o.meta.seasonData.episodes.find(m=>m.id===i);if(!d)return null;l={type:"show",releaseYear:+(o.meta.year??0),title:o.meta.title,poster:o.meta.poster,tmdbId:o.tmdbId??"",imdbId:o.imdbId,episodes:o.meta.seasonData.episodes.map(m=>({number:m.number,title:m.title,tmdbId:m.id,air_date:m.air_date})),episode:{number:d.number,title:d.title,tmdbId:d.id,air_date:d.air_date},season:{number:o.meta.seasonData.number,title:o.meta.seasonData.title,tmdbId:o.meta.seasonData.id}}}else l={type:"movie",releaseYear:+(o.meta.year??0),title:o.meta.title,poster:o.meta.poster,tmdbId:o.tmdbId??"",imdbId:o.imdbId};return r(l),l},[r]);return{playerMeta:t,setPlayerMeta:a,setDirectMeta:r,scrapeMedia:n}}function Rs(t){return e.jsx("div",{className:"h-full w-full flex justify-center items-center p-8 text-center",children:t.children})}function za({episode:t,isActive:s,isAired:n,isWatched:r,isFavorited:a,percentage:o,episodeProgress:i,onPlay:l,onToggleWatch:d,onToggleFavorite:m,onToggleExpansion:u,expandedEpisodes:p={},truncatedEpisodes:g={},descriptionRefs:h,forceCompactEpisodeView:x=!1,seasonNumber:y}){const{t:f}=q();return e.jsxs("div",{children:[e.jsx("div",{className:z("block w-full px-3 relative",x?"":"sm:hidden"),children:e.jsx(Y.Link,{onClick:()=>l(t.id),active:s,clickable:n,rightSide:e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:b=>m(t.id,b),className:"p-1.5 rounded-full hover:bg-white/20 transition-colors",title:f("player.menus.episodes.markAsFavorite"),children:e.jsx(M,{icon:a?k.BOOKMARK:k.BOOKMARK_OUTLINE,className:"h-8 w-8 text-white/80"})}),!s&&e.jsx("button",{type:"button",onClick:b=>d(t.id,b),className:"p-1.5 rounded-full hover:bg-white/20 transition-colors",title:f(r?"player.menus.episodes.markAsUnwatched":"player.menus.episodes.markAsWatched"),children:e.jsx(M,{icon:r?k.EYE_SLASH:k.EYE,className:"h-4 w-4 text-white/80"})})]}),i&&e.jsx(ux,{className:"h-[18px] w-[18px] text-white",percentage:o})]}),children:e.jsx(Y.LinkTitle,{children:e.jsxs("div",{className:z("text-left flex items-center space-x-1 text-video-context-type-main",n||s?"":"text-opacity-25"),children:[e.jsx("span",{className:"p-0.5 px-2 rounded inline bg-video-context-hoverColor bg-opacity-50",children:y?`S${y}E${t.number}`:`E${t.number}`}),e.jsx("span",{className:"line-clamp-1 break-all",children:t.title})]})})})}),e.jsxs("div",{onClick:()=>l(t.id),className:z("hidden sm:flex lg:hidden w-full rounded-lg overflow-hidden transition-all duration-200 relative cursor-pointer",x?"!hidden":"",s?"bg-video-context-hoverColor/50":"hover:bg-video-context-hoverColor/50",n?"":"opacity-50"),children:[e.jsxs("div",{className:"relative aspect-video max-h-[110px] w-1/3 flex-shrink-0 bg-video-context-hoverColor",children:[t.still_path?e.jsx("img",{src:`https://image.tmdb.org/t/p/w300${t.still_path}`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black bg-opacity-50",children:e.jsx(M,{icon:k.FILM,className:"text-video-context-type-main opacity-50 text-3xl"})}),e.jsxs("div",{className:"absolute top-2 left-2 flex items-center space-x-2",children:[e.jsx("span",{className:"p-0.5 px-2 rounded inline bg-video-context-hoverColor bg-opacity-80 text-video-context-type-main text-sm",children:y?`S${y}E${t.number}`:`E${t.number}`}),!n&&e.jsx("span",{className:"bg-video-context-hoverColor/50 text-video-context-type-main/80 text-sm px-1 py-0.5 rounded-md",children:t.air_date?`(${f("details.airs")} - ${new Date(t.air_date).toLocaleDateString()})`:`(${f("media.unreleased")})`})]}),n&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx("button",{type:"button",onClick:b=>m(t.id,b),className:"p-1.5 bg-black/50 rounded-full hover:bg-black/80 transition-colors",title:f("player.menus.episodes.markAsFavorite"),children:e.jsx(M,{icon:a?k.BOOKMARK:k.BOOKMARK_OUTLINE,className:"h-8 w-8 text-white/80"})}),!s&&e.jsx("button",{type:"button",onClick:b=>d(t.id,b),className:"p-1.5 bg-black/50 rounded-full hover:bg-black/80 transition-colors",title:f(r?"player.menus.episodes.markAsUnwatched":"player.menus.episodes.markAsWatched"),children:e.jsx(M,{icon:r?k.EYE_SLASH:k.EYE,className:"h-4 w-4 text-white/80"})})]})]}),e.jsxs("div",{className:"p-3 flex-1",children:[e.jsx("h3",{className:"font-bold text-white line-clamp-1",children:t.title}),t.overview&&e.jsxs("div",{className:"relative",children:[e.jsx("p",{ref:b=>{h&&(h.current[`medium-${t.id}`]=b)},className:z("text-sm text-white/80 mt-1.5 transition-all duration-200",p[`medium-${t.id}`]?"max-h-[200px] overflow-y-auto scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent pr-2":"line-clamp-2"),children:t.overview}),!p[`medium-${t.id}`]&&g[`medium-${t.id}`]&&e.jsx("button",{type:"button",onClick:b=>u==null?void 0:u(`medium-${t.id}`,b),className:"text-sm text-white/60 hover:text-white transition-opacity duration-200 opacity-0 animate-fade-in",children:f("player.menus.episodes.showMore")}),p[`medium-${t.id}`]&&e.jsx("button",{type:"button",onClick:b=>u==null?void 0:u(`medium-${t.id}`,b),className:"mt-2 text-sm text-white/60 hover:text-white transition-opacity duration-200 opacity-0 animate-fade-in",children:f("player.menus.episodes.showLess")})]})]}),o>0&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-progress-background/25",children:e.jsx("div",{className:"h-full bg-progress-filled",style:{width:`${o}%`}})})]}),e.jsxs("div",{onClick:()=>l(t.id),className:z("hidden lg:block flex-shrink-0 transition-all duration-200 relative cursor-pointer rounded-lg overflow-hidden",x?"!hidden":"",s?"bg-video-context-hoverColor/50":"hover:bg-video-context-hoverColor/50",n?"hover:scale-95":"opacity-50",p[`large-${t.id}`]?"w-[32rem]":"w-64","h-[280px]"),children:[!p[`large-${t.id}`]&&e.jsxs("div",{className:"relative h-[158px] w-full bg-video-context-hoverColor",children:[t.still_path?e.jsx("img",{src:`https://image.tmdb.org/t/p/w300${t.still_path}`,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black bg-opacity-50",children:e.jsx(M,{icon:k.FILM,className:"text-video-context-type-main opacity-50 text-3xl"})}),e.jsxs("div",{className:"absolute top-2 left-2 flex items-center space-x-2",children:[e.jsx("span",{className:"p-0.5 px-2 rounded inline bg-video-context-hoverColor bg-opacity-80 text-video-context-type-main text-sm",children:y?`S${y}E${t.number}`:`E${t.number}`}),!n&&e.jsx("span",{className:"bg-video-context-hoverColor/50 text-video-context-type-main/80 text-sm px-1 py-0.5 rounded-md",children:t.air_date?`(${f("details.airs")} - ${new Date(t.air_date).toLocaleDateString()})`:`(${f("media.unreleased")})`})]}),n&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx("button",{type:"button",onClick:b=>m(t.id,b),className:"p-1.5 bg-black/50 rounded-full hover:bg-black/80 transition-colors",title:f("player.menus.episodes.markAsFavorite"),children:e.jsx(M,{icon:a?k.BOOKMARK:k.BOOKMARK_OUTLINE,className:"h-8 w-8 text-white/80"})}),!s&&e.jsx("button",{type:"button",onClick:b=>d(t.id,b),className:"p-1.5 bg-black/50 rounded-full hover:bg-black/80 transition-colors",title:f(r?"player.menus.episodes.markAsUnwatched":"player.menus.episodes.markAsWatched"),children:e.jsx(M,{icon:r?k.EYE_SLASH:k.EYE,className:"h-4 w-4 text-white/80"})})]})]}),e.jsxs("div",{className:z("p-3",p[`large-${t.id}`]?"h-full":"h-[122px]"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"font-bold text-white line-clamp-1",children:t.title}),p[`large-${t.id}`]&&n&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:b=>m(t.id,b),className:"p-1.5 rounded-full hover:bg-white/20 transition-colors",title:f("player.menus.episodes.markAsFavorite"),children:e.jsx(M,{icon:a?k.BOOKMARK:k.BOOKMARK_OUTLINE,className:"h-8 w-8 text-white/80"})}),!s&&e.jsx("button",{type:"button",onClick:b=>d(t.id,b),className:"p-1.5 rounded-full hover:bg-white/20 transition-colors",title:f(r?"player.menus.episodes.markAsUnwatched":"player.menus.episodes.markAsWatched"),children:e.jsx(M,{icon:r?k.EYE_SLASH:k.EYE,className:"h-4 w-4 text-white/80"})})]})]}),t.overview&&e.jsxs("div",{className:"relative",children:[e.jsx("p",{ref:b=>{h&&(h.current[`large-${t.id}`]=b)},className:z("text-sm text-white/80 mt-1.5 transition-all duration-200",p[`large-${t.id}`]?"max-h-[200px] overflow-y-auto scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent pr-2":"line-clamp-2"),children:t.overview}),!p[`large-${t.id}`]&&g[`large-${t.id}`]&&e.jsx("button",{type:"button",onClick:b=>u==null?void 0:u(`large-${t.id}`,b),className:"text-sm text-white/60 hover:text-white transition-opacity duration-200 opacity-0 animate-fade-in",children:f("player.menus.episodes.showMore")}),p[`large-${t.id}`]&&e.jsx("button",{type:"button",onClick:b=>u==null?void 0:u(`large-${t.id}`,b),className:"mt-2 text-sm text-white/60 hover:text-white transition-opacity duration-200 opacity-0 animate-fade-in",children:f("player.menus.episodes.showLess")})]})]}),o>0&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-progress-background/25",children:e.jsx("div",{className:"h-full bg-progress-filled",style:{width:`${o}%`}})})]})]})}function dl(t,s){const[n,r]=c.useState(null);return[Dt(async()=>{const o=await us(ge.SERIES,t,s);return(o==null?void 0:o.meta.type)!==ge.SERIES?null:(r(o.meta.seasons),{season:o.meta.seasonData,fullData:o})},[t,s]),n]}function mx({selectedSeason:t,setSeason:s}){const{t:n}=q(),r=E(m=>m.meta),[a,o]=dl((r==null?void 0:r.tmdbId)??"",t),i=me(m=>m.getFavoriteEpisodes),l=r!=null&&r.tmdbId?i(r.tmdbId):[];let d=null;return o?d=e.jsxs(Y.Section,{className:"pb-6",children:[l.length>0&&e.jsx(Y.ChevronLink,{onClick:()=>s("favorites"),children:e.jsxs("span",{className:"font-bold",children:[n("player.menus.episodes.favorites")," (",l.length,")"]})},"favorites"),o==null?void 0:o.map(m=>e.jsx(Y.ChevronLink,{onClick:()=>s(m.id),children:m.title},m.id))]}):a.error?d=e.jsx(Rs,{children:n("player.menus.episodes.loadingError")}):a.loading&&(d=e.jsx(Rs,{children:n("player.menus.episodes.loadingList")})),e.jsxs(Y.CardWithScrollable,{children:[e.jsx(Y.Title,{children:(r==null?void 0:r.title)??n("player.menus.episodes.loadingTitle")}),d]})}function hx({id:t,selectedSeason:s,goBack:n,onChange:r}){var H;const{t:a}=q(),o=Re(t),{setPlayerMeta:i}=Ws(),l=E($=>$.meta),[d,m]=dl((l==null?void 0:l.tmdbId)??"",s),u=je(),p=je($=>$.updateItem),g=me($=>$.getFavoriteEpisodes),h=l!=null&&l.tmdbId?g(l.tmdbId):[],x=me($=>$.bookmarks),[y,f]=c.useState(!1),[b,v]=c.useState([]);c.useEffect(()=>{s==="favorites"&&(l!=null&&l.tmdbId)&&m&&(f(!0),(async()=>{const K=m.map(async T=>{try{const X=await us(ge.SERIES,l.tmdbId,T.id);return(X==null?void 0:X.meta.type)===ge.SERIES?X.meta.seasonData:null}catch(X){return console.error(`Failed to load season ${T.id}:`,X),null}}),V=await Promise.all(K);v(V.filter(Boolean)),f(!1)})())},[s,l==null?void 0:l.tmdbId,m]);const w=c.useRef(null),R=c.useRef(null),[P,O]=c.useState({}),[U,D]=c.useState({}),S=c.useRef({}),N=J($=>$.forceCompactEpisodeView),C=$=>$?$.scrollHeight>$.clientHeight:!1;c.useEffect(()=>{const $=()=>{const T={};d.value&&(d.value.season.episodes.forEach(X=>{if(!P[`medium-${X.id}`]){const ae=S.current[`medium-${X.id}`];T[`medium-${X.id}`]=C(ae)}if(!P[`large-${X.id}`]){const ae=S.current[`large-${X.id}`];T[`large-${X.id}`]=C(ae)}}),D(T))};$();const K=setTimeout($,250),V=()=>{$()};return window.addEventListener("resize",V),()=>{clearTimeout(K),window.removeEventListener("resize",V)}},[d.value,P]);const _=($,K)=>{K.stopPropagation(),O(V=>({...V,[$]:!V[$]}))},I=c.useCallback($=>{if(d.value){const K=i(d.value.fullData,$);K&&(r==null||r(K))}o.close(!0)},[i,d,o,r]),A=c.useCallback(($,K)=>{var V,T;if(K.stopPropagation(),d.value&&(l!=null&&l.tmdbId)){const X=d.value.season.episodes.find(ae=>ae.id===$);if(X){const ae=(T=(V=u.items[l.tmdbId])==null?void 0:V.episodes)==null?void 0:T[$],Q=(ae?ae.progress.watched/ae.progress.duration*100:0)>90;p({meta:{tmdbId:l.tmdbId,title:l.title||"",type:"show",releaseYear:l.releaseYear,poster:l.poster,episode:{tmdbId:$,number:X.number,title:X.title||""},season:{tmdbId:s,number:d.value.season.number,title:d.value.season.title||""}},progress:{watched:Q?0:60,duration:60}})}}},[d,l,s,p,u.items]),L=me($=>$.toggleFavoriteEpisode),j=c.useCallback(($,K)=>{K.stopPropagation(),l!=null&&l.tmdbId&&L(l.tmdbId,$,{title:l.title||"",poster:l.poster,year:l.releaseYear})},[l==null?void 0:l.tmdbId,l==null?void 0:l.title,l==null?void 0:l.poster,l==null?void 0:l.releaseYear,L]),B=$=>{if(!w.current)return;const T=(256+16)*2,X=w.current.scrollLeft+($==="left"?-T:T);w.current.scrollTo({left:X,behavior:"smooth"})};if(c.useEffect(()=>{if(R.current)if(window.innerWidth>=1024&&w.current){const $=w.current.getBoundingClientRect().left,K=w.current.clientWidth,V=R.current.getBoundingClientRect().left,T=R.current.clientWidth,X=V-$-K/2+T/2;w.current.scrollLeft+=X}else R.current.scrollIntoView({behavior:"smooth",block:"center"})},[d.value]),!(l!=null&&l.tmdbId))return null;let W=null;if(d.error)W=e.jsx(Rs,{children:a("player.menus.episodes.loadingError")});else if(d.loading)W=e.jsx(Rs,{children:a("player.menus.episodes.loadingList")});else if(s==="favorites")if(h.length===0)W=e.jsx("div",{className:"flex-shrink-0 w-full flex justify-center items-center p-4",children:e.jsx("p",{children:a("player.menus.episodes.noFavorites")})});else if(y)W=e.jsx(Rs,{children:a("player.menus.episodes.loadingList")});else{const K=b.flatMap(V=>V.episodes.map(T=>({...T,seasonNumber:V.number}))).filter(V=>h.includes(V.id));K.length===0?W=e.jsx("div",{className:"flex-shrink-0 w-full flex justify-center items-center p-4",children:e.jsx("p",{children:a("player.menus.episodes.noFavorites")})}):W=e.jsx("div",{className:"relative",children:e.jsx("div",{className:z("flex pb-4 pt-2 scrollbar-hide",{"carousel-container":window.innerWidth>=1024&&!N},N?"flex-col space-y-3":"flex-col lg:flex-row lg:overflow-x-auto space-y-3 sm:space-y-4 lg:space-y-0 lg:space-x-4 lg:px-12"),style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:K.map(V=>{var ee,Pe,Ie,G,oe;const T=(Pe=(ee=u.items[(l==null?void 0:l.tmdbId)??""])==null?void 0:ee.episodes)==null?void 0:Pe[V.id],X=T?T.progress.watched/T.progress.duration*100:0,ae=X>90,ce=Ct(V.air_date),Q=V.id===((Ie=l==null?void 0:l.episode)==null?void 0:Ie.tmdbId),xe=l!=null&&l.tmdbId?((oe=(G=x[l.tmdbId])==null?void 0:G.favoriteEpisodes)==null?void 0:oe.includes(V.id))??!1:!1;return e.jsx(za,{episode:V,isActive:Q,isAired:ce,isWatched:ae,isFavorited:xe,percentage:X,episodeProgress:T,onPlay:I,onToggleWatch:A,onToggleFavorite:j,onToggleExpansion:_,expandedEpisodes:P,truncatedEpisodes:U,descriptionRefs:S,forceCompactEpisodeView:N,seasonNumber:V.seasonNumber},V.id)})})})}else d.value&&(W=e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:z("absolute left-0 top-1/2 transform -translate-y-1/2 z-10 px-4",N?"hidden":"hidden lg:block"),children:e.jsx("button",{type:"button",className:"p-2 bg-black/80 hover:bg-video-context-hoverColor transition-colors rounded-full border border-video-context-border backdrop-blur-sm",onClick:()=>B("left"),children:e.jsx(M,{icon:k.CHEVRON_LEFT,className:"text-white/80"})})}),e.jsx("div",{ref:w,className:z("flex pb-4 pt-2 scrollbar-hide",{"carousel-container":window.innerWidth>=1024&&!N},N?"flex-col  space-y-3":"flex-col lg:flex-row lg:overflow-x-auto space-y-3 sm:space-y-4 lg:space-y-0 lg:space-x-4 lg:px-12 "),style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:d.value.season.episodes.length===0?e.jsx("div",{className:"flex-shrink-0 w-full flex justify-center items-center p-4",children:e.jsx("p",{children:a("player.menus.episodes.emptyState")})}):d.value.season.episodes.map($=>{var Q,xe,ee,Pe,Ie;const K=(xe=(Q=u.items[l==null?void 0:l.tmdbId])==null?void 0:Q.episodes)==null?void 0:xe[$.id],V=K?K.progress.watched/K.progress.duration*100:0,T=Ct($.air_date),X=$.id===((ee=l==null?void 0:l.episode)==null?void 0:ee.tmdbId),ae=V>90,ce=l!=null&&l.tmdbId?((Ie=(Pe=x[l.tmdbId])==null?void 0:Pe.favoriteEpisodes)==null?void 0:Ie.includes($.id))??!1:!1;return e.jsx("div",{ref:X?R:null,children:e.jsx(za,{episode:$,isActive:X,isAired:T,isWatched:ae,isFavorited:ce,percentage:V,episodeProgress:K,onPlay:I,onToggleWatch:A,onToggleFavorite:j,onToggleExpansion:_,expandedEpisodes:P,truncatedEpisodes:U,descriptionRefs:S,forceCompactEpisodeView:N})},$.id)})}),e.jsx("div",{className:z("absolute right-0 top-1/2 transform -translate-y-1/2 z-10 px-4",N?"hidden":"hidden lg:block"),children:e.jsx("button",{type:"button",className:"p-2 bg-black/80 hover:bg-video-context-hoverColor transition-colors rounded-full border border-video-context-border backdrop-blur-sm",onClick:()=>B("right"),children:e.jsx(M,{icon:k.CHEVRON_RIGHT,className:"text-white/80"})})})]}));return e.jsxs(Y.CardWithScrollable,{children:[e.jsx(Y.BackLink,{onClick:n,side:"right",children:s==="favorites"?a("player.menus.episodes.favorites"):((H=d==null?void 0:d.value)==null?void 0:H.season.title)||a("player.menus.episodes.loadingTitle")}),W]})}function fx({id:t,onChange:s}){const n=Re(t),r=E(m=>m.meta),[a,o]=c.useState(""),i=c.useRef(!1);c.useEffect(()=>{var m;i.current!==n.isRouterActive&&(i.current=n.isRouterActive,o(((m=r==null?void 0:r.season)==null?void 0:m.tmdbId)??""))},[r,a,o,n.isRouterActive]);const l=c.useCallback(m=>{o(m),n.navigate("/episodes")},[n]),d=J(m=>m.forceCompactEpisodeView);return e.jsx(ji,{id:t,children:e.jsxs(al,{id:t,children:[e.jsx(Fe,{id:t,path:"/",width:343,height:431,children:e.jsx(mx,{setSeason:l,selectedSeason:a})}),e.jsx(Fe,{id:t,path:"/episodes",width:343,height:d||window.innerWidth<1024?431:375,fullWidth:!d,children:a.length>0?e.jsx(hx,{selectedSeason:a,id:t,goBack:()=>n.navigate("/"),onChange:s}):null})]})})}function px(t){return e.jsx(fx,{onChange:t.onChange,id:"episodes"})}function Ga(t){const{t:s}=q(),n=Re("episodes"),r=E(o=>o.setHasOpenOverlay),a=E(o=>{var i;return(i=o.meta)==null?void 0:i.type});return c.useEffect(()=>{r(n.isRouterActive)},[r,n.isRouterActive]),a!=="show"||!t.inControl?null:e.jsx(Kr,{id:n.id,children:e.jsx(qe,{onClick:()=>n.open("/episodes"),icon:k.EPISODES,children:s("player.menus.episodes.button")})})}function qa(){const t=E(n=>n.interface.canAirplay),s=E(n=>n.display);return t?e.jsx(qe,{onClick:()=>s==null?void 0:s.startAirplay(),icon:k.AIRPLAY}):null}function xx(){const t=di(),s=at(r=>r.currentOverlay),n=E(r=>r.mediaPlaying.volume);return e.jsx(Se,{animation:"slide-down",show:t.showVolume&&s==="volume",className:"absolute inset-x-0 top-4 flex justify-center pointer-events-none",children:e.jsxs(fe.Base,{className:"hover:flare-enabled pointer-events-auto bg-video-context-background pl-4 pr-6 py-3 group w-72 h-full rounded-lg transition-colors text-video-context-type-main",children:[e.jsx(fe.Light,{enabled:!0,flareSize:200,cssColorVar:"--colors-video-context-light",backgroundClass:"bg-video-context-background duration-100",className:"rounded-lg"}),e.jsxs(fe.Child,{className:"grid grid-cols-[auto,1fr] gap-3 pointer-events-auto relative transition-transform",children:[e.jsx(M,{className:"text-2xl",icon:n>0?k.VOLUME:k.VOLUME_X}),e.jsx("div",{className:"w-full flex items-center",children:e.jsx("div",{className:"w-full h-1.5 rounded-full bg-video-context-slider bg-opacity-25",children:e.jsx("div",{className:"h-full bg-video-context-sliderFilled rounded-full transition-[width] duration-100",style:{width:`${n*100}%`}})})})]})]})})}function gx(){const t=Te(r=>r.showDelayIndicator),s=at(r=>r.currentOverlay),n=Te(r=>r.delay);return e.jsx(Se,{animation:"slide-down",show:t&&s==="subtitle",className:"absolute inset-x-0 top-4 flex justify-center pointer-events-none",children:e.jsxs(fe.Base,{className:"hover:flare-enabled pointer-events-auto bg-video-context-background pl-4 pr-6 py-3 group w-72 h-full rounded-lg transition-colors text-video-context-type-main",children:[e.jsx(fe.Light,{enabled:!0,flareSize:200,cssColorVar:"--colors-video-context-light",backgroundClass:"bg-video-context-background duration-100",className:"rounded-lg"}),e.jsxs(fe.Child,{className:"grid grid-cols-[auto,1fr] gap-3 pointer-events-auto relative transition-transform",children:[e.jsx(M,{className:"text-2xl",icon:k.CAPTIONS}),e.jsx("div",{className:"w-full flex items-center justify-between",children:e.jsxs("span",{className:"text-sm",children:["Subtitle delay: ",n>0?"+":"",n.toFixed(1),"s"]})})]})]})})}function bx(t,s){const n=t/s;return s-t<=30?"always":n>=.93?"hover":"none"}function Ya(t){return e.jsx("button",{className:z("font-bold rounded h-10 w-40 scale-95 hover:scale-100 transition-all duration-200",t.className),type:"button",onClick:t.onClick,children:t.children})}function yx(t,s=!1){return Dt(async()=>{if(s){if(!t)return null;const r=await us(ge.SERIES,t);return(r==null?void 0:r.meta.type)!==ge.SERIES?null:r.meta.seasons}},[t,s])}function vx(t,s){return Dt(async()=>{var r,a;if(t){if(!s)return null;const o=await us(ge.SERIES,s,t==null?void 0:t.id);if((o==null?void 0:o.meta.type)!==ge.SERIES)return null;const i=(a=(r=o==null?void 0:o.meta)==null?void 0:r.seasonData)==null?void 0:a.episodes.filter(l=>Ct(l.air_date)).map(l=>({number:l.number,title:l.title,tmdbId:l.id}));if(i.length>0)return i[0]}},[s,t==null?void 0:t.id])}function wx(t){var S,N,C,_,I;const{t:s}=q(),n=E(A=>A.progress.duration),r=E(A=>A.interface.hideNextEpisodeBtn),a=E(A=>A.meta),{setDirectMeta:o}=Ws(),i=E(A=>{var L;return(L=A.meta)==null?void 0:L.type}),l=E(A=>A.progress.time),d=J(A=>A.enableAutoplay),m=J(A=>A.enableSkipCredits),u=bx(l,n),p=E(A=>A.status),g=E(A=>A.setShouldStartFromBeginning),h=je(A=>A.updateItem),x=!((S=a==null?void 0:a.episode)!=null&&S.number)||!((C=(N=a==null?void 0:a.episodes)==null?void 0:N.at(-1))!=null&&C.number)?!1:a.episode.number===a.episodes.at(-1).number,f=(_=yx(a==null?void 0:a.tmdbId,x).value)==null?void 0:_.find(A=>{var L;return A.number===(((L=a==null?void 0:a.season)==null?void 0:L.number)??0)+1}),b=vx(f,a==null?void 0:a.tmdbId);let v=!1;const w=c.useRef(!1);(u==="always"||u==="hover"&&t.controlsShowing)&&(v=!0),(r||p!=="playing"||n===0)&&(v=!1);const R=u==="hover"?"slide-up":"fade";let P="bottom-[calc(6rem+env(safe-area-inset-bottom))]";u==="always"&&(P=t.controlsShowing?P:"bottom-[calc(3rem+env(safe-area-inset-bottom))]");const O=x?b.value:(I=a==null?void 0:a.episodes)==null?void 0:I.find(A=>{var L;return A.number===(((L=a==null?void 0:a.episode)==null?void 0:L.number)??0)+1}),U=c.useCallback(()=>{var j;if(!a||!O)return;const A={...a};A.episode=O,A.season=x&&f?{...f,tmdbId:f.id}:A.season,g(!0),o(A),(j=t.onChange)==null||j.call(t,A),h({meta:A,progress:{duration:0,watched:0}})},[o,O,a,t,g,h,x,f]),D=c.useCallback(()=>{var j;if(!a||!a.episode)return;const A={...a};g(!0),o(A),(j=t.onChange)==null||j.call(t,A),h({meta:A,progress:{duration:0,watched:0}})},[o,a,t,g,h]);return c.useEffect(()=>{if(!d||i!=="show")return;const A=n/100,L=m?l>=n-A&&n!==0:l>=n&&n!==0;n===0&&(w.current=!1),L&&ll()&&!w.current&&(w.current=!0,U())},[n,d,m,U,i,l]),!t.inControl||!(a!=null&&a.episode)||!O||i!=="show"?null:t.showAsButton?e.jsxs(Z,{onClick:()=>U(),theme:"secondary",padding:"md:px-12 p-2.5",className:"w-full",children:[e.jsx(M,{className:"mr-2",icon:k.SKIP_EPISODE}),s(x&&O?"player.nextEpisode.nextSeason":"player.nextEpisode.next")]}):e.jsx(Se,{animation:R,show:v,className:"absolute right-[calc(3rem+env(safe-area-inset-right))] bottom-0",children:e.jsxs("div",{className:z(["absolute bottom-0 right-0 transition-[bottom] duration-200 flex items-center space-x-3",P]),children:[e.jsx(Ya,{className:"py-px box-content bg-buttons-secondary hover:bg-buttons-secondaryHover bg-opacity-90 text-buttons-secondaryText justify-center items-center",onClick:()=>D(),children:s("player.nextEpisode.replay")}),e.jsxs(Ya,{onClick:()=>U(),className:"bg-buttons-primary hover:bg-buttons-primaryHover text-buttons-primaryText flex justify-center items-center",children:[e.jsx(M,{className:"text-xl mr-1",icon:k.SKIP_EPISODE}),s(x&&O?"player.nextEpisode.nextSeason":"player.nextEpisode.next")]})]})})}function Qa({className:t}){const[s,n]=c.useState(!1),r=E(o=>o.interface.isCasting),a=c.useRef(null);return c.useEffect(()=>{var u;const i=(u=window.cast)==null?void 0:u.framework;if(!i){n(!0);return}const l=i.CastContext.getInstance(),d=()=>{const p=l.getCastState();n(p===i.CastState.NO_DEVICES_AVAILABLE)},m=()=>d();return l.addEventListener(i.CastContextEventType.CAST_STATE_CHANGED,m),d(),()=>{l.removeEventListener(i.CastContextEventType.CAST_STATE_CHANGED,m)}},[]),c.useEffect(()=>{if(!a.current||a.current.children.length>0)return;const o=document.createElement("google-cast-launcher");a.current.appendChild(o)},[]),e.jsx(qe,{className:[t??"","google-cast-button","cast-button-container",r?"casting":"",s?"hidden":""].join(" "),children:e.jsx("div",{ref:a})})}function jx(){const{t}=q(),s=E(i=>i.mediaPlaying.isLoading),n=E(i=>i.display),r=(n==null?void 0:n.getType())==="casting",a=E(i=>i.casting.player);if(s||!r)return null;let o=(a==null?void 0:a.displayName)||t("player.casting.device");return o==="Default Media Receiver"&&(o=t("player.casting.device")),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"rounded-full bg-opacity-10 bg-video-buttonBackground p-3 brightness-100 grayscale",children:e.jsx(M,{icon:k.CASTING})}),e.jsx("p",{className:"text-center",children:t("player.casting.to",{device:o})})]})}function Xa(){const t=Re("settings"),s=E(n=>n.setHasOpenOverlay);return c.useEffect(()=>{s(t.isRouterActive)},[s,t.isRouterActive]),e.jsx(Kr,{id:t.id,children:e.jsx(qe,{onClick:()=>{t.open(),t.navigate("/captionsOverlay")},icon:k.CAPTIONS})})}function kx(){const t=E(a=>a.interface.isSpeedBoosted),s=E(a=>a.interface.showSpeedIndicator),n=at(a=>a.currentOverlay),r=E(a=>a.mediaPlaying.playbackRate);return e.jsx(Se,{animation:"slide-down",show:s&&n==="speed",className:"absolute inset-x-0 top-4 flex justify-center pointer-events-none",children:e.jsxs(fe.Base,{className:"hover:flare-enabled pointer-events-auto bg-video-context-background pl-4 pr-6 py-3 group w-20 h-full rounded-lg transition-colors text-video-context-type-main",children:[e.jsx(fe.Light,{enabled:!0,flareSize:200,cssColorVar:"--colors-video-context-light",backgroundClass:"bg-video-context-background duration-100",className:"rounded-lg"}),e.jsxs(fe.Child,{className:"grid grid-cols-[auto,1fr] gap-3 pointer-events-auto relative transition-transform",children:[e.jsx(M,{className:"text-2xl",icon:k.TACHOMETER}),e.jsx("div",{className:"w-full flex items-center justify-between",children:e.jsx("span",{className:"text-sm",children:t?re("player.menus.playback.speedBoosted"):re("player.menus.playback.speedUnboosted",{speed:r})})})]})]})})}function Nx(t=15,s=50){const[n,r]=c.useState([]),a=c.useRef(0),o=c.useRef(0),i=c.useRef(!1),l=E(h=>h.progress),d=E(h=>h.mediaPlaying),m=E(h=>h.meta),u=E(h=>h.interface.isSeeking);c.useEffect(()=>{i.current=u},[u]);const p=c.useCallback(()=>{r([]),a.current=0,o.current=0},[]),g=c.useCallback(()=>{var w,R,P;const h=Date.now(),x=l.time;if(!d.hasPlayedOnce||i.current){a.current=x,o.current=h;return}if(a.current===0){a.current=x,o.current=h;return}const y=x-a.current,f=h-o.current,b=d.isPlaying?f/1e3*d.playbackRate:0,v=Math.abs(y-b);if(Math.abs(y)>=t&&v>=3){const O={startTime:a.current,endTime:x,skipDuration:y,timestamp:h,meta:m?{title:m.type==="show"&&m.episode?`${m.title} - S${((w=m.season)==null?void 0:w.number)||0}E${m.episode.number||0}`:m.title,type:m.type==="movie"?"Movie":"TV Show",tmdbId:m.tmdbId,seasonNumber:(R=m.season)==null?void 0:R.number,episodeNumber:(P=m.episode)==null?void 0:P.number}:void 0};r(U=>{const D=[...U,O];return D.length>s?D.slice(D.length-s):D})}a.current=x,o.current=h},[l.time,d,m,t,s]);return c.useEffect(()=>{const h=setInterval(()=>{d.hasPlayedOnce&&g()},1e3);return()=>clearInterval(h)},[g,d.hasPlayedOnce]),c.useEffect(()=>{p()},[m==null?void 0:m.tmdbId,p]),{skipHistory:n,latestSkip:n.length>0?n[n.length-1]:null,clearHistory:p}}function Sx(){const{skipHistory:t,latestSkip:s}=Nx(15),n=c.useRef(0),r=E(a=>a.meta);return c.useEffect(()=>{var u,p,g,h,x,y,f,b,v,w,R,P,O;if(!s||!r||s.timestamp===n.current)return;const a=U=>{const D=Math.abs(U),S=Math.floor(D/60),N=Math.floor(D%60);return S>0?`${S}m ${N}s`:`${N}s`},o=U=>{const D=Math.floor(U/60),S=Math.floor(U%60);return`${D}:${S.toString().padStart(2,"0")}`},i=s.skipDuration>0?"forward":"backward",l=Math.abs(s.skipDuration)>=30?"scrub":"skip";console.log(`User ${l.toUpperCase()} detected`,{direction:i,duration:a(s.skipDuration),from:o(s.startTime),to:o(s.endTime),content:{title:((u=s.meta)==null?void 0:u.title)||"Unknown",type:((p=s.meta)==null?void 0:p.type)||"Unknown",tmdbId:(g=s.meta)==null?void 0:g.tmdbId},...r.type==="show"&&{episode:{season:(h=s.meta)==null?void 0:h.seasonNumber,episode:(x=s.meta)==null?void 0:x.episodeNumber}},analytics:{timestamp:new Date(s.timestamp).toISOString(),startTime:s.startTime,endTime:s.endTime,skipDuration:s.skipDuration,contentId:(y=s.meta)==null?void 0:y.tmdbId,contentType:(f=s.meta)==null?void 0:f.type,seasonId:(b=r.season)==null?void 0:b.tmdbId,episodeId:(v=r.episode)==null?void 0:v.tmdbId}}),r.type==="show"&&s.startTime<=30&&s.skipDuration>15&&s.skipDuration<=120&&console.log("Potential intro skip dete",{show:(w=s.meta)==null?void 0:w.title,season:(R=s.meta)==null?void 0:R.seasonNumber,episode:(P=s.meta)==null?void 0:P.episodeNumber,introSkipDuration:a(s.skipDuration),message:"User likely skipped intro sequence"});const m=E.getState().progress.duration-s.endTime;s.skipDuration>0&&m<=300&&s.skipDuration>=15&&console.log("Potential outro skip detected",{content:(O=s.meta)==null?void 0:O.title,timeRemaining:a(m),skipDuration:a(s.skipDuration),message:"User likely skipped credits/outro"}),n.current=s.timestamp},[s,r]),c.useEffect(()=>{if(t.length>0&&t.length%5===0){const a=t.filter(l=>l.skipDuration>0),o=t.filter(l=>l.skipDuration<0),i=t.reduce((l,d)=>l+Math.abs(d.skipDuration),0)/t.length;console.log("skip analytics",{totalSkips:t.length,forwardSkips:a.length,backwardSkips:o.length,averageSkipDuration:`${Math.round(i)}s`,content:(r==null?void 0:r.title)||"Unknown"})}},[t.length,t,r==null?void 0:r.title]),null}function Cx(t,s){for(let n=0;n<s.length;n+=1)if(s.start(s.length-1-n)<t)return s.end(s.length-1-n);return 0}const Ex={1:{name:"MEDIA_ERR_ABORTED",key:"player.playbackError.errors.errorAborted"},2:{name:"MEDIA_ERR_NETWORK",key:"player.playbackError.errors.errorNetwork"},3:{name:"MEDIA_ERR_DECODE",key:"player.playbackError.errors.errorDecode"},4:{name:"MEDIA_ERR_SRC_NOT_SUPPORTED",key:"player.playbackError.errors.errorNotSupported"}};function Ix(t){const s=Ex[(t==null?void 0:t.code)??-1];return s||{name:"MEDIA_ERR_GENERIC",key:"player.playbackError.errors.errorGenericMedia"}}function ds(t){const s=new URL(t),n=le().CDN_REPLACEMENTS;for(const[r,a]of n)if(s.hostname.endsWith(r))return s.hostname=a,s.port="",s.protocol="https://",s.toString();return t}function ul(){const t={};return{on(s,n){var r;t[s]||(t[s]=[]),(r=t[s])==null||r.push(n)},off(s,n){var r;t[s]=((r=t[s])==null?void 0:r.filter(a=>a!==n))??[]},emit(s,n){(t[s]??[]).forEach(r=>r(n))}}}const Tx={360:"360",1080:"1080",720:"720",480:"480",2160:"4k"},Rx=[{minHeight:1800,quality:"4k"},{minHeight:800,quality:"1080"},{minHeight:600,quality:"720"},{minHeight:420,quality:"480"},{minHeight:0,quality:"360"}];function Cs(t){if(!(t!=null&&t.height))return null;const s=Tx[t.height];if(s)return s;for(const n of Rx)if(t.height>=n.minHeight)return n.quality;return"unknown"}function Px(t){return t.map(s=>Cs(s)).filter(s=>!!s)}function Ja(t){return[...t].sort((s,n)=>(n.height||0)-(s.height||0))}function ml(){const{emit:t,on:s,off:n}=ul();let r=null,a=null,o=null,i=null,l=!1,d=!1,m=!1,u=0,p=!1,g=null,h=1,x=0,y=0;const f=new Map;function b(){if(!a)return;const N=a.levels.map(C=>Cs(C)).filter(C=>!!C);t("qualities",N)}function v(){if(!a)return;const S=ze.getState().language,N=a.audioTracks,C=N.find(I=>I.lang===S);C&&(a.audioTrack=N.indexOf(C));const _=N==null?void 0:N[a.audioTrack??0];_&&(t("changedaudiotrack",{id:_.id.toString(),label:_.name,language:_.lang??"unknown"}),t("audiotracks",a.audioTracks.map(I=>({id:I.id.toString(),label:I.name,language:I.lang??"unknown"}))))}function w(){if(o&&rn(o)||!a)return;if(p)a.currentLevel=-1,a.loadLevel=-1;else{const N=Ja(a.levels),C=Px(N),_=ki(C,{lastChosenQuality:g,automaticQuality:p});if(_){const I=a.levels.filter(A=>Cs(A)===_);if(I.length>0){const A=Ja(I)[0],L=a.levels.indexOf(A);L!==-1&&(a.currentLevel=L,a.loadLevel=L)}}}const S=Cs(a.levels[a.currentLevel]);t("changedquality",S)}function R(S,N){if(a=null,N.type==="hls"){if(rn(S)){S.src=ds(N.url),S.currentTime=u;return}if(!ut.isSupported())throw new Error("HLS not supported. Update your browser. ü§¶‚Äç‚ôÇÔ∏è");if(!a){a=new ut({autoStartLoad:!0,maxBufferLength:120,maxMaxBufferLength:240,fragLoadPolicy:{default:{maxLoadTimeMs:30*1e3,maxTimeToFirstByteMs:30*1e3,errorRetry:{maxNumRetry:10,retryDelayMs:1e3,maxRetryDelayMs:1e4},timeoutRetry:{maxNumRetry:10,maxRetryDelayMs:0,retryDelayMs:0}}},renderTextTracksNatively:!1});const C=["Failed to execute 'appendBuffer' on 'SourceBuffer': This SourceBuffer has been removed from the parent media source."];a==null||a.on(ut.Events.ERROR,(_,I)=>{var L,j,B;console.error("HLS error",I);const A={details:I.details,fatal:I.fatal,level:I.level,levelDetails:I.levelDetails?{url:I.levelDetails.url,width:I.levelDetails.width,height:I.levelDetails.height,bitrate:I.levelDetails.bitrate}:void 0,frag:I.frag?{url:I.frag.url,baseurl:I.frag.baseurl,duration:I.frag.duration,start:I.frag.start,sn:I.frag.sn}:void 0,type:I.type,url:I.url};I.fatal&&(N==null?void 0:N.url)===((L=I.frag)==null?void 0:L.baseurl)&&!C.includes(I.error.message)?t("error",{message:I.error.message,stackTrace:I.error.stack,errorName:I.error.name,type:"hls",hls:A}):I.details==="manifestLoadError"&&t("error",{message:"Failed to load HLS manifest",stackTrace:((j=I.error)==null?void 0:j.stack)||"",errorName:((B=I.error)==null?void 0:B.name)||"ManifestLoadError",type:"hls",hls:A})}),a.on(ut.Events.MANIFEST_LOADED,()=>{a&&(b(),w(),v(),Xe()&&(a.on(ut.Events.LEVEL_LOADED,async(_,I)=>{const A=I.details.fragments.map(j=>new URL(j.url).hostname),L=[...new Set(A)];await lr({ruleId:or.SET_DOMAINS_HLS,targetDomains:L,requestHeaders:{...N.preferredHeaders,...N.headers}})}),a.on(ut.Events.AUDIO_TRACK_LOADED,async(_,I)=>{const A=I.details.fragments.map(j=>new URL(j.url).hostname),L=[...new Set(A)];await lr({ruleId:or.SET_DOMAINS_HLS_AUDIO,targetDomains:L,requestHeaders:{...N.preferredHeaders,...N.headers}})})))}),a.on(ut.Events.LEVEL_SWITCHED,()=>{if(!a)return;const _=Cs(a.levels[a.currentLevel]);t("changedquality",_)}),a.on(ut.Events.SUBTITLE_TRACK_LOADED,()=>{for(const[_,I]of f)if(a==null?void 0:a.subtitleTracks.find(L=>L.lang===_)){I(),f.delete(_);break}})}a.attachMedia(S),a.loadSource(ds(N.url)),S.currentTime=u;return}S.src=ds(N.url),S.currentTime=u}function P(){!o||!r||(R(o,r),o.addEventListener("play",()=>{t("play",void 0),t("loading",!1)}),o.addEventListener("error",()=>{const S=(o==null?void 0:o.error)??null,N=Ix(S);t("error",{errorName:N.name,key:N.key,type:"htmlvideo"})}),o.addEventListener("playing",()=>t("play",void 0)),o.addEventListener("pause",()=>t("pause",void 0)),o.addEventListener("canplay",()=>t("loading",!1)),o.addEventListener("waiting",()=>t("loading",!0)),o.addEventListener("volumechange",()=>t("volumechange",o!=null&&o.muted?0:(o==null?void 0:o.volume)??0)),o.addEventListener("timeupdate",()=>{const S=(o==null?void 0:o.currentTime)??0;(S>=y||m)&&(y=S,t("time",S))}),o.addEventListener("loadedmetadata",()=>{(r==null?void 0:r.type)==="hls"&&o&&rn(o)&&(t("qualities",["unknown"]),t("changedquality","unknown"));const S=(o==null?void 0:o.duration)??0;S>0?(x=S,t("duration",S)):x>0&&t("duration",x)}),o.addEventListener("progress",()=>{o&&t("buffered",Cx(o.currentTime,o.buffered))}),o.addEventListener("webkitendfullscreen",()=>{l=!1,t("fullscreen",l),l||t("needstrack",!1)}),o.addEventListener("webkitplaybacktargetavailabilitychanged",S=>{S.availability==="available"&&t("canairplay",!0)}),o.addEventListener("ratechange",()=>{o&&t("playbackrate",o.playbackRate)}),o.addEventListener("durationchange",()=>{const S=(o==null?void 0:o.duration)??0;S>0?(x=S,t("duration",S)):x>0&&t("duration",x)}))}function O(){o&&(o.removeAttribute("src"),o.load()),a&&(a.destroy(),a=null),x=0,y=0}function U(){O(),o&&(o=null)}function D(){l=!!document.fullscreenElement||!!document.webkitFullscreenElement,t("fullscreen",l),l||t("needstrack",!1)}return tt.addEventListener("fullscreenchange",D),{on:s,off:n,getType(){return"web"},destroy:()=>{U(),tt.removeEventListener("fullscreenchange",D)},load(S){S.source||O(),p=S.automaticQuality,g=S.preferredQuality,r=S.source,t("loading",!0),u=S.startAt,P()},changeQuality(S,N){(r==null?void 0:r.type)==="hls"&&(p=S,g=N,w())},processVideoElement(S){U(),o=S,P(),this.setVolume(h)},processContainerElement(S){i=S},setMeta(){},setCaption(){},pause(){o==null||o.pause()},play(){o==null||o.play()},setSeeking(S){if(S!==m){if(m=S,!S){d||this.play();return}d=(o==null?void 0:o.paused)??!0,this.pause()}},setTime(S){if(!o)return;let N=Math.min(S,o.duration);N=Math.max(0,N),!Number.isNaN(N)&&(t("time",N),o.currentTime=N)},async setVolume(S){let N=Math.min(S,1);if(N=Math.max(0,N),h=S,!o)return;o.muted=N===0,await Zi()?o.volume=N:t("volumechange",N===0?0:1)},toggleFullscreen(){if(l){if(l=!1,t("fullscreen",l),t("needstrack",!1),!tt.fullscreenElement)return;tt.exitFullscreen();return}if(l=!0,t("fullscreen",l),!(!tl()||tt.fullscreenElement)){if(Fn()){i&&tt.requestFullscreen(i);return}el()&&o&&(t("needstrack",!0),o.webkitEnterFullscreen())}},togglePictureInPicture(){if(o){if(nl()){const S=o;S.webkitSetPresentationMode(S.webkitPresentationMode==="picture-in-picture"?"inline":"picture-in-picture")}sl()&&(o!==document.pictureInPictureElement?o.requestPictureInPicture():document.exitPictureInPicture())}},startAirplay(){const S=o;S&&S.webkitShowPlaybackTargetPicker&&S.webkitShowPlaybackTargetPicker()},setPlaybackRate(S){o&&(o.playbackRate=S)},getCaptionList(){return(a==null?void 0:a.subtitleTracks.map(S=>({id:S.id.toString(),language:S.lang??"unknown",url:S.url,type:"vtt",needsProxy:!1,hls:!0})))??[]},getSubtitleTracks(){return(a==null?void 0:a.subtitleTracks)??[]},async setSubtitlePreference(S){const N=a==null?void 0:a.subtitleTracks.find(_=>_.lang===S);if((N==null?void 0:N.details)!==void 0)return Promise.resolve();const C=new Promise((_,I)=>{f.set(S,_),setTimeout(()=>{I(),f.delete(S)},5e3)});return a==null||a.setSubtitleOption({lang:S}),C},changeAudioTrack(S){if(!a)return;const N=a==null?void 0:a.audioTracks.find(C=>C.id.toString()===S.id);N&&(a.audioTrack=a.audioTracks.indexOf(N),t("changedaudiotrack",{id:N.id.toString(),label:N.name,language:N.lang??"unknown"}))}}}function Lx(t){const{emit:s,on:n,off:r}=ul();let a=!1,o=1,i=null,l=null,d=!1,m=!1,u=!1,p=0,g={title:"",type:ge.MOVIE},h=null;function x(){var R;const w=P=>{switch(P.field){case"volumeLevel":s("volumechange",P.value);break;case"currentTime":s("time",P.value);break;case"duration":s("duration",P.value??0);break;case"mediaInfo":P.value&&s("duration",P.value.duration??0);break;case"playerState":s("loading",P.value==="BUFFERING"),P.value==="PLAYING"?s("play",void 0):P.value==="PAUSED"&&s("pause",void 0),a=P.value==="PAUSED";break;case"isMuted":s("volumechange",P.value?0:t.player.volumeLevel);break}};return(R=t.controller)==null||R.addEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,w),()=>{var P;(P=t.controller)==null||P.removeEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,w)}}function y(){var S;if(!i){(S=t.controller)==null||S.stop();return}let w="video/mp4";i.type==="hls"&&(w="application/x-mpegurl");const R=new chrome.cast.media.GenericMediaMetadata;R.title=g.title;let P=ds(i.url);if(i.type==="hls")try{const N=le().M3U8_PROXY_URLS;let C={};const _=localStorage.getItem("m3u8-proxy-enabled");if(_)try{C=JSON.parse(_)}catch{C={}}const I=N.filter((L,j)=>C[j.toString()]!==!1),A=I.length>0?I:N;if(A.length>0){const L=A[Math.floor(Math.random()*A.length)];P=`${L.endsWith("/")?L.slice(0,-1):L}/?destination=${encodeURIComponent(P)}`}}catch{}const O=new chrome.cast.media.MediaInfo(P,w);if(O.streamType=chrome.cast.media.StreamType.BUFFERED,O.metadata=R,O.customData={playbackRate:o},h!=null&&h.url)try{const N=new chrome.cast.media.Track(1,chrome.cast.media.TrackType.TEXT);N.trackContentType="text/vtt",N.trackContentId=h.url,N.language=h.language,N.name=h.language||"Subtitles",N.subtype=chrome.cast.media.TextTrackType.SUBTITLES,O.tracks=[N]}catch{}const U=new chrome.cast.media.LoadRequest(O);U.autoplay=!0,U.currentTime=p,h!=null&&h.url&&(U.activeTrackIds=[1]);const D=t.instance.getCurrentSession();D==null||D.loadMedia(U).then(()=>{s("loading",!1)}).catch(N=>{s("loading",!1),s("error",{type:"global",errorName:"chromecast_load_failure",message:(N==null?void 0:N.message)??String(N)})})}function f(){i&&y()}function b(){d=!!document.fullscreenElement||!!document.webkitFullscreenElement,s("fullscreen",d),d||s("needstrack",!1)}tt.addEventListener("fullscreenchange",b);const v=x();return{on:n,off:r,getType(){return"casting"},destroy:()=>{v(),tt.removeEventListener("fullscreenchange",b)},load(w){i=w.source,s("loading",!0),p=w.startAt,f()},changeQuality(){},setCaption(w){h=w;const R=t.instance.getCurrentSession(),P=R==null?void 0:R.getMediaSession();try{if(P){const O=w!=null&&w.url?[1]:[],U=new chrome.cast.media.EditTracksInfoRequest(O);P.editTracksInfo(U);return}}catch{}f()},processVideoElement(w){f()},processContainerElement(w){l=w},setMeta(w){g=w,f()},pause(){t.player.isPaused||t.controller.playOrPause()},play(){t.player.isPaused&&t.controller.playOrPause()},setSeeking(w){if(w!==u){if(u=w,!w){m||this.play();return}m=a??!0,this.pause()}},setTime(w){let R=w;Number.isNaN(t.player.duration)||(R=Math.min(w,t.player.duration),R=Math.max(0,R)),!Number.isNaN(R)&&(s("time",R),t.player.currentTime=R,t.controller.seek())},async setVolume(w){let R=Math.min(w,1);R=Math.max(0,R),t.player.volumeLevel=R,t.controller.setVolumeLevel(),s("volumechange",R)},toggleFullscreen(){if(d){if(d=!1,s("fullscreen",d),s("needstrack",!1),!tt.fullscreenElement)return;tt.exitFullscreen();return}d=!0,s("fullscreen",d),!(!tl()||tt.fullscreenElement)&&Fn()&&l&&tt.requestFullscreen(l)},togglePictureInPicture(){},startAirplay(){},setPlaybackRate(w){o=w,s("playbackrate",w)},getCaptionList(){return[]},getSubtitleTracks(){return[]},async setSubtitlePreference(){return Promise.resolve()},changeAudioTrack(){}}}const Dx="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",wr=[];let jr=null,Za=!1;function Ax(t){jr=t,wr.forEach(s=>s(t)),wr.length=0}function Mx(t){if(jr!==null){setTimeout(()=>t(jr),0);return}wr.push(t)}function _x(){if(!Za&&(Za=!0,window.__onGCastApiAvailable||(window.__onGCastApiAvailable=t=>{var s,n,r,a;try{t&&((s=window.cast)!=null&&s.framework)&&window.cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:(a=(r=(n=window.chrome)==null?void 0:n.cast)==null?void 0:r.media)==null?void 0:a.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:window.cast.framework.AutoJoinPolicy.ORIGIN_SCOPED})}catch(o){console.warn("Chromecast initialization error:",o)}finally{Ax(!!t)}}),!document.getElementById("chromecast-script"))){const t=document.createElement("script");t.src=Dx,t.id="chromecast-script",t.onerror=()=>console.warn("Failed to load Chromecast SDK"),document.body.appendChild(t)}}function Ox(){const[t,s]=c.useState(null);return c.useEffect(()=>{let n=!0;return Mx(r=>{n&&s(r)}),()=>{n=!1}},[]),t}function Bx(){const t=E(v=>v.casting.setInstance),s=E(v=>v.casting.setController),n=E(v=>v.casting.setPlayer),r=E(v=>v.casting.setIsCasting),a=E(v=>v.interface.isCasting),o=E(v=>{var w;return(w=v.caption)==null?void 0:w.selected}),i=E(v=>v.setDisplay),l=E(v=>v.redisplaySource),d=Ox(),m=E(v=>v.display),u=E(v=>v.casting.controller),p=E(v=>v.casting.player),g=E(v=>v.casting.instance),h=E(v=>v.progress.time),x=E(v=>{var w;return(w=v.meta)==null?void 0:w.title}),y=E(v=>{var w;return(w=v.meta)==null?void 0:w.type}),f=c.useRef({controller:u,player:p,instance:g,time:h,metaTitle:x,metaType:y,caption:o});c.useEffect(()=>{f.current={controller:u,player:p,instance:g,time:h,metaTitle:x,metaType:y,caption:o}},[u,p,g,h,x,y,o]),c.useEffect(()=>{if(a){if(f.current.controller&&f.current.instance&&f.current.player){const v=Lx({controller:f.current.controller,instance:f.current.instance,player:f.current.player});v.setMeta({title:f.current.metaTitle??"",type:hn(f.current.metaType??"movie")}),v.setCaption(f.current.caption),i(v),l(f.current.time??0)}}else{const v=ml();i(v),l(f.current.time??0)}},[a,i,l]),c.useEffect(()=>{m==null||m.setMeta({title:f.current.metaTitle??"",type:hn(f.current.metaType??"movie")})},[x,y,m]);const b=c.useCallback(v=>{v.field==="isConnected"&&r(v.value)},[r]);return c.useEffect(()=>{var R,P,O,U;if(!d||!((R=window.cast)!=null&&R.framework)||!((U=(O=(P=window.chrome)==null?void 0:P.cast)==null?void 0:O.media)!=null&&U.DEFAULT_MEDIA_RECEIVER_APP_ID)||!window.chrome.cast.AutoJoinPolicy)return;let v=null,w=null;try{const D=cast.framework.CastContext.getInstance();t(D);const S=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,N=chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED;D.setOptions({receiverApplicationId:S,autoJoinPolicy:N,androidReceiverCompatible:!1,resumeSavedSession:!1}),v=new cast.framework.RemotePlayer,w=new cast.framework.RemotePlayerController(v),n(v),s(w),w.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,b)}catch(D){console.error("Error initializing Chromecast:",D);return}return()=>{w&&w.removeEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,b)}},[d,n,s,t,b]),null}function Fx(){var r,a;const{t}=q(),s=E(o=>o.meta);if(!s)return null;if(s.type!=="show")return e.jsx(dt,{children:e.jsx("title",{children:s.title})});const n=t("media.episodeDisplay",{season:(r=s.season)==null?void 0:r.number,episode:(a=s.episode)==null?void 0:a.number});return e.jsx(dt,{children:e.jsxs("title",{children:[s.title," - ",n]})})}function $x(){const t=Re(""),s=E(_=>_.display),n=E(_=>_.progress),{isSeeking:r}=E(_=>_.interface),a=E(_=>_.mediaPlaying),o=E(_=>_.progress.time),{setVolume:i,toggleMute:l}=rl(),d=kt(_=>_.enabled),{toggleLastUsed:m}=Bn(),u=di(_=>_.setShowVolume),p=Te(_=>_.setDelay),g=Te(_=>_.delay),h=Te(_=>_.setShowDelayIndicator),x=J(_=>_.enableHoldToBoost),[y,f]=c.useState(!1),b=c.useRef(),v=c.useRef(),w=E(_=>_.setSpeedBoosted),R=E(_=>_.setShowSpeedIndicator),P=c.useRef(),O=c.useRef(),U=c.useRef(!1),D=c.useRef(1),S=c.useRef(!1),N=at(_=>_.setCurrentOverlay),C=c.useRef({setShowVolume:u,setVolume:i,toggleMute:l,setIsRolling:f,toggleLastUsed:m,display:s,mediaPlaying:a,mediaProgress:n,isSeeking:r,isRolling:y,time:o,router:t,setDelay:p,delay:g,setShowDelayIndicator:h,setCurrentOverlay:N,isInWatchParty:d,previousRateRef:D,isSpaceHeldRef:S,setSpeedBoosted:w,setShowSpeedIndicator:R,speedIndicatorTimeoutRef:P,boostTimeoutRef:O,isPendingBoostRef:U,enableHoldToBoost:x});return c.useEffect(()=>{C.current={setShowVolume:u,setVolume:i,toggleMute:l,setIsRolling:f,toggleLastUsed:m,display:s,mediaPlaying:a,mediaProgress:n,isSeeking:r,isRolling:y,time:o,router:t,setDelay:p,delay:g,setShowDelayIndicator:h,setCurrentOverlay:N,isInWatchParty:d,previousRateRef:D,isSpaceHeldRef:S,setSpeedBoosted:w,setShowSpeedIndicator:R,speedIndicatorTimeoutRef:P,boostTimeoutRef:O,isPendingBoostRef:U,enableHoldToBoost:x}},[u,i,l,f,m,s,a,n,r,y,o,t,p,g,h,N,d,w,R,x]),c.useEffect(()=>{const _=A=>{var B,W,H,$,K,V,T,X,ae,ce,Q,xe,ee,Pe,Ie,G,oe;if(A.target&&A.target.nodeName==="INPUT")return;const L=A.key,j=A.key.toLowerCase();if(["ArrowUp","ArrowDown","m","M"].includes(L)&&(C.current.setShowVolume(!0),C.current.setCurrentOverlay("volume"),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{C.current.setShowVolume(!1),C.current.setCurrentOverlay(null)},3e3)),L==="ArrowUp"&&C.current.setVolume((((B=C.current.mediaPlaying)==null?void 0:B.volume)||0)+.15),L==="ArrowDown"&&C.current.setVolume((((W=C.current.mediaPlaying)==null?void 0:W.volume)||0)-.15),j==="m"&&C.current.toggleMute(),(L===">"||L==="<")&&!C.current.isInWatchParty){const ie=[.25,.5,1,1.5,2];let de=ie.indexOf((H=C.current.mediaPlaying)==null?void 0:H.playbackRate);de===-1&&(de=ie.indexOf(1));const te=de+(L===">"?1:-1),ne=ie[te];ne&&(($=C.current.display)==null||$.setPlaybackRate(ne))}if(L===" "&&!C.current.isInWatchParty&&C.current.enableHoldToBoost){if(A.target&&A.target.nodeName==="BUTTON")return;if(A.preventDefault(),C.current.mediaPlaying.isPaused){(K=C.current.display)==null||K.play();return}if(C.current.isSpaceHeldRef.current)return;C.current.previousRateRef.current=C.current.mediaPlaying.playbackRate,C.current.isPendingBoostRef.current=!0,C.current.boostTimeoutRef.current&&clearTimeout(C.current.boostTimeoutRef.current),C.current.boostTimeoutRef.current=setTimeout(()=>{var ie;C.current.isPendingBoostRef.current&&(C.current.isSpaceHeldRef.current=!0,C.current.isPendingBoostRef.current=!1,C.current.setSpeedBoosted(!0),C.current.setShowSpeedIndicator(!0),C.current.setCurrentOverlay("speed"),C.current.speedIndicatorTimeoutRef.current&&clearTimeout(C.current.speedIndicatorTimeoutRef.current),(ie=C.current.display)==null||ie.setPlaybackRate(2))},300)}if(L===" "&&(!C.current.enableHoldToBoost||C.current.isInWatchParty)){if(A.target&&A.target.nodeName==="BUTTON")return;A.preventDefault();const ie=C.current.mediaPlaying.isPaused?"play":"pause";(V=C.current.display)==null||V[ie]()}if(L==="ArrowRight"&&((T=C.current.display)==null||T.setTime(C.current.time+5)),L==="ArrowLeft"&&((X=C.current.display)==null||X.setTime(C.current.time-5)),j==="j"&&((ae=C.current.display)==null||ae.setTime(C.current.time-10)),j==="l"&&((ce=C.current.display)==null||ce.setTime(C.current.time+10)),L==="."&&((Q=C.current.mediaPlaying)!=null&&Q.isPaused)&&((xe=C.current.display)==null||xe.setTime(C.current.time+1)),L===","&&((ee=C.current.mediaPlaying)!=null&&ee.isPaused)&&((Pe=C.current.display)==null||Pe.setTime(C.current.time-1)),j==="f"&&((Ie=C.current.display)==null||Ie.toggleFullscreen()),j==="k"&&!C.current.isSpaceHeldRef.current){if(A.target&&A.target.nodeName==="BUTTON")return;const ie=C.current.mediaPlaying.isPaused?"play":"pause";(G=C.current.display)==null||G[ie]()}if(L==="Escape"&&C.current.router.close(),j==="c"&&C.current.toggleLastUsed().catch(()=>{}),j==="r"){if(C.current.isRolling||A.ctrlKey||A.metaKey)return;C.current.setIsRolling(!0),(oe=document.querySelector(".popout-location"))==null||oe.classList.add("roll"),document.body.setAttribute("data-no-scroll","true"),setTimeout(()=>{var ie;(ie=document.querySelector(".popout-location"))==null||ie.classList.remove("roll"),document.body.removeAttribute("data-no-scroll"),C.current.setIsRolling(!1)},1e3)}if(L==="["||L==="]"){const ie=L==="["?-.5:.5;C.current.setDelay(C.current.delay+ie),C.current.setShowDelayIndicator(!0),C.current.setCurrentOverlay("subtitle"),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{C.current.setShowDelayIndicator(!1),C.current.setCurrentOverlay(null)},3e3)}},I=A=>{var j,B;if(A.key===" "&&!C.current.isInWatchParty&&C.current.enableHoldToBoost)if(C.current.isPendingBoostRef.current){C.current.isPendingBoostRef.current=!1,C.current.boostTimeoutRef.current&&clearTimeout(C.current.boostTimeoutRef.current);const W=C.current.mediaPlaying.isPaused?"play":"pause";(j=C.current.display)==null||j[W]()}else C.current.isSpaceHeldRef.current&&((B=C.current.display)==null||B.setPlaybackRate(C.current.previousRateRef.current),C.current.isSpaceHeldRef.current=!1,C.current.setSpeedBoosted(!1),C.current.speedIndicatorTimeoutRef.current&&clearTimeout(C.current.speedIndicatorTimeoutRef.current),C.current.speedIndicatorTimeoutRef.current=setTimeout(()=>{C.current.setShowSpeedIndicator(!1),C.current.setCurrentOverlay(null)},1500))};return window.addEventListener("keydown",_),window.addEventListener("keyup",I),()=>{window.removeEventListener("keydown",_),window.removeEventListener("keyup",I)}},[]),null}function Ux(){var u,p,g,h;const{setDirectMeta:t}=Ws(),s=E(x=>x.setShouldStartFromBeginning),n=E(x=>x.mediaPlaying),r=E(x=>x.progress),a=E(x=>x.meta),o=E(x=>x.display),i=c.useRef(!1),l=c.useRef(0),d=c.useCallback(x=>{var b;const y=(b=a==null?void 0:a.episodes)==null?void 0:b.find(v=>{var w;return v.number===(((w=a==null?void 0:a.episode)==null?void 0:w.number)??0)+x});if(!a||!y)return;const f={...a};f.episode=y,s(!0),t(f)},[a,t,s]),m=c.useCallback(x=>{if(typeof navigator.mediaSession.setPositionState!="function")return;const{duration:y,buffered:f}=r,{playbackRate:b}=n;typeof y!="number"||Number.isNaN(y)||!Number.isFinite(y)||y<=0||((typeof x!="number"||Number.isNaN(x)||x<0)&&(x=0),x>f&&(i.current=!0),x>y&&(x=y),l.current=r.time,navigator.mediaSession.setPositionState({duration:y,playbackRate:b,position:x}))},[n,r]);return c.useEffect(()=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState=n.isPaused?"paused":"playing")},[n.isPaused]),c.useEffect(()=>{"mediaSession"in navigator&&(typeof r.duration!="number"||Number.isNaN(r.duration)||r.duration<=0||m(r.time))},[r.time,n.playbackRate,r.duration,m]),c.useEffect(()=>{if(!("mediaSession"in navigator))return;const{time:x,duration:y}=r,{isLoading:f}=n;typeof y!="number"||Number.isNaN(y)||y<=0||(!i.current&&f&&(i.current=!0),!f&&!i.current&&Math.abs(x-l.current)>=5&&(i.current=!0),i.current&&!f&&(i.current=!1,m(x)),l.current=x)},[n,r,m]),c.useEffect(()=>{var v,w,R,P,O,U;if(!("mediaSession"in navigator)||!n.isLoading&&n.isPlaying&&!o)return;let x,y;(a==null?void 0:a.type)==="movie"?x=a.title:(a==null?void 0:a.type)==="show"&&(y=a.title,x=`S${(v=a.season)==null?void 0:v.number} E${(w=a.episode)==null?void 0:w.number}: ${(R=a.episode)==null?void 0:R.title}`),navigator.mediaSession.metadata=new MediaMetadata({title:x,artist:y,artwork:[{src:(a==null?void 0:a.poster)??"",sizes:"342x513",type:"image/png"}]}),navigator.mediaSession.setActionHandler("play",()=>{n.isLoading||(o==null||o.play(),m(r.time))}),navigator.mediaSession.setActionHandler("pause",()=>{n.isLoading||(o==null||o.pause(),m(r.time))}),navigator.mediaSession.setActionHandler("seekto",D=>{D.seekTime!=null&&(o==null||o.setTime(D.seekTime),m(D.seekTime))}),(((P=a==null?void 0:a.episode)==null?void 0:P.number)??1)>1?navigator.mediaSession.setActionHandler("previoustrack",()=>d(-1)):navigator.mediaSession.setActionHandler("previoustrack",null);const f=((O=a==null?void 0:a.episodes)==null?void 0:O.length)??0,b=((U=a==null?void 0:a.episode)==null?void 0:U.number)??0;b>0&&b<f?navigator.mediaSession.setActionHandler("nexttrack",()=>d(1)):navigator.mediaSession.setActionHandler("nexttrack",null)},[d,m,n.isLoading,n.isPlaying,o,r.duration,r.time,(u=a==null?void 0:a.episode)==null?void 0:u.number,(p=a==null?void 0:a.episodes)==null?void 0:p.length,(g=a==null?void 0:a.episode)==null?void 0:g.title,a==null?void 0:a.title,a==null?void 0:a.type,a==null?void 0:a.poster,(h=a==null?void 0:a.season)==null?void 0:h.number]),null}function Hx(){const t=E(r=>r.meta),s=E(r=>r.progress),n=E(r=>r.mediaPlaying);return c.useEffect(()=>(window.meta||(window.meta={}),t&&(window.meta.player={meta:{title:t.title,type:t.type,tmdbId:t.tmdbId,year:t.releaseYear,poster:t.poster},controls:{isPlaying:n.isPlaying,isLoading:n.isLoading},season:t.season?{number:t.season.number,tmdbId:t.season.tmdbId,title:t.season.title}:void 0,episode:t.episode?{number:t.episode.number,tmdbId:t.episode.tmdbId,title:t.episode.title}:void 0,progress:{time:s.time,duration:s.duration}}),()=>{window.meta&&delete window.meta.player}),[t,s,n]),null}function Vx(){const t=E(l=>l.meta),s=E(l=>l.progress),n=je(l=>l.updateItem),r=E(l=>l.status),a=E(l=>l.mediaPlaying.hasPlayedOnce),o=c.useRef(null),i=c.useRef({updateItem:n,meta:t,progress:s,status:r,hasPlayedOnce:a});return c.useEffect(()=>{i.current.updateItem=n,i.current.meta=t,i.current.progress=s,i.current.status=r,i.current.hasPlayedOnce=a},[n,s,t,r,a]),Sr(()=>{var m,u;const l=i.current;if(!l.progress||!l.meta||!l.updateItem||l.status!==we.PLAYING||!a)return;let d=!1;o.current?(((m=o.current)==null?void 0:m.duration)!==s.duration||((u=o.current)==null?void 0:u.watched)!==s.time)&&(d=!0):d=!0,o.current={duration:s.duration,watched:s.time},d&&l.updateItem({meta:l.meta,progress:o.current})},3e3),null}function Wx(t){const s=[0,1];let n=.5,r=0;for(let a=0;a<t;a+=1){const o=1/n-1;for(let i=0;i<o-r;i+=1){const l=i*n*2;s.push(l+n)}r=o,n/=2}return s}class Kx{constructor(s){this.videoEl=null,this.canvasEl=null,this.hls=null,this.cb=s.addImage,this.interrupted=!1}start(s){if(Ji)return!1;const n=document.createElement("video");n.setAttribute("muted","true");const r=document.createElement("canvas");if(this.hls=new ut,s.type==="mp4")n.src=ds(s.url),n.crossOrigin="anonymous";else if(s.type==="hls")this.hls.attachMedia(n),this.hls.loadSource(ds(s.url));else throw new Error("Invalid loadable source type");this.videoEl=n,this.canvasEl=r,this.begin().catch(a=>console.error(a))}destroy(){var s,n;this.interrupted=!0,this.videoEl=null,this.canvasEl=null,(s=this.hls)==null||s.detachMedia(),(n=this.hls)==null||n.destroy(),this.hls=null}async initVideo(){!this.videoEl||!this.canvasEl||(await new Promise((s,n)=>{var r,a;(r=this.videoEl)==null||r.addEventListener("loadedmetadata",s),(a=this.videoEl)==null||a.addEventListener("error",n)}),!(!this.videoEl||!this.canvasEl)&&(this.canvasEl.height=this.videoEl.videoHeight,this.canvasEl.width=this.videoEl.videoWidth))}async takeSnapshot(s){if(!this.videoEl||!this.canvasEl||(this.videoEl.currentTime=s,await new Promise(a=>{var i;const o=()=>{var l;(l=this.videoEl)==null||l.removeEventListener("seeked",o),a(null)};(i=this.videoEl)==null||i.addEventListener("seeked",o)}),!this.videoEl||!this.canvasEl))return;const n=this.canvasEl.getContext("2d");if(!n)return;n.drawImage(this.videoEl,0,0,this.canvasEl.width,this.canvasEl.height);const r=this.canvasEl.toDataURL();this.interrupted||r==="data:,"||!r||this.cb({at:s,data:r})}async begin(){const s=this.videoEl;if(!s)return;await this.initVideo();const n=Wx(6);for(let r=0;r<n.length;r+=1){if(this.interrupted)return;await this.takeSnapshot(s.duration*n[r])}}}function zx(){var p,g;const t=E(h=>h.thumbnails.addImage),s=E(h=>h.status),n=E(h=>h.thumbnails.resetImages),r=E(h=>h.meta),a=E(h=>h.source),o=J(h=>h.enableThumbnails),i=c.useRef(null),l=JSON.stringify(a),d=c.useCallback(()=>{let h=null;if(a&&(h=hr(a,{automaticQuality:!1,lastChosenQuality:"360"})),i.current||s!==we.PLAYING||!h)return;n();const x=new Kx({addImage:t});i.current=x,x.start(h.stream)},[a,t,n,s]),m=c.useRef(d);c.useEffect(()=>{m.current=d},[d,s]),c.useEffect(()=>{o&&m.current()},[l,o]),c.useEffect(()=>()=>{i.current&&(i.current.destroy(),i.current=null)},[]);const u=JSON.stringify({id:r==null?void 0:r.tmdbId,ep:(p=r==null?void 0:r.episode)==null?void 0:p.tmdbId,se:(g=r==null?void 0:r.season)==null?void 0:g.tmdbId});return c.useEffect(()=>{i.current&&(i.current.destroy(),i.current=null),o&&m.current()},[u,l,s,o]),null}function Gx(t){return e.jsx("div",{className:`pointer-events-none flex h-20 w-20 items-center justify-center rounded-full bg-black bg-opacity-50 text-white ${t.direction==="backward"?"animate-seek-left":"animate-seek-right"}`,children:e.jsx(M,{icon:t.direction==="backward"?k.SKIP_BACKWARD:k.SKIP_FORWARD,className:"text-3xl"})})}function qx(){const t=E(r=>r.display),s=E(r=>r.setDisplay),n=c.useRef(t);c.useEffect(()=>{n.current=t},[t]),c.useEffect(()=>{if(!n.current){const r=ml();n.current=r,s(r)}return()=>{n.current&&(n.current=null,s(null))}},[s])}function hl(){return E(s=>s.status)===we.PLAYING}function Yx(t,s){const n=c.useRef(null),r=c.useMemo(()=>{n.current&&URL.revokeObjectURL(n.current);const a=t();return n.current=a,a},s);return c.useEffect(()=>()=>{n.current&&URL.revokeObjectURL(n.current)},[]),r}const Qx=function(){const s=c.useRef(null),n=c.useRef(null),r=E(m=>m.display),a=E(m=>{var u;return(u=m.caption.selected)==null?void 0:u.srtData}),o=E(m=>m.caption.asTrack),i=E(m=>{var u;return(u=m.caption.selected)==null?void 0:u.language}),l=Yx(()=>a?Of(a):null,[a]);c.useEffect(()=>{r&&s.current&&r.processVideoElement(s.current)},[r,s]),c.useEffect(()=>{n.current&&(n.current.track.mode="showing")},[n]);let d=null;return o&&l&&i&&(d=e.jsx("track",{label:"P-Stream Captions",kind:"subtitles",srcLang:i,src:l,default:!0})),e.jsx("video",{id:"video-element",className:"absolute inset-0 w-full h-screen bg-black",autoPlay:!0,playsInline:!0,ref:s,preload:"metadata",onContextMenu:m=>m.preventDefault(),children:d})},Xx=Qx;function Jx(){const t=hl();return qx(),Uf(),t?e.jsx(Xx,{}):null}function Zx(t){const s=hl(),n=E(V=>V.display),r=E(V=>V.progress.time),a=E(V=>V.mediaPlaying.isPaused),o=E(V=>V.mediaPlaying.playbackRate),i=E(V=>V.updateInterfaceHovering),l=E(V=>V.setSpeedBoosted),d=E(V=>V.setShowSpeedIndicator),m=E(V=>V.interface.hovering),u=at(V=>V.setCurrentOverlay),p=kt(V=>V.enabled),g=J(V=>V.enableHoldToBoost),h=J(V=>V.enableDoubleClickToSeek),[x,y,f]=Zc(()=>{i(it.NOT_HOVERING)},3e3);$o(()=>{y()});const b=c.useRef(o),v=c.useRef(!1),w=c.useRef(null),R=c.useRef(null),[P,O]=c.useState(!1),[U,D]=c.useState(null),[S,N]=c.useState(0),[C,_]=c.useState(!1),I=c.useRef(null),A=c.useRef(null),L=c.useCallback(()=>{n==null||n.toggleFullscreen()},[n]),j=c.useCallback(V=>{if(!h){L();return}const T=V.currentTarget.getBoundingClientRect(),X=V.clientX-T.left,ae=T.width/3;X<ae?(n==null||n.setTime(r-10),D("backward"),N(ce=>ce+1),_(!0)):X>ae*2?(n==null||n.setTime(r+10),D("forward"),N(ce=>ce+1),_(!0)):L()},[n,L,h,r]);c.useEffect(()=>{C&&(I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{_(!1)},400))},[S,C]);const B=c.useCallback(V=>{if(v.current){v.current=!1;return}if(P&&(clearTimeout(R.current),O(!1),v.current=!1),V.pointerType==="mouse"){if(V.button!==0)return;a?n==null||n.play():n==null||n.pause();return}C||(m!==it.MOBILE_TAPPED?(i(it.MOBILE_TAPPED),f()):(i(it.NOT_HOVERING),y()))},[n,a,m,i,f,y,P,C]),W=c.useCallback(V=>{V.pointerType==="mouse"&&V.button!==0||(A.current?(clearTimeout(A.current),A.current=null,j(V)):(h||B(V),A.current=setTimeout(()=>{h&&B(V),A.current=null},250)))},[j,B,h]),H=c.useCallback(V=>{if((V.pointerType==="mouse"&&V.button===0||V.pointerType==="touch")&&!p&&g){if(a)return;b.current=o,R.current&&clearTimeout(R.current),O(!0),R.current=setTimeout(()=>{v.current=!0,O(!1),l(!0),d(!0),u("speed"),w.current&&clearTimeout(w.current),n==null||n.setPlaybackRate(2)},300)}},[n,o,a,l,d,u,p,g]),$=c.useCallback(V=>{if(P){clearTimeout(R.current),O(!1),W(V);return}v.current&&g&&(V.pointerType==="mouse"&&V.button===0||V.pointerType==="touch")?(n==null||n.setPlaybackRate(b.current),v.current=!1,l(!1),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{d(!1),u(null),w.current=null},1500)):W(V)},[n,W,l,d,u,P,g]),K=c.useCallback(()=>{P&&(clearTimeout(R.current),O(!1)),v.current&&(n==null||n.setPlaybackRate(b.current),v.current=!1,l(!1),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{d(!1),u(null),w.current=null},1500))},[n,l,d,u,P]);return s?e.jsxs(e.Fragment,{children:[U?e.jsx("div",{onAnimationEnd:()=>D(null),className:U==="backward"?"absolute inset-0 flex items-center justify-start ml-32":"absolute inset-0 flex items-center justify-end mr-32",children:e.jsx(Gx,{direction:U})},S):null,e.jsx("div",{className:z("absolute inset-0",{"absolute inset-0":!0,"cursor-none":!t.showingControls}),onPointerDown:H,onPointerUp:$,onPointerLeave:K,onContextMenu:V=>V.preventDefault()})]}):null}function eg(){const t=E(a=>a.meta),{disable:s}=kt(),n=c.useRef(null),r=c.useMemo(()=>t?`${t.type}-${t.tmdbId}`:null,[t]);return c.useEffect(()=>{r&&n.current&&r!==n.current&&(console.log("Base media changed, disabling watch party:",{previous:n.current,current:r}),s()),n.current=r},[r,s]),c.useEffect(()=>()=>{console.log("WatchPartyResetter unmounting, disabling watch party"),s()},[]),null}function tg(t=10){const[s,n]=c.useState([]),r=c.useRef(null),a=c.useRef(0),o=E(m=>m.mediaPlaying),i=E(m=>m.progress),l=c.useCallback(()=>{const m=Date.now(),u={isPlaying:o.isPlaying,isPaused:o.isPaused,isLoading:o.isLoading,hasPlayedOnce:o.hasPlayedOnce,volume:o.volume,playbackRate:o.playbackRate,time:i.time,duration:i.duration,buffered:i.buffered,timestamp:m};if(r.current===null)return n([u]),r.current=u,a.current=m,u;const g=r.current,h=m-a.current,x=g.isPlaying!==u.isPlaying||g.isPaused!==u.isPaused||g.isLoading!==u.isLoading,y=g.playbackRate!==u.playbackRate,f=u.isPlaying&&h>=4e3&&Math.abs(g.time-u.time)>1,b=Math.abs(g.duration-u.duration)>1,v=u.isPlaying&&h>=1e4;return(x||y||f||b||v)&&(n(R=>{const P=[...R,u];return P.length>t?P.slice(P.length-t):P}),r.current=u,a.current=m),u},[o,i,t]),d=c.useCallback(()=>{n([]),r.current=null,a.current=0},[]);return c.useEffect(()=>{l();const m=setInterval(()=>{o.hasPlayedOnce&&l()},2e3);return()=>clearInterval(m)},[l,o.hasPlayedOnce]),{statusHistory:s,latestStatus:s.length>0?s[s.length-1]:null,clearHistory:d,forceUpdate:l}}const sg="watchparty:validation",Zs=t=>{window.dispatchEvent(new CustomEvent(sg,{detail:{success:t}}))};function ng(){var y,f,b,v;const{statusHistory:t,latestStatus:s}=tg(5),n=c.useRef(0),r=c.useRef(""),a=c.useRef(!1),o=c.useRef({}),i=be(),l=he(w=>w.account),d=(l==null?void 0:l.userId)||"guest",m=He(),u=E(w=>w.meta),{enabled:p,roomCode:g,isHost:h,disable:x}=kt();return c.useEffect(()=>{p||(a.current=!1,o.current={})},[p]),c.useEffect(()=>{(async()=>{var R,P;if(!(!p||!g||!(u!=null&&u.tmdbId)||h||a.current))try{const O=await Ps(m,l,g),D=Object.values(O.users).flat().find(S=>S.isHost);if(D&&D.content.tmdbId){const S=D.content.tmdbId,N=parseInt(u.tmdbId,10);if(S!==N){console.error("Content mismatch - disconnecting from watch party",{hostContent:S,currentContent:N}),x(),Zs(!1),alert(re("watchParty.contentMismatch"));return}if(u.type==="show"&&D.content.type==="TV Show"){const C=D.content.seasonId,_=D.content.episodeId,I=(R=u.season)!=null&&R.tmdbId?parseInt(u.season.tmdbId,10):void 0,A=(P=u.episode)!=null&&P.tmdbId?parseInt(u.episode.tmdbId,10):void 0;if(C&&_&&(o.current={seasonId:C,episodeId:_}),C&&I&&C!==I||_&&A&&_!==A){console.error("Episode mismatch - disconnecting from watch party",{host:{seasonId:C,episodeId:_},current:{seasonId:I,episodeId:A}}),x(),Zs(!1),alert(re("watchParty.episodeMismatch"));return}}}a.current=!0,Zs(!0)}catch(O){console.error("Failed to validate watch party content:",O),x(),Zs(!1)}})()},[p,g,u==null?void 0:u.tmdbId,(y=u==null?void 0:u.season)==null?void 0:y.tmdbId,(f=u==null?void 0:u.episode)==null?void 0:f.tmdbId,u==null?void 0:u.type,h,m,l,x]),c.useEffect(()=>{if(!p||!g||h||!(u!=null&&u.tmdbId)||u.type!=="show")return;const w=async()=>{var P,O;try{const U=await Ps(m,l,g),S=Object.values(U.users).flat().find(I=>I.isHost);if(!S||S.content.type!=="TV Show")return;const N=S.content.seasonId,C=S.content.episodeId;if(!o.current.seasonId&&!o.current.episodeId){o.current={seasonId:N,episodeId:C};return}if((N!==o.current.seasonId||C!==o.current.episodeId)&&N&&C){o.current={seasonId:N,episodeId:C};const I=(P=u.season)!=null&&P.tmdbId?parseInt(u.season.tmdbId,10):void 0,A=(O=u.episode)!=null&&O.tmdbId?parseInt(u.episode.tmdbId,10):void 0;if(I===N&&A===C)return;console.log("Host changed episode, following to new episode:",{seasonId:N,episodeId:C});const L=new URL(`/media/tmdb-tv-${u.tmdbId}/${N}/${C}`,window.location.origin);L.searchParams.set("watchparty",g),a.current=!1,i(L.pathname+L.search)}}catch(U){console.error("Failed to check for episode change:",U)}},R=setInterval(w,1500);return w(),()=>clearInterval(R)},[p,g,h,u==null?void 0:u.tmdbId,(b=u==null?void 0:u.season)==null?void 0:b.tmdbId,(v=u==null?void 0:u.episode)==null?void 0:v.tmdbId,u==null?void 0:u.type,m,l,i]),c.useEffect(()=>{var C;if(!p||!s||!s.hasPlayedOnce||!g||!h&&!a.current)return;const w=Date.now(),R=JSON.stringify({isPlaying:s.isPlaying,isPaused:s.isPaused,isLoading:s.isLoading,time:Math.floor(s.time),playbackRate:s.playbackRate}),P=R!==r.current,O=w-n.current>=2e3,U=h&&w-n.current>=500;if(!P&&!O&&!U)return;let D="Unknown content",S="Unknown";u&&(u.type==="movie"?(D=u.title,S="Movie"):u.type==="show"&&u.episode&&(D=`${u.title} - S${((C=u.season)==null?void 0:C.number)||0}E${u.episode.number||0}`,S="TV Show")),(async()=>{var _,I,A,L;try{await Ym(m,l,{userId:d,roomCode:g,isHost:h,content:{title:D,type:S,tmdbId:u!=null&&u.tmdbId?Number(u.tmdbId):0,seasonId:(_=u==null?void 0:u.season)!=null&&_.tmdbId?Number(u.season.tmdbId):void 0,episodeId:(I=u==null?void 0:u.episode)!=null&&I.tmdbId?Number(u.episode.tmdbId):void 0,seasonNumber:(A=u==null?void 0:u.season)==null?void 0:A.number,episodeNumber:(L=u==null?void 0:u.episode)==null?void 0:L.number},player:{isPlaying:s.isPlaying,isPaused:s.isPaused,isLoading:s.isLoading,hasPlayedOnce:s.hasPlayedOnce,time:s.time,duration:s.duration,playbackRate:s.playbackRate,buffered:s.buffered}}),n.current=w,r.current=R,console.log("Sent player status update to backend",{time:new Date().toISOString(),isPlaying:s.isPlaying,currentTime:Math.floor(s.time),userId:d,content:D,roomCode:g})}catch(j){console.error("Failed to send player status to backend",j)}})()},[s,t.length,d,l,u,p,g,h,m]),null}function rg(t){const s=c.useRef(null),n=E(a=>a.updateInterfaceHovering),r=E(a=>a.interface.hovering);c.useEffect(()=>{if(!t.current)return;const a=t.current;function o(l){l.pointerType==="mouse"&&(n(it.MOUSE_HOVER),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{n(it.NOT_HOVERING),s.current=null},3e3))}function i(l){l.pointerType==="mouse"&&(n(it.NOT_HOVERING),s.current&&clearTimeout(s.current))}return a.addEventListener("pointermove",o),a.addEventListener("pointerleave",i),()=>{a.removeEventListener("pointermove",o),a.removeEventListener("pointerleave",i)}},[t,r,n])}function ag(t){const s=c.useRef(null),n=E(r=>r.display);return rg(s),c.useEffect(()=>{n&&s.current&&n.processContainerElement(s.current)},[n,s]),e.jsx("div",{ref:s,children:e.jsx(vm,{children:e.jsx("div",{className:"h-screen select-none",children:t.children})})})}function og(t){const s=c.useRef(t.onLoad);return c.useEffect(()=>{var n;(n=s.current)==null||n.call(s)},[]),e.jsx("div",{className:"relative",children:e.jsxs(ag,{children:[e.jsx(Hx,{}),e.jsx(zx,{}),e.jsx(Bx,{}),e.jsx(Jx,{}),e.jsx(Vx,{}),e.jsx($x,{}),e.jsx(Ux,{}),e.jsx(ng,{}),e.jsx(Sx,{}),e.jsx(eg,{}),e.jsxs("div",{className:"relative h-screen overflow-hidden",children:[e.jsx(Zx,{showingControls:t.showingControls}),e.jsx(Fx,{}),t.children]})]})})}const ig=function(s){const[n]=mh(s.id),r=Qe(i=>i.hideBanner),a={error:"bg-[#C93957] text-white",info:"bg-[#126FD3] text-white"},o={error:k.CIRCLE_EXCLAMATION,info:k.CIRCLE_EXCLAMATION};return c.useEffect(()=>{sessionStorage.getItem(`hideBanner-${s.id}`)&&r(s.id,!0)},[r,s.id]),e.jsx("div",{ref:n,children:e.jsxs("div",{className:[a[s.type],"flex items-center justify-center p-1"].join(" "),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{icon:o[s.type]}),e.jsx("div",{children:s.children})]}),e.jsx("span",{className:"absolute right-4 hover:cursor-pointer",onClick:()=>{r(s.id,!0),sessionStorage.setItem(`hideBanner-${s.id}`,"true")},children:e.jsx(M,{icon:k.X})})]})})},eo=ig;function fl(t){const{t:s}=q(),n=Qe(h=>h.isOnline),r=Qe(h=>h.setLocation),a=Qe(h=>h.ignoredBannerIds),o=Qe(h=>h.location),i=Qe(h=>h.banners),l=Qe(h=>h.showBanner),d=t.location??null;if(c.useEffect(()=>{if(d)return r(d),()=>{r(null)}},[r,d]),c.useEffect(()=>{const h=le(),x=h.BANNER_MESSAGE,y=h.BANNER_ID||"custom-message";x&&d===null&&l(y)},[d,l]),o!==d)return null;const m=le(),u=m.BANNER_MESSAGE,p=m.BANNER_ID||"custom-message",g=i.some(h=>h.id===p);return e.jsxs("div",{children:[!n&&!a.includes("offline")?e.jsx(eo,{id:"offline",type:"error",children:s("navigation.banner.offline")}):null,g&&u?e.jsx(eo,{id:p,type:"info",children:u}):null]})}function lg(t){const s=Mn("player"),n=E(r=>r.setHoveringAnyControls);return c.useEffect(()=>()=>{n(!1)},[n]),e.jsxs("div",{className:"w-full text-white",children:[e.jsx(Se,{animation:"fade",show:t.show,style:{top:`${s}px`},className:"pointer-events-none flex justify-end pb-32 bg-gradient-to-b from-black to-transparent [margin-bottom:env(safe-area-inset-bottom)] transition-opacity duration-200 absolute top-0 w-full"}),e.jsx("div",{className:"relative z-10",children:e.jsx(fl,{location:"player"})}),e.jsx("div",{onMouseOver:()=>n(!0),onMouseOut:()=>n(!1),className:"pointer-events-auto pl-[calc(2rem+env(safe-area-inset-left))] pr-[calc(2rem+env(safe-area-inset-right))] pt-6 absolute top-0 w-full",style:{top:`${s}px`},children:e.jsx(Se,{animation:"slide-down",show:t.show,className:"top-content text-white",children:t.children})})]})}function cg(t){return e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none [&>*]:pointer-events-auto",children:t.children})}function dg(t){const s=E(n=>n.setHoveringAnyControls);return c.useEffect(()=>()=>{s(!1)},[s]),e.jsxs("div",{className:"w-full text-white",children:[e.jsx(Se,{animation:"fade",show:t.show,className:"pointer-events-none flex justify-end pt-32 bg-gradient-to-t from-black to-transparent transition-opacity duration-200 absolute bottom-0 w-full"}),e.jsx("div",{onMouseOver:()=>s(!0),onMouseOut:()=>s(!1),className:"pointer-events-auto z-10 pl-[calc(2rem+env(safe-area-inset-left))] pr-[calc(2rem+env(safe-area-inset-right))] pb-3 mb-[env(safe-area-inset-bottom)] absolute bottom-0 w-full",children:e.jsx(Se,{animation:"slide-up",show:t.show,children:t.children})})]})}function ug(t){return e.jsx(Se,{animation:"fade",show:t.show,className:"absolute inset-0 w-full h-full bg-black bg-opacity-20 pointer-events-none"})}function mg(t){const{t:s}=q();return e.jsx("div",{className:"flex items-center",children:e.jsxs(vt,{to:t.url,className:"py-1 -my-1 px-2 -mx-2 tabbable rounded-lg flex items-center cursor-pointer text-type-secondary hover:text-white transition-colors duration-200 font-medium",children:[e.jsx(M,{className:"mr-2",icon:k.ARROW_LEFT}),e.jsx("span",{className:"md:hidden",children:s("player.back.short")}),e.jsx("span",{className:"hidden md:block",children:s("player.back.default")})]})})}function hg(t){const s=E(r=>r.setHoveringLeftControls),n=c.useCallback(()=>{s(!1)},[s]);return c.useEffect(()=>()=>{s(!1)},[s]),e.jsx("div",{className:z(["flex space-x-3 items-center",t.className]),onMouseLeave:n,children:t.children})}function fg(t){return e.jsx(Se,{animation:"fade",show:t.show,className:"pointer-events-none",children:e.jsx("div",{className:z(["absolute inset-0 flex space-x-6 items-center justify-center pointer-events-none [&>*]:pointer-events-auto",t.className]),children:t.children})})}const pg={i:"I"};function xg({text:t,styling:s,overrideCasing:n}){const r=c.useMemo(()=>{let i=t;n&&t&&(i=t.slice(0,1)+t.slice(1).toLowerCase());const l=(i||"").split(" ").map(m=>pg[m]??m).join(" ").replaceAll(/ i'/g," I'").replaceAll(/\r?\n/g,"<br />");return Lf(l,{ALLOWED_TAGS:["c","b","i","u","span","ruby","rt","br"],ADD_TAGS:["v","lang"],ALLOWED_ATTR:["title","lang"]})},[t,n]),o=(()=>{switch(s.fontStyle){case"raised":return{textShadow:"0 2px 0 rgba(0,0,0,0.8), 0 1.5px 1.5px rgba(0,0,0,0.9)"};case"depressed":return{textShadow:"0 -2px 0 rgba(0,0,0,0.8), 0 -1.5px 1.5px rgba(0,0,0,0.9)"};case"uniform":return{textShadow:"1.5px 1.5px 1.5px rgba(0,0,0,0.8), -1.5px -1.5px 1.5px rgba(0,0,0,0.8), 1.5px -1.5px 1.5px rgba(0,0,0,0.8), -1.5px 1.5px 1.5px rgba(0,0,0,0.8)"};case"dropShadow":return{textShadow:"2.5px 2.5px 4.5px rgba(0,0,0,0.9)"};case"default":default:return{textShadow:"0 2px 4px rgba(0,0,0,0.5)"}}})();return e.jsx("p",{className:"mb-1 rounded px-4 py-1 text-center leading-normal",style:{color:s.color,fontSize:`${(1.5*s.size).toFixed(2)}em`,backgroundColor:`rgba(0,0,0,${s.backgroundOpacity.toFixed(2)})`,backdropFilter:s.backgroundBlur!==0?`blur(${Math.floor(s.backgroundBlur*64)}px)`:"none",fontWeight:s.bold?"bold":"normal",...o},children:e.jsx("span",{dangerouslySetInnerHTML:{__html:r},dir:"ltr"})})}function gg(){const t=E(d=>d.progress.time),s=E(d=>{var m;return(m=d.caption.selected)==null?void 0:m.srtData}),n=E(d=>{var m;return(m=d.caption.selected)==null?void 0:m.language}),r=Te(d=>d.styling),a=Te(d=>d.overrideCasing),o=Te(d=>d.delay),i=c.useMemo(()=>s?qi(s):[],[s,n]),l=c.useMemo(()=>i.filter(({start:d,end:m})=>Wi(d,m,o,t)),[i,t,o]);return e.jsx("div",{children:l.map(({start:d,end:m,content:u},p)=>e.jsx(xg,{text:u,styling:r,overrideCasing:a},Df(p,d,m)))})}function bg(t){const s=E(i=>i.caption.selected),n=E(i=>i.caption.asTrack),r=E(i=>i.display),a=(r==null?void 0:r.getType())==="casting",o=Te(i=>i.styling);return n||!s||a?null:e.jsx(Se,{animation:"slide-up",show:!0,children:e.jsx("div",{className:"text-white absolute w-full flex flex-col items-center transition-[bottom]",style:{bottom:t.controlsShown?"6rem":`${o.verticalPosition}rem`},children:e.jsx(gg,{})})})}function yg(){const t=me(i=>i.addBookmark),s=me(i=>i.removeBookmark),n=me(i=>i.bookmarks),r=E(i=>i.meta),a=!!n[(r==null?void 0:r.tmdbId)??""],o=c.useCallback(()=>{r&&(a?s(r.tmdbId):t(r))},[a,r,t,s]);return e.jsx(qe,{onClick:()=>o(),icon:a?k.BOOKMARK:k.BOOKMARK_OUTLINE,iconSizeClass:"text-base",className:"p-2"})}function vg(){const t=E(l=>l.meta),s=Ke("player-details"),n=E(l=>l.setHasOpenOverlay),[r,a]=c.useState(null);c.useEffect(()=>{n(s.isShown)},[n,s.isShown]);const o=async()=>{t!=null&&t.tmdbId&&(a({id:Number(t.tmdbId),type:t.type==="movie"?"movie":"show"}),s.show())};return J(l=>l.enableLowPerformanceMode)?null:e.jsxs(e.Fragment,{children:[e.jsx(qe,{icon:k.CIRCLE_QUESTION,iconSizeClass:"text-base",className:"p-2 !-mr-2",onClick:o}),r&&e.jsx(_t,{id:"player-details",data:r,minimal:!0})]})}function wg(t){var l;const s=E(d=>d.meta),{setDirectMeta:n}=Ws(),r=E(d=>d.setShouldStartFromBeginning),a=je(d=>d.updateItem),o=(l=s==null?void 0:s.episodes)==null?void 0:l.find(d=>{var m;return d.number===(((m=s==null?void 0:s.episode)==null?void 0:m.number)??0)+1}),i=c.useCallback(()=>{var u;if(!s||!o)return;const d={...s};d.episode=o,r(!0),n(d),(u=t.onChange)==null||u.call(t,d),a({meta:d,progress:{duration:0,watched:0}})},[n,o,s,t,r,a]);return!t.inControl||!(s!=null&&s.episode)||!o||s.type!=="show"?null:e.jsx(qe,{onClick:()=>i(),icon:k.SKIP_EPISODE,iconSizeClass:"text-xl",className:"hover:bg-video-buttonBackground hover:bg-opacity-50"})}function jg(t,s){return typeof s!="number"?"none":t>=0&&t<s?t<=10?"always":"hover":"none"}function kg(t){return e.jsx("button",{className:z("font-bold rounded h-10 w-40 scale-95 hover:scale-100 transition-all duration-200",t.className),type:"button",onClick:t.onClick,children:t.children})}function Ng(t){const s=E(m=>m.progress.time),n=E(m=>m.status),r=E(m=>m.display),a=jg(s,t.skipTime),o=a==="hover"?"slide-up":"fade";let i="bottom-[calc(6rem+env(safe-area-inset-bottom))]";a==="always"&&(i=t.controlsShowing?i:"bottom-[calc(3rem+env(safe-area-inset-bottom))]");const l=c.useCallback(()=>{typeof t.skipTime=="number"&&r&&r.setTime(t.skipTime)},[t.skipTime,r]);if(!t.inControl)return null;let d=!1;return(a==="always"||a==="hover"&&t.controlsShowing)&&(d=!0),n!=="playing"&&(d=!1),e.jsx(Se,{animation:o,show:d,className:"absolute right-[calc(3rem+env(safe-area-inset-right))] bottom-0",children:e.jsx("div",{className:z(["absolute bottom-0 right-0 transition-[bottom] duration-200 flex items-center space-x-3",i]),children:e.jsxs(kg,{onClick:l,className:"bg-buttons-primary hover:bg-buttons-primaryHover text-buttons-primaryText flex justify-center items-center",children:[e.jsx(M,{className:"text-xl mr-1",icon:k.SKIP_EPISODE}),"Skip Intro"]})})})}function Sg(){var r;const{t}=q(),s=E(a=>a.meta);return E(a=>a.status)!=="scraping"||!((r=s==null?void 0:s.episode)!=null&&r.air_date)||Ct(s.episode.air_date)?null:e.jsx(Se,{animation:"slide-down",show:!0,className:"absolute inset-x-0 top-4 flex justify-center pointer-events-none",children:e.jsxs(fe.Base,{className:"hover:flare-enabled pointer-events-auto bg-video-context-background pl-4 pr-6 py-3 group w-72 h-full rounded-lg transition-colors text-video-context-type-main",children:[e.jsx(fe.Light,{enabled:!0,flareSize:200,cssColorVar:"--colors-video-context-light",backgroundClass:"bg-video-context-background duration-100",className:"rounded-lg"}),e.jsxs(fe.Child,{className:"grid grid-cols-[auto,1fr] gap-3 pointer-events-auto relative transition-transform",children:[e.jsx(M,{className:"text-2xl",icon:k.FILM}),e.jsx("div",{className:"w-full flex items-center justify-between",children:e.jsxs("span",{className:"text-sm",children:[t("media.unreleased")," -"," ",new Date(s.episode.air_date).toLocaleDateString()]})})]})]})})}function Cg(){const{t}=q(),{enabled:s,roomCode:n,isHost:r,showStatusOverlay:a}=kt(),[o,i]=c.useState(!1),[l,d]=c.useState(!1),[m,u]=c.useState(1),{roomUsers:p,hostUser:g,isBehindHost:h,isAheadOfHost:x,timeDifferenceFromHost:y,syncWithHost:f,isSyncing:b,userCount:v}=cl();if(c.useEffect(()=>{if(v>m){d(!0);const R=setTimeout(()=>d(!1),3e3);return()=>clearTimeout(R)}u(v)},[v,m]),!s||!n||!a)return null;const w=()=>{i(!o)};return e.jsxs("div",{className:`absolute top-4 right-4 z-50 p-2 bg-mediaCard-shadow bg-opacity-70 backdrop-blur-sm rounded-md text-white text-xs 
        flex flex-col items-end gap-1 max-w-[260px] transition-all duration-300
        ${l?"ring-1 ring-buttons-purple shadow-lg shadow-buttons-purple":""}`,children:[e.jsxs("div",{className:"flex gap-2 w-full justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{icon:k.WATCH_PARTY,className:"w-4 h-4"}),e.jsx("span",{className:"font-bold pr-1",children:t(r?"watchParty.hosting":"watchParty.watching")})]}),e.jsx("span",{className:"text-type-logo font-mono tracking-wider",children:n})]}),e.jsxs("div",{className:"w-full text-type-secondary flex justify-between items-center space-x-2",children:[e.jsx("div",{className:"cursor-pointer",onClick:w,children:e.jsx(M,{icon:o?k.CHEVRON_DOWN:k.CHEVRON_RIGHT,className:"w-3 h-3"})}),e.jsx("span",{children:p.length<=1?t("watchParty.alone"):t("watchParty.withCount",{count:p.length-1})}),!r&&g&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${h||x?"bg-red-500":"bg-green-500"}`}),e.jsx("span",{className:"text-xs",children:t(h||x?"watchParty.status.outOfSync":"watchParty.status.inSync")})]})]}),o&&p.length>1&&e.jsxs("div",{className:"w-full mt-1 border-t border-mediaCard-hoverBackground pt-1",children:[e.jsx("div",{className:"text-xs text-type-secondary mb-1",children:"Viewers:"}),e.jsx("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:p.map(R=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{icon:R.isHost?k.RISING_STAR:k.USER,className:`w-3 h-3 ${R.isHost?"text-onboarding-best":""}`}),e.jsxs("span",{className:R.isHost?"text-onboarding-best":"",children:[R.userId.substring(0,8),"..."]})]}),e.jsx("span",{className:"text-type-secondary",children:R.player.duration>0?`${Math.floor(R.player.time/R.player.duration*100)}%`:`${Math.floor(R.player.time)}s`})]},R.userId))})]}),!r&&g&&(h||x)&&e.jsx("div",{className:"mt-1 w-full",children:e.jsxs(Z,{theme:"secondary",className:"text-xs py-1 px-2 bg-buttons-purple bg-opacity-50 hover:bg-buttons-purpleHover hover:bg-opacity-80 w-full flex items-center justify-center gap-1",onClick:f,disabled:b,children:[e.jsx(M,{icon:k.CLOCK,className:"w-3 h-3"}),e.jsx("span",{className:"whitespace-nowrap",children:b?t("watchParty.syncing"):h?t("watchParty.behindHost",{seconds:Math.abs(Math.round(y))}):t("watchParty.aheadOfHost",{seconds:Math.round(y)})})]})})]})}function to(){const[t,s]=c.useState(!1);return e.jsx(qe,{icon:t?k.SHRINK:k.STRETCH,className:"text-white",onClick:()=>{const n=document.getElementById("video-element");n&&(n.classList.toggle("object-cover"),s(!t))}})}function Eg(){const t=E(u=>u.interface.hovering),s=E(u=>u.interface.lastHoveringState),n=E(u=>u.mediaPlaying.isPaused),r=E(u=>u.interface.hasOpenOverlay),a=E(u=>u.interface.isHoveringControls),o=s===it.MOBILE_TAPPED,l=t!==it.NOT_HOVERING||a&&!o||r,m=o?l:l||n;return{showTouchTargets:o&&m,showTargets:m}}const Ig="https://fed-skips.pstream.mov",Tg=3;function Rg(){var a,o;const{playerMeta:t}=Ws(),[s,n]=c.useState(null),r=J(i=>i.febboxKey);return c.useEffect(()=>{const i=async(l=0)=>{var d,m;if(!(!(t!=null&&t.imdbId)||t.type==="movie")&&le().ALLOW_FEBBOX_KEY&&r)try{const u=`${Ig}/${t.imdbId}/${(d=t.season)==null?void 0:d.number}/${(m=t.episode)==null?void 0:m.number}`,p=await fetch(u);if(!p.ok){if(p.status===500&&l<Tg)return i(l+1);throw new Error("API request failed")}const g=await p.json(),x=(y=>{if(!y||typeof y!="string")return null;const f=y.match(/^(\d+)s$/);return f?parseInt(f[1],10):null})(g.introSkipTime);console.log("Skip time:",x),n(x)}catch(u){console.error("Error fetching skip time:",u),n(null)}};i()},[t==null?void 0:t.tmdbId,t==null?void 0:t.imdbId,t==null?void 0:t.type,(a=t==null?void 0:t.season)==null?void 0:a.number,(o=t==null?void 0:t.episode)==null?void 0:o.number,r]),s}function so(t){return t.type==="loading"}function qr(t){const[s]=ko(()=>({percentage:so(t)?t.percentage:0}),[t]);return e.jsxs("div",{className:z({"p-0.5 border-current border-[3px] rounded-full h-6 w-6 relative transition-colors":!0,"text-video-scraping-loading":t.type==="loading","text-video-scraping-noresult text-opacity-50":t.type==="waiting","text-video-scraping-error bg-video-scraping-error":t.type==="error","text-green-500 bg-green-500":t.type==="success","text-video-scraping-noresult bg-video-scraping-noresult":t.type==="noresult"},t.className),children:[e.jsx(Se,{animation:"fade",show:so(t),children:e.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 64 64",xmlns:"http://www.w3.org/2000/svg",className:"rounded-full -rotate-90",children:e.jsx(Fo.circle,{strokeWidth:"32",strokeDasharray:Vl(s.percentage,n=>`${n} 100`),r:"25%",cx:"50%",cy:"50%",fill:"transparent",stroke:"currentColor",className:"transition-[strokeDasharray]"})})}),e.jsx(Se,{animation:"fade",show:t.type==="error",children:e.jsx(M,{className:"absolute inset-0 flex items-center justify-center text-background-main",icon:k.X})}),e.jsx(Se,{animation:"fade",show:t.type==="success",children:e.jsx(M,{className:"absolute inset-0 flex items-center text-sm justify-center text-background-main",icon:k.CHECKMARK})}),e.jsx(Se,{animation:"fade",show:t.type==="noresult",children:e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"h-[3px] flex-1 mx-1 rounded-full bg-background-main"})})})]})}const Pg={notfound:"player.scraping.items.notFound",failure:"player.scraping.items.failure",pending:"player.scraping.items.pending"},Lg={failure:"error",notfound:"noresult",pending:"loading",success:"success",waiting:"waiting"};function pl(t){const{t:s}=q(),n=Pg[t.status],r=Lg[t.status];return e.jsxs("div",{className:"grid gap-4 grid-cols-[auto,1fr]","data-source-id":t.id,children:[e.jsx(qr,{type:r,percentage:t.percentage??0}),e.jsxs("div",{children:[e.jsx("p",{className:r==="loading"?"text-white":"text-type-secondary",children:t.name}),e.jsx(Se,{animation:"fade",show:!!n,children:e.jsx("p",{className:"text-[15px] mt-1",children:n?s(n):""})}),t.children]})]})}function Dg(t){return e.jsx("div",{"data-source-id":t.id,className:"w-80 mb-6",children:e.jsx("div",{className:z({"!bg-opacity-100 py-6":t.hasChildren,"w-80 rounded-md px-6 bg-video-scraping-card bg-opacity-0":!0}),children:e.jsx(pl,{...t})})})}function Ag(){const[t,s]=c.useState({}),[n,r]=c.useState([]),[a,o]=c.useState(),i=c.useRef(null),l=c.useCallback(h=>{s(h.sourceIds.map(x=>{const y=Ut().find(b=>b.id===x);if(!y)throw new Error("invalid source id");return{name:y.name,id:y.id,status:"waiting",percentage:0}}).reduce((x,y)=>(x[y.id]=y,x),{})),r(h.sourceIds.map(x=>({id:x,children:[]})))},[]),d=c.useCallback(h=>{const x=i.current;s(y=>(y[h]&&(y[h].status="pending"),x&&y[x]&&y[x].status==="pending"&&(y[x].status="success"),{...y})),o(h),i.current=h},[]),m=c.useCallback(h=>{s(x=>(x[h.id]&&(x[h.id].status=h.status,x[h.id].reason=h.reason,x[h.id].error=h.error,x[h.id].percentage=h.percentage),{...x}))},[]),u=c.useCallback(h=>{s(x=>(h.embeds.forEach(y=>{const f=Ut().find(v=>v.id===y.embedScraperId);if(!f)throw new Error("invalid source id");const b={embedId:y.embedScraperId,name:f.name,id:y.id,status:"waiting",percentage:0};x[y.id]=b}),{...x})),r(x=>{const y=x.find(f=>f.id===h.sourceId);if(!y)throw new Error("invalid source id");return y.children=h.embeds.map(f=>f.id),[...x]})},[]),p=c.useCallback(()=>{i.current=null},[]),g=c.useCallback(h=>(h&&i.current&&s(x=>i.current?(x[i.current]&&(x[i.current].status="success"),{...x}):x),h),[]);return{initEvent:l,startEvent:d,updateEvent:m,discoverEmbedsEvent:u,startScrape:p,getResult:g,sources:t,sourceOrder:n,currentSource:a}}function Mg(){const{sources:t,sourceOrder:s,currentSource:n,updateEvent:r,discoverEmbedsEvent:a,initEvent:o,getResult:i,startEvent:l,startScrape:d}=Ag(),m=J(f=>f.sourceOrder),u=J(f=>f.enableSourceOrder),p=J(f=>f.disabledSources),g=J(f=>f.embedOrder),h=J(f=>f.enableEmbedOrder),x=J(f=>f.disabledEmbeds);return{startScraping:c.useCallback(async f=>{const b=u?m.filter(O=>!p.includes(O)):void 0,v=h?g.filter(O=>!x.includes(O)):void 0,w=Ar();if(w&&!Xe()){d();const O=dn(w),U=await un(O.scrapeAll(f,b,v),["completed","noOutput"]);U.on("init",o),U.on("start",l),U.on("update",r),U.on("discoverEmbeds",a);const D=await U.promise();return D&&Xe()&&await Ms(D.stream),i(D===""?null:D)}d();const P=await Ls().runAll({media:f,sourceOrder:b,embedOrder:v,events:{init:o,start:l,update:r,discoverEmbeds:a}});return P&&Xe()&&await Ms(P.stream),i(P)},[o,l,r,a,i,d,m,u,p,g,h,x]),sourceOrder:s,sources:t,currentSource:n}}function _g(t,s,n,r){const[a,o]=c.useState(!1),i=c.useCallback(()=>{if(!t.current||!s.current)return;const d=[...s.current.querySelectorAll("div[data-source-id]")],m=d.findIndex(R=>R.getAttribute("data-source-id")===r),u=d[m];if(!u)return;const p=t.current.getBoundingClientRect().width,g=s.current.getBoundingClientRect().width,h=t.current.getBoundingClientRect().height,x=s.current.getBoundingClientRect().top,y=u.getBoundingClientRect().top,f=u.getBoundingClientRect().height,b=y-x,v=p/2-g/2,w=h/2-b-f/2;s.current.style.transform=`translateY(${w}px) translateX(${v}px)`,setTimeout(()=>{o(!0)},150)},[r,t,s,o]),l=c.useRef(i);return c.useEffect(()=>{i(),l.current=i},[i,n]),c.useEffect(()=>{function d(){l.current()}return window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}},[]),a}function Og(t){return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen text-center font-medium",children:[e.jsx(bs,{}),e.jsx(M,{className:"text-type-danger text-2xl",icon:k.WARNING}),e.jsx("div",{className:"max-w-[19rem] mt-3 mb-12 text-type-secondary",children:t.children})]})}function tv(t){const{report:s}=Rr(),{startScraping:n,sourceOrder:r,sources:a,currentSource:o}=Mg(),i=Uo(),{t:l}=q(),d=c.useRef(null),m=c.useRef(null),[u,p]=c.useState(!1),g=_g(d,m,r,o),h=c.useRef({sourceOrder:r,sources:a});c.useEffect(()=>{h.current={sourceOrder:r,sources:a}},[r,a]);const x=c.useRef(!1);c.useEffect(()=>{x.current||(x.current=!0,(async()=>{var b,v;const f=await n(t.media);i()&&((b=t.onResult)==null||b.call(t,h.current.sources,h.current.sourceOrder),s(lu(t.media,h.current.sourceOrder,h.current.sources)),(v=t.onGetStream)==null||v.call(t,f))})().catch(()=>p(!0)))},[n,t,s,i]);let y=r.findIndex(f=>f.id===o||f.children.includes(o??""));return y===-1&&(y=r.length-1),u?e.jsx(Og,{children:l("player.turnstile.error")}):e.jsxs("div",{className:"h-full w-full relative dir-neutral:origin-top-left flex",ref:d,children:[!r||r.length===0?e.jsxs("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center flex flex-col justify-center z-0",children:[e.jsx(At,{className:"mb-8"}),e.jsx("p",{children:l("player.turnstile.verifyingHumanity")})]}):null,e.jsx("div",{className:z({"absolute transition-[transform,opacity] opacity-0 dir-neutral:left-0":!0,"!opacity-100":g}),ref:m,children:r.map(f=>{const b=a[f.id],v=Math.abs(r.findIndex(w=>w.id===f.id)-y);return e.jsx("div",{className:"transition-opacity duration-100",style:{opacity:Math.max(0,1-v*.3)},children:e.jsx(Dg,{id:f.id,name:b.name,status:b.status,hasChildren:f.children.length>0,percentage:b.percentage,children:e.jsx("div",{className:z({"space-y-6 mt-8":f.children.length>0}),children:f.children.map(w=>{const R=a[w];return e.jsx(pl,{id:w,name:R.name,status:R.status,percentage:R.percentage},w)})})})},f.id)})})]})}function Bg(){const{t}=q();return e.jsxs("div",{className:"flex gap-3 pb-3",children:[e.jsx(Z,{href:"/",theme:"secondary",padding:"md:px-17 p-3",className:"mt-6",children:t("notFound.goHome")}),e.jsx(Z,{onClick:()=>window.location.reload(),theme:"purple",padding:"md:px-17 p-3",className:"mt-6",children:t("notFound.reloadButton")})]})}function Fg(){const{t}=q(),[s]=c.useState(()=>{const n=Math.floor(Math.random()*21)+1;return t(`player.scraping.tips.${n}`)});return e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("p",{className:"text-type-secondary text-center text-sm text-bold",children:["Tip: ",s]})})}function $g(t){const{showTargets:s,showTouchTargets:n}=Eg(),r=E(R=>R.status),{isMobile:a}=jt(),o=J(R=>R.manualSourceSelection),i=E(R=>R.mediaPlaying.isLoading),{isHost:l,enabled:d}=kt(),m=!d||l,u=/iPad|iPhone|iPod/.test(navigator.userAgent),p=window.matchMedia("(display-mode: standalone)").matches,[g,h]=c.useState(!1),[x,y]=c.useState(!1),f=c.useRef(null);document.addEventListener("keydown",R=>{R.key==="Shift"&&h(!0)}),document.addEventListener("keyup",R=>{R.key==="Shift"&&h(!1)});const b=()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{y(!0)},100)},v=()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{y(!1)},1e3)},w=Rg();return e.jsxs(og,{onLoad:t.onLoad,showingControls:s,children:[t.children,e.jsx(ug,{show:s&&r===we.PLAYING}),e.jsx(px,{onChange:t.onMetaChange}),e.jsx(cx,{}),e.jsx(bg,{controlsShown:s}),r===we.PLAYING?e.jsxs(cg,{children:[e.jsx(Jf,{}),e.jsx(Zf,{}),e.jsx(jx,{})]}):null,e.jsxs(fg,{className:"text-white",show:n&&r===we.PLAYING,children:[e.jsx(Oa,{iconSizeClass:"text-3xl",inControl:m}),e.jsx(La,{iconSizeClass:"text-5xl",className:i?"opacity-0":"opacity-100"}),e.jsx(_a,{iconSizeClass:"text-3xl",inControl:m})]}),e.jsx("div",{className:`absolute right-4 z-50 transition-all duration-300 ease-in-out ${s?"top-16":"top-1"}`,children:e.jsx(Cg,{})}),e.jsx(lg,{show:s,children:e.jsxs("div",{className:"grid grid-cols-[1fr,auto] xl:grid-cols-3 items-center",children:[e.jsxs("div",{className:"flex space-x-3 items-center",children:[e.jsx(mg,{url:t.backUrl}),e.jsx("span",{className:"text mx-3 text-type-secondary",children:"/"}),e.jsx(sp,{}),e.jsx(vg,{}),e.jsx(yg,{})]}),e.jsx("div",{className:"text-center hidden xl:flex justify-center items-center",children:e.jsx(np,{})}),e.jsx("div",{className:"hidden sm:flex items-center justify-end",children:e.jsx(qt,{})}),e.jsx("div",{className:"flex sm:hidden items-center justify-end",children:r===we.PLAYING?e.jsxs(e.Fragment,{children:[e.jsx(qa,{}),e.jsx(Qa,{})]}):null})]})}),e.jsxs(dg,{show:s,children:[r!==we.PLAYING&&!o&&e.jsx(Fg,{}),e.jsxs("div",{className:"flex items-center justify-center space-x-3 h-full",children:[r===we.SCRAPING?e.jsx(Bg,{}):null,r===we.PLAYING?e.jsxs(e.Fragment,{children:[a?e.jsx(Ba,{short:!0}):null,e.jsx(Xf,{})]}):null]}),e.jsxs("div",{className:"hidden lg:flex justify-between",dir:"ltr",children:[e.jsx(hg,{children:r===we.PLAYING?e.jsxs(e.Fragment,{children:[e.jsx(La,{}),e.jsx(Oa,{inControl:m}),e.jsx(_a,{inControl:m}),e.jsx(tp,{}),e.jsx(Ba,{})]}):null}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ga,{inControl:m}),e.jsx(wg,{inControl:m,onChange:t.onMetaChange}),r===we.PLAYING?e.jsxs(e.Fragment,{children:[e.jsx(Aa,{}),e.jsx(qa,{}),e.jsx(Qa,{})]}):null,r===we.PLAYBACK_ERROR||r===we.PLAYING?e.jsx(Xa,{}):null,e.jsx(Ka,{}),!g&&e.jsx(Da,{}),g&&e.jsx("div",{children:e.jsx(to,{})})]})]}),e.jsxs("div",{className:"grid grid-cols-[2.5rem,1fr,2.5rem] gap-3 lg:hidden",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[!p&&!u&&r===we.PLAYING&&e.jsx(Aa,{}),e.jsx(Ga,{inControl:m}),r===we.PLAYING?e.jsx("div",{className:"hidden ssm:block",children:e.jsx(Xa,{})}):null,e.jsx(Ka,{})]}),e.jsx("div",{children:r===we.PLAYING&&e.jsx("div",{onTouchStart:b,onTouchEnd:v,className:"select-none touch-none",style:{WebkitTapHighlightColor:"transparent"},children:x?e.jsx(to,{}):e.jsx(Da,{})})})]})]}),e.jsx(xx,{}),e.jsx(gx,{}),e.jsx(kx,{}),e.jsx(Sg,{}),e.jsx(wx,{controlsShowing:s,onChange:t.onMetaChange,inControl:m}),e.jsx(Ng,{controlsShowing:s,skipTime:w,inControl:m})]})}const Ug={releaseYear:2010,title:"Sintel",tmdbId:"45745",type:"movie",poster:"https://image.tmdb.org/t/p/w342//4BMG9hk9NvSBeQvC82sVmVRK140.jpg"},no={hls:"https://alpha-charlott.github.io/video-openh264/Sintel_master.m3u8",mp4:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4"},ro={hls:"HLS",mp4:"MP4"};function Hg(){const{status:t,playMedia:s,setMeta:n}=Xi(),[r,a]=c.useState("mp4"),[o,i]=c.useState(""),l=c.useCallback((d,m)=>{let u;if(m==="hls")u={type:"hls",url:d};else if(m==="mp4")u={type:"file",qualities:{unknown:{type:"mp4",url:d}}};else throw new Error("Invalid type");n(Ug),s(u,[],null)},[s,n]);return e.jsxs($g,{backUrl:"/dev",children:[t===we.IDLE?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-4xl rounded-xl bg-video-scraping-card p-10 m-4",children:e.jsxs("div",{className:"flex gap-16 flex-col lg:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ms,{children:"Custom stream"}),e.jsxs("div",{className:"grid grid-cols-[1fr,auto] gap-2 items-center",children:[e.jsx(Hr,{className:"bg-video-context-flagBg rounded-md p-2 text-white w-full",value:o,onChange:i,placeholder:"https://..."}),e.jsx(Pt,{options:Object.entries(ro).map(d=>({id:d[0],name:d[1]})),selectedItem:{id:r,name:ro[r]},setSelectedItem:d=>a(d.id)})]}),e.jsx(Z,{onClick:()=>l(o,r),children:"Start stream"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ms,{children:"Preset tests"}),e.jsxs("div",{className:"grid grid-cols-[1fr,1fr] gap-2",children:[e.jsx(Z,{onClick:()=>l(no.hls,"hls"),children:"HLS test"}),e.jsx(Z,{onClick:()=>l(no.mp4,"mp4"),children:"MP4 test"})]})]})]})})}):null,t===we.PLAYBACK_ERROR?e.jsx(Wf,{}):null]})}function ao({direction:t,onClick:s}){return e.jsx("button",{type:"button",className:`absolute ${t==="left"?"left-12":"right-12"} top-1/2 transform -translate-y-3/4 z-10`,onClick:s,children:e.jsxs(fe.Base,{className:"group -m-[0.705em] rounded-full bg-search-hoverBackground transition-transform duration-300 focus:relative focus:z-10 hover:bg-mediaCard-hoverBackground tabbable hover:scale-110",children:[e.jsx(fe.Light,{flareSize:90,cssColorVar:"--colors-mediaCard-hoverAccent",backgroundClass:"bg-mediaCard-hoverBackground duration-100",className:"rounded-full group-hover:opacity-100 z-20"}),e.jsx(fe.Child,{className:"cursor-pointer text-white flex justify-center items-center h-10 w-10 rounded-full active:scale-110 transition-[transform,background-color] duration-200 z-30",children:e.jsx(M,{icon:t==="left"?k.CHEVRON_LEFT:k.CHEVRON_RIGHT})})]})})}function _s({categorySlug:t,carouselRefs:s}){const n=r=>{const a=s.current[t];if(!a)return;const o=a.getElementsByTagName("a");o.length!==0&&requestAnimationFrame(()=>{const i=o[0].getBoundingClientRect().width,l=a.getBoundingClientRect().width;if(i===0||l===0)return;const d=Math.floor(l/i),m=i*(d>5?4:2),u=a.scrollLeft+(r==="left"?-m:m);a.scrollTo({left:u,behavior:"smooth"})})};return e.jsxs(e.Fragment,{children:[e.jsx(ao,{direction:"left",onClick:()=>n("left")}),e.jsx(ao,{direction:"right",onClick:()=>n("right")})]})}const Ks=Ae()(Ze(t=>({selectedCategory:"movies",lastView:null,setSelectedCategory:s=>t({selectedCategory:s}),setLastView:s=>t({lastView:s}),clearLastView:()=>t({lastView:null})}),{name:"__MW::discover"})),xl=t=>{const s=[...t];for(let n=s.length-1;n>0;n-=1){const r=Math.floor(Math.random()*(n+1));[s[n],s[r]]=[s[r],s[n]]}return s},gl=xl([{id:9342,type:"movie"},{id:293,type:"movie"},{id:370172,type:"movie"},{id:661374,type:"movie"},{id:207,type:"movie"},{id:378785,type:"movie"},{id:335984,type:"movie"},{id:13353,type:"movie"},{id:27205,type:"movie"},{id:106646,type:"movie"},{id:334533,type:"movie"},{id:693134,type:"movie"},{id:765245,type:"movie"},{id:264660,type:"movie"},{id:92591,type:"movie"},{id:976893,type:"movie"},{id:13187,type:"movie"},{id:11527,type:"movie"},{id:120,type:"movie"},{id:157336,type:"movie"},{id:762,type:"movie"},{id:666243,type:"movie"},{id:545611,type:"movie"},{id:329,type:"movie"},{id:330459,type:"movie"},{id:279,type:"movie"},{id:823219,type:"movie"},{id:22,type:"movie"},{id:18971,type:"movie"},{id:26388,type:"movie"},{id:152601,type:"movie"},{id:11886,type:"movie"},{id:1362,type:"movie"},{id:578,type:"movie"},{id:78,type:"movie"},{id:348,type:"movie"},{id:198184,type:"movie"},{id:405774,type:"movie"},{id:333339,type:"movie"}]),bl=xl([{id:456,type:"show"},{id:73021,type:"show"},{id:1434,type:"show"},{id:1695,type:"show"},{id:1408,type:"show"},{id:93740,type:"show"},{id:60625,type:"show"},{id:1396,type:"show"},{id:44217,type:"show"},{id:90228,type:"show"},{id:13916,type:"show"},{id:71912,type:"show"},{id:61222,type:"show"},{id:93405,type:"show"},{id:87108,type:"show"},{id:105248,type:"show"},{id:82738,type:"show"},{id:615,type:"show"},{id:4625,type:"show"},{id:513,type:"show"},{id:110948,type:"show"},{id:110492,type:"show"},{id:125988,type:"show"},{id:87917,type:"show"},{id:42009,type:"show"},{id:86831,type:"show"},{id:261579,type:"show"}]),Vg=[{name:"Netflix",id:"8"},{name:"Apple TV+",id:"2"},{name:"Amazon Prime Video",id:"10"},{name:"Hulu",id:"15"},{name:"Disney Plus",id:"337"},{name:"Max",id:"1899"},{name:"Paramount Plus",id:"531"},{name:"Shudder",id:"99"},{name:"Crunchyroll",id:"283"},{name:"fuboTV",id:"257"},{name:"AMC+",id:"526"},{name:"Starz",id:"43"},{name:"Lifetime",id:"157"},{name:"National Geographic",id:"1964"}],Wg=[{name:"Netflix",id:"8"},{name:"Apple TV+",id:"350"},{name:"Amazon Prime Video",id:"10"},{name:"Paramount Plus",id:"531"},{name:"Hulu",id:"15"},{name:"Max",id:"1899"},{name:"Adult Swim",id:"318"},{name:"Disney Plus",id:"337"},{name:"Crunchyroll",id:"283"},{name:"fuboTV",id:"257"},{name:"Shudder",id:"99"},{name:"Discovery +",id:"520"},{name:"National Geographic",id:"1964"},{name:"Fox",id:"328"}];function yl(t){const[s,n]=c.useState([]),[r,a]=c.useState(!1),[o,i]=c.useState(null),l=ze(u=>u.language),d=yt(l),m=t==="movie"?Vg:Wg;return c.useEffect(()=>{(async()=>{a(!0),i(null);try{const p=await De(`/genre/${t}/list`,{api_key:le().TMDB_READ_API_KEY,language:d});n(p.genres.slice(0,50))}catch(p){console.error(`Error fetching ${t} genres:`,p),i(p.message)}finally{a(!1)}})()},[t,d]),{genres:s,providers:m,isLoading:r,error:o}}function vl({contentType:t,mediaType:s,id:n,fallbackType:r,page:a=1,genreName:o,providerName:i,mediaTitle:l,isCarouselView:d=!1}){const[m,u]=c.useState([]),[p,g]=c.useState(!1),[h,x]=c.useState(null),[y,f]=c.useState(!0),[b,v]=c.useState(""),[w,R]=c.useState(t),{t:P}=q(),O=ze(A=>A.language),U=yt(O);c.useEffect(()=>{t!==w&&(u([]),R(t))},[t,w]);const D=c.useCallback(async(A,L={})=>{try{d?L.page="1":L.page=a.toString();const j=await De(A,{api_key:le().TMDB_READ_API_KEY,language:U,...L});return{results:(d?j.results.slice(0,20):j.results).map(W=>({...W,type:s==="movie"?"movie":"show"})),hasMore:a<j.total_pages}}catch(j){throw console.error("Error fetching TMDB media:",j),j}},[U,a,s,d]),S=c.useCallback(async A=>{try{const L=new Promise((X,ae)=>{setTimeout(()=>ae(new Error("Trakt request timed out")),3e3)}),j=await Promise.race([A(),L]),B=d?20:100,{tmdb_ids:W,hasMore:H}=Oh(j,a,B),K=(d?W.slice(0,20):W).map(async X=>{const ae=`/${s}/${X}`;try{return{...await De(ae,{api_key:le().TMDB_READ_API_KEY,language:U}),type:s==="movie"?"movie":"show"}}catch(ce){return console.error(`Error fetching details for TMDB ID ${X}:`,ce),null}});return{results:(await Promise.allSettled(K)).filter(X=>X.status==="fulfilled"&&X.value!==null).map(X=>X.value),hasMore:H}}catch(L){throw console.error("Error fetching Trakt media:",L),L}},[s,U,a,d]),N=c.useCallback(A=>{const L=ef[A];if(!L)return null;if(L==="netflix"&&s==="tv")return Vh;if(L==="netflix"&&s==="movie")return Hh;switch(L){case"appletv":return Uh;case"prime":return Wh;case"hulu":return Kh;case"disney":return zh;case"hbo":return Gh;default:return null}},[s]),C=c.useCallback(A=>{const L=tf[A];if(!L)return null;switch(L){case"action":return qh;case"drama":return Yh;default:return null}},[]),_=c.useCallback(async()=>{const A=s==="movie"?gl:bl,L=d?A.slice(0,20):A;try{const j=L.map(async W=>{const H=`/${s}/${W.id}`;return{...await De(H,{api_key:le().TMDB_READ_API_KEY,language:U,append_to_response:"videos,images"}),type:W.type}});return{results:await Promise.all(j),hasMore:A.length>L.length}}catch(j){throw console.error("Error fetching editor picks:",j),j}},[s,U,d]),I=c.useCallback(async()=>{g(!0),x(null);const A=async L=>{let j,B,W;switch(L){case"popular":j=await D(`/${s}/popular`),v(P("discover.carousel.title.popular"));break;case"topRated":j=await D(`/${s}/top_rated`),v(P("discover.carousel.title.topRated"));break;case"onTheAir":if(s==="tv")j=await D("/tv/on_the_air"),v(P("discover.carousel.title.onTheAir"));else throw new Error("onTheAir is only available for TV shows");break;case"nowPlaying":if(s==="movie")j=await D("/movie/now_playing"),v(P("discover.carousel.title.inCinemas"));else throw new Error("nowPlaying is only available for movies");break;case"latest":j=await S(Bh),v(P("discover.carousel.title.latestReleases"));break;case"latest4k":j=await S(Fh),v(P("discover.carousel.title.4kReleases"));break;case"latesttv":j=await S($h),v(P("discover.carousel.title.latestTVReleases"));break;case"genre":if(!n)throw new Error("Genre ID is required");if(B=C(n),B)try{j=await S(B),v(s==="movie"?P("discover.carousel.title.movies",{category:o}):P("discover.carousel.title.tvshows",{category:o}))}catch(H){console.error("Trakt genre fetch failed, falling back to TMDB:",H),j=await D(`/discover/${s}`,{with_genres:n}),v(s==="movie"?P("discover.carousel.title.movies",{category:o}):P("discover.carousel.title.tvshows",{category:o}))}else j=await D(`/discover/${s}`,{with_genres:n}),v(s==="movie"?P("discover.carousel.title.movies",{category:o}):P("discover.carousel.title.tvshows",{category:o}));break;case"provider":if(!n)throw new Error("Provider ID is required");if(W=N(n),W)try{j=await S(W),v(s==="movie"?P("discover.carousel.title.moviesOn",{provider:i}):P("discover.carousel.title.tvshowsOn",{provider:i}))}catch(H){console.error("Trakt provider fetch failed, falling back to TMDB:",H),j=await D(`/discover/${s}`,{with_watch_providers:n,watch_region:"US"}),v(s==="movie"?P("discover.carousel.title.moviesOn",{provider:i}):P("discover.carousel.title.tvshowsOn",{provider:i}))}else j=await D(`/discover/${s}`,{with_watch_providers:n,watch_region:"US"}),v(s==="movie"?P("discover.carousel.title.moviesOn",{provider:i}):P("discover.carousel.title.tvshowsOn",{provider:i}));break;case"recommendations":if(!n)throw new Error("Media ID is required for recommendations");j=await D(`/${s}/${n}/recommendations`),v(P("discover.carousel.title.recommended",{title:l}));break;case"editorPicks":j=await _(),v(P(s==="movie"?"discover.carousel.title.editorPicksMovies":"discover.carousel.title.editorPicksShows"));break;default:throw new Error(`Unsupported content type: ${L}`)}return j};try{const L=await A(t);u(j=>a===1?L.results:[...j,...L.results]),f(L.hasMore)}catch(L){if(console.error("Error fetching media:",L),x(L.message),r&&r!==t){console.info(`Falling back from ${t} to ${r}`);try{const j=await A(r);u(B=>a===1?j.results:[...B,...j.results]),f(j.hasMore),x(null)}catch(j){console.error("Error fetching fallback media:",j),x(j.message)}}}finally{g(!1)}},[t,s,n,r,o,i,l,D,S,_,P,a,C,N]);return c.useEffect(()=>{(t!==w||a===1)&&(u([]),R(t)),I()},[I,t,w,a,n]),{media:m,isLoading:p,error:h,hasMore:y,refetch:I,sectionTitle:b}}function Kg(t={}){const[s,n]=c.useState(!1),[r,a]=c.useState(!1),o=c.useRef(null);return c.useEffect(()=>{const i=new IntersectionObserver(([d])=>{n(d.isIntersecting),d.isIntersecting&&a(!0)},{...t,rootMargin:t.rootMargin||"400px 0px"}),l=o.current;return l&&i.observe(l),()=>{l&&i.unobserve(l)}},[t]),{targetRef:o,isIntersecting:s,hasIntersected:r}}function zg({link:t}){const{t:s}=q();return e.jsx("div",{className:"relative mt-4 group cursor-pointer user-select-none rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(vt,{to:t,className:"block",children:e.jsxs(fe.Base,{className:"group -m-[0.705em] h-[20rem] hover:scale-95 transition-all rounded-xl bg-background-main duration-300 hover:bg-mediaCard-hoverBackground tabbable",children:[e.jsx(fe.Light,{flareSize:300,cssColorVar:"--colors-mediaCard-hoverAccent",backgroundClass:"bg-mediaCard-hoverBackground duration-100",className:"rounded-xl bg-background-main group-hover:opacity-100"}),e.jsx(fe.Child,{className:"pointer-events-auto h-[20rem] relative mb-2 p-[0.4em] transition-transform duration-300",children:e.jsxs("div",{className:"flex absolute inset-0 flex-col items-center justify-center",children:[e.jsx(M,{icon:k.ARROW_RIGHT,className:"text-4xl mb-2 transition-transform duration-300"}),e.jsx("span",{className:"text-sm text-center px-2",children:s("discover.carousel.more")})]})})]})})})}const Gg=function({content:s,isTVShow:n,carouselRefs:r,onShowDetails:a,moreContent:o,moreLink:i,showProviders:l=!1,showGenres:d=!1,showRecommendations:m=!1}){var te,ne;const{t:u}=q(),{width:p}=wn(),{setLastView:g}=Ks(),{isMobile:h}=jt(),x=!!window.chrome,[y,f]=c.useState(""),[b,v]=c.useState(""),[w,R]=c.useState(""),[P,O]=c.useState(""),[U,D]=c.useState(""),[S,N]=c.useState(""),[C,_]=Ye.useState(null),I=n?"tv":"movie",{providers:A,genres:L}=yl(I),j=je(F=>F.items),B=Object.entries(j||{}).filter(([F,se])=>se.type===(n?"show":"movie")).map(([F,se])=>({id:F,title:se.title||""})),{targetRef:W,isIntersecting:H}=Kg({rootMargin:"300px"}),$=Ye.useCallback((F,se)=>{f(F),v(se)},[]),K=Ye.useCallback((F,se)=>{R(F),O(se)},[]),V=Ye.useMemo(()=>{if(l)return A.map(F=>({id:F.id,name:F.name}));if(d)return L.map(F=>({id:F.id.toString(),name:F.name}))},[l,d,A,L]);c.useEffect(()=>{l&&A.length>0&&!y&&$(A[0].id,A[0].name),d&&L.length>0&&!w&&K(L[0].id.toString(),L[0].name)},[l,d,A,L,y,w,$,K]);const T=Ye.useMemo(()=>{if(l)return $;if(d)return K},[l,d,$,K]),{visibleButtons:X,dropdownButtons:ae}=Ye.useMemo(()=>{if(!V)return{visibleButtons:[],dropdownButtons:[]};const F=p>850?V.slice(0,5):[],se=p>850?V.slice(5):V;return{visibleButtons:F,dropdownButtons:se}},[V,p]),ce=Ye.useMemo(()=>l&&y?"provider":d&&w?"genre":m&&U?"recommendations":s.type,[l,y,d,w,m,U,s.type]),{media:Q,sectionTitle:xe}=vl({contentType:ce,mediaType:I,id:y||w||U,fallbackType:s.fallback,genreName:P,providerName:b,mediaTitle:S,isCarouselView:!0}),ee=Ye.useMemo(()=>V==null?void 0:V.find(F=>F.name===(C==null?void 0:C.name)||F.name===xe.split(" on ")[1]),[V,C==null?void 0:C.name,xe]),Pe=Ye.useMemo(()=>ae.map(F=>({id:F.id,name:F.name})),[ae]);Ye.useEffect(()=>{ee&&!X.find(F=>F.id===ee.id)&&_({id:ee.id,name:ee.name})},[ee,X]),c.useEffect(()=>{if(m&&B.length>0&&!U){const F=B[Math.floor(Math.random()*B.length)];D(F.id),N(F.title)}},[m,B,U]);const Ie=`${xe.toLowerCase().replace(/[^a-z0-9]+/g,"-")}-${n?"tv":"movie"}`,G=c.useRef(!1),oe=Ye.useCallback(F=>{G.current||(G.current=!0,Math.abs(F.deltaX)>Math.abs(F.deltaY)&&(F.stopPropagation(),F.preventDefault()),x?setTimeout(()=>{G.current=!1},345):G.current=!1)},[x]),ie=Ye.useCallback(()=>{g({url:window.location.pathname,scrollPosition:window.scrollY})},[g]),de=Ye.useMemo(()=>{if(i)return i;const F="/discover/more";return l&&y?`${F}/provider/${y}/${I}`:d&&w?`${F}/genre/${w}/${I}`:m&&U?`${F}/recommendations/${U}/${I}`:`${F}/${s.type}/${I}`},[i,l,y,d,w,m,U,I,s.type]);return!H||!xe?e.jsxs("div",{ref:W,children:[e.jsx("div",{className:"flex items-center justify-between ml-2 md:ml-8 mt-2",children:e.jsx("div",{className:"flex gap-4 items-center",children:e.jsx("h2",{className:"text-2xl cursor-default font-bold text-white md:text-2xl pl-5 text-balance",children:u("discover.carousel.title.loading")})})}),e.jsx("div",{className:"relative overflow-hidden carousel-container md:pb-4",children:e.jsxs("div",{className:"grid grid-flow-col auto-cols-max gap-4 pt-0 overflow-x-scroll scrollbar-none rounded-xl overflow-y-hidden md:pl-8 md:pr-8",children:[e.jsx("div",{className:"md:w-12"}),Array(10).fill(null).map((F,se)=>e.jsx("div",{className:"relative mt-4 group cursor-default user-select-none rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(cs,{media:{id:`skeleton-${se}`,title:"",poster:"",type:n?"show":"movie"},forceSkeleton:!0})},`skeleton-loading-${Math.random().toString(36).substring(2)}`)),e.jsx("div",{className:"md:w-12"})]})})]}):e.jsxs("div",{ref:W,children:[e.jsxs("div",{className:"flex items-center justify-between ml-2 md:ml-8 mt-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl cursor-default font-bold text-white md:text-2xl pl-5 text-balance",children:xe}),m&&B&&B.length>0&&e.jsx("div",{className:"relative pr-4",children:e.jsx(Pt,{selectedItem:B.find(F=>F.id===U)?{id:U||"",name:((te=B.find(F=>F.id===U))==null?void 0:te.title)||""}:{id:"",name:((ne=B[0])==null?void 0:ne.title)||""},setSelectedItem:F=>{const se=B.find(ue=>ue.id===F.id);se&&(D(F.id),N(se.title))},options:B.map(F=>({id:F.id,name:F.title})),customButton:e.jsxs("button",{type:"button",className:"px-2 py-1 text-sm bg-mediaCard-hoverBackground rounded-full hover:bg-mediaCard-background transition-colors flex items-center gap-1",children:[e.jsx("span",{children:u("discover.carousel.change")}),e.jsx(M,{icon:k.UP_DOWN_ARROW,className:"text-xs text-dropdown-secondary"})]}),side:"right",customMenu:e.jsx(ot.Options,{static:!0,className:"py-1",children:B.map(F=>e.jsx(ot.Option,{className:({active:se})=>`cursor-pointer min-w-60 flex gap-4 items-center relative select-none py-2 px-4 mx-1 rounded-lg ${se?"bg-background-secondaryHover text-type-link":"text-type-secondary"}`,value:{id:F.id,name:F.title},children:({selected:se})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block ${se?"font-medium":"font-normal"}`,children:F.title}),se&&e.jsx(M,{icon:k.CHECKMARK,className:"text-xs text-type-link"})]})},F.id))})})})]}),o&&e.jsxs(vt,{to:de,onClick:ie,className:"flex px-5 items-center hover:text-type-link transition-colors",children:[e.jsx("span",{className:"text-sm",children:u("discover.carousel.more")}),e.jsx(M,{className:"text-sm ml-1",icon:k.ARROW_RIGHT})]})]}),V&&V.length>0&&e.jsxs("div",{className:"flex items-center space-x-2 mr-6",children:[X==null?void 0:X.map(F=>e.jsx("button",{type:"button",onClick:()=>T==null?void 0:T(F.id,F.name),className:`px-3 py-1 text-sm rounded-full hover:bg-mediaCard-background transition-colors whitespace-nowrap flex-shrink-0 ${F.id===(y||w)?"bg-mediaCard-background":"bg-mediaCard-hoverBackground"}`,children:F.name},F.id)),ae&&ae.length>0&&e.jsx("div",{className:"relative my-0",children:e.jsx(Pt,{selectedItem:C||{id:"",name:ee&&!X.find(F=>F.id===ee.id)?ee.name:"..."},setSelectedItem:F=>{_(F),T==null||T(F.id,F.name)},options:Pe,customButton:e.jsxs("button",{type:"button",className:"px-3 py-1 text-sm bg-mediaCard-hoverBackground rounded-full hover:bg-mediaCard-background transition-colors flex items-center gap-1",children:[e.jsx("span",{children:ee&&!X.find(F=>F.id===ee.id)?ee.name:"..."}),e.jsx(M,{icon:k.UP_DOWN_ARROW,className:"text-xs text-dropdown-secondary"})]}),side:"right",preventWrap:!0})})]})]}),e.jsxs("div",{className:"relative overflow-hidden carousel-container md:pb-4",children:[e.jsxs("div",{id:`carousel-${Ie}`,className:"grid grid-flow-col auto-cols-max gap-4 pt-0 overflow-x-scroll scrollbar-none rounded-xl overflow-y-hidden md:pl-8 md:pr-8",ref:F=>{r.current[Ie]=F},onWheel:oe,children:[e.jsx("div",{className:"md:w-12"}),Q.length>0?Q.map(F=>e.jsx("div",{onContextMenu:se=>se.preventDefault(),className:"relative mt-4 group cursor-pointer user-select-none rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(cs,{linkable:!0,media:{id:F.id.toString(),title:F.title||F.name||"",poster:F.poster_path?`https://image.tmdb.org/t/p/w342${F.poster_path}`:"/placeholder.png",type:n?"show":"movie",year:n?F.first_air_date?parseInt(F.first_air_date.split("-")[0],10):void 0:F.release_date?parseInt(F.release_date.split("-")[0],10):void 0},onShowDetails:a},F.id)},F.id)):Array(10).fill(null).map((F,se)=>e.jsx("div",{className:"relative mt-4 group cursor-default user-select-none rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(cs,{media:{id:`skeleton-${se}`,title:"",poster:"",type:n?"show":"movie"},forceSkeleton:!0})},`skeleton-${Ie}-${Math.random().toString(36).substring(2)}`)),o&&de&&e.jsx(zg,{link:de}),e.jsx("div",{className:"md:w-12"})]}),!h&&e.jsx(_s,{categorySlug:Ie,carouselRefs:r})]})]})},Ue=Gg;function qg(){const[t,s]=c.useState(),[n,r]=c.useState([]),[a,o]=c.useState({}),i=Ke("discover-details"),l=c.useRef({}),d=be(),{lastView:m}=Ks(),{isMobile:u}=jt();c.useEffect(()=>{(async()=>{try{const y=await Jh();r(y);const f={};for(const b of y)try{const v=await Zh(b.tmdbIds,50);v.length>0&&(f[b.listSlug]=v)}catch(v){console.error(`Failed to fetch movies for list ${b.listSlug}:`,v)}o(f)}catch(y){console.error("Failed to fetch curated lists:",y)}})()},[]);const p=async x=>{s({id:Number(x.id),type:x.type==="movie"?"movie":"show"}),i.show()},g=()=>{m?(d(m.url),window.scrollTo(0,m.scrollPosition)):d(-1)},h=x=>{Math.abs(x.deltaX)>Math.abs(x.deltaY)&&(x.stopPropagation(),x.preventDefault())};return e.jsxs(st,{children:[e.jsxs(lt,{children:[e.jsx("div",{className:"flex items-center justify-between gap-8",children:e.jsx(wt,{className:"text-2xl font-bold text-white",children:re("discover.allLists")})}),e.jsx("div",{className:"flex items-center gap-4 pb-8",children:e.jsxs("button",{type:"button",onClick:g,className:"flex items-center text-white hover:text-gray-300 transition-colors",children:[e.jsx(M,{className:"text-xl",icon:k.ARROW_LEFT}),e.jsx("span",{className:"ml-2",children:re("discover.page.back")})]})})]}),e.jsxs(lt,{ultraWide:!0,children:[e.jsx("div",{className:"relative",children:e.jsx(Ue,{content:{type:"latest",fallback:"nowPlaying"},isTVShow:!1,carouselRefs:l,onShowDetails:p})}),e.jsx("div",{className:"relative",children:e.jsx(Ue,{content:{type:"latest4k",fallback:"topRated"},isTVShow:!1,carouselRefs:l,onShowDetails:p})}),n.map(x=>{var y;return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between ml-2 md:ml-8 mt-2",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h2",{className:"text-2xl cursor-default font-bold text-white md:text-2xl pl-5 text-balance",children:x.listName})})})}),e.jsxs("div",{className:"relative overflow-hidden carousel-container md:pb-4",children:[e.jsxs("div",{className:"grid grid-flow-col auto-cols-max gap-4 pt-0 overflow-x-scroll scrollbar-none rounded-xl overflow-y-hidden md:pl-8 md:pr-8",ref:f=>{l.current[x.listSlug]=f},onWheel:h,children:[e.jsx("div",{className:"md:w-12"}),(y=a[x.listSlug])==null?void 0:y.map(f=>e.jsx("div",{className:"relative mt-4 group cursor-pointer user-select-none rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(cs,{linkable:!0,media:{id:f.id.toString(),title:f.title,poster:f.poster_path?`https://image.tmdb.org/t/p/w342${f.poster_path}`:"/placeholder.png",type:"movie",year:f.release_date?parseInt(f.release_date.split("-")[0],10):void 0},onShowDetails:p})},f.id)),e.jsx("div",{className:"md:w-12"})]}),!u&&e.jsx(_s,{categorySlug:x.listSlug,carouselRefs:l})]})]},x.listSlug)})]}),t&&e.jsx(_t,{id:"discover-details",data:t})]})}const Yg=function(){const[s,n]=c.useState(null),[r,a]=c.useState(null),[o,i]=c.useState(null),[l,d]=c.useState([]),m=be(),u=ze(h=>h.language),p=yt(u);c.useEffect(()=>{(async()=>{try{const x=await De("/movie/popular",{api_key:le().TMDB_READ_API_KEY,language:p,page:2});d(x.results)}catch(x){console.error("Error fetching popular movies:",x)}})()},[p]),c.useEffect(()=>{let h;return r!==null&&r>0&&(h=setInterval(()=>{a(x=>x!==null?x-1:x)},1e3)),()=>clearInterval(h)},[r]);const g=()=>{if(l.length===0)return;const h=new Set(l.map(b=>b.title)),x=Array.from(h),y=Math.floor(Math.random()*x.length),f=l.find(b=>b.title===x[y]);if(f)if(r!==null&&r>0)a(null),o&&(clearTimeout(o),i(null),n(null));else{n(f),a(5);const b=setTimeout(()=>{m(`/media/tmdb-movie-${f.id}-random`)},5e3);i(b)}};return e.jsx("div",{className:"flex justify-center items-center",children:e.jsxs("button",{type:"button",className:`
          relative flex items-center overflow-hidden
          rounded-full text-white h-10
          bg-pill-background bg-opacity-50 hover:bg-pill-backgroundHover
          transition-all duration-300 ease-in-out
          ${r!==null&&r>0?"min-w-[10px] pl-3":"w-10"}
        `,onClick:g,children:[e.jsx("div",{className:`
            relative whitespace-nowrap
            transition-all duration-300 ease-in-out
            ${r!==null&&r>0?"opacity-100 translate-x-0":"opacity-0 -translate-x-4"}
          `,children:r!==null&&r>0&&e.jsx("span",{className:"font-bold",children:s==null?void 0:s.title})}),e.jsx("div",{className:"ml-auto flex items-center justify-center w-10 h-10",children:r!==null&&r>0?e.jsx("div",{className:"animate-[pulse_1s_ease-in-out_infinite] text-lg font-bold",children:r}):e.jsx("img",{src:"/lightbar-images/dice.svg",alt:"Dice",className:"w-6 h-6"})})]})})},Qg=Yg,Xg=function({shorter:s}){return e.jsxs("div",{className:z("relative w-full transition-[height] duration-300 ease-in-out",s?"h-[75vh]":"h-[75vh] md:h-[100vh]"),children:[e.jsx("div",{className:"relative w-full h-full overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-gray-900",style:{maskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 500px)",WebkitMaskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 500px)"}})}),e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-black/30",children:e.jsx("div",{className:"w-8 h-8 bg-gray-900 rounded-full animate-pulse"})}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-black/30",children:e.jsx("div",{className:"w-8 h-8 bg-gray-900 rounded-full animate-pulse"})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-[19] flex gap-2",children:[1,2,3,4,5,6,7,8,9,10].map(n=>e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-gray-900 animate-pulse"},n))}),e.jsx("div",{className:"absolute inset-0 flex items-end pb-20 z-10",children:e.jsx("div",{className:"container mx-auto px-8 md:px-4",children:e.jsxs("div",{className:"max-w-3xl",children:[e.jsx("div",{className:"h-12 w-48 bg-gray-900 rounded animate-pulse mb-6"}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("div",{className:"h-4 bg-gray-900 rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-900 rounded animate-pulse w-1/2"})]}),e.jsxs("div",{className:"flex gap-4 justify-center items-center sm:justify-start",children:[e.jsx("div",{className:"h-10 w-32 bg-gray-900 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-32 bg-gray-900 rounded animate-pulse"})]})]})})})]})},oo=Xg,Jg=function({onShowDetails:s,children:n,searching:r,shorter:a,forcedCategory:o}){var de;const{selectedCategory:i}=Ks(),l=o||i,[d,m]=c.useState(0),[u,p]=c.useState(!0),[g,h]=c.useState([]),[x,y]=c.useState(!0),[f,b]=c.useState(),[v,w]=c.useState(null),[R,P]=c.useState(null),[O,U]=c.useState({}),D=c.useRef(!1),S=c.useRef(null),N=c.useRef(null),C=be(),_=J(te=>te.enableImageLogos),I=ze(te=>te.language),A=yt(I),{width:L,height:j}=wn(),[B,W]=c.useState(null),[H,$]=c.useState(1),K=g[d],V=10,T=20,X=6,ae=4,ce=8e3;c.useEffect(()=>{Sn().then(te=>{D.current=te})},[]),c.useEffect(()=>{K&&(async()=>{var ne;if(!(!D.current||!((ne=K==null?void 0:K.external_ids)!=null&&ne.imdb_id)))try{const F=await Hi(K.external_ids.imdb_id,void 0,void 0,void 0,K.type);if(typeof F.imdb_rating=="number"&&typeof F.votes=="number"){const se={rating:F.imdb_rating,votes:F.votes};U(ue=>({...ue,[K.external_ids.imdb_id]:se}))}}catch(F){console.error("Error fetching IMDb ratings:",F)}})()},[K]),c.useEffect(()=>{(async()=>{y(!0),b(void 0),U({}),W(null),m(0),$(1),S.current&&S.current.abort();try{if(l==="movies"||l==="tvshows")try{const ne=await Qh();let F=[];l==="movies"?F=ne.movie_tmdb_ids:F=ne.tv_tmdb_ids;const se=F.map($e=>De(`/${l==="movies"?"movie":"tv"}/${$e}`,{api_key:le().TMDB_READ_API_KEY,language:A,append_to_response:"external_ids"})),Me=(await Promise.all(se)).map($e=>({...$e,type:l==="movies"?"movie":"show"}));h(Me.slice(0,V))}catch(ne){if(console.error("Falling back to TMDB method","Error fetching from Trakt discover:",ne),l==="movies"){const se=(await De("/movie/popular",{api_key:le().TMDB_READ_API_KEY,language:A})).results.slice(0,T).map(Ve=>De(`/movie/${Ve.id}`,{api_key:le().TMDB_READ_API_KEY,language:A,append_to_response:"external_ids"})),$e=[...(await Promise.all(se)).map(Ve=>({...Ve,type:"movie"}))].sort(()=>.5-Math.random());h($e.slice(0,V))}else if(l==="tvshows"){const se=(await De("/tv/popular",{api_key:le().TMDB_READ_API_KEY,language:A})).results.slice(0,T).map(Ve=>De(`/tv/${Ve.id}`,{api_key:le().TMDB_READ_API_KEY,language:A,append_to_response:"external_ids"})),$e=[...(await Promise.all(se)).map(Ve=>({...Ve,type:"show"}))].sort(()=>.5-Math.random());h($e.slice(0,V))}}else if(l==="editorpicks"){const ne=gl.map(We=>({id:We.id,type:"movie"})),F=bl.map(We=>({id:We.id,type:"show"})),se=[...ne,...F].sort(()=>.5-Math.random()),ue=se.filter(We=>We.type==="movie").slice(0,X),Me=se.filter(We=>We.type==="show").slice(0,ae),$e=ue.map(({id:We})=>De(`/movie/${We}`,{api_key:le().TMDB_READ_API_KEY,language:A,append_to_response:"external_ids"})),Ve=Me.map(({id:We})=>De(`/tv/${We}`,{api_key:le().TMDB_READ_API_KEY,language:A,append_to_response:"external_ids"})),[Xt,_e]=await Promise.all([Promise.all($e),Promise.all(Ve)]),Un=Xt.map(We=>({...We,type:"movie"})),Il=_e.map(We=>({...We,type:"show"}));h([...Un,...Il])}}catch(ne){console.error("Error fetching featured media:",ne)}finally{y(!1)}})()},[A,l]);const Q=()=>{$(0),U({}),W(null),setTimeout(()=>{m(te=>(te-1+g.length)%g.length),b(void 0),setTimeout(()=>$(1),100)},150),N.current&&clearInterval(N.current),u&&(N.current=setInterval(()=>{m(te=>(te+1)%g.length)},5e3))},xe=()=>{$(0),U({}),W(null),setTimeout(()=>{m(te=>(te+1)%g.length),b(void 0),setTimeout(()=>$(1),100)},150),N.current&&clearInterval(N.current),u&&(N.current=setInterval(()=>{m(te=>(te+1)%g.length)},5e3))},ee=te=>{w(te.targetTouches[0].clientX)},Pe=te=>{P(te.targetTouches[0].clientX)},Ie=()=>{if(!v||!R)return;const te=v-R;Math.abs(te)>50&&(te>0?xe():Q()),w(null),P(null)};if(c.useEffect(()=>((async()=>{var F,se;S.current&&S.current.abort(),S.current=new AbortController;const ne=(F=g[d])==null?void 0:F.id;if(!ne){b(void 0);return}try{const ue=await ai(ne.toString(),g[d].type==="movie"?Ne.MOVIE:Ne.TV);((se=g[d])==null?void 0:se.id)===ne&&b(ue)}catch(ue){if(ue instanceof Error&&ue.name==="AbortError")return;console.error("Error fetching logo:",ue),b(void 0)}})(),()=>{S.current&&S.current.abort()}),[d,g]),c.useEffect(()=>()=>{S.current&&S.current.abort()},[]),c.useEffect(()=>(u&&g.length>0&&(N.current=setInterval(()=>{$(0),U({}),W(null),setTimeout(()=>{m(te=>(te+1)%g.length),b(void 0),setTimeout(()=>$(1),100)},150)},ce)),()=>{N.current&&clearInterval(N.current)}),[u,g.length]),c.useEffect(()=>{(async()=>{if(K!=null&&K.id)try{const ne=await Ui(K.id.toString());W(ne)}catch(ne){console.error("Failed to fetch release info:",ne)}})()},[K==null?void 0:K.id]),x)return e.jsx(oo,{shorter:a});if(g.length===0)return e.jsx(oo,{shorter:a});const G=K.title||K.name;let oe="";r?oe="opacity-0 transition-opacity duration-300":oe="opacity-100 transition-opacity duration-300";const ie=()=>{if(!B||K.type==="show")return null;const te=!!B.digital_release_date,ne=!!B.theatrical_release_date;if(te){const F=new Date(B.digital_release_date),se=new Date(F);if(se.setDate(se.getDate()+2),new Date>=se)return e.jsx("span",{className:"text-green-400",children:"HD"})}if(ne){const F=new Date(B.theatrical_release_date),se=new Date(F);return se.setDate(se.getDate()+45),new Date>=se?e.jsx("div",{className:"px-2 py-1 rounded-lg backdrop-blur-sm bg-gray-600/40",children:e.jsx("span",{className:"text-green-400",children:"HD"})}):e.jsx("div",{className:"px-2 py-1 rounded-lg backdrop-blur-sm bg-gray-600/40",children:e.jsx("span",{className:"text-yellow-400",children:"CAM"})})}return null};return e.jsxs("div",{className:z("relative w-full transition-[height] duration-300 ease-in-out",r?"h-24":a?j>600?"h-[40rem] md:h-[85vh]":"h-[100vh]":"h-[40rem] md:h-[100vh]"),onTouchStart:ee,onTouchMove:Pe,onTouchEnd:Ie,children:[e.jsx("div",{className:z("relative w-full h-full overflow-hidden",oe),children:g.map((te,ne)=>e.jsx("div",{className:`absolute inset-0 transition-opacity duration-1000 ${ne===d?"opacity-100":"opacity-0"}`,style:{backgroundImage:`url(https://image.tmdb.org/t/p/original${te.backdrop_path})`,backgroundSize:"cover",backgroundPosition:"center top",maskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 700px)",WebkitMaskImage:"linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) 700px)"}},te.id))}),e.jsx("button",{type:"button",onClick:Q,className:z("absolute left-4 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-black/30 hover:bg-black/50 transition-colors",oe),"aria-label":"Previous slide",children:e.jsx(M,{icon:k.CHEVRON_LEFT,className:"text-white w-8 h-8"})}),e.jsx("button",{type:"button",onClick:xe,className:z("absolute right-4 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-black/30 hover:bg-black/50 transition-colors",oe),"aria-label":"Next slide",children:e.jsx(M,{icon:k.CHEVRON_RIGHT,className:"text-white w-8 h-8"})}),e.jsx("div",{className:z("absolute bottom-8 left-1/2 -translate-x-1/2 z-[19] flex gap-2",oe),children:g.map((te,ne)=>e.jsx("button",{type:"button",onClick:()=>{$(0),U({}),W(null),setTimeout(()=>{m(ne),b(void 0),setTimeout(()=>$(1),100)},150),N.current&&clearInterval(N.current),u&&(N.current=setInterval(()=>{m(F=>(F+1)%g.length)},5e3))},className:`w-2.5 h-2.5 rounded-full transition-all ${ne===d?"bg-white scale-125":"bg-white/50 hover:bg-white/75"}`,"aria-label":`Go to slide ${ne+1}`},`dot-${te.id}`))}),e.jsx("div",{className:z("absolute inset-0 flex items-end pb-20 z-10 transition-opacity duration-150",oe),style:{opacity:H},children:e.jsxs("div",{className:"container mx-auto px-8 lg:px-4 flex justify-between items-end w-full",children:[e.jsxs("div",{className:"max-w-3xl",children:[f&&_?e.jsx("img",{src:f,alt:G,className:"max-w-[14rem] md:max-w-[22rem] max-h-[20vh] object-contain drop-shadow-lg bg-transparent mb-6",style:{background:"none"}}):e.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-white mb-4",children:G}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/80 mb-4",children:[ie()&&e.jsxs(e.Fragment,{children:[ie(),e.jsx("span",{className:"text-white/60",children:"‚Ä¢"})]}),(K==null?void 0:K.vote_average)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{icon:k.TMDB}),e.jsx("span",{children:K.vote_average.toFixed(1)}),K.vote_count&&e.jsxs("span",{className:"text-white/60",children:["(",K.vote_count.toLocaleString(),")"]})]}),((de=K==null?void 0:K.external_ids)==null?void 0:de.imdb_id)&&O[K.external_ids.imdb_id]&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"‚Ä¢"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{icon:k.IMDB,className:"text-yellow-400"}),e.jsx("span",{children:O[K.external_ids.imdb_id].rating.toFixed(1)}),e.jsxs("span",{className:"text-white/60",children:["(",O[K.external_ids.imdb_id].votes.toLocaleString(),")"]})]})]}),(K==null?void 0:K.release_date)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"‚Ä¢"}),e.jsx("span",{children:new Date(K.release_date).getFullYear()})]}),(K==null?void 0:K.type)==="show"&&(K==null?void 0:K.number_of_seasons)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"‚Ä¢"}),e.jsxs("span",{children:[K.number_of_seasons," ",re("details.seasons")]})]})]}),e.jsx("p",{className:"text-lg text-white mb-6 line-clamp-3 md:line-clamp-4",children:K.overview}),e.jsxs("div",{className:"flex gap-4 justify-center items-center sm:justify-start",onMouseEnter:()=>p(!1),onMouseLeave:()=>p(!0),children:[e.jsxs(Z,{onClick:()=>C(`/media/tmdb-${K.type}-${K.id}-${G==null?void 0:G.toLowerCase().replace(/[^a-z0-9]+/g,"-")}`),theme:"secondary",className:"w-full sm:w-auto text-base",children:[e.jsx(M,{icon:k.PLAY,className:"text-white"}),e.jsx("span",{className:"text-white",children:re("discover.featured.playNow")})]}),e.jsxs(Z,{onClick:()=>s(K),theme:"secondary",className:"w-full sm:w-auto text-base",children:[e.jsx(M,{icon:k.CIRCLE_QUESTION,className:"text-white scale-100"}),e.jsx("span",{className:"text-white",children:re("discover.featured.moreInfo")})]})]})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(Qg,{})})]})}),n&&e.jsx("div",{className:z("absolute inset-0 pointer-events-none",L>1280?"pt-0":"pt-14"),children:e.jsx("div",{className:"pointer-events-auto z-50",children:n})})]})},wl=Jg,Zg=function({selectedCategory:s,onCategoryChange:n}){const{t:r}=q();return e.jsx("div",{className:"pb-4 w-full max-w-screen-xl mx-auto",children:e.jsx("div",{className:"relative flex justify-center",children:e.jsx("div",{className:"flex space-x-4",children:["movies","tvshows","editorpicks"].map(a=>e.jsx("button",{type:"button",className:`text-xl md:text-2xl font-bold p-2 bg-transparent text-center rounded-full cursor-pointer flex items-center transition-transform duration-200 ${s===a?"transform scale-105 text-type-link":"text-type-secondary"}`,onClick:()=>n(a),children:r(`discover.tabs.${a}`)},a))})})})},eb=Zg,tb=function(){const{t:s}=q(),[n,r]=c.useState(!1),a=()=>{const i=window.scrollY>300;r(i)};c.useEffect(()=>{const i=()=>{const l=setTimeout(a,100);return()=>clearTimeout(l)};return window.addEventListener("scroll",i),()=>window.removeEventListener("scroll",i)},[]);const o=()=>{window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs("div",{className:"fixed bottom-9 md:bottom-4 transform -translate-x-1/2 z-50 left-12 md:left-1/2",children:[e.jsx("div",{className:`absolute inset-0 mx-auto h-[50px] w-[200px] rounded-full blur-[50px] opacity-50 pointer-events-none z-0 ${n?"opacity-100 visible":"opacity-0 invisible"}`,style:{backgroundImage:"linear-gradient(to right, rgba(var(--colors-buttons-purpleHover)), rgba(var(--colors-progress-filled)))",transition:"opacity 0.4s ease-in-out, transform 0.2s ease-in-out"}}),e.jsxs("button",{type:"button",onClick:o,className:`relative backdrop-blur-sm flex items-center justify-center space-x-2 rounded-full px-3 py-3 md:py-2 text-lg font-semibold text-white bg-pill-background bg-opacity-80 hover:bg-pill-backgroundHover transition-opacity hover:scale-105 duration-500 ease-in-out ${n?"opacity-100 visible":"opacity-0 invisible"}`,style:{transition:"opacity 0.4s ease-in-out, transform 0.2s ease-in-out"},children:[e.jsx(M,{icon:k.CHEVRON_UP,className:"text-2xl z-10"}),e.jsx("span",{className:"z-10 hidden md:block",children:s("discover.scrollToTop")})]})]})},sb=tb;function jl(){const{selectedCategory:t,setSelectedCategory:s}=Ks(),[n,r]=c.useState(),a=be(),o=Ke("discover-details"),i=c.useRef({}),l=je(v=>v.items),d=t==="movies",m=t==="tvshows",u=t==="editorpicks",p=v=>{s(v)},g=async v=>{r({id:Number(v.id),type:v.type==="movie"?"movie":"show"}),o.show()},h=Object.entries(l||{}).filter(([v,w])=>w.type==="movie"),x=Object.entries(l||{}).filter(([v,w])=>w.type==="show"),y=()=>e.jsxs(e.Fragment,{children:[h.length>0&&e.jsx(Ue,{content:{type:"recommendations"},isTVShow:!1,carouselRefs:i,onShowDetails:g,moreContent:!0,showRecommendations:!0}),e.jsx(Ue,{content:{type:"latest",fallback:"nowPlaying"},isTVShow:!1,carouselRefs:i,onShowDetails:g,moreContent:!0}),e.jsx(Ue,{content:{type:"latest4k",fallback:"popular"},isTVShow:!1,carouselRefs:i,onShowDetails:g,moreContent:!0}),e.jsx(Ue,{content:{type:"topRated"},isTVShow:!1,carouselRefs:i,onShowDetails:g,moreContent:!0}),e.jsx(Ue,{content:{type:"provider"},isTVShow:!1,carouselRefs:i,onShowDetails:g,showProviders:!0,moreContent:!0}),e.jsx(Ue,{content:{type:"genre"},isTVShow:!1,carouselRefs:i,onShowDetails:g,showGenres:!0,moreContent:!0})]}),f=()=>e.jsxs(e.Fragment,{children:[x.length>0&&e.jsx(Ue,{content:{type:"recommendations"},isTVShow:!0,carouselRefs:i,onShowDetails:g,moreContent:!0,showRecommendations:!0}),e.jsx(Ue,{content:{type:"latesttv",fallback:"onTheAir"},isTVShow:!0,carouselRefs:i,onShowDetails:g,moreContent:!0}),e.jsx(Ue,{content:{type:"topRated"},isTVShow:!0,carouselRefs:i,onShowDetails:g,moreContent:!0}),e.jsx(Ue,{content:{type:"popular"},isTVShow:!0,carouselRefs:i,onShowDetails:g,moreContent:!0}),e.jsx(Ue,{content:{type:"provider"},isTVShow:!0,carouselRefs:i,onShowDetails:g,showProviders:!0,moreContent:!0}),e.jsx(Ue,{content:{type:"genre"},isTVShow:!0,carouselRefs:i,onShowDetails:g,showGenres:!0,moreContent:!0})]}),b=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ue,{content:{type:"editorPicks"},isTVShow:!1,carouselRefs:i,onShowDetails:g,moreContent:!0}),e.jsx(Ue,{content:{type:"editorPicks"},isTVShow:!0,carouselRefs:i,onShowDetails:g,moreContent:!0})]});return e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx(eb,{selectedCategory:t,onCategoryChange:p}),e.jsxs(lt,{ultraWide:!0,classNames:"!px-0",children:[e.jsx("div",{style:{display:d?"block":"none"},children:y()}),e.jsx("div",{style:{display:m?"block":"none"},children:f()}),e.jsx("div",{style:{display:u?"block":"none"},children:b()})]}),e.jsx("div",{className:z("flex justify-center mt-8 mb-12",d?"block":"hidden"),children:e.jsx(Z,{theme:"purple",onClick:()=>a("/discover/all"),children:re("discover.viewLists")})}),e.jsx(sb,{}),n&&e.jsx(_t,{id:"discover-details",data:n})]})}function nb(){const[t,s]=c.useState(),n=Ke("discover-details");c.useEffect(()=>{n.isShown||s(void 0)},[n.isShown]);const r=a=>{s({id:Number(a.id),type:a.type}),n.show()};return e.jsxs(st,{children:[e.jsx(dt,{children:e.jsx("style",{type:"text/css",children:`
            html, body {
              scrollbar-width: none;
              -ms-overflow-style: none;
            }
          `})}),e.jsx(et,{subpage:!0,k:"global.pages.discover"}),e.jsx("div",{className:"!mt-[-170px]",children:e.jsx(wl,{onShowDetails:r})}),e.jsx("div",{className:"relative z-20 px-4 md:px-10",children:e.jsx(jl,{})}),t&&e.jsx(_t,{id:"discover-details",data:t})]})}function er({onShowDetails:t}){var K,V;const{mediaType:s="movie",contentType:n,id:r,category:a}=vn(),[o,i]=c.useState(1),[l,d]=c.useState(),[m,u]=c.useState(null),[p,g]=c.useState(null),[h,x]=c.useState(""),[y,f]=c.useState(!1),{t:b}=q(),v=be(),w=Ke("discover-details"),{lastView:R}=Ks(),{width:P}=wn(),O=je(),{providers:U,genres:D}=yl(s),S=Object.entries(O.items||{}).filter(([T,X])=>X.type===(s==="tv"?"show":"movie")).map(([T,X])=>({id:T,title:X.title||""})),N=n||(a==null?void 0:a.split("-")[0])||"popular",C=s||(a!=null&&a.endsWith("-tv")?"tv":"movie"),{media:_,isLoading:I,hasMore:A,sectionTitle:L}=vl({contentType:N,mediaType:C,id:r||(m==null?void 0:m.id)||(p==null?void 0:p.id)||h,page:o,genreName:p==null?void 0:p.name,providerName:m==null?void 0:m.name,mediaTitle:(K=S.find(T=>T.id===h))==null?void 0:K.title,isCarouselView:!1});c.useEffect(()=>{if(!I||o>1){const T=setTimeout(()=>{f(!0)},50);return()=>clearTimeout(T)}f(!1)},[I,_,o]);const j=()=>{R?(v(R.url),window.scrollTo(0,R.scrollPosition)):v(-1)},B=async T=>{if(t){t(T);return}d({id:Number(T.id),type:T.type==="movie"?"movie":"show"}),w.show()},W=async()=>{i(T=>T+1)};c.useEffect(()=>{if(n==="provider"&&r){const T=U.find(X=>X.id===r);T&&u({id:T.id,name:T.name})}else if(n==="genre"&&r){const T=D.find(X=>X.id.toString()===r);T&&g({id:T.id.toString(),name:T.name})}else n==="recommendations"&&r&&x(r)},[n,r,U,D]),c.useEffect(()=>{n==="provider"&&m?v(`/discover/more/provider/${m.id}/${C}`):n==="genre"&&p?v(`/discover/more/genre/${p.id}/${C}`):n==="recommendations"&&h&&v(`/discover/more/recommendations/${h}/${C}`)},[m,p,h,n,C,v]);const{visibleButtons:H,dropdownButtons:$}=Ye.useMemo(()=>{const T=n==="provider"?U:n==="genre"?D:[],X=P>850?T.slice(0,7):T.slice(0,2),ae=P>850?T.slice(7):T.slice(2);return{visibleButtons:X,dropdownButtons:ae}},[n,U,D,P]);return I&&o===1?e.jsx(st,{children:e.jsx(lt,{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-mediaCard-hoverBackground rounded w-1/4 mb-8"}),e.jsx(Rt,{children:Array(20).fill(null).map(()=>e.jsx("div",{className:"relative group cursor-default user-select-none rounded-xl p-2 bg-transparent",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-full aspect-[2/3] bg-mediaCard-hoverBackground rounded-lg"}),e.jsx("div",{className:"mt-2 h-4 bg-mediaCard-hoverBackground rounded w-3/4"})]})},`loading-skeleton-${Math.random().toString(36).substring(2)}`))})]})})}):e.jsxs(st,{children:[e.jsxs(lt,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-8",children:[e.jsx(wt,{className:"text-2xl font-bold text-white",children:L}),n==="recommendations"&&e.jsx("div",{className:"relative pr-4",children:e.jsx(Pt,{selectedItem:S.find(T=>T.id===h)?{id:h,name:((V=S.find(T=>T.id===h))==null?void 0:V.title)||""}:{id:"",name:"..."},setSelectedItem:T=>x(T.id),options:S.map(T=>({id:T.id,name:T.title})),customButton:e.jsxs("button",{type:"button",className:"px-2 py-1 text-sm bg-mediaCard-hoverBackground rounded-full hover:bg-mediaCard-background transition-colors flex items-center gap-1",children:[e.jsx("span",{children:b("discover.carousel.change")}),e.jsx(M,{icon:k.UP_DOWN_ARROW,className:"text-xs text-dropdown-secondary"})]}),side:"right"})})]}),e.jsx("div",{className:"flex items-center gap-4 pb-8",children:e.jsxs("button",{type:"button",onClick:j,className:"flex items-center text-white hover:text-gray-300 transition-colors",children:[e.jsx(M,{className:"text-xl",icon:k.ARROW_LEFT}),e.jsx("span",{className:"ml-2",children:b("discover.page.back")})]})}),(n==="provider"||n==="genre")&&e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[H.map(T=>e.jsx("button",{type:"button",onClick:()=>{n==="provider"?u({id:T.id,name:T.name}):g({id:T.id.toString(),name:T.name})},className:`px-3 py-1 text-sm rounded-full transition-colors whitespace-nowrap flex-shrink-0 ${T.id.toString()===((m==null?void 0:m.id)||(p==null?void 0:p.id))?"bg-mediaCard-background":"bg-mediaCard-hoverBackground hover:bg-mediaCard-background"}`,children:T.name},T.id)),$.length>0&&e.jsx("div",{className:"relative",children:e.jsx(Pt,{selectedItem:n==="provider"?m||{id:"",name:"..."}:p||{id:"",name:"..."},setSelectedItem:T=>{n==="provider"?u(T):g(T)},options:$.map(T=>({id:n==="provider"?T.id:T.id.toString(),name:T.name})),customButton:e.jsxs("button",{type:"button",className:"px-3 py-1 text-sm bg-mediaCard-hoverBackground hover:bg-mediaCard-background rounded-full transition-colors flex items-center gap-1",children:[e.jsx("span",{children:"..."}),e.jsx(M,{icon:k.UP_DOWN_ARROW,className:"text-xs text-dropdown-secondary"})]}),side:"right"})})]}),e.jsxs("div",{className:`transition-opacity duration-300 ease-in-out ${y?"opacity-100":"opacity-0"}`,children:[e.jsx(Rt,{children:_.map(T=>{const X=!!T.first_air_date,ae=X?T.first_air_date:T.release_date,ce=ae?parseInt(ae.split("-")[0],10):void 0,Q={id:T.id.toString(),title:T.title||T.name||"",poster:T.poster_path?`https://image.tmdb.org/t/p/w342${T.poster_path}`:"/placeholder.png",type:X?"show":"movie",year:ce,release_date:ae?new Date(ae):void 0};return e.jsx("div",{style:{userSelect:"none"},onContextMenu:xe=>xe.preventDefault(),children:e.jsx(cs,{media:Q,onShowDetails:B,linkable:!0})},T.id)})}),A&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(Z,{theme:"purple",onClick:W,disabled:I,children:b(I?"discover.page.loading":"discover.page.loadMore")})})]})]}),l&&e.jsx(_t,{id:"discover-details",data:l})]})}function rb({onHomeButtonClick:t}){const{t:s}=q();return e.jsxs("div",{className:"relative flex flex-1 flex-col",children:[e.jsx(_n,{}),e.jsx(dt,{children:e.jsx("title",{children:s("downtimeNotice.title")})}),e.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center p-5 text-center",children:e.jsx(Ln,{children:e.jsxs(Pn,{children:[e.jsx(Tn,{icon:k.WARNING,children:s("downtimeNotice.badge")}),e.jsx(ms,{children:s("downtimeNotice.title")}),e.jsx(ye,{children:s("downtimeNotice.message")}),e.jsx("span",{className:"font-bold text-white",children:wy}),e.jsx("div",{className:"flex gap-3",children:e.jsx(Z,{onClick:t,theme:"purple",className:"mt-6",children:s("downtimeNotice.goHome")})})]})})})]})}function ab(){const{t}=q();return e.jsxs("div",{className:"relative flex flex-1 flex-col",children:[e.jsx(dt,{children:e.jsx("title",{children:t("notFound.badge")})}),e.jsx(_n,{}),e.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center p-5 text-center",children:e.jsx(Ln,{children:e.jsxs(Pn,{children:[e.jsx(Tn,{icon:k.EYE_SLASH,children:t("notFound.badge")}),e.jsx(ms,{children:t("notFound.title")}),e.jsx(ye,{children:t("notFound.message")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Z,{href:"/",theme:"secondary",padding:"md:px-12 p-2.5",className:"mt-6",children:t("notFound.goHome")}),e.jsx(Z,{onClick:()=>window.location.reload(),theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:t("notFound.reloadButton")})]})]})})})]})}function ob(){return e.jsx(ab,{})}function ib(t,s){const[n,r]=c.useState(t);return c.useEffect(()=>{const a=setTimeout(()=>{r(t)},s);return()=>{clearTimeout(a)}},[t,s]),n}function lb(t){const s=J(a=>a.enableFeatured),[n,r]=c.useState(!1);return c.useEffect(()=>{const a=()=>{r(!!s&&window.scrollY<600)};return window.addEventListener("scroll",a),a(),()=>{window.removeEventListener("scroll",a)}},[s]),e.jsxs(Ii,{children:[e.jsx(_n,{bg:s?!0:t.showBg,clearBackground:n,noLightbar:s}),t.children]})}function tr(t){const s=t.match(/^\[([a-zA-Z0-9_]+)\](.*)$/);if(s){const n=s[1].toUpperCase(),r=ke[n]||ke.BOOKMARK,a=s[2].trim();return{icon:r,name:a}}return{icon:ke.BOOKMARK,name:t}}const en=20;function cb(){return e.jsx("div",{className:"relative mt-4 group cursor-default rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-full aspect-[2/3] bg-mediaCard-hoverBackground rounded-lg"}),e.jsx("div",{className:"mt-2 h-4 bg-mediaCard-hoverBackground rounded w-3/4"})]})})}function io(){const{t}=q();return e.jsx("div",{className:"relative mt-4 group cursor-pointer rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(vt,{to:"/bookmarks",className:"block",children:e.jsxs(fe.Base,{className:"group -m-[0.705em] h-[20rem] hover:scale-95 transition-all rounded-xl bg-background-main duration-300 hover:bg-mediaCard-hoverBackground tabbable",children:[e.jsx(fe.Light,{flareSize:300,cssColorVar:"--colors-mediaCard-hoverAccent",backgroundClass:"bg-mediaCard-hoverBackground duration-100",className:"rounded-xl bg-background-main group-hover:opacity-100"}),e.jsx(fe.Child,{className:"pointer-events-auto h-[20rem] relative mb-2 p-[0.4em] transition-transform duration-300",children:e.jsxs("div",{className:"flex absolute inset-0 flex-col items-center justify-center",children:[e.jsx(M,{icon:k.ARROW_RIGHT,className:"text-4xl mb-2 transition-transform duration-300"}),e.jsx("span",{className:"text-sm text-center px-2",children:t("home.bookmarks.showAll")})]})})]})})})}function db({carouselRefs:t,onShowDetails:s}){const{t:n}=q(),r=!!window.chrome;let a=!1;const[o,i]=c.useState(!1),l=me(j=>j.removeBookmark),d=He(),m=he(j=>j.account),u=Je(j=>j.groupOrder),p=Je(j=>j.setGroupOrder),g=Ke("bookmark-edit-order-carousel"),[h,x]=c.useState([]),{isMobile:y}=jt(),f=me(j=>Object.keys(j.bookmarks).length),b=je(j=>j.items),v=me(j=>j.bookmarks),w=c.useMemo(()=>{let j=[];return Object.entries(v).forEach(B=>{j.push({id:B[0],...B[1]})}),j=j.sort((B,W)=>{const H=v[B.id],$=v[W.id],K=b[B.id],V=b[W.id],T=Math.max(H.updatedAt,(K==null?void 0:K.updatedAt)??0);return Math.max($.updatedAt,(V==null?void 0:V.updatedAt)??0)-T}),j},[v,b]),{groupedItems:R,regularItems:P}=c.useMemo(()=>{const j={},B=[];return w.forEach(W=>{const H=v[W.id];Array.isArray(H==null?void 0:H.group)?H.group.forEach($=>{j[$]||(j[$]=[]),j[$].push(W)}):B.push(W)}),Object.keys(j).forEach(W=>{j[W].sort((H,$)=>{const K=v[H.id],V=v[$.id],T=b[H.id],X=b[$.id],ae=Math.max(K.updatedAt,(T==null?void 0:T.updatedAt)??0);return Math.max(V.updatedAt,(X==null?void 0:X.updatedAt)??0)-ae})}),{groupedItems:j,regularItems:B}},[w,v,b]),O=c.useMemo(()=>{const j=new Set;return Object.values(v).forEach(B=>{Array.isArray(B.group)&&B.group.forEach(W=>j.add(W))}),j.add("bookmarks"),Array.from(j)},[v]),U=c.useMemo(()=>{const j=g.isShown?h:u;if(j.length===0)return O.map(H=>{const{name:$}=tr(H);return{id:H,name:H==="bookmarks"?n("home.bookmarks.sectionTitle"):$}});const B=new Map(j.map((H,$)=>[H,$]));return O.sort((H,$)=>{const K=B.has(H)?B.get(H):Number.MAX_SAFE_INTEGER,V=B.has($)?B.get($):Number.MAX_SAFE_INTEGER;return K-V}).map(H=>{const{name:$}=tr(H);return{id:H,name:H==="bookmarks"?n("home.bookmarks.sectionTitle"):$}})},[O,n,g.isShown,h,u]),D=c.useMemo(()=>{const j=[],B=new Map;if(Object.entries(R).forEach(([W,H])=>{B.set(W,H)}),P.length>0&&B.set("bookmarks",P),u.length===0)B.forEach((W,H)=>{H==="bookmarks"?j.push({type:"regular",items:W}):j.push({type:"grouped",group:H,items:W})});else{const W=new Map(u.map((H,$)=>[H,$]));Array.from(B.entries()).sort(([H],[$])=>{const K=W.has(H)?W.get(H):Number.MAX_SAFE_INTEGER,V=W.has($)?W.get($):Number.MAX_SAFE_INTEGER;return K-V}).forEach(([H,$])=>{H==="bookmarks"?j.push({type:"regular",items:$}):j.push({type:"grouped",group:H,items:$})})}return j},[R,P,u]),S=j=>{a||(a=!0,Math.abs(j.deltaX)>Math.abs(j.deltaY)&&(j.stopPropagation(),j.preventDefault()),r?setTimeout(()=>{a=!1},345):a=!1)},N=()=>{if(u.length===0){const j=O.map(B=>B);x(j)}else x([...u]);g.show()},C=()=>{N(),i(!0)},_=()=>{g.hide()},I=()=>{p(h),g.hide(),d&&m&&Je.getState().saveGroupOrderToBackend(d,m)},A="bookmarks",L=10;return f===0?null:e.jsxs(e.Fragment,{children:[D.map(j=>{if(j.type==="grouped"){const{icon:B,name:W}=tr(j.group||"");return e.jsxs("div",{children:[e.jsx(gt,{title:W,customIcon:e.jsx("span",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx(xt,{icon:B,className:"w-full h-full"})}),className:"ml-4 md:ml-12 mt-2 -mb-5",children:e.jsxs("div",{className:"mr-4 md:mr-8 flex items-center gap-2",children:[o&&O.length>1&&e.jsx($t,{editing:o,onEdit:C,id:"edit-group-order-button-carousel",text:n("home.bookmarks.groups.reorder.button"),secondaryText:n("home.bookmarks.groups.reorder.done")}),e.jsx(Tt,{editing:o,onEdit:i,id:`edit-button-bookmark-${j.group}`})]})}),e.jsxs("div",{className:"relative overflow-hidden carousel-container md:pb-4",children:[e.jsxs("div",{id:`carousel-${j.group}`,className:"grid grid-flow-col auto-cols-max gap-4 pt-0 overflow-x-scroll scrollbar-none rounded-xl overflow-y-hidden md:pl-8 md:pr-8",ref:H=>{t.current[j.group||"bookmarks"]=H},onWheel:S,children:[e.jsx("div",{className:"md:w-12"}),j.items.slice(0,en).map(H=>e.jsx("div",{onContextMenu:$=>$.preventDefault(),className:"relative mt-4 group cursor-pointer rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(bt,{media:H,onShowDetails:s,closable:o,onClose:()=>l(H.id)},H.id)},H.id)),j.items.length>en&&e.jsx(io,{}),e.jsx("div",{className:"md:w-12"})]}),!y&&e.jsx(_s,{categorySlug:j.group||"bookmarks",carouselRefs:t})]})]},j.group)}return e.jsxs("div",{children:[e.jsx(gt,{title:n("home.bookmarks.sectionTitle"),icon:k.BOOKMARK,className:"ml-4 md:ml-12 mt-2 -mb-5",children:e.jsxs("div",{className:"mr-4 md:mr-8 flex items-center gap-2",children:[o&&O.length>1&&e.jsx($t,{editing:o,onEdit:C,id:"edit-group-order-button-carousel",text:n("home.bookmarks.groups.reorder.button"),secondaryText:n("home.bookmarks.groups.reorder.done")}),e.jsx(Tt,{editing:o,onEdit:i,id:"edit-button-bookmark"})]})}),e.jsxs("div",{className:"relative overflow-hidden carousel-container md:pb-4",children:[e.jsxs("div",{id:`carousel-${A}`,className:"grid grid-flow-col auto-cols-max gap-4 pt-0 overflow-x-scroll scrollbar-none rounded-xl overflow-y-hidden md:pl-8 md:pr-8",ref:B=>{t.current[A]=B},onWheel:S,children:[e.jsx("div",{className:"md:w-12"}),j.items.length>0?j.items.slice(0,en).map(B=>e.jsx("div",{onContextMenu:W=>W.preventDefault(),className:"relative mt-4 group cursor-pointer rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(bt,{media:B,onShowDetails:s,closable:o,onClose:()=>l(B.id)},B.id)},B.id)):Array.from({length:L}).map(()=>e.jsx(cb,{},`skeleton-${A}-${Math.random().toString(36).substring(7)}`)),j.items.length>en&&e.jsx(io,{}),e.jsx("div",{className:"md:w-12"})]}),!y&&e.jsx(_s,{categorySlug:A,carouselRefs:t})]})]},"regular-bookmarks")}),e.jsx(Vr,{id:g.id,isShown:g.isShown,items:U,onCancel:_,onSave:I,onItemsChange:j=>{const B=j.map(W=>W.id);x(B)}})]})}function sr(t){const s=t.match(/^\[([a-zA-Z0-9_]+)\](.*)$/);if(s){const n=s[1].toUpperCase(),r=ke[n]||ke.BOOKMARK,a=s[2].trim();return{icon:r,name:a}}return{icon:ke.BOOKMARK,name:t}}function ub({onItemsChange:t,onShowDetails:s}){const{t:n}=q(),r=je(N=>N.items),a=me(N=>N.bookmarks),o=Je(N=>N.groupOrder),i=Je(N=>N.setGroupOrder),l=me(N=>N.removeBookmark),[d,m]=c.useState(!1),[u]=Os(),p=Ke("bookmark-edit-order"),[g,h]=c.useState([]),x=He(),y=he(N=>N.account),f=c.useMemo(()=>{let N=[];return Object.entries(a).forEach(C=>{N.push({id:C[0],...C[1]})}),N=N.sort((C,_)=>{const I=a[C.id],A=a[_.id],L=r[C.id],j=r[_.id],B=Math.max(I.updatedAt,(L==null?void 0:L.updatedAt)??0);return Math.max(A.updatedAt,(j==null?void 0:j.updatedAt)??0)-B}),N},[a,r]),{groupedItems:b,regularItems:v}=c.useMemo(()=>{const N={},C=[];return f.forEach(_=>{const I=a[_.id];Array.isArray(I==null?void 0:I.group)?I.group.forEach(A=>{N[A]||(N[A]=[]),N[A].push(_)}):C.push(_)}),Object.keys(N).forEach(_=>{N[_].sort((I,A)=>{const L=a[I.id],j=a[A.id],B=r[I.id],W=r[A.id],H=Math.max(L.updatedAt,(B==null?void 0:B.updatedAt)??0);return Math.max(j.updatedAt,(W==null?void 0:W.updatedAt)??0)-H})}),{groupedItems:N,regularItems:C}},[f,a,r]),w=c.useMemo(()=>{const N=new Set;return Object.values(a).forEach(C=>{Array.isArray(C.group)&&C.group.forEach(_=>N.add(_))}),N.add("bookmarks"),Array.from(N)},[a]),R=c.useMemo(()=>{const N=p.isShown?g:o;if(N.length===0)return w.map(I=>{const{name:A}=sr(I);return{id:I,name:I==="bookmarks"?n("home.bookmarks.sectionTitle"):A}});const C=new Map(N.map((I,A)=>[I,A]));return w.sort((I,A)=>{const L=C.has(I)?C.get(I):Number.MAX_SAFE_INTEGER,j=C.has(A)?C.get(A):Number.MAX_SAFE_INTEGER;return L-j}).map(I=>{const{name:A}=sr(I);return{id:I,name:I==="bookmarks"?n("home.bookmarks.sectionTitle"):A}})},[w,n,p.isShown,g,o]),P=c.useMemo(()=>{const N=[],C=new Map;if(Object.entries(b).forEach(([_,I])=>{C.set(_,I)}),v.length>0&&C.set("bookmarks",v),o.length===0)C.forEach((_,I)=>{I==="bookmarks"?N.push({type:"regular",items:_}):N.push({type:"grouped",group:I,items:_})});else{const _=new Map(o.map((I,A)=>[I,A]));Array.from(C.entries()).sort(([I],[A])=>{const L=_.has(I)?_.get(I):Number.MAX_SAFE_INTEGER,j=_.has(A)?_.get(A):Number.MAX_SAFE_INTEGER;return L-j}).forEach(([I,A])=>{I==="bookmarks"?N.push({type:"regular",items:A}):N.push({type:"grouped",group:I,items:A})})}return N},[b,v,o]);c.useEffect(()=>{t(f.length>0)},[f,t]);const O=()=>{if(o.length===0){const N=w.map(C=>C);h(N)}else h([...o]);p.show()},U=()=>{O(),m(!0)},D=()=>{p.hide()},S=()=>{i(g),p.hide(),x&&y&&Je.getState().saveGroupOrderToBackend(x,y)};return f.length===0?null:e.jsxs("div",{className:"relative",children:[P.map(N=>{if(N.type==="grouped"){const{icon:C,name:_}=sr(N.group||"");return e.jsxs("div",{className:"mb-6",children:[e.jsx(gt,{title:_,customIcon:e.jsx("span",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx(xt,{icon:C,className:"w-full h-full"})}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[d&&w.length>1&&e.jsx($t,{editing:d,onEdit:U,id:"edit-group-order-button",text:n("home.bookmarks.groups.reorder.button"),secondaryText:n("home.bookmarks.groups.reorder.done")}),e.jsx(Tt,{editing:d,onEdit:m,id:`edit-button-bookmark-${N.group}`})]})}),e.jsx(Rt,{children:N.items.map(I=>e.jsx("div",{onContextMenu:A=>A.preventDefault(),children:e.jsx(bt,{media:I,closable:d,onClose:()=>l(I.id),onShowDetails:s})},I.id))})]},N.group||"bookmarks")}return e.jsxs("div",{className:"mb-6",children:[e.jsx(gt,{title:n("home.bookmarks.sectionTitle"),icon:k.BOOKMARK,children:e.jsxs("div",{className:"flex items-center gap-2",children:[d&&w.length>1&&e.jsx($t,{editing:d,onEdit:U,id:"edit-group-order-button",text:n("home.bookmarks.groups.reorder.button"),secondaryText:n("home.bookmarks.groups.reorder.done")}),e.jsx(Tt,{editing:d,onEdit:m,id:"edit-button-bookmark"})]})}),e.jsx(Rt,{ref:u,children:N.items.map(C=>e.jsx("div",{onContextMenu:_=>_.preventDefault(),children:e.jsx(bt,{media:C,closable:d,onClose:()=>l(C.id),onShowDetails:s})},C.id))})]},"regular-bookmarks")}),e.jsx(Vr,{id:p.id,isShown:p.isShown,items:R,onCancel:D,onSave:S,onItemsChange:N=>{const C=N.map(_=>_.id);h(C)}})]})}function mb(t){c.useEffect(()=>{const s=n=>{var r;if(n.key==="/"){if(document.activeElement&&document.activeElement.tagName.toLowerCase()==="input")return;n.preventDefault(),(r=t.current)==null||r.focus()}};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[t])}function hb(t){return e.jsx("h1",{className:`text-2xl font-bold text-white sm:text-3xl md:text-4xl ${t.className??""}`,children:t.children})}function fb(){const[t,s]=c.useState(!1);return c.useEffect(()=>{function n(){const r=navigator.userAgent||"";["Silk","SmartTV","Tizen","Web0S","SamsungBrowser","HbbTV","Viera","NetCast","AppleTV","Android TV","GoogleTV","Roku","PlayStation","Xbox","Opera TV","AquosBrowser","Hisense","SonyBrowser","SharpBrowser","AFT","Chromecast"].some(i=>r.toLowerCase().includes(i.toLowerCase()))&&s(!0)}n()},[]),{isTV:t}}function pb(t){const s=t.getMonth()+1,n=t.getDate();if(s===4&&n===20)return"420";if(s===6&&n===9)return"69";if(s===10&&n===31)return"halloween";const r=t.getHours();return r<5?"night":r<12?"morning":r<19?"day":"night"}function lo({setIsSticky:t,searchParams:s,showTitle:n,isInFeatured:r}){const{t:a}=Wr(),[o,i,l]=s,[d,m]=c.useState(!1),u=Mn(),p=c.useCallback(S=>{m(S),t(S)},[m,t]),{width:g,height:h}=wn(),{isTV:x}=fb(),y=/iPad|iPhone|iPod/i.test(navigator.userAgent)&&window.matchMedia("(display-mode: standalone)").matches,f=y?60:16,[b,v]=c.useState(f),R=h<g&&y?-40:0;c.useEffect(()=>{g>1280?v(f):v(f+60+R)},[R,f,g]);const P=pb(new Date),O=a(`home.titles.${P}`),U=a("home.search.placeholder"),D=c.useRef(null);return mb(D),e.jsx(Us,{children:e.jsxs("div",{className:z("space-y-16 text-center",n?"mt-44":"mt-4"),children:[n&&(!x||o.length===0)?e.jsx("div",{className:"relative z-10 mb-16",children:e.jsx(hb,{className:"mx-auto max-w-md",children:O})}):null,e.jsx("div",{className:"relative h-20 z-30",children:e.jsx(ed,{topOffset:b*-1+u,stickyStyle:{paddingTop:`${b+u}px`},onFixedToggle:p,children:e.jsx(Oi,{ref:D,onChange:i,value:o,onUnFocus:l,placeholder:U??"",isSticky:d,isInFeatured:r})})})]})})}function xb(){return e.jsx("div",{className:"relative mt-4 group cursor-default rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-full aspect-[2/3] bg-mediaCard-hoverBackground rounded-lg"}),e.jsx("div",{className:"mt-2 h-4 bg-mediaCard-hoverBackground rounded w-3/4"})]})})}function gb({carouselRefs:t,onShowDetails:s}){const{t:n}=q(),r=!!window.chrome;let a=!1;const[o,i]=c.useState(!1),l=je(y=>y.removeItem),{isMobile:d}=jt(),m=je(y=>Object.entries(y.items).filter(f=>Ds(f[1]).show).length),u=je(y=>y.items),p=c.useMemo(()=>{const y=[];return Object.entries(u).filter(f=>Ds(f[1]).show).sort((f,b)=>b[1].updatedAt-f[1].updatedAt).forEach(f=>{y.push({id:f[0],...f[1]})}),y},[u]),g=y=>{a||(a=!0,Math.abs(y.deltaX)>Math.abs(y.deltaY)&&(y.stopPropagation(),y.preventDefault()),r?setTimeout(()=>{a=!1},345):a=!1)},h="continue-watching",x=10;return m===0?null:e.jsxs(e.Fragment,{children:[e.jsx(gt,{title:n("home.continueWatching.sectionTitle"),icon:k.CLOCK,className:"ml-2 md:ml-8 mt-2 -mb-5",children:e.jsx("div",{className:"mr-6",children:e.jsx(Tt,{editing:o,onEdit:i,id:"edit-button-watching"})})}),e.jsxs("div",{className:"relative overflow-hidden carousel-container md:pb-4",children:[e.jsxs("div",{id:`carousel-${h}`,className:"grid grid-flow-col auto-cols-max gap-4 pt-0 overflow-x-scroll scrollbar-none rounded-xl overflow-y-hidden md:pl-8 md:pr-8",ref:y=>{t.current[h]=y},onWheel:g,children:[e.jsx("div",{className:"md:w-12"}),p.length>0?p.map(y=>e.jsx("div",{onContextMenu:f=>f.preventDefault(),className:"relative mt-4 group cursor-pointer rounded-xl p-2 bg-transparent transition-colors duration-300 w-[10rem] md:w-[11.5rem] h-auto",children:e.jsx(bt,{media:y,onShowDetails:s,closable:o,onClose:()=>l(y.id)},y.id)},y.id)):Array.from({length:x}).map(()=>e.jsx(xb,{},`skeleton-${h}-${Math.random().toString(36).substring(7)}`)),e.jsx("div",{className:"md:w-12"})]}),!d&&e.jsx(_s,{categorySlug:h,carouselRefs:t})]})]})}function bb({onItemsChange:t,onShowDetails:s}){const{t:n}=q(),r=je(m=>m.items),a=je(m=>m.removeItem),[o,i]=c.useState(!1),[l]=Os(),d=c.useMemo(()=>{const m=[];return Object.entries(r).filter(u=>Ds(u[1]).show).sort((u,p)=>p[1].updatedAt-u[1].updatedAt).forEach(u=>{m.push({id:u[0],...u[1]})}),m},[r]);return c.useEffect(()=>{t(d.length>0)},[d,t]),d.length===0?null:e.jsxs("div",{className:"relative",children:[e.jsx(gt,{title:n("home.continueWatching.sectionTitle"),icon:k.CLOCK,children:e.jsx(Tt,{editing:o,onEdit:i,id:"edit-button-watching"})}),e.jsx(Rt,{ref:l,children:d.map(m=>e.jsx("div",{onContextMenu:u=>u.preventDefault(),children:e.jsx(bt,{media:m,closable:o,onClose:()=>a(m.id),onShowDetails:s})},m.id))})]})}function kl(){const{t}=q();return e.jsx(At,{className:"mb-24 mt-40",text:t("home.search.loading")??void 0})}function co(t){const{t:s}=q(),n=be(),r=t.failed?k.WARNING:k.EYE_SLASH;return e.jsxs("div",{className:"mt-40 flex flex-col items-center justify-center space-y-3 text-center",children:[e.jsx(ht,{icon:r,className:`text-xl ${t.failed?"text-red-400":"text-type-logo"}`}),t.failed?null:e.jsx("div",{children:(t.results??0)>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:s("home.search.allResults")}),e.jsx(bn,{className:"px-py p-[0.3em] mt-3 rounded-xl text-type-dimmed box-content text-[17px] bg-largeCard-background justify-center items-center",onClick:()=>n("/discover"),children:s("home.search.discoverMore")})]}):e.jsx("p",{children:s("home.search.noResults")})}),t.failed?e.jsx("div",{children:e.jsx("p",{children:s("home.search.failed")})}):null]})}function yb({searchQuery:t,onShowDetails:s}){const{t:n}=q(),[r,a]=c.useState([]),[o,i]=rt(l=>ii(l));return c.useEffect(()=>{async function l(d){const m=await i(d);m&&a(m)}t!==""&&l({searchQuery:t})},[t,i]),o.loading?e.jsx(kl,{}):o.error?e.jsx(co,{failed:!0}):r?e.jsxs("div",{children:[r.length>0?e.jsxs("div",{children:[e.jsx(gt,{title:n("home.search.sectionTitle"),icon:k.SEARCH}),e.jsx(Rt,{children:r.map(l=>e.jsx(bt,{media:l,onShowDetails:s},l.id.toString()))})]}):null,e.jsx(co,{results:r.length})]}):null}function vb(t){const s=document.cookie.split(";");for(let n=0;n<s.length;n+=1){const r=s[n].trim();if(r.startsWith(`${t}=`))return r.substring(t.length+1)}return null}function wb(t,s,n){const r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);const a=`expires=${r.toUTCString()}`;document.cookie=`${t}=${s};${a};path=/`}function jb(){const[t,s]=c.useState(()=>vb("adDismissed")==="true"),n=c.useCallback(()=>{s(!0),wb("adDismissed","true",2)},[]);return t?null:e.jsx("div",{className:"w-fit max-w-[32rem] mx-auto relative group pb-4",children:(()=>{const r=le().AD_CONTENT_URL;if(!Array.isArray(r))return null;const a=typeof r[1]=="string"&&r[1].length>0,o=typeof r[2]=="string",i=r.length>=2&&a&&o,l=typeof r[3]=="string"&&r[3].length>0,d=typeof r[4]=="string",m=r.length>=5&&l&&d;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 justify-center w-full items-center md:items-start",children:[i?e.jsx("div",{className:"rounded-xl bg-background-main hover:scale-[1.02] max-w-[16rem] md:max-w-[18rem] transition-all duration-300 md:flex-1 relative group",children:e.jsxs("div",{className:"bg-opacity-10 bg-buttons-purple rounded-xl border-2 border-buttons-purple border-opacity-30 hover:border-opacity-70 hover:shadow-lg hover:shadow-buttons-purple/20",children:[" ",e.jsx("button",{onClick:n,type:"button",className:"absolute z-50 -top-2 -right-2 w-6 h-6 bg-mediaCard-hoverBackground rounded-full flex items-center justify-center md:opacity-0 group-hover:opacity-100 transition-opacity duration-300","aria-label":"Dismiss ad",children:e.jsx(M,{className:"text-xs font-semibold text-type-secondary",icon:k.X})}),e.jsxs("a",{href:r[1],className:"block",children:[e.jsx("div",{className:"overflow-hidden rounded-t-xl",children:e.jsx("img",{src:r[2],alt:"ad banner",className:"w-full h-auto transition-transform duration-300"})}),e.jsx("p",{className:"text-xs text-type-dimmed text-center py-2 transition-colors duration-300 group-hover:text-type-secondary",children:e.jsx("span",{children:r[3]})})]})]})}):null,m?e.jsx("div",{className:"rounded-xl bg-background-main hover:scale-[1.02] max-w-[16rem] md:max-w-[18rem] transition-all duration-300 md:flex-1 relative group",children:e.jsxs("div",{className:"bg-opacity-10 bg-buttons-purple rounded-xl border-2 border-buttons-purple border-opacity-30 hover:border-opacity-70 hover:shadow-lg hover:shadow-buttons-purple/20",children:[e.jsx("button",{onClick:n,type:"button",className:"absolute z-50 -top-2 -right-2 w-6 h-6 bg-mediaCard-hoverBackground rounded-full flex items-center justify-center md:opacity-0 group-hover:opacity-100 transition-opacity duration-300","aria-label":"Dismiss ad",children:e.jsx(M,{className:"text-xs font-semibold text-type-secondary",icon:k.X})}),e.jsxs("a",{href:r[4],className:"block",children:[e.jsx("div",{className:"overflow-hidden rounded-t-xl",children:e.jsx("img",{src:r[5],alt:"ad banner",className:"w-full h-auto transition-transform duration-300"})}),e.jsx("p",{className:"text-xs text-type-dimmed text-center py-2 transition-colors duration-300 group-hover:text-type-secondary",children:e.jsx("span",{children:r[6]})})]})]})}):null]}),r[0]!=="null"&&e.jsx("div",{children:e.jsx("p",{className:"text-xs text-type-dimmed text-center pt-2 mx-4",children:e.jsx("a",{href:"https://discord.gg/mcjnJK98Gd",target:"_blank",rel:"noreferrer",children:r[0]})})})]})})()})}function kb(t){const[s,n]=c.useState(!1),[r,a]=c.useState(!1),o=ib(t,500);return c.useEffect(()=>{n(t!==""),a(t!==""),t!==""&&window.scrollTo(0,0)},[t]),c.useEffect(()=>{a(!1)},[o]),{loading:r,searching:s}}function uo(){const{t}=q(),{t:s}=Wr(),n=s("home.search.empty"),r=be(),[a,o]=c.useState(!1),i=Fi(),[l]=i,d=kb(l),[m,u]=c.useState(!1),[p,g]=c.useState(!1),[h,x]=c.useState(),{showModal:y}=at(),f=J(S=>S.enableDiscover),b=J(S=>S.enableFeatured),v=c.useRef({}),w=J(S=>S.enableCarouselView),R=J(S=>S.enableLowPerformanceMode),P=J(S=>S.homeSectionOrder),O=S=>{window.scrollTo(0,0),r(S)},U=async S=>{x({id:Number(S.id),type:S.type==="movie"?"movie":"show"}),y("details")},D=()=>{const S=P.map(N=>{switch(N){case"watching":return w?e.jsx(gb,{carouselRefs:v,onShowDetails:U},"watching"):e.jsx(bb,{onItemsChange:g,onShowDetails:U},"watching");case"bookmarks":return w?e.jsx(db,{carouselRefs:v,onShowDetails:U},"bookmarks"):e.jsx(ub,{onItemsChange:u,onShowDetails:U},"bookmarks");default:return null}});return w?e.jsx(lt,{ultraWide:!0,classNames:"!px-3 md:!px-9",children:S}):e.jsx(lt,{children:e.jsx("div",{className:"flex flex-col gap-8",children:S})})};return e.jsxs(lb,{showBg:a,children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs(dt,{children:[e.jsx("style",{type:"text/css",children:`
            html, body {
              scrollbar-gutter: stable;
            }
          `}),e.jsx("title",{children:t("global.name")})]}),b?e.jsx(wl,{forcedCategory:"movies",onShowDetails:U,searching:d.searching,shorter:!0,children:e.jsx(lo,{searchParams:i,setIsSticky:o,isInFeatured:!0})}):e.jsx(lo,{searchParams:i,setIsSticky:o,showTitle:!0}),le().SHOW_AD?e.jsx(jb,{}):null]}),l&&e.jsx(lt,{children:d.loading?e.jsx(kl,{}):d.searching&&e.jsx(yb,{searchQuery:l,onShowDetails:U})}),!l&&D(),e.jsxs(lt,{ultraWide:!0,classNames:"!px-3 md:!px-9",children:[!(m||p)&&(!f||R)?e.jsx("div",{className:"flex flex-col translate-y-[-30px] items-center justify-center pt-20",children:e.jsx("p",{className:"text-[18.5px] pb-3",children:n})}):null,f&&(b?e.jsx("div",{className:"pb-4"}):m||p?e.jsx("div",{className:"pb-10"}):e.jsx("div",{className:"pb-20"})),f&&!l&&!R?e.jsx(jl,{}):e.jsx("div",{className:"flex flex-col justify-center items-center h-40 space-y-4",children:e.jsx("div",{className:"flex flex-col items-center justify-center",children:!l&&!R&&e.jsx(bn,{className:"px-py p-[0.35em] mt-3 rounded-xl text-type-dimmed box-content text-[18px] bg-largeCard-background justify-center items-center",onClick:()=>O("/discover"),children:t("home.search.discover")})})})]}),h&&e.jsx(_t,{id:"details",data:h})]})}function Nb(t){return e.jsx("button",{className:z("font-bold rounded h-10 w-40 scale-90 hover:scale-95 transition-all duration-200",t.className),type:"button",onClick:t.onClick,disabled:t.disabled,children:t.children})}function Sb(){const{t}=q();return e.jsxs(st,{children:[e.jsx(et,{subpage:!0,k:"global.pages.jip"}),e.jsxs(Us,{children:[e.jsx(wt,{children:t("jip.title")}),e.jsxs(ye,{className:"flex flex-col gap-6",children:[e.jsx(pe,{i18nKey:"jip.text",components:{bold:e.jsx("span",{className:"font-bold",style:{color:"#cfcfcf"}})}}),e.jsx(Nb,{className:"box-content w-full py-1 text-lg bg-buttons-secondary hover:bg-buttons-secondaryHover bg-opacity-90 text-buttons-secondaryText justify-center items-center inline-block",onClick:()=>window.open("https://github.com/jipfr","_blank"),children:"Jipfr on GitHub"})]})]})]})}function zs(t){return e.jsxs("div",{className:"flex flex-col items-center",children:[t.top?e.jsx("div",{className:"inline-block transform translate-y-1/2",children:t.top}):null,e.jsx("div",{className:"w-full rounded-xl bg-largeCard-background bg-opacity-50 max-w-[600px] mx-auto p-[3rem]",children:t.children})]})}function Gs(t){return e.jsx("div",{className:"flex flex-col items-center text-center mb-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center max-w-[318px]",children:[t.icon?e.jsx("div",{className:"text-2xl mb-4 text-largeCard-icon",children:t.icon}):null,e.jsx("h2",{className:"text-xl text-white font-bold",children:t.title}),t.children?e.jsx("div",{className:"text-type-text mt-4",children:t.children}):null]})})}function ps(t){return e.jsx("div",{className:"mt-12",children:e.jsx("div",{className:z("mx-auto",{"flex flex-row-reverse justify-between items-center":t.splitAlign,"flex max-w-xs flex-col-reverse gap-3":!t.splitAlign}),children:t.children})})}function Lt(t){return e.jsxs("div",{className:z("space-y-3",t.className),children:[t.label?e.jsx("p",{className:"font-bold text-white",children:t.label}):null,e.jsx(Hr,{name:t.name,value:t.value,autoComplete:t.autoComplete,onChange:t.onChange,placeholder:t.placeholder,passwordToggleable:t.passwordToggleable,className:"w-full flex-1 bg-authentication-inputBg px-4 py-3 text-search-text focus:outline-none rounded-lg placeholder:text-gray-700"})]})}function Cb(t){const[s,n]=c.useState(""),[r,a]=c.useState(""),{login:o,restore:i,importData:l}=Mt(),d=je(h=>h.items),m=me(h=>h.bookmarks),{t:u}=q(),[p,g]=rt(async(h,x)=>{var b;if(!qu(h))throw new Error(u("auth.login.validationError")??void 0);const y=x.trim();if(y.length===0)throw new Error(u("auth.login.deviceLengthError")??void 0);let f;try{f=await o({mnemonic:h,userData:{device:y}})}catch(v){throw v.status===401?new Error(u("auth.login.validationError")??void 0):v}if(!f)throw new Error(u("auth.login.validationError")??void 0);await l(f,d,m),await i(f),(b=t.onLogin)==null||b.call(t)},[t,o,i,u]);return e.jsxs(zs,{top:e.jsx(qt,{backgroundClass:"bg-[#161527]"}),children:[e.jsx(Gs,{title:u("auth.login.title"),children:u("auth.login.description")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Lt,{label:u("auth.login.passphraseLabel")??void 0,value:s,autoComplete:"username",name:"username",onChange:n,placeholder:u("auth.login.passphrasePlaceholder")??void 0,passwordToggleable:!0}),e.jsx(Lt,{label:u("auth.deviceNameLabel")??void 0,value:r,onChange:a,placeholder:u("auth.deviceNamePlaceholder")??void 0}),p.error&&!p.loading?e.jsx("p",{className:"text-authentication-errorText",children:p.error.message}):null]}),e.jsx(ps,{children:e.jsx(Z,{theme:"purple",loading:p.loading,onClick:()=>g(s,r),children:u("auth.login.submit")})}),e.jsx("p",{className:"text-center mt-6",children:e.jsx(pe,{i18nKey:"auth.createAccount",children:e.jsx(Vs,{to:"/register",children:"."})})})]})}function Eb(){const t=be();return e.jsxs(st,{children:[e.jsx(et,{subpage:!0,k:"global.pages.login"}),e.jsx(Cb,{onLogin:()=>{t("/")}})]})}const Ib=function(s){const n=s.current/s.steps*100;return e.jsxs("div",{className:s.className,children:[e.jsxs("p",{className:"mb-2",children:[s.current,"/",s.steps]}),e.jsx("div",{className:"max-w-full h-1 w-32 bg-onboarding-bar rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-onboarding-barFilled transition-[width] rounded-full",style:{width:`${n.toFixed(0)}%`}})})]})},Yt=Ib;function Et(t){return e.jsx("div",{className:z("w-full grid justify-center",t.className),children:e.jsx("div",{className:"w-px h-10 bg-onboarding-divider"})})}function Qt(t){return e.jsxs("div",{className:"bg-background-main min-h-screen",style:{backgroundImage:"linear-gradient(to bottom, var(--tw-gradient-from), var(--tw-gradient-to) 800px)"},children:[e.jsx(bs,{}),e.jsx("div",{className:"fixed px-7 py-5 left-0 top-0 z-20",children:e.jsx(vt,{className:"block tabbable rounded-full text-xs ssm:text-base",to:"/",children:e.jsx(qt,{clickable:!0})})}),e.jsx("div",{className:"min-h-screen",children:t.children})]})}function Tb(){const t=be(),{t:s}=q();return e.jsxs(Qt,{children:[e.jsx(et,{subpage:!0,k:"global.pages.migration"}),e.jsxs(Ur,{children:[e.jsx(Yt,{steps:2,current:1,className:"mb-12"}),e.jsx(Ce,{className:"!mt-0 !text-3xl",children:s("migration.start.title")}),e.jsx(ye,{className:"max-w-[360px]",children:s("migration.start.explainer")}),e.jsxs("div",{className:"w-full flex flex-col md:flex-row gap-3",children:[e.jsx(Gn,{onClick:()=>t("/migration/direct"),className:"flex-1",children:e.jsx(qn,{colorClass:"!text-onboarding-best",title:s("migration.start.options.direct.title"),subtitle:s("migration.start.options.direct.quality"),description:e.jsx(pe,{i18nKey:"migration.start.options.direct.description"}),icon:k.CLOUD_ARROW_UP,children:e.jsx(nn,{children:s("migration.start.options.direct.action")})})}),e.jsxs("div",{className:"hidden md:grid grid-rows-[1fr,auto,1fr] justify-center gap-4",children:[e.jsx(Et,{className:"items-end"}),e.jsx("span",{className:"text-xs uppercase font-bold",children:s("migration.start.options.or")}),e.jsx(Et,{})]}),e.jsx(Gn,{onClick:()=>t("/migration/download"),className:"flex-1",children:e.jsx(qn,{colorClass:"!text-migration-good",title:s("migration.start.options.download.title"),subtitle:s("migration.start.options.download.quality"),description:s("migration.start.options.download.description"),icon:k.FILE_ARROW_DOWN,children:e.jsx(nn,{children:s("migration.start.options.download.action")})})}),e.jsxs("div",{className:"hidden md:grid grid-rows-[1fr,auto,1fr] justify-center gap-4",children:[e.jsx(Et,{className:"items-end"}),e.jsx("span",{className:"text-xs uppercase font-bold",children:s("migration.start.options.or")}),e.jsx(Et,{})]}),e.jsx(Gn,{onClick:()=>t("/migration/upload"),className:"flex-1",children:e.jsx(qn,{colorClass:"!text-migration-good",title:s("migration.start.options.upload.title"),subtitle:s("migration.start.options.upload.quality"),description:s("migration.start.options.upload.description"),icon:k.CLOUD_ARROW_UP,children:e.jsx(nn,{children:s("migration.start.options.upload.action")})})})]})]})]})}function Wt(t){return e.jsx("div",{className:z("w-full rounded-lg bg-settings-card-background bg-opacity-[0.15] border border-settings-card-border",t.paddingClass??"px-8 py-6",t.className),children:t.children})}function sv(t){return e.jsx("div",{className:z("w-full rounded-lg bg-settings-card-altBackground bg-opacity-50",t.paddingClass??"px-8 py-6",t.className),children:t.children})}function Rb(){const t=he(i=>i.account),s=je(i=>i.items),n=me(i=>i.bookmarks),{login:r}=wi(),a=async(i,l,d,m)=>{if(Object.keys(d).length===0&&Object.keys(m).length===0)return;const u=Object.entries(d).flatMap(([g,h])=>bi(g,h)),p=Object.entries(m).map(([g,h])=>ui(g,h));await Promise.all([xi(i,l,u),gi(i,l,p)])};return{migrate:c.useCallback(async(i,l)=>{if(!t)return;const{challenge:d}=await yi(i,l||void 0),m=await mi(In(t.seed)),u=await dr(m,d),p=await vi(i,{challenge:{code:d,signature:u},publicKey:xn(m.publicKey),device:await ur(t.deviceName,m.seed),profile:t.profile}),g=await r(p,p.user,p.session,pn(m.seed));return await a(i,g,s,n),g},[t,r,n,s])}}function Pb(){const{t}=q(),s=he(),{logout:n}=Mt(),r=be(),{migrate:a}=Rb(),[o,i]=c.useState(""),[l,d]=c.useState("idle"),m=he(g=>g.setBackendUrl),u=c.useCallback(async()=>{if(l!=="processing"){if(!o){alert("Please provide a Backend URL.");return}try{d("processing"),await a(o)?(d("success"),m(o)):d("error")}catch(g){console.error("Error during migration:",g),d("error")}}},[o,a,m,l]),p=()=>{l==="success"&&n().then(()=>{r("/login")})};return e.jsxs(Qt,{children:[e.jsx(et,{subpage:!0,k:"global.pages.migration"}),e.jsx(Hs,{children:s.account?e.jsxs("div",{children:[e.jsx(Yt,{steps:2,current:2,className:"mb-12"}),e.jsxs(Ce,{className:"!text-4xl",children:[" ",t("migration.direct.title")]}),e.jsxs("div",{className:"space-y-6 max-w-3xl mx-auto",children:[e.jsx(ye,{className:"text-lg max-w-md",children:t("migration.direct.description")}),e.jsxs(Wt,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("p",{className:"font-bold text-white",children:t("migration.direct.backendLabel")})}),o!==null&&e.jsxs(e.Fragment,{children:[e.jsx(nt,{marginClass:"my-6 px-8 box-content -mx-8"}),e.jsx(Lt,{placeholder:"https://",value:o??"",onChange:i})]})]})]}),e.jsx(nt,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Z,{theme:"secondary",onClick:()=>r("/migration"),children:t("migration.back")}),l!=="success"&&e.jsx(Z,{theme:"purple",onClick:u,disabled:l==="processing",children:t(l==="processing"?"migration.direct.button.processing":"migration.direct.button.migrate")}),l==="success"&&e.jsx("div",{children:e.jsx(Z,{theme:"purple",className:"mt-4",onClick:p,children:t("migration.direct.button.login")})})]}),e.jsxs("div",{className:"flex justify-center",children:[l==="success"&&e.jsx("p",{className:"text-green-600 mt-4",children:t("migration.direct.status.success")}),l==="error"&&e.jsx("p",{className:"text-red-600 mt-4",children:t("migration.direct.status.error")})]})]}):e.jsxs("div",{className:"flex flex-col items-center text-center mb-8",children:[e.jsx(ye,{className:"max-w-[320px] text-md",children:t("migration.loginRequired")}),e.jsx(Z,{theme:"purple",className:"mt-4",onClick:()=>r("/"),children:t("migration.direct.button.home")})]})})]})}function Lb(){const{t}=q(),s=he(),n=be(),r=me(d=>d.bookmarks),a=je(d=>d.items),[o,i]=c.useState("idle"),l=c.useCallback(()=>{var d,m;try{const u={account:{profile:(d=s.account)==null?void 0:d.profile,deviceName:(m=s.account)==null?void 0:m.deviceName},bookmarks:r,progress:a,exportDate:new Date().toISOString()},p=JSON.stringify(u,null,2),g=`data:application/json;charset=utf-8,${encodeURIComponent(p)}`,h=`mw-account-data-${new Date().toISOString().split("T")[0]}.json`,x=document.createElement("a");x.setAttribute("href",g),x.setAttribute("download",h),x.click(),i("success")}catch(u){console.error("Error during data download:",u),i("error")}},[r,a,s.account]);return e.jsxs(Qt,{children:[e.jsx(et,{subpage:!0,k:"global.pages.migration"}),e.jsx(Hs,{children:e.jsxs("div",{children:[e.jsx(Yt,{steps:2,current:2,className:"mb-12"}),e.jsx(Ce,{className:"!text-4xl",children:t("migration.download.title")}),e.jsxs("div",{className:"space-y-6 max-w-3xl mx-auto",children:[e.jsx(ye,{className:"text-lg max-w-md",children:t("migration.download.description")}),e.jsxs(Wt,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs(Gt,{className:"!my-0 !text-type-secondary",children:[t("migration.download.items.description")," "]})}),e.jsx(nt,{marginClass:"my-6 px-8 box-content -mx-8"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-background rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{icon:k.BOOKMARK,className:"text-xl"}),e.jsx("span",{className:"font-medium",children:t("migration.download.items.bookmarks")})]}),e.jsx("div",{className:"text-xl font-bold mt-2",children:Object.keys(r).length})]}),e.jsxs("div",{className:"p-4 bg-background rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{icon:k.CLOCK,className:"text-xl"}),e.jsx("span",{className:"font-medium",children:t("migration.download.items.progress")})]}),e.jsx("div",{className:"text-xl font-bold mt-2",children:Object.keys(a).length})]})]})]})]}),e.jsx(nt,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Z,{theme:"secondary",onClick:()=>n("/migration"),children:t("migration.back")}),o!=="success"&&e.jsx(Z,{theme:"purple",onClick:l,children:t("migration.download.button.download")}),o==="success"&&e.jsx("div",{children:e.jsx(Z,{theme:"purple",onClick:()=>n("/"),children:t("migration.download.button.home")})})]}),e.jsxs("div",{className:"flex justify-center pt-4",children:[o==="success"&&e.jsx("p",{className:"text-green-600 mt-4",children:t("migration.download.status.success")}),o==="error"&&e.jsx("p",{className:"text-red-600 mt-4",children:t("migration.download.status.error")})]})]})})]})}function Db(){const{t}=q(),s=be(),n=he(),{importData:r}=Mt(),a=c.useRef(null),o=me(v=>v.replaceBookmarks),i=je(v=>v.replaceItems),[l,d]=c.useState(null),[m,u]=c.useState("idle"),[p,g]=c.useState(null),h=()=>{a.current&&a.current.click()},x=async v=>{try{u("processing");const w=await v.text(),R=JSON.parse(w),P={...R,bookmarks:R.bookmarks?Object.entries(R.bookmarks).reduce((O,[U,D])=>(typeof D.type=="string"&&(D.type==="show"||D.type==="movie")&&(O[U]={title:D.title||"",year:typeof D.year=="number"?D.year:void 0,poster:D.poster,type:D.type,updatedAt:typeof D.updatedAt=="number"?D.updatedAt:Date.now()}),O),{}):void 0,progress:R.progress?Object.entries(R.progress).reduce((O,[U,D])=>(typeof D.type=="string"&&(D.type==="show"||D.type==="movie")&&(O[U]={title:D.title||"",poster:D.poster,type:D.type,updatedAt:typeof D.updatedAt=="number"?D.updatedAt:Date.now(),year:typeof D.year=="number"?D.year:void 0,progress:D.progress,episodes:D.episodes||{},seasons:D.seasons||{}}),O),{}):void 0};g(P),u("idle")}catch(w){console.error("Error parsing JSON file:",w),u("error")}},y=v=>{if(v.target.files&&v.target.files.length>0){d(v.target.files[0]),u("idle"),g(null);const w=v.target.files[0];x(w)}},f=c.useCallback(()=>{m!=="processing"&&(!p||!n.account||(u("processing"),p.bookmarks&&o(p.bookmarks),p.progress&&i(p.progress),r(n.account,p.progress||{},p.bookmarks||{}).then(()=>{u("success")}).catch(v=>{console.error("Error importing data:",v),u("error")})))},[o,i,p,n.account,r,m]),b=c.useCallback(()=>{if(p){u("processing");try{p.bookmarks&&(localStorage.setItem("__MW::bookmarks",JSON.stringify({state:{bookmarks:p.bookmarks}})),o(p.bookmarks)),p.progress&&(localStorage.setItem("__MW::progress",JSON.stringify({state:{items:p.progress}})),i(p.progress)),u("success")}catch{u("error")}}},[p,o,i]);return e.jsxs(Qt,{children:[e.jsx(et,{k:"migration.upload.title",subpage:!0}),e.jsx(Hs,{children:e.jsxs("div",{children:[e.jsx(Yt,{current:2,steps:2,className:"mb-12"}),e.jsx(Ce,{className:"!text-4xl !mt-0",children:t("migration.upload.title")}),e.jsx(ye,{className:"text-lg max-w-md mb-6",children:t("migration.upload.description")}),e.jsx(Wt,{children:e.jsxs("div",{className:"flex py-6 flex-col space-y-4 items-center justify-center",children:[e.jsx("div",{className:"flex flex-col space-y-2 w-full items-center",children:e.jsxs("p",{className:"text-sm",children:[t("migration.upload.file.description"),":"]})}),e.jsx("input",{type:"file",accept:".json",onChange:y,ref:a,className:"hidden"}),e.jsxs(Z,{onClick:h,theme:"purple",className:"w-full max-w-xs",padding:"md:px-12 p-2.5",children:[e.jsx(M,{icon:k.FILE,className:"pr-2"}),t(l?"migration.upload.file.change":"migration.upload.file.select")]}),l&&e.jsx("div",{className:"text-center mt-2 w-full",children:e.jsxs("span",{className:"text-sm font-medium",children:[l.name,(p==null?void 0:p.exportDate)&&e.jsxs("div",{className:"text-sm pb-2",children:[t("migration.upload.exportedOn"),":"," ",new Date((p==null?void 0:p.exportDate)||"").toLocaleDateString()]})]})}),m==="processing"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400",children:[e.jsx(M,{icon:k.CLOCK,className:"pr-2"}),t("migration.upload.status.processing")]}),m==="error"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-400",children:[e.jsx(M,{icon:k.WARNING,className:"pr-2"}),t("migration.upload.status.error")]})]})}),p&&e.jsxs(Wt,{className:"mt-6",children:[e.jsx(Ce,{className:"!my-0 !text-type-secondary",children:t("migration.upload.dataPreview")}),e.jsx(nt,{marginClass:"my-6 px-8 box-content -mx-8"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-background rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{icon:k.BOOKMARK,className:"text-xl"}),e.jsx("span",{className:"font-medium",children:t("migration.upload.items.bookmarks")})]}),e.jsx("div",{className:"text-xl font-bold mt-2",children:p.bookmarks?Object.keys(p.bookmarks).length:0})]}),e.jsxs("div",{className:"p-4 bg-background rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{icon:k.CLOCK,className:"text-xl"}),e.jsx("span",{className:"font-medium",children:t("migration.upload.items.progress")})]}),e.jsx("div",{className:"text-xl font-bold mt-2",children:p.progress?Object.keys(p.progress).length:0})]})]}),e.jsx("div",{className:"flex py-6 flex-col space-y-2 items-center justify-center",children:m==="success"?e.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[e.jsx(M,{icon:k.CHECKMARK,className:"pr-2"}),n.account?t("migration.upload.status.success"):t("migration.upload.status.successLocal")]}):n.account?e.jsxs(Z,{onClick:f,className:"w-full max-w-xs",theme:"purple",padding:"md:px-12 p-2.5",disabled:m==="processing",children:[e.jsx(M,{icon:k.CLOUD_ARROW_UP,className:"pr-2"}),t(m==="processing"?"migration.upload.button.processing":"migration.upload.button.import")]}):e.jsxs(Z,{onClick:b,className:"w-full max-w-xs",theme:"purple",padding:"md:px-12 p-2.5",disabled:m==="processing",children:[e.jsx(M,{icon:k.CLOUD_ARROW_UP,className:"pr-2"}),t(m==="processing"?"migration.upload.button.processing":"migration.upload.button.saveLocal")]})})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx(Z,{theme:"secondary",onClick:()=>s("/migration"),children:t("migration.back")}),m==="success"&&e.jsx(Z,{onClick:()=>s("/"),theme:"purple",children:t("migration.upload.button.home")})]})]})})]})}const Ab=Ae(Ze(Oe(t=>({completed:!1,setCompleted(s){t(n=>{n.completed=s})}})),{name:"__MW::onboarding"}));function Yr(){const[t]=$r("redirect"),s=be(),n=Ab(o=>o.setCompleted),r=c.useCallback(()=>{s(t??"/")},[s,t]);return{completeAndRedirect:c.useCallback(()=>{n(!0),r()},[r,n])}}function Qr(){const t=be(),s=xs();return c.useCallback(r=>{t({pathname:r,search:s.search})},[t,s])}const Xr=Ae()(Ze(t=>({region:null,lastChecked:null,userPicked:!1,setRegion:(s,n=!1)=>{t({region:s,lastChecked:Math.floor(Date.now()/1e3),userPicked:n})}}),{name:"__MW::region",version:8})),Mb=[{region:"dallas",lat:32.7767,lon:-96.797},{region:"portland",lat:45.5152,lon:-122.6784},{region:"new-york",lat:40.7128,lon:-74.006},{region:"paris",lat:48.8566,lon:2.3522},{region:"hong-kong",lat:22.3193,lon:114.1694},{region:"kansas",lat:39.0997,lon:-94.5786},{region:"sydney",lat:-33.8688,lon:151.2093},{region:"singapore",lat:1.3521,lon:103.8198},{region:"mumbai",lat:19.076,lon:72.8777}];function _b(t,s,n,r){const o=t*Math.PI/180,i=n*Math.PI/180,l=(n-t)*Math.PI/180,d=(r-s)*Math.PI/180,m=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o)*Math.cos(i)*Math.sin(d/2)*Math.sin(d/2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function mo(t){const{latitude:s,longitude:n}=t;let r="unknown",a=1/0;for(const{region:o,lat:i,lon:l}of Mb){const d=_b(s,n,i,l);d<a&&(a=d,r=o)}return r}async function Ob(){const t=Xr.getState();if(t.userPicked&&t.region||!(!t.region||!t.lastChecked||Math.floor(Date.now()/1e3)-t.lastChecked>=2592e3)&&t.region)return t.region;try{const r=await(await fetch("https://ipapi.co/json/")).json();if(typeof r.latitude!="number"||typeof r.longitude!="number"){const i=await(await fetch("https://ipinfo.io/json")).json();if(i.loc){const[l,d]=i.loc.split(",").map(Number),m=mo({latitude:l,longitude:d});return t.userPicked||t.setRegion(m),m}return"unknown"}const a=mo(r);return t.userPicked||t.setRegion(a),a}catch(n){return console.warn("Failed to detect region:",n),t.region||"unknown"}}function Bb(){var r;const{region:t,setRegion:s}=Xr(),n=[{id:"dallas",name:"Dallas, TX"},{id:"portland",name:"Portland, OR"},{id:"new-york",name:"New York, NY"},{id:"paris",name:"Paris, France"},{id:"hong-kong",name:"Hong Kong"},{id:"kansas",name:"Kansas City, MO"},{id:"sydney",name:"Sydney, Australia"},{id:"singapore",name:"Singapore"},{id:"mumbai",name:"Mumbai, India"}];return e.jsx(Pt,{options:n,selectedItem:{id:t||"new-york",name:((r=n.find(a=>a.id===t))==null?void 0:r.name)||"Unknown (New York, NY)"},setSelectedItem:a=>s(a.id,!0),direction:"up"})}const ho="https://postman-echo.com/get",os=t=>new Promise(s=>{setTimeout(()=>{s()},t)});function Fb(t){return new Promise((s,n)=>{setTimeout(()=>n(new Error("Timed out!")),3e3),Cn(t,ho,{}).then(r=>{if(r.url!==ho)return n(new Error("Not a proxy"));s()}).catch(n)})}async function Nl(t){const s="https://fed-api.pstream.mov/movie/412059";if(!t)return"unset";let n=0;const r=2;for(;n<r;){console.log(`Attempt ${n+1} of ${r} to check Febbox token`);try{const a=await fetch(s,{headers:{"ui-token":t}});if(!a.ok){if(console.error("Febbox API test failed with status:",a.status),a.status===503||a.status===502)return"api_down";if(n+=1,n===r)return console.log("Max attempts reached, returning error"),"invalid_token";console.log("Retrying after failed response..."),await os(3e3);continue}const o=await a.json();if(!o||!o.streams){if(console.error("Invalid response format from Febbox API:",o),n+=1,n===r)return console.log("Max attempts reached, returning error"),"invalid_token";console.log("Retrying after invalid response format..."),await os(3e3);continue}if(Object.values(o.streams).some(l=>typeof l=="string"?l.toLowerCase().includes("vip"):!1))return console.log("VIP link found, returning success"),"success";if(console.log("No VIP link found in attempt",n+1),n+=1,n===r)return console.log("Max attempts reached, returning error"),"invalid_token";console.log("Retrying after no VIP link found..."),await os(3e3)}catch(a){if(console.error("Error testing Febbox token:",a),n+=1,n===r)return console.log("Max attempts reached, returning error"),"api_down";console.log("Retrying after error..."),await os(3e3)}}return console.log("All attempts exhausted, returning error"),"api_down"}async function $b(t){if(!t)return"unset";const s=2;let n=0;for(;n<s;)try{console.log(`RD API attempt ${n+1}`);const r=await Ht("https://api.real-debrid.com/rest/1.0/user",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(r&&typeof r=="object"&&r.type==="premium")return console.log("RD premium status confirmed"),"success";if(console.log("RD response did not indicate premium status"),n+=1,n===s)return"invalid_token";await os(3e3)}catch(r){if(console.error("RD API error:",r),n+=1,n===s)return"api_down";await os(3e3)}return"api_down"}function Ub(){const t=he(i=>i.proxySet),s=J(i=>i.febboxKey),n=J(i=>i.realDebridKey),{loading:r,value:a}=Dt(async()=>{const i=await Sn()?"success":"unset";let l="unset";if(t&&t.length>0)try{await Fb(t[0]),l="success"}catch{l="error"}const d=await Nl(s),m=await $b(n);return{extension:i,proxy:l,defaultProxy:"success",...le().ALLOW_FEBBOX_KEY&&{febboxKeyTest:d},realDebridKeyTest:m}},[t,s,n]);let o="unset";return((a==null?void 0:a.extension)==="success"||(a==null?void 0:a.proxy)==="success"||(a==null?void 0:a.febboxKeyTest)==="success"||(a==null?void 0:a.realDebridKeyTest)==="success")&&(o="success"),((a==null?void 0:a.proxy)==="error"||(a==null?void 0:a.extension)==="error"||(a==null?void 0:a.febboxKeyTest)==="error"||(a==null?void 0:a.realDebridKeyTest)==="error")&&(o="error"),{setupStates:a,globalState:o,loading:r}}function Ns(t){const{t:s}=q(),n={error:"error",success:"success",unset:"noresult",api_down:"error",invalid_token:"error"};return e.jsxs("div",{className:"flex items-start text-type-dimmed my-4",children:[e.jsx(qr,{type:n[t.status],className:z({"!text-video-scraping-noresult !bg-video-scraping-noresult opacity-50":t.grey,"scale-90 mr-3":!0})}),e.jsxs("div",{children:[e.jsx("p",{className:z({"!text-white":t.grey&&t.highlight,"!text-type-dimmed opacity-75":t.grey&&!t.highlight,"text-type-danger":t.status==="error","text-white":t.status==="success"}),children:t.children}),t.status==="error"?e.jsx("p",{className:"max-w-96",children:s("settings.connections.setup.itemError")}):null]})]})}function nv(){const{t}=q(),s=be(),{loading:n,setupStates:r,globalState:a}=Ub();if(n||!r)return e.jsx(Wt,{children:e.jsx("div",{className:"flex py-6 items-center justify-center",children:e.jsx(At,{})})});const o={error:{title:"settings.connections.setup.errorStatus.title",desc:"settings.connections.setup.errorStatus.description",button:"settings.connections.setup.redoSetup"},success:{title:"settings.connections.setup.successStatus.title",desc:"settings.connections.setup.successStatus.description",button:"settings.connections.setup.redoSetup"},unset:{title:"settings.connections.setup.unsetStatus.title",desc:"settings.connections.setup.unsetStatus.description",button:"settings.connections.setup.doSetup"},api_down:{title:"settings.connections.setup.errorStatus.title",desc:"settings.connections.setup.errorStatus.description",button:"settings.connections.setup.redoSetup"},invalid_token:{title:"settings.connections.setup.errorStatus.title",desc:"settings.connections.setup.errorStatus.description",button:"settings.connections.setup.redoSetup"}};return e.jsx(Wt,{children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start gap-4",children:[e.jsx("div",{children:e.jsx("div",{className:z({"rounded-full h-12 w-12 flex bg-opacity-15 justify-center items-center":!0,"text-type-success bg-type-success":a==="success","text-type-danger bg-type-danger":a==="error"||a==="unset"}),children:e.jsx(M,{icon:a==="success"?k.CHECKMARK:k.X,className:"text-xl"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Gt,{className:"!mb-3",children:t(o[a].title)}),e.jsx("p",{className:"max-w-[20rem] font-medium mb-6",children:t(o[a].desc)}),e.jsx(Ns,{status:r.extension,children:t("settings.connections.setup.items.extension")}),e.jsx(Ns,{status:r.proxy,children:t("settings.connections.setup.items.proxy")}),e.jsx(Ns,{grey:!0,highlight:a==="unset",status:r.defaultProxy,children:t("settings.connections.setup.items.default")}),le().ALLOW_REAL_DEBRID_KEY&&e.jsx(Ns,{status:r.realDebridKeyTest||"unset",children:"Real Debrid token"}),le().ALLOW_FEBBOX_KEY&&e.jsx(Ns,{status:r.febboxKeyTest||"unset",children:"Febbox UI token"})]}),e.jsx("div",{className:"md:mt-5",children:e.jsx(Z,{theme:"purple",onClick:()=>s("/onboarding"),children:t(o[a].button)})})]})})}async function Hb(t){return t?await Nl(t):"unset"}function Vb(){const{t}=q(),s=J(g=>g.febboxKey),n=J(g=>g.setFebboxKey),r=Ke("febbox-example"),[a,o]=c.useState(s!==null&&s!=="");c.useEffect(()=>{s&&s.length>0&&o(!0)},[s]);const[i,l]=c.useState("unset"),d={error:"error",success:"success",unset:"noresult",api_down:"error",invalid_token:"error"};c.useEffect(()=>{(async()=>{const h=await Hb(s);l(h)})()},[s]);const m=()=>{a?(n(""),o(!1)):o(!0)},[u,p]=c.useState(!1);if(le().ALLOW_FEBBOX_KEY)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-6",children:e.jsxs(Wt,{children:[e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"my-3",children:[e.jsx("p",{className:"text-white font-bold mb-3",children:t("fedapi.onboarding.title")}),e.jsx("p",{className:"max-w-[30rem] font-medium",children:e.jsx(pe,{i18nKey:"fedapi.onboarding.description"})})]}),e.jsx("div",{children:e.jsx(ct,{onClick:m,enabled:a})})]}),a?e.jsxs(e.Fragment,{children:[e.jsx(nt,{marginClass:"my-6 px-8 box-content -mx-8"}),e.jsxs("div",{className:"my-3",children:[e.jsxs("p",{className:"max-w-[30rem] font-medium",children:[t("fedapi.setup.title"),e.jsx("br",{}),e.jsxs("div",{onClick:()=>p(!u),className:"flex items-center justify-between p-1 px-2 my-2 w-fit border border-type-secondary rounded-lg cursor-pointer text-type-secondary hover:text-white transition-colors duration-200",children:[e.jsx("span",{className:"text-sm",children:t(u?"fedapi.setup.hideVideo":"fedapi.setup.showVideo")}),u?e.jsx(M,{icon:k.CHEVRON_UP,className:"pl-1"}):e.jsx(M,{icon:k.CHEVRON_DOWN,className:"pl-1"})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative pt-[56.25%] mt-2",children:e.jsx("iframe",{src:"https://player.vimeo.com/video/1059834885?h=c3ab398d42&badge=0&autopause=0&player_id=0&app_id=58479",allow:"autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media",className:"absolute top-0 left-0 w-full h-full border border-type-secondary rounded-lg bg-black",title:"P-Stream FED API Setup Tutorial"})}),e.jsx("br",{})]}),e.jsx(pe,{i18nKey:"fedapi.setup.step.1",children:e.jsx(Vs,{url:"https://febbox.com"})}),e.jsx("br",{}),e.jsx(pe,{i18nKey:"fedapi.setup.step.2"}),e.jsx("br",{}),e.jsx(pe,{i18nKey:"fedapi.setup.step.3"}),e.jsx("br",{}),e.jsx(pe,{i18nKey:"fedapi.setup.step.4"})," ",e.jsx("button",{type:"button",onClick:r.show,className:"text-type-link hover:text-type-linkHover",children:e.jsx(pe,{i18nKey:"fedapi.setup.tokenExample.button"})}),e.jsx("br",{}),e.jsx(pe,{i18nKey:"fedapi.setup.step.5"})]}),e.jsx("p",{className:"text-type-danger mt-2",children:e.jsx(pe,{i18nKey:"fedapi.setup.step.warning"})})]}),e.jsx(nt,{marginClass:"my-6 px-8 box-content -mx-8"}),e.jsx("p",{className:"text-white font-bold mb-3",children:t("fedapi.setup.tokenLabel")}),e.jsxs("div",{className:"flex items-center w-full gap-4",children:[e.jsx(qr,{type:d[i],className:"mx-2"}),e.jsx(Lt,{onChange:g=>{n(g)},value:s??"",placeholder:"eyJ0eXAi...",passwordToggleable:!0,className:"flex-grow"}),e.jsx(Bb,{})]}),i==="error"&&e.jsx("p",{className:"text-type-danger mt-4",children:t("fedapi.status.failure")}),i==="api_down"&&e.jsx("p",{className:"text-type-danger mt-4",children:t("fedapi.status.api_down","Febbox API is currently unavailable. Please try again later.")}),i==="invalid_token"&&e.jsx("p",{className:"text-type-danger mt-4",children:t("fedapi.status.invalid_token","Invalid token. Please check your Febbox UI token.")})]}):null]})}),e.jsx(Fs,{id:r.id,children:e.jsxs(An,{children:[e.jsx(Ce,{className:"!mt-0 !mb-4 !text-2xl",children:t("fedapi.setup.tokenExample.title")}),e.jsx(ye,{className:"!mt-1 !mb-6",children:t("fedapi.setup.tokenExample.description")}),e.jsx("div",{className:"bg-authentication-inputBg p-4 rounded-lg mb-6 font-mono text-sm break-all",children:"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDc1MTI2MTksIm5iZiI6MTc0NzUxMjYxOSwiZXhwIjoxNzc4NjE2NjM5LCJkYXRhIjp7InVpZCI6NTI1NTc3LCsudujeI6IjE4NTQ4NmEwMzBjMGNlMWJjY2IzYWJjMjI2OTYwYzQ4dhdhs.qkuTF2aVPu54S0RFJS_ca7rlHuGz_Fe6kWkBydYQoCg"}),e.jsx(ye,{className:"!mt-1 !mb-6 text-type-danger",children:t("fedapi.setup.tokenExample.warning")}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Z,{theme:"secondary",onClick:r.hide,children:t("fedapi.setup.tokenExample.close")})})]})})]})}function Bt(t){return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white mb-2 font-medium",children:t.title}),e.jsx("div",{className:"text-type-text",children:t.children})]})}function Wb(){const t=Qr(),s=Ke("skip"),n=Ke("info"),{completeAndRedirect:r}=Yr(),{t:a}=q(),o=Kt().length===0,i=typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/Edg/.test(navigator.userAgent);return e.jsxs(Qt,{children:[e.jsx(et,{subpage:!0,k:"global.pages.onboarding"}),e.jsx(Fs,{id:s.id,children:e.jsxs(An,{children:[e.jsx(wt,{className:"!mt-0 !mb-4 !text-2xl",children:a("onboarding.defaultConfirm.title")}),e.jsx(ye,{className:"!mt-1 !mb-12",children:a("onboarding.defaultConfirm.description")}),e.jsxs("div",{className:"flex flex-col-reverse gap-3 md:flex-row md:justify-between",children:[e.jsx(Z,{theme:"secondary",onClick:s.hide,children:a("onboarding.defaultConfirm.cancel")}),e.jsx(Z,{theme:"purple",onClick:()=>r(),children:a("onboarding.defaultConfirm.confirm")})]})]})}),e.jsxs(mr,{id:n.id,title:a("onboarding.start.moreInfo.title"),size:"xl",children:[e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.explainer.intro",className:"pb-4"}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row py-8",children:[e.jsxs("div",{className:"md:w-1/2",children:[e.jsx(Gt,{className:"font-normal",children:e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.recommended.title"})}),e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.recommended.subtitle"}),e.jsxs("div",{className:"space-y-4 pt-8 bg-mediaCard-hoverAccent/10 rounded-xl p-10 mt-6 mr-2 min-w-[20rem]",children:[e.jsx(Bt,{title:a("onboarding.start.moreInfo.recommended.desktop.title"),children:e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.recommended.desktop.description"})}),e.jsx(Bt,{title:a("onboarding.start.moreInfo.recommended.iOS.title"),children:e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.recommended.iOS.description"})}),e.jsx(Bt,{title:a("onboarding.start.moreInfo.recommended.android.title"),children:e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.recommended.android.description"})})]})]}),e.jsx("div",{className:"inline md:hidden",children:e.jsx(nt,{})}),e.jsxs("div",{children:[e.jsx(Ft,{items:[e.jsx(Bt,{title:a("onboarding.start.moreInfo.explainer.extension"),children:a("onboarding.start.moreInfo.explainer.extensionDescription")}),e.jsx(Bt,{title:a("onboarding.start.moreInfo.explainer.proxy"),children:a("onboarding.start.moreInfo.explainer.proxyDescription")}),e.jsx(Bt,{title:a("onboarding.start.moreInfo.explainer.default"),children:a("onboarding.start.moreInfo.explainer.defaultDescription")})].filter(Boolean)}),le().ALLOW_FEBBOX_KEY&&e.jsx("div",{className:"pt-12 pl-[3.2rem]",children:e.jsx(Bt,{title:a("onboarding.start.moreInfo.explainer.fedapi.fedapi"),children:a("onboarding.start.moreInfo.explainer.fedapi.fedapiDescription")})})]})]}),e.jsx("div",{children:e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.explainer.outro",children:e.jsx("a",{href:"https://discord.com/invite/7z6znYgrTG",target:"_blank",rel:"noopener noreferrer",className:"text-type-link"})})})]}),e.jsxs(Ur,{children:[e.jsx(Yt,{steps:2,current:1,className:"mb-12"}),e.jsx(Ce,{className:"!mt-0 !text-3xl",children:a("onboarding.start.title")}),e.jsxs(ye,{className:"max-w-[360px]",children:[a("onboarding.start.explainer"),e.jsxs("div",{className:"pt-4 flex cursor-pointer items-center text-type-link",onClick:()=>n.show(),children:[e.jsx(pe,{i18nKey:"onboarding.start.moreInfo.button"}),e.jsx(M,{className:"pl-2",icon:k.CIRCLE_QUESTION})]})]}),e.jsxs("div",{className:"hidden md:flex w-full flex-col md:flex-row gap-3 pb-6",children:[e.jsx(pt,{onClick:()=>t("/onboarding/extension"),className:"md:w-1/3",children:e.jsx(Kn,{colorClass:"!text-onboarding-best",title:a("onboarding.start.options.extension.title"),subtitle:a("onboarding.start.options.extension.quality"),description:a("onboarding.start.options.extension.description"),children:e.jsx(ft,{className:"!text-onboarding-best",children:a("onboarding.start.options.extension.action")})})}),e.jsxs("div",{className:"hidden md:grid grid-rows-[1fr,auto,1fr] justify-center gap-4",children:[e.jsx(Et,{className:"items-end"}),e.jsx("span",{className:"text-xs uppercase font-bold",children:a("onboarding.start.options.or")}),e.jsx(Et,{})]}),e.jsx(pt,{onClick:()=>t("/onboarding/proxy"),className:"md:w-1/3",children:e.jsx(Kn,{colorClass:"!text-onboarding-good",title:a("onboarding.start.options.proxy.title"),subtitle:a("onboarding.start.options.proxy.quality"),description:a("onboarding.start.options.proxy.description"),children:e.jsx(ft,{children:a("onboarding.start.options.proxy.action")})})}),o?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden md:grid grid-rows-[1fr,auto,1fr] justify-center gap-4",children:[e.jsx(Et,{className:"items-end"}),e.jsx("span",{className:"text-xs uppercase font-bold",children:a("onboarding.start.options.or")}),e.jsx(Et,{})]}),e.jsx(pt,{onClick:i?()=>r():s.show,className:"md:w-1/3",children:e.jsx(Kn,{colorClass:"!text-onboarding-bad",title:a("onboarding.defaultConfirm.confirm"),subtitle:"",description:a("onboarding.defaultConfirm.description"),children:e.jsx(pe,{i18nKey:"onboarding.start.options.default.text"})})})]})]}),e.jsxs("div",{className:"md:hidden flex w-full flex-col md:flex-row gap-3 pb-6",children:[e.jsx(pt,{onClick:()=>t("/onboarding/extension"),className:"md:w-1/3 md:h-full",children:e.jsx(zn,{colorClass:"!text-onboarding-best",title:a("onboarding.start.options.extension.title"),subtitle:a("onboarding.start.options.extension.quality"),description:a("onboarding.start.options.extension.description")})}),e.jsx(pt,{onClick:()=>t("/onboarding/proxy"),className:"md:w-1/3",children:e.jsx(zn,{colorClass:"!text-onboarding-good",title:a("onboarding.start.options.proxy.title"),subtitle:a("onboarding.start.options.proxy.quality"),description:a("onboarding.start.options.proxy.description")})}),o?null:e.jsx(pt,{onClick:i?()=>r():s.show,className:"md:w-1/3",children:e.jsx(zn,{colorClass:"!text-onboarding-bad",title:a("onboarding.defaultConfirm.confirm"),subtitle:"",description:a("onboarding.defaultConfirm.description")})})]}),e.jsx(Vb,{})]})]})}async function Kb(){const t=await Tr();return t?t.success?t.allowed?t.hasPermission?qo(t.version)?"success":"outdated":"noperms":"disallowed":"failed":"unknown"}function zb(){const{t}=q(),s=c.useCallback(()=>{window.location.reload()},[]);return e.jsx(pt,{className:"mt-4",children:e.jsxs("div",{className:"flex items-center space-x-7",children:[e.jsx("p",{className:"flex-1",children:t("onboarding.extension.notDetecting")}),e.jsx(Z,{theme:"secondary",onClick:s,children:t("onboarding.extension.notDetectingAction")})]})})}function Jr(t){const{t:s}=q(),[n,r]=c.useState(t.status);c.useEffect(()=>{t.loading||r(t.status)},[t.status,t.loading]);let a=null;return(t.loading||t.status==="unknown")&&(a=e.jsxs(e.Fragment,{children:[e.jsx(At,{}),e.jsx("p",{children:s("onboarding.extension.status.loading")})]})),t.status==="disallowed"||t.status==="noperms"?a=e.jsxs(e.Fragment,{children:[e.jsx("p",{children:s("onboarding.extension.status.disallowed")}),e.jsx(Z,{onClick:()=>{au({page:"PermissionGrant",redirectUrl:window.location.href})},theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:s("onboarding.extension.status.disallowedAction")})]}):t.status==="failed"?a=e.jsx("p",{children:s("onboarding.extension.status.failed")}):t.status==="outdated"?a=e.jsx("p",{children:s("onboarding.extension.status.outdated")}):t.status==="success"&&(a=e.jsxs("p",{className:"flex items-center",children:[e.jsx(M,{icon:k.CHECKMARK,className:"text-type-success mr-4"}),s("onboarding.extension.status.success")]})),e.jsxs(e.Fragment,{children:[e.jsx(pt,{children:e.jsx("div",{className:"flex py-6 flex-col space-y-2 items-center justify-center",children:a})}),n==="unknown"?e.jsx(zb,{}):null,t.showHelp&&t.status!=="success"?e.jsx(pt,{className:"mt-4",children:e.jsxs("div",{className:"flex items-center space-x-7",children:[e.jsx(M,{icon:k.WARNING,className:"text-type-danger text-2xl"}),e.jsx("p",{className:"flex-1",children:e.jsx(pe,{i18nKey:"onboarding.extension.extensionHelp",components:{bold:e.jsx("span",{className:"text-white"})}})})]})}):null]})}function Gb(t){const{t:s}=q(),n=le().ONBOARDING_CHROME_EXTENSION_INSTALL_LINK;return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"!mt-0 !text-3xl max-w-[435px]",children:s("onboarding.extension.title")}),e.jsx(ye,{className:"max-w-[320px] mb-4",children:s("onboarding.extension.explainer")}),n?e.jsx(ft,{href:n,target:"_blank",className:"mb-12",children:s("onboarding.extension.linkChrome")}):null,e.jsx(Jr,{status:t.status,loading:t.loading}),e.jsx(ft,{href:"https://github.com/p-stream/extension",target:"_blank",className:"pt-4 !text-type-dimmed",children:"See extension source code"})]})}function qb(t){const{t:s}=q(),n=le().ONBOARDING_FIREFOX_EXTENSION_INSTALL_LINK;return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"!mt-0 !text-3xl max-w-[435px]",children:s("onboarding.extension.title")}),e.jsx(ye,{className:"max-w-[320px] mb-4",children:s("onboarding.extension.explainer")}),n?e.jsx(ft,{href:n,target:"_blank",className:"mb-12",children:s("onboarding.extension.linkFirefox")}):null,e.jsx(Jr,{status:t.status,loading:t.loading,showHelp:!0}),e.jsx(ft,{href:"https://github.com/p-stream/extension",target:"_blank",className:"pt-4 !text-type-dimmed",children:"See extension source code"})]})}function Yb(t){const{t:s}=q();return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"!mt-0 !text-3xl max-w-[435px]",children:s("onboarding.extension.title")}),e.jsx(ye,{className:"max-w-[320px] mb-4",children:e.jsx(pe,{i18nKey:"onboarding.extension.explainerIos",components:{bold:e.jsx("span",{className:"text-white font-bold"})}})})]})}function Qb(t){const{t:s}=q(),n=le().ONBOARDING_CHROME_EXTENSION_INSTALL_LINK,r=le().ONBOARDING_FIREFOX_EXTENSION_INSTALL_LINK;return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"!mt-0 !text-3xl max-w-[435px]",children:s("onboarding.extension.title")}),e.jsx(ye,{className:"max-w-[320px] mb-4",children:s("onboarding.extension.explainer")}),e.jsx("div",{className:"mb-4",children:n?e.jsx(ft,{href:n,target:"_blank",children:s("onboarding.extension.linkChrome")}):null}),e.jsx("div",{className:"mb-12",children:r?e.jsx(ft,{href:r,target:"_blank",children:s("onboarding.extension.linkFirefox")}):null}),e.jsx(Jr,{status:t.status,loading:t.loading,showHelp:!0}),e.jsx(ft,{href:"https://github.com/p-stream/extension",target:"_blank",className:"pt-4 !text-type-dimmed",children:"See extension source code"})]})}function Xb(){const{t}=q(),s=Qr(),{completeAndRedirect:n}=Yr(),r=c.useMemo(()=>Kf(),[]),[{loading:a,value:o},i]=rt(async(m=!1)=>{const u=await Kb();return u==="success"&&m&&n(),u},[n]);Sr(i,1e3);const d={chrome:Gb,firefox:qb,ios:Yb,unknown:Qb}[r];return e.jsxs(Qt,{children:[e.jsx(et,{subpage:!0,k:"global.pages.onboarding"}),e.jsxs(Hs,{children:[e.jsx(Yt,{steps:2,current:2,className:"mb-12"}),e.jsx(d,{loading:a,status:o??"unknown"}),e.jsxs("div",{className:"flex justify-between items-center mt-8",children:[e.jsx(Z,{onClick:()=>s("/onboarding"),theme:"secondary",children:t("onboarding.extension.back")}),o==="success"?e.jsx(Z,{onClick:()=>i(!0),theme:"purple",children:t("onboarding.extension.submit")}):null]})]})]})}function Jb(t){return e.jsxs("p",{className:z("inline-flex items-center text-type-danger",t.className),children:[e.jsx(M,{icon:k.WARNING,className:"text-xl mr-4"}),t.children]})}const fo="https://postman-echo.com/get";function Zb(){const{t}=q(),s=Qr(),{completeAndRedirect:n}=Yr(),[r,a]=c.useState(""),o=he(g=>g.setProxySet),i=le().ONBOARDING_PROXY_INSTALL_LINK,l=He(),d=he(g=>g.account),[{loading:m,error:u},p]=rt(async()=>{if(!r.startsWith("http"))throw new Error("onboarding.proxy.input.errorInvalidUrl");try{if((await Cn(r,fo,{})).url!==fo)throw new Error("onboarding.proxy.input.errorNotProxy");o([r]),d&&l&&await Br(l,d,{proxyUrls:[r]}),n()}catch{throw new Error("onboarding.proxy.input.errorConnection")}},[r,n,o]);return e.jsxs(Qt,{children:[e.jsx(et,{subpage:!0,k:"global.pages.onboarding"}),e.jsxs(Hs,{children:[e.jsx(Yt,{steps:2,current:2,className:"mb-12"}),e.jsx(Ce,{className:"!mt-0 !text-3xl max-w-[435px]",children:t("onboarding.proxy.title")}),e.jsx(ye,{className:"max-w-[320px] !mb-5",children:t("onboarding.proxy.explainer")}),i?e.jsx(ft,{href:i,target:"_blank",className:"mb-12",children:t("onboarding.proxy.link")}):null,e.jsxs("div",{className:"w-[400px] max-w-full  mt-14 mb-28",children:[e.jsx(Lt,{label:t("onboarding.proxy.input.label"),value:r,onChange:a,placeholder:t("onboarding.proxy.input.placeholder"),className:"mb-4"}),u?e.jsx(Jb,{children:t(u.message)}):null]}),e.jsx(nt,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Z,{theme:"secondary",onClick:()=>s("/onboarding"),children:t("onboarding.proxy.back")}),e.jsx(Z,{theme:"purple",loading:m,onClick:p,children:t("onboarding.proxy.submit")})]})]})]})}const an=["#0A54FF","#CF2E68","#F9DD7F","#7652DD","#2ECFA8"],po=an[0],ey=function(s){return e.jsxs("div",{className:"space-y-3",children:[s.label?e.jsx("p",{className:"font-bold text-white",children:s.label}):null,e.jsxs("div",{className:"flex gap-3",children:[an.map(n=>e.jsx("button",{type:"button",tabIndex:0,className:z("w-full h-10 rounded flex justify-center items-center text-white pointer border-2 border-opacity-10 cursor-pointer",s.value===n?"border-white":"border-transparent"),onClick:()=>s.onInput(n),style:{backgroundColor:n},children:s.value===n?e.jsx(M,{icon:k.CHECKMARK}):null},n)),e.jsxs("div",{className:"relative w-full h-10",children:[e.jsx("input",{type:"color",value:s.value,onChange:n=>s.onInput(n.target.value),className:"absolute opacity-0 cursor-pointer w-full h-10"}),e.jsx("button",{type:"button",tabIndex:0,className:z("w-full h-10 rounded flex justify-center items-center text-white pointer border-2 border-opacity-10 cursor-pointer",an.includes(s.value)?"border-transparent":"border-white"),style:{backgroundColor:an.includes(s.value)?"#333":s.value},children:e.jsx(M,{icon:k.BRUSH})})]})]})]})},xo=ey,Sl=[ke.CAT,ke.WEED,ke.USER_GROUP,ke.COUCH,ke.MOBILE,ke.TICKET,ke.SATURN,ke.HEADPHONES,ke.TV,ke.GHOST,ke.COFFEE,ke.FIRE,ke.MEGAPHONE,ke.DRAGON,ke.RISING_STAR,ke.CLOUD_ARROW_UP,ke.WAND,ke.CLAPPER_BOARD],ty=Sl[0],sy=function(s){return e.jsxs("div",{className:"space-y-3",children:[s.label?e.jsx("p",{className:"font-bold text-white",children:s.label}):null,e.jsx("div",{className:"grid grid-cols-6 gap-3",children:Sl.map(n=>e.jsx("button",{type:"button",tabIndex:0,className:z("w-full h-10 rounded flex justify-center items-center text-white pointer border-2 border-opacity-10 cursor-pointer",s.value===n?"bg-buttons-purple border-white":"bg-authentication-inputBg border-transparent"),onClick:()=>s.onInput(n),children:e.jsx(xt,{className:"text-xl",icon:n})},n))})]})},ny=sy;function ry(t){const[s,n]=c.useState(""),[r,a]=c.useState(po),[o,i]=c.useState(po),[l,d]=c.useState(ty),{t:m}=q(),[u,p]=c.useState(!1),g=c.useCallback(()=>{var x;p(!1);const h=s.trim();if(h.length===0){p(!0);return}(x=t.onNext)==null||x.call(t,{device:h,profile:{colorA:r,colorB:o,icon:l}})},[s,t,r,o,l]);return e.jsxs(zs,{children:[e.jsx(Gs,{icon:e.jsx(Ti,{profile:{colorA:r,colorB:o,icon:l},iconClass:"text-3xl",sizeClass:"w-16 h-16"}),title:m("auth.register.information.title")??void 0,children:m("auth.register.information.header")}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Lt,{label:m("auth.deviceNameLabel")??void 0,value:s,onChange:n,placeholder:m("auth.deviceNamePlaceholder")??void 0}),e.jsx(xo,{label:m("auth.register.information.color1"),value:r,onInput:a}),e.jsx(xo,{label:m("auth.register.information.color2"),value:o,onInput:i}),e.jsx(ny,{label:m("auth.register.information.icon"),value:l,onInput:d}),u?e.jsx("p",{className:"text-authentication-errorText",children:m("auth.login.deviceLengthError")}):null]}),e.jsx(ps,{children:e.jsx(Z,{theme:"purple",onClick:()=>g(),children:m("auth.register.information.next")})})]})}const ay=function(s){const{t:n}=q(),r=s.mnemonic.split(" "),[,a]=Cr(),[o,i]=c.useState(!1),[l,d]=c.useState(!1),[m,u]=c.useState(""),[p,g]=c.useState(!1),[h,x]=c.useState(""),y=Uo(),f=c.useRef(),b=/^[a-zA-Z0-9\s\-_.,!?@#$%^&*()+=:;"'<>[\]{}|\\/`~]+$/;function v(){a(s.mnemonic),i(!0),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>y()&&i(!1),500)}function w(N){N.key==="Shift"&&g(!0)}function R(N){N.key==="Shift"&&g(!1)}function P(N){return N.length<8?(x(n("auth.generate.passphraseTooShort")),!1):b.test(N)?(x(""),!0):(x(n("auth.generate.invalidPassphraseCharacters")),!1)}function O(N){u(N),h&&x("")}function U(){var N;m.trim()&&P(m.trim())&&((N=s.onCustomPassphrase)==null||N.call(s,m.trim()),d(!1),u(""),x(""))}function D(){d(!1),u(""),x("")}function S(){d(!0)}return c.useEffect(()=>(document.addEventListener("keydown",w),document.addEventListener("keyup",R),()=>{document.removeEventListener("keydown",w),document.removeEventListener("keyup",R)}),[]),l?e.jsxs("div",{className:"rounded-lg border border-authentication-border/50",children:[e.jsxs("div",{className:"px-4 py-2 flex justify-between border-b border-authentication-border/50",children:[e.jsx("p",{className:"font-bold text-sm text-white",children:n("auth.generate.customPassphraseLabel")}),e.jsxs("button",{type:"button",className:"text-authentication-copyText hover:text-authentication-copyTextHover transition-colors flex gap-2 items-center cursor-pointer",onClick:D,children:[e.jsx(M,{icon:k.X,className:"text-xs"}),e.jsx("span",{className:"text-sm",children:n("actions.cancel")})]})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsx(Lt,{value:m,onChange:O,placeholder:n("auth.generate.customPassphrasePlaceholder"),passwordToggleable:!0,className:"mb-4"}),h&&e.jsx("p",{className:"text-authentication-errorText text-sm mb-4",children:h}),e.jsx("button",{type:"button",className:"w-full bg-authentication-inputBg hover:bg-authentication-inputBg/80 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",onClick:U,disabled:!m.trim()||!!h,children:n("auth.generate.useCustomPassphrase")})]})]}):e.jsxs("div",{className:"rounded-lg border border-authentication-border/50 relative",children:[e.jsxs("div",{className:"px-4 py-2 flex justify-between border-b border-authentication-border/50",children:[e.jsx("p",{className:"font-bold text-sm text-white",children:n("auth.generate.passphraseFrameLabel")}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{type:"button",className:`text-authentication-copyText hover:text-authentication-copyTextHover transition-all duration-200 flex gap-2 pr-2 items-center cursor-pointer ${p?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,onClick:S,title:n("auth.generate.useCustomPassphrase"),children:[e.jsx(M,{icon:k.EDIT,className:"text-xs"}),e.jsx("span",{className:"text-sm",children:n("auth.generate.custom")})]}),e.jsxs("button",{type:"button",className:"text-authentication-copyText hover:text-authentication-copyTextHover transition-colors flex gap-2 items-center cursor-pointer",onClick:v,children:[e.jsx(M,{icon:o?k.CHECKMARK:k.COPY,className:o?"text-xs":""}),e.jsx("span",{className:"text-sm",children:n("actions.copy")})]})]})]}),e.jsx("div",{className:"px-4 py-4 grid grid-cols-3 text-sm sm:text-base sm:grid-cols-4 gap-2",children:r.map((N,C)=>e.jsx("div",{className:"rounded-md py-2 bg-authentication-wordBackground text-white font-medium text-center",children:N},C))})]})},oy=ay;function iy(t){const[s,n]=c.useState(()=>Yu()),{t:r}=q(),a=c.useCallback(o=>{n(o)},[]);return e.jsxs(zs,{children:[e.jsx(Gs,{title:r("auth.generate.title"),icon:e.jsx(M,{icon:k.USER}),children:e.jsx(pe,{i18nKey:"auth.generate.description",components:{bold:e.jsx("span",{className:"font-bold",style:{color:"#cfcfcf"}})}})}),e.jsx(oy,{mnemonic:s,onCustomPassphrase:a}),e.jsx(ps,{children:e.jsx(Z,{theme:"purple",onClick:()=>{var o;return(o=t.onNext)==null?void 0:o.call(t,s)},children:r("auth.generate.next")})})]})}function ly(t){const s=be(),n=He(),r=c.useMemo(()=>n?new URL(n).hostname:void 0,[n]),a=Dt(()=>n?yn(n):Promise.resolve(null),[n]),{t:o}=q();let i=e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:o("auth.trust.failed.title")}),e.jsx("p",{children:o("auth.trust.failed.text")})]});return a.loading&&(i=e.jsx(At,{})),a.value&&(i=e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:a.value.name}),a.value.description?e.jsx("p",{className:"text-center",children:a.value.description}):null]})),e.jsxs(zs,{children:[e.jsx(Gs,{title:o(r?"auth.trust.title":"auth.trust.noHostTitle"),icon:e.jsx(M,{icon:k.CIRCLE_EXCLAMATION}),children:r?e.jsx(pe,{i18nKey:"auth.trust.host",values:{hostname:r},children:e.jsx("span",{className:"text-white"})}):e.jsx("p",{children:o("auth.trust.noHost")})}),r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-authentication-border rounded-xl px-4 py-8 flex flex-col items-center space-y-2 my-8",children:i}),e.jsxs(ps,{children:[e.jsx(Z,{theme:"secondary",onClick:()=>s("/"),children:o("auth.trust.no")}),e.jsx(Z,{theme:"purple",onClick:()=>{var l;return a.value&&((l=t.onNext)==null?void 0:l.call(t,a.value))},children:o("auth.trust.yes")})]}),e.jsx("p",{className:"text-center mt-6",children:e.jsx(pe,{i18nKey:"auth.hasAccount",children:e.jsx(Vs,{to:"/login",children:"."})})})]}):e.jsx(ps,{children:e.jsx(Z,{theme:"purple",onClick:()=>s("/"),children:o("auth.trust.no")})})]})}function cy(t){const[s,n]=c.useState(""),{register:r,restore:a,importData:o}=Mt(),i=je(b=>b.items),l=me(b=>b.bookmarks),d=ze(b=>b.language),m=Te(b=>b.lastSelectedLanguage),u=Fr(b=>b.theme),p=J(b=>({enableThumbnails:b.enableThumbnails,enableAutoplay:b.enableAutoplay,enableSkipCredits:b.enableSkipCredits,enableDiscover:b.enableDiscover,enableFeatured:b.enableFeatured,enableDetailsModal:b.enableDetailsModal,enableImageLogos:b.enableImageLogos,enableCarouselView:b.enableCarouselView,forceCompactEpisodeView:b.forceCompactEpisodeView,sourceOrder:b.sourceOrder,enableSourceOrder:b.enableSourceOrder,disabledSources:b.disabledSources,embedOrder:b.embedOrder,enableEmbedOrder:b.enableEmbedOrder,disabledEmbeds:b.disabledEmbeds,proxyTmdb:b.proxyTmdb,febboxKey:b.febboxKey,realDebridKey:b.realDebridKey,enableLowPerformanceMode:b.enableLowPerformanceMode,enableNativeSubtitles:b.enableNativeSubtitles,enableHoldToBoost:b.enableHoldToBoost,homeSectionOrder:b.homeSectionOrder,enableDoubleClickToSeek:b.enableDoubleClickToSeek,manualSourceSelection:b.manualSourceSelection})),g=He(),{t:h}=q(),{executeRecaptcha:x}=td(),[y,f]=rt(async b=>{var R;if(!g)throw new Error(h("auth.verify.noBackendUrl")??void 0);if(!t.mnemonic||!t.userData)throw new Error(h("auth.verify.invalidData")??void 0);let v;if(t.hasCaptcha&&(v=x?await x():void 0,!v))throw new Error(h("auth.verify.recaptchaFailed")??void 0);if(b!==t.mnemonic)throw new Error(h("auth.verify.noMatch")??void 0);const w=await r({mnemonic:b,userData:t.userData,recaptchaToken:v});if(!w)throw new Error(h("auth.verify.registrationFailed")??void 0);await o(w,i,l),await Br(g,w,{applicationLanguage:d,defaultSubtitleLanguage:m??void 0,applicationTheme:u??void 0,proxyUrls:void 0,...p}),await a(w),(R=t.onNext)==null||R.call(t)},[t,r,a]);return e.jsx(zs,{children:e.jsxs("form",{children:[e.jsx(Gs,{icon:e.jsx(M,{icon:k.CIRCLE_CHECK}),title:h("auth.verify.title"),children:h("auth.verify.description")}),e.jsx(Lt,{label:h("auth.verify.passphraseLabel")??void 0,autoComplete:"username",name:"username",value:s,onChange:n,passwordToggleable:!0}),y.error?e.jsx("p",{className:"mt-3 text-authentication-errorText",children:y.error.message}):null,e.jsx(ps,{children:e.jsx(Z,{theme:"purple",loading:y.loading,onClick:()=>f(s),children:h("auth.verify.register")})})]})})}function dy(t){return t.siteKey?e.jsx(sd,{reCaptchaKey:t.siteKey,children:t.children}):t.children}function uy(){const t=be(),[s,n]=c.useState(0),[r,a]=c.useState(null),[o,i]=c.useState(null),[l,d]=c.useState(null);return e.jsx(dy,{siteKey:l,children:e.jsxs(st,{children:[e.jsx(et,{subpage:!0,k:"global.pages.register"}),s===0?e.jsx(ly,{onNext:m=>{d(m.hasCaptcha&&m.captchaClientKey?m.captchaClientKey:null),n(1)}}):null,s===1?e.jsx(iy,{onNext:m=>{a(m),n(2)}}):null,s===2?e.jsx(ry,{onNext:m=>{i(m),n(3)}}):null,s===3?e.jsx(cy,{hasCaptcha:!!l,mnemonic:r,userData:o,onNext:()=>{t("/")}}):null]})})}const my=function(s){return e.jsx("ol",{children:s.items.map((n,r)=>e.jsxs("li",{className:z("grid grid-cols-[auto,1fr] gap-6",r!==s.items.length-1?"pb-12":void 0),children:[e.jsxs("div",{className:"relative z-0",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-about-circle text-about-circleText font-medium flex justify-center items-center relative z-10"}),r!==s.items.length-1?e.jsx("div",{className:"h-[calc(100%+1.5rem)] w-px absolute top-6 left-1/2 transform -translate-x-1/2",style:{backgroundImage:"linear-gradient(to bottom, transparent 5px, #1F1F29 5px, #1F1F29 10px)",backgroundSize:"10px 10px",backgroundRepeat:"Repeat"}}):null]}),e.jsx("div",{children:n})]}))})},hy=my;function fy(t){return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white mb-2 font-medium",children:t.title}),e.jsx("div",{className:"text-type-text",children:t.children})]})}function py(){const{t}=q();return e.jsxs(st,{children:[e.jsx(et,{subpage:!0,k:"global.pages.support"}),e.jsxs(Us,{children:[e.jsx(wt,{children:t("support.title")}),e.jsx(ye,{children:e.jsx(pe,{i18nKey:"support.text",components:{bold:e.jsx("span",{className:"font-bold",style:{color:"#cfcfcf"}})}})}),e.jsx(hy,{items:[e.jsx(fy,{title:t("support.q1.title"),children:e.jsx(pe,{i18nKey:"support.q1.body",children:e.jsx(Vs,{to:le().DISCORD_LINK})})})]})]})]})}function xy(t){const s=Mn(),n=Qe(r=>r.location);return e.jsxs("div",{children:[e.jsx("div",{className:"fixed inset-x-0 z-[1000]",children:e.jsx(fl,{})}),e.jsx("div",{style:{paddingTop:n===null?`${s}px`:"0px"},className:"flex min-h-screen flex-col",children:t.children})]})}const Cl=Ae(Oe(t=>({routes:[],registerRoute(s){t(n=>{n.routes.push(s)})}})));function gy(){const t=xs(),s=Cl(n=>n.registerRoute);c.useEffect(()=>{s({path:t.pathname})},[t.pathname,s]),$o(()=>{s({path:t.pathname})})}function rv(){const t=Cl(r=>r.routes),s=xs();return c.useMemo(()=>{const r=[...t];r.reverse();const a=r.find(o=>!o.path.startsWith("/media")&&s.pathname!==o.path&&!o.path.startsWith("/s/")&&!o.path.startsWith("/onboarding"));return(a==null?void 0:a.path)??"/"},[t,s])}const by=c.lazy(()=>$s(()=>import("./DeveloperPage-BMGO60jF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));c.lazy(()=>$s(()=>import("./TestView-BxxXwwET.js"),__vite__mapDeps([10,1,2,3,8,5,6,7,4,9])));const kr=No(()=>$s(()=>import("./PlayerView-D7c7UoO3.js"),__vite__mapDeps([11,1,2,3,5,6,7,4,8,9]))),El=No(()=>$s(()=>import("./Settings-DddXXiO9.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,9,8])));kr.preload();El.preload();function go({children:t}){const s=xs(),n=be();return c.useEffect(()=>{const r=s.pathname;cr(r)&&Lu(s.pathname).then(a=>{n(a??"/",{replace:!0})})},[s.pathname,n]),cr(s.pathname)?null:t}function yy(){const{query:t}=vn(),s=be();return c.useEffect(()=>{t?Cu(t).then(n=>{s(n??"/",{replace:!0})}):s("/",{replace:!0})},[t,s]),null}function vy(){const{query:t}=vn(),s=be();return c.useEffect(()=>{t?s(`/browse/${t}`,{replace:!0}):s("/",{replace:!0})},[t,s]),null}const wy="March 31th 11:00 PM - 5:00 AM EST";function jy(){gy(),xh(),ph();const t=!1,[s,n]=c.useState(t),r=()=>{n(!1)};return c.useEffect(()=>{sessionStorage.getItem("downtimeToken")},[n,t]),e.jsxs(xy,{children:[e.jsx(Hd,{}),e.jsx(oh,{id:"notifications"}),!s&&e.jsxs(Wl,{children:[e.jsx(ve,{path:"/s/:query",element:e.jsx(yy,{})}),e.jsx(ve,{path:"/search/:type",element:e.jsx(Kl,{to:"/browse"})}),e.jsx(ve,{path:"/search/:type/:query?",element:e.jsx(vy,{})}),e.jsx(ve,{path:"/media/:media",element:e.jsx(go,{children:e.jsx(c.Suspense,{fallback:null,children:e.jsx(kr,{})})})}),e.jsx(ve,{path:"/media/:media/:season/:episode",element:e.jsx(go,{children:e.jsx(c.Suspense,{fallback:null,children:e.jsx(kr,{})})})}),e.jsx(ve,{path:"/browse/:query?",element:e.jsx(uo,{})}),e.jsx(ve,{path:"/",element:e.jsx(uo,{})}),e.jsx(ve,{path:"/register",element:e.jsx(uy,{})}),e.jsx(ve,{path:"/login",element:e.jsx(Eb,{})}),e.jsx(ve,{path:"/about",element:e.jsx(yh,{})}),e.jsx(ve,{path:"/onboarding",element:e.jsx(Wb,{})}),e.jsx(ve,{path:"/onboarding/extension",element:e.jsx(Xb,{})}),e.jsx(ve,{path:"/onboarding/proxy",element:e.jsx(Zb,{})}),e.jsx(ve,{path:"/migration",element:e.jsx(Tb,{})}),e.jsx(ve,{path:"/migration/direct",element:e.jsx(Pb,{})}),e.jsx(ve,{path:"/migration/download",element:e.jsx(Lb,{})}),e.jsx(ve,{path:"/migration/upload",element:e.jsx(Db,{})}),Ei()?e.jsx(ve,{path:"/legal",element:e.jsx(zm,{})}):null,e.jsx(ve,{path:"/support",element:e.jsx(py,{})}),e.jsx(ve,{path:"/jip",element:e.jsx(Sb,{})}),e.jsx(ve,{path:"/discover",element:e.jsx(nb,{})}),e.jsx(ve,{path:"/discover/more/:contentType/:mediaType",element:e.jsx(er,{})}),e.jsx(ve,{path:"/discover/more/:contentType/:id/:mediaType",element:e.jsx(er,{})}),e.jsx(ve,{path:"/discover/more/:category",element:e.jsx(er,{})}),e.jsx(ve,{path:"/discover/all",element:e.jsx(qg,{})}),e.jsx(ve,{path:"/bookmarks",element:e.jsx(Pf,{})}),e.jsx(ve,{path:"/settings",element:e.jsx(c.Suspense,{fallback:null,children:e.jsx(El,{})})}),e.jsx(ve,{path:"/admin",element:e.jsx(Lh,{})}),e.jsx(ve,{path:"/dev",element:e.jsx(by,{})}),e.jsx(ve,{path:"/dev/video",element:e.jsx(Hg,{})}),null,e.jsx(ve,{path:"*",element:e.jsx(ob,{})})]}),s&&e.jsx(rb,{onHomeButtonClick:r})]})}const ky=5*1e3;async function Ny(t,s,n,r){for(const a of t)if(s(a.id),!!r)try{if(a.action==="delete"){await zu(n,r,a.tmdbId);continue}if(a.action==="add"){await Ku(n,r,{meta:{poster:a.poster,title:a.title??"",type:a.type??"",year:a.year??NaN},tmdbId:a.tmdbId,group:a.group,favoriteEpisodes:a.favoriteEpisodes});continue}}catch(o){console.error(`Failed to sync bookmark: ${a.tmdbId} - ${a.action}`,o)}}function Sy(){const t=me(r=>r.clearUpdateQueue),s=me(r=>r.removeUpdateItem),n=He();return c.useEffect(()=>{t()},[t]),c.useEffect(()=>{const r=setInterval(()=>{(async()=>{if(!n)return;const a=me.getState(),o=he.getState();await Ny(a.updateQueue,s,n,o.account)})()},ky);return()=>{clearInterval(r)}},[s,n]),null}const Cy=5*1e3;function Ey(){const t=He(),s=Je(a=>a.groupOrder),n=c.useRef([]),r=c.useRef(!1);return c.useEffect(()=>{r.current||(n.current=[...s],r.current=!0)},[s]),c.useEffect(()=>{const a=setInterval(()=>{(async()=>{if(!t)return;const o=he.getState();if(!o.account)return;const i=Je.getState().groupOrder;if(JSON.stringify(i)!==JSON.stringify(n.current))try{await fi(t,o.account,i),n.current=[...i]}catch(d){console.error("Failed to sync group order:",d)}})()},Cy);return()=>{clearInterval(a)}},[t]),null}const Iy=5*1e3;async function Ty(t,s,n,r){for(const a of t)if(s(a.id),!!r)try{if(a.action==="delete"){await tm(n,r,a.tmdbId,a.seasonId,a.episodeId);continue}if(a.action==="upsert"){await em(n,r,Zu(a));continue}}catch(o){console.error(`Failed to sync progress: ${a.tmdbId} - ${a.action}`,o)}}function Ry(){const t=je(r=>r.clearUpdateQueue),s=je(r=>r.removeUpdateItem),n=He();return c.useEffect(()=>{t()},[t]),c.useEffect(()=>{const r=setInterval(()=>{(async()=>{if(!n)return;const a=je.getState(),o=he.getState();await Ty(a.updateQueue,s,n,o.account)})()},Iy);return()=>{clearInterval(r)}},[s,n]),null}const Py=5*1e3;function Ly(){const t=Te(n=>n.importSubtitleLanguage),s=He();return c.useEffect(()=>{const n=setInterval(()=>{(async()=>{if(!s)return;const r=Te.getState(),a=he.getState();r.lastSync.lastSelectedLanguage!==r.lastSelectedLanguage&&a.account&&r.lastSelectedLanguage&&(await Br(s,a.account,{defaultSubtitleLanguage:r.lastSelectedLanguage}),t(r.lastSelectedLanguage))})()},Py);return()=>{clearInterval(n)}},[t,s]),null}_x();function Zr(t){const s={user:"screens.loadingUser",lazy:"screens.loadingApp"},{t:n}=q();return e.jsx(_i,{iconSlot:e.jsx(At,{}),children:n(s[t.type]??"unknown.translation")})}function ea(t){const{t:s}=q(),{logout:n}=Mt(),r=he(i=>i.setBackendUrl),a=c.useCallback(()=>{r(null),location.reload()},[r]),o=c.useCallback(()=>{n().then(()=>{location.reload()})},[n]);return e.jsxs(_i,{iconSlot:e.jsx(M,{className:"text-type-danger text-2xl",icon:k.WARNING}),children:[t.children,t.showResetButton?e.jsx("div",{className:"mt-6",children:e.jsx(Z,{theme:"secondary",onClick:a,children:s("screens.loadingUserError.reset")})}):null,t.showLogoutButton?e.jsx("div",{className:"mt-6",children:e.jsx(Z,{theme:"secondary",onClick:o,children:s("screens.loadingUserError.logout")})}):null,t.showReloadButton?e.jsx("div",{className:"mt-6",children:e.jsx(Z,{theme:"secondary",onClick:()=>window.location.reload(),children:s("screens.loadingUserError.reload")})}):null]})}function Dy(){const t=hm(),s=le().BACKEND_URL,n=He(),{t:r}=q(),a=s!==n;return t.loading?e.jsx(Zr,{type:"user"}):t.error?e.jsx(ea,{showResetButton:a,showLogoutButton:!a,showReloadButton:!a,children:r(a?"screens.loadingUserError.textWithReset":"screens.loadingUserError.text")}):e.jsx(jy,{})}function Ay(){const t=Dt(async()=>{Ko(ze.getState().language),await ud();const n=await Ob();Xr.getState().setRegion(n)},[]),{t:s}=q();return t.loading?e.jsx(fh,{}):t.error?e.jsx(ea,{children:s("screens.migration.failed")}):e.jsx(Dy,{})}function My(t){return le().NORMAL_ROUTER?e.jsx(rd,{children:t.children}):e.jsx(ad,{children:t.children})}function _y(){const{t}=q(),[s]=rt(async()=>{if(!Xe)return Tr()});return s.loading?e.jsx(Zr,{type:"lazy"}):s.error?e.jsx(ea,{children:t("screens.loadingUserError.reload")}):null}const Oy=document.getElementById("root"),By=nd(Oy);By.render(e.jsx(c.StrictMode,{children:e.jsx(Km,{children:e.jsx(zl,{children:e.jsxs(c.Suspense,{fallback:e.jsx(Zr,{type:"lazy"}),children:[e.jsx(_y,{}),e.jsxs(um,{applyGlobal:!0,children:[e.jsx(Ry,{}),e.jsx(Sy,{}),e.jsx(Ey,{}),e.jsx(Ly,{}),e.jsx(My,{children:e.jsx(Ay,{})})]})]})})})}));export{sm as $,Sn as A,Z as B,he as C,$r as D,Ln as E,Xi as F,Ws as G,rv as H,Tn as I,Re as J,we as K,At as L,ge as M,_n as N,br as O,Vf as P,xr as Q,$g as R,vs as S,Us as T,tv as U,Wf as V,dm as W,hi as X,In as Y,Ce as Z,He as _,ms as a,Wt as a0,wi as a1,ev as a2,sv as a3,Gt as a4,Fs as a5,An as a6,ye as a7,Ti as a8,xo as a9,Xy as aA,Fr as aB,ze as aC,Br as aD,ur as aE,Jy as aF,Zy as aG,st as aH,et as aI,nm as aJ,lt as aK,Oi as aL,ny as aa,Mt as ab,Lt as ac,wt as ad,ct as ae,Tf as af,Te as ag,Zn as ah,Pt as ai,Kp as aj,Up as ak,Se as al,xg as am,nv as an,Vs as ao,nt as ap,qr as aq,Bb as ar,$b as as,Nl as at,jt as au,yn as av,Gy as aw,ll as ax,Ih as ay,Rh as az,Ls as b,us as c,Qy as d,Tr as e,Yy as f,Ar as g,Pn as h,qo as i,au as j,le as k,je as l,wx as m,Ke as n,Ab as o,J as p,su as q,Kb as r,qy as s,Vm as t,E as u,Xe as v,Ut as w,Y as x,pp as y,fp as z};
